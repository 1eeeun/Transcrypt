/*
 Fabric.js Copyright 2008-2015, Printio (Juriy Zaytsev, Maxim Chernyak) */
'use strict';var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(p,w,u){p!=Array.prototype&&p!=Object.prototype&&(p[w]=u.value)};$jscomp.getGlobal=function(p){return"undefined"!=typeof window&&window===p?p:"undefined"!=typeof global&&null!=global?global:p};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.symbolCounter_=0;$jscomp.Symbol=function(p){return $jscomp.SYMBOL_PREFIX+(p||"")+$jscomp.symbolCounter_++};
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var p=$jscomp.global.Symbol.iterator;p||(p=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[p]&&$jscomp.defineProperty(Array.prototype,p,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(p){var w=0;return $jscomp.iteratorPrototype(function(){return w<p.length?{done:!1,value:p[w++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(p){$jscomp.initSymbolIterator();p={next:p};p[$jscomp.global.Symbol.iterator]=function(){return this};return p};$jscomp.makeIterator=function(p){$jscomp.initSymbolIterator();$jscomp.initSymbol();$jscomp.initSymbolIterator();var w=p[Symbol.iterator];return w?w.call(p):$jscomp.arrayIterator(p)};$jscomp.arrayFromIterator=function(p){for(var w,u=[];!(w=p.next()).done;)u.push(w.value);return u};$jscomp.arrayFromIterable=function(p){return p instanceof Array?p:$jscomp.arrayFromIterator($jscomp.makeIterator(p))};
$jscomp.polyfill=function(p,w,u,y){if(w){u=$jscomp.global;p=p.split(".");for(y=0;y<p.length-1;y++){var L=p[y];L in u||(u[L]={});u=u[L]}p=p[p.length-1];y=u[p];w=w(y);w!=y&&null!=w&&$jscomp.defineProperty(u,p,{configurable:!0,writable:!0,value:w})}};$jscomp.polyfill("Object.getOwnPropertySymbols",function(p){return p?p:function(){return[]}},"es6","es5");
$jscomp.checkStringArgs=function(p,w,u){if(null==p)throw new TypeError("The 'this' value for String.prototype."+u+" must not be null or undefined");if(w instanceof RegExp)throw new TypeError("First argument to String.prototype."+u+" must not be a regular expression");return p+""};
$jscomp.polyfill("String.prototype.startsWith",function(p){return p?p:function(p,u){var w=$jscomp.checkStringArgs(this,p,"startsWith");p+="";var L=w.length,M=p.length;u=Math.max(0,Math.min(u|0,w.length));for(var D=0;D<M&&u<L;)if(w[u++]!=p[D++])return!1;return D>=M}},"es6","es3");$jscomp.polyfill("Number.isFinite",function(p){return p?p:function(p){return"number"!==typeof p?!1:!isNaN(p)&&Infinity!==p&&-Infinity!==p}},"es6","es3");
$jscomp.polyfill("Number.isInteger",function(p){return p?p:function(p){return Number.isFinite(p)?p===Math.floor(p):!1}},"es6","es3");$jscomp.polyfill("Array.from",function(p){return p?p:function(p,u,y){$jscomp.initSymbolIterator();u=null!=u?u:function(p){return p};var w=[],M=p[Symbol.iterator];if("function"==typeof M)for(p=M.call(p);!(M=p.next()).done;)w.push(u.call(y,M.value));else{M=p.length;for(var D=0;D<M;D++)w.push(u.call(y,p[D]))}return w}},"es6","es3");
$jscomp.iteratorFromArray=function(p,w){$jscomp.initSymbolIterator();p instanceof String&&(p+="");var u=0,y={next:function(){if(u<p.length){var L=u++;return{value:w(L,p[L]),done:!1}}y.next=function(){return{done:!0,value:void 0}};return y.next()}};y[Symbol.iterator]=function(){return y};return y};$jscomp.polyfill("Array.prototype.keys",function(p){return p?p:function(){return $jscomp.iteratorFromArray(this,function(p){return p})}},"es6","es3");
$jscomp.polyfill("String.prototype.repeat",function(p){return p?p:function(p){var u=$jscomp.checkStringArgs(this,null,"repeat");if(0>p||1342177279<p)throw new RangeError("Invalid count value");p|=0;for(var w="";p;)if(p&1&&(w+=u),p>>>=1)u+=u;return w}},"es6","es3");
$jscomp.polyfill("Array.prototype.fill",function(p){return p?p:function(p,u,y){var w=this.length||0;0>u&&(u=Math.max(0,w+u));if(null==y||y>w)y=w;y=Number(y);0>y&&(y=Math.max(0,w+y));for(u=Number(u||0);u<y;u++)this[u]=p;return this}},"es6","es3");
function pong(){function p(a){return void 0===a||null===a?!1:0<=["boolean","number"].indexOf(typeof a)?a:a.__bool__ instanceof Function?a.__bool__()?a:!1:a.__len__ instanceof Function?0!==a.__len__()?a:!1:a instanceof Function?a:0!==P(a)?a:!1}function w(a){this.iterable=a;this.index=0}function u(a){this.iterable=a;this.index=0}function y(a,b,l){void 0==b&&(b=a,a=0);void 0==l&&(l=1);if(0<l&&a>=b||0>l&&a<=b)return[];for(var m=[];0<l?a<b:a>b;a+=l)m.push(a);return m}function L(a){if(null==a||"object"==
typeof a)return a;var b={},l;for(l in obj)a.hasOwnProperty(l)&&(b[l]=a[l]);return b}function M(a){if(null==a||"object"==typeof a)return a;var b={},l;for(l in obj)a.hasOwnProperty(l)&&(b[l]=M(a[l]));return b}function D(a){return a?Array.from(a):[]}function C(a){a=a?[].slice.apply(a):[];a.__class__=C;return a}function N(a){var b=[];if(a)for(var l=0;l<a.length;l++)b.add(a[l]);b.__class__=N;return b}function fa(a,b){if(void 0==a)return new Uint8Array(0);b=Y(a);if(b==T)return new Uint8Array(a);if(b==H){b=
new Uint8Array(P(a));for(var l=0;l<P(a);l++)b[l]=a.charCodeAt(l);return b}if(b==D||b==C)return new Uint8Array(a);throw ja;}function H(a){if("number"===typeof a)return a.toString();try{return a.__str__()}catch(b){try{return U(a)}catch(l){return String(a)}}}function ka(a){return this.hasOwnProperty(a)}function la(){var a=[],b;for(b in this)V(b)||a.push(b);return a}function ma(){var a=[],b;for(b in this)V(b)||a.push([b,this[b]]);return a}function na(a){delete this[a]}function oa(){for(var a in this)delete this[a]}
function pa(a,b){var l=this[a];void 0==l&&(l=this["py_"+a]);return void 0==l?void 0==b?null:b:l}function qa(a,b){var l=this[a];if(void 0!=l)return l;b=void 0==b?null:b;return this[a]=b}function ra(a,b){var l=this[a];if(void 0!=l)return delete this[a],l;if(void 0===b)throw ha(a,Error());return b}function sa(){var a=Object.keys(this)[0];if(null==a)throw ha("popitem(): dictionary is empty",Error());var b=C([a,this[a]]);delete this[a];return b}function ta(a){for(var b in a)this[b]=a[b]}function ua(){var a=
[],b;for(b in this)V(b)||a.push(this[b]);return a}function va(a){return this[a]}function wa(a,b){this[a]=b}function F(a){var b={};if(!a||a instanceof Array){if(a)for(var l=0;l<a.length;l++){var m=a[l];if(!(m instanceof Array)||2!=m.length)throw Q("dict update sequence element #"+l+" has length "+m.length+"; 2 is required",Error());var r=m[0];m=m[1];!(a instanceof Array)&&a instanceof Object&&(ba(a,F)||(m=F(m)));b[r]=m}}else if(ba(a,F))for(m=a.py_keys(),l=0;l<m.length;l++)r=m[l],b[r]=a[r];else if(a instanceof
Object)b=a;else throw Q("Invalid type of object for dict creation",Error());E(b,"__class__",{value:F,enumerable:!1,writable:!0});E(b,"__contains__",{value:ka,enumerable:!1});E(b,"py_keys",{value:la,enumerable:!1});E(b,"__iter__",{value:function(){new w(this.py_keys())},enumerable:!1});$jscomp.initSymbol();$jscomp.initSymbolIterator();E(b,Symbol.iterator,{value:function(){new u(this.py_keys())},enumerable:!1});E(b,"py_items",{value:ma,enumerable:!1});E(b,"py_del",{value:na,enumerable:!1});E(b,"py_clear",
{value:oa,enumerable:!1});E(b,"py_get",{value:pa,enumerable:!1});E(b,"py_setdefault",{value:qa,enumerable:!1});E(b,"py_pop",{value:ra,enumerable:!1});E(b,"py_popitem",{value:sa,enumerable:!1});E(b,"py_update",{value:ta,enumerable:!1});E(b,"py_values",{value:ua,enumerable:!1});E(b,"__getitem__",{value:va,enumerable:!1});E(b,"__setitem__",{value:wa,enumerable:!1});return b}var n={},W=function(a,b,l){if(""!=b){b=b.split(".");for(var m=b.length,r=0;r<b.length;r++){if(!a.hasOwnProperty(b[r])){m=r;break}a=
a[b[r]]}for(r=m;r<b.length;r++)a[b[r]]={},a=a[b[r]]}for(var h in l)a[h]=l[h]};n.__nest__=W;var ca=function(a){a.__inited__||(a.__all__.__init__(a.__all__),a.__inited__=!0);return a.__all__};n.__init__=ca;var t=function(a,b,l){return a&&(a.hasOwnProperty("__class__")||"string"==typeof a||a instanceof String)?(l&&Object.defineProperty(a,l,{value:function(){var m=[].slice.apply(arguments);return b.apply(null,[a].concat(m))},writable:!0,enumerable:!0,configurable:!0}),function(){var m=[].slice.apply(arguments);
return b.apply(null,[a].concat(m))}):b};n.__get__=t;n.__getcm__=function(a,b,l){return a.hasOwnProperty("__class__")?function(){var m=[].slice.apply(arguments);return b.apply(null,[a.__class__].concat(m))}:function(){var m=[].slice.apply(arguments);return b.apply(null,[a].concat(m))}};n.__getsm__=function(a,b,l){return b};var R={__name__:"type",__bases__:[],__new__:function(a,b,l,m){for(var r,h=function(){var d=[].slice.apply(arguments);return h.__new__(d)},k=l.length-1;0<=k;k--){var g=l[k],c;for(c in g)r=
Object.getOwnPropertyDescriptor(g,c),Object.defineProperty(h,c,r);r=$jscomp.makeIterator(Object.getOwnPropertySymbols(g));for(var f=r.next();!f.done;f=r.next()){f=f.value;var e=Object.getOwnPropertyDescriptor(g,f);Object.defineProperty(h,f,e)}}h.__metaclass__=a;h.__name__=b.startsWith("py_")?b.slice(3):b;h.__bases__=l;for(c in m)r=Object.getOwnPropertyDescriptor(m,c),Object.defineProperty(h,c,r);a=$jscomp.makeIterator(Object.getOwnPropertySymbols(m));for(f=a.next();!f.done;f=a.next())b=f.value,l=
Object.getOwnPropertyDescriptor(m,b),Object.defineProperty(h,b,l);return h}};R.__metaclass__=R;n.py_metatype=R;var I={__init__:function(a){},__metaclass__:R,__name__:"object",__bases__:[],__new__:function(a){var b=Object.create(this,{__class__:{value:this,enumerable:!0}});if("__getattr__"in this||"__setattr__"in this)b=new Proxy(b,{get:function(a,b){var m=a[b];return void 0==m?a.__getattr__(b):m},set:function(a,b,r){try{a.__setattr__(b,r)}catch(h){a[b]=r}return!0}});this.__init__.apply(null,[b].concat(a));
return b}};n.object=I;var B=function(a,b,l,m){void 0===m&&(m=b[0].__metaclass__);return m.__new__(m,a,b,l)};n.__class__=B;n.__pragma__=function(){};W(n,"org.transcrypt.__base__",{__all__:{__inited__:!1,__init__:function(a){var b=B("__Envir__",[I],{__module__:"org.transcrypt.__base__",get __init__(){return t(this,function(a){a.interpreter_name="python";a.transpiler_name="transcrypt";a.transpiler_version="3.6.101";a.target_subdir="__javascript__"})}}),l=b();a.__Envir__=b;a.__envir__=l;a.__name__="org.transcrypt.__base__"}}});
W(n,"org.transcrypt.__standard__",{__all__:{__inited__:!1,__init__:function(a){var b=B("Exception",[I],{__module__:"org.transcrypt.__standard__",get __init__(){return t(this,function(d){var e=F();if(arguments.length){var c=arguments.length-1;if(arguments[c]&&arguments[c].hasOwnProperty("__kwargtrans__")){var f=arguments[c--],a;for(a in f)switch(a){case "self":d=f[a];break;default:e[a]=f[a]}delete e.__kwargtrans__}c=C([].slice.apply(arguments).slice(1,c+1))}else c=C();d.__args__=c;try{d.stack=e.error.stack}catch(Ba){d.stack=
"No stack trace available"}})},get __repr__(){return t(this,function(d){return P(d.__args__)?"{}{}".format(d.__class__.__name__,U(C(d.__args__))):"{}()".format(d.__class__.__name__)})},get __str__(){return t(this,function(d){return 1<P(d.__args__)?H(C(d.__args__)):P(d.__args__)?H(d.__args__[0]):""})}}),l=B("IterableError",[b],{__module__:"org.transcrypt.__standard__",get __init__(){return t(this,function(d,e){b.__init__(d,"Can't iterate over non-iterable",K({error:e}))})}}),m=B("StopIteration",[b],
{__module__:"org.transcrypt.__standard__",get __init__(){return t(this,function(d,e){b.__init__(d,"Iterator exhausted",K({error:e}))})}}),r=B("ValueError",[b],{__module__:"org.transcrypt.__standard__",get __init__(){return t(this,function(d,e,c){b.__init__(d,e,K({error:c}))})}}),h=B("KeyError",[b],{__module__:"org.transcrypt.__standard__",get __init__(){return t(this,function(d,e,c){b.__init__(d,e,K({error:c}))})}}),k=B("AssertionError",[b],{__module__:"org.transcrypt.__standard__",get __init__(){return t(this,
function(d,e,c){e?b.__init__(d,e,K({error:c})):b.__init__(d,K({error:c}))})}}),g=B("NotImplementedError",[b],{__module__:"org.transcrypt.__standard__",get __init__(){return t(this,function(d,e,c){b.__init__(d,e,K({error:c}))})}}),c=B("IndexError",[b],{__module__:"org.transcrypt.__standard__",get __init__(){return t(this,function(d,e,c){b.__init__(d,e,K({error:c}))})}}),f=B("AttributeError",[b],{__module__:"org.transcrypt.__standard__",get __init__(){return t(this,function(d,e,c){b.__init__(d,e,K({error:c}))})}}),
e=B("py_TypeError",[b],{__module__:"org.transcrypt.__standard__",get __init__(){return t(this,function(d,e,c){b.__init__(d,e,K({error:c}))})}}),d=B("Warning",[b],{__module__:"org.transcrypt.__standard__"}),q=B("UserWarning",[d],{__module__:"org.transcrypt.__standard__"}),v=B("DeprecationWarning",[d],{__module__:"org.transcrypt.__standard__"}),A=B("RuntimeWarning",[d],{__module__:"org.transcrypt.__standard__"}),x=function(d,e,c){if("undefined"==typeof e||null!=e&&e.hasOwnProperty("__kwargtrans__"))e=
null;if("undefined"==typeof c||null!=c&&c.hasOwnProperty("__kwargtrans__"))c=!1;if(arguments.length){var f=arguments.length-1;if(arguments[f]&&arguments[f].hasOwnProperty("__kwargtrans__")){f=arguments[f--];for(var a in f)switch(a){case "iterable":d=f[a];break;case "key":e=f[a];break;case "reverse":c=f[a]}}}e?d.sort(function(d,c){if(arguments.length){var f=arguments.length-1;if(arguments[f]&&arguments[f].hasOwnProperty("__kwargtrans__")){f=arguments[f--];for(var a in f)switch(a){case "a":d=f[a];break;
case "b":c=f[a]}}}return e(d)>e(c)?1:-1}):d.sort();c&&d.reverse()},z=B("__Terminal__",[I],{__module__:"org.transcrypt.__standard__",get __init__(){return t(this,function(d){d.buffer="";try{d.element=document.getElementById("__terminal__")}catch(da){d.element=null}d.element&&(d.element.style.overflowX="auto",d.element.style.boxSizing="border-box",d.element.style.padding="5px",d.element.innerHTML="_")})},get print(){return t(this,function(d){var e=" ";var c="\n";if(arguments.length){var f=arguments.length-
1;if(arguments[f]&&arguments[f].hasOwnProperty("__kwargtrans__")){var a=arguments[f--],g;for(g in a)switch(g){case "self":d=a[g];break;case "sep":e=a[g];break;case "end":c=a[g]}}var h=C([].slice.apply(arguments).slice(1,f+1))}else h=C();d.buffer="{}{}{}".format(d.buffer,e.join(function(){for(var d=[],e=$jscomp.makeIterator(h),c=e.next();!c.done;c=e.next())d.append(H(c.value));return d}()),c).__getslice__(-4096,null,1);d.element?(d.element.innerHTML=d.buffer.py_replace("\n","<br>").py_replace(" ",
"&nbsp"),d.element.scrollTop=d.element.scrollHeight):console.log(e.join(function(){for(var d=[],e=$jscomp.makeIterator(h),c=e.next();!c.done;c=e.next())d.append(H(c.value));return d}()))})},get input(){return t(this,function(d,e){if(arguments.length){var c=arguments.length-1;if(arguments[c]&&arguments[c].hasOwnProperty("__kwargtrans__")){c=arguments[c--];for(var f in c)switch(f){case "self":d=c[f];break;case "question":e=c[f]}}}d.print("{}".format(e),K({end:""}));f=window.prompt("\n".join(d.buffer.py_split("\n").__getslice__(-16,
null,1)));d.print(f);return f})}}),J=z();a.AssertionError=k;a.AttributeError=f;a.DeprecationWarning=v;a.Exception=b;a.IndexError=c;a.IterableError=l;a.KeyError=h;a.NotImplementedError=g;a.RuntimeWarning=A;a.StopIteration=m;a.py_TypeError=e;a.UserWarning=q;a.ValueError=r;a.Warning=d;a.__Terminal__=z;a.__name__="org.transcrypt.__standard__";a.__sort__=x;a.__terminal__=J;a.filter=function(d,e){null==d&&(d=S);var c=[];e=$jscomp.makeIterator(e);for(var f=e.next();!f.done;f=e.next())f=f.value,d(f)&&c.append(f);
return c};a.map=function(d,e){var c=[];e=$jscomp.makeIterator(e);for(var f=e.next();!f.done;f=e.next())c.append(d(f.value));return c};a.sorted=function(d,e,c){if("undefined"==typeof e||null!=e&&e.hasOwnProperty("__kwargtrans__"))e=null;if("undefined"==typeof c||null!=c&&c.hasOwnProperty("__kwargtrans__"))c=!1;if(arguments.length){var f=arguments.length-1;if(arguments[f]&&arguments[f].hasOwnProperty("__kwargtrans__"))for(a in f=arguments[f--],f)switch(a){case "iterable":d=f[a];break;case "key":e=f[a];
break;case "reverse":c=f[a]}}var a=Y(d)==F?L(d.py_keys()):L(d);x(a,e,c);return a}}}});n.__call__=function(){var a=[].slice.apply(arguments);return"object"==typeof a[0]&&"__call__"in a[0]?a[0].__call__.apply(a[1],a.slice(2)):a[0].apply(a[1],a.slice(2))};W(n,"",ca(n.org.transcrypt.__base__));R=n.__envir__;W(n,"",ca(n.org.transcrypt.__standard__));var xa=n.Exception,ya=n.StopIteration,Q=n.ValueError,ha=n.KeyError,za=n.AssertionError,ja=n.py_TypeError,Aa=n.__sort__;n.print=n.__terminal__.print;n.input=
n.__terminal__.input;R.executor_name=R.transpiler_name;n.main={__file__:""};n.__except__=null;var K=function(a){a.__kwargtrans__=null;a.constructor=Object;return a};n.__kwargtrans__=K;n.__globals__=function(a){return ba(a,F)?a:F(a)};n.__super__=function(a,b){a=$jscomp.makeIterator(a.__bases__);for(var l=a.next();!l.done;l=a.next())if(l=l.value,b in l)return l[b];throw new xa("Superclass method not found");};n.property=function(a,b){b||(b=function(){});return{get:function(){return a(this)},set:function(a){b(this,
a)},enumerable:!0}};var E=function(a,b,l){a.hasOwnProperty(b)||Object.defineProperty(a,b,l)};n.__setProperty__=E;n.assert=function(a,b){if(!a)throw za(b,Error());};n.__merge__=function(a,b){var l={},m;for(m in a)l[m]=a[m];for(m in b)l[m]=b[m];return l};n.dir=function(a){var b=[],l;for(l in a)b.push(l.startsWith("py_")?l.slice(3):l);b.sort();return b};n.setattr=function(a,b,l){a[b]=l};n.getattr=function(a,b){return b in a?a[b]:a["py_"+b]};n.hasattr=function(a,b){try{return b in a||"py_"+b in a}catch(l){return!1}};
n.delattr=function(a,b){b in a?delete a[b]:delete a["py_"+b]};n.__in__=function(a,b){return void 0===b||null===b?!1:b.__contains__ instanceof Function?b.__contains__(a):b.indexOf?-1<b.indexOf(a):b.hasOwnProperty(a)};var V=function(a){return a.startswith("__")&&a.endswith("__")||"constructor"==a||a.startswith("py_")};n.__specialattrib__=V;var P=function(a){if(void 0===a||null===a)return 0;if(a.__len__ instanceof Function)return a.__len__();if(void 0!==a.length)return a.length;var b=0,l;for(l in a)V(l)||
b++;return b};n.len=P;n.__t__=p;var Z=function(a){if("inf"==a)return Infinity;if("-inf"==a)return-Infinity;if("nan"==a)return NaN;if(isNaN(parseFloat(a))){if(!1===a)return 0;if(!0===a)return 1;throw Q("could not convert string to float: '"+H(a)+"'",Error());}return+a};Z.__name__="float";Z.__bases__=[I];n.float=Z;var T=function(a){return Z(a)|0};T.__name__="int";T.__bases__=[I];n.int=T;Number.prototype.__format__=function(a){if(void 0==a||0==a.strip().length)return this.toString();var b=!1,l=!1,m=
0,r=!1,h=!1,k="-",g=">",c=" ",f=void 0,e=void 0,d=this.valueOf(),q=0>d;d=Math.abs(d);var v=function(d,e,c,f){void 0==c&&(c=" ");void 0==f&&(f=">");var a="",g="";d.startswith(["+","-"])&&(g=d[0],d=d.substr(1));h&&d.startswith(["0b","0o","0x"])&&(a=d.slice(0,2),d=d.substr(2));e-=d.length+g.length+a.length;switch(f){case "=":return g+a+O(c,e)+d;case ">":return O(c,e)+g+a+d;case "<":return g+a+d+O(c,e);case "^":return f=(e%2+2)%2,e=Math.floor(e/2),O(c,e)+g+a+d+O(c,e+f);default:throw Q("Invalid align type: '"+
f+"'",Error());}},A=function(d){if(-1==d.indexOf("e+")&&("g"==e||"G"==e)){var c=d.py_split(".");d=c[0];for(c=c[1];"0"==c[c.length-1];)c=c.slice(0,-1);d=""!=c?".".join([d,c]):d}h&&-1==d.indexOf(".")&&(d+=".");return d};a.endswith("bcdeEfFgGnoxX%".split(""))?(e=a[a.length-1],a=a.slice(0,-1),"n"==e&&(e=Number.isInteger(d)?"d":"f")):(e=Number.isInteger(d)?"d":"g",l=!0);var x=a.split(".");a=x[0];f=x[1];void 0!=f&&(f=parseInt(f));0<a.length&&","==a[a.length-1]&&(b=!0,a=a.slice(0,-1));if(0<a.length){for(x=
"";a&&a[a.length-1].isnumeric();)x=a[a.length-1]+x,a=a.slice(0,-1);0<x.length&&("0"==x[0]?(m=parseInt(x.substr(1)),r=!0):m=parseInt(x));0<a.length&&"#"==a[a.length-1]&&(h=!0,a=a.slice(0,-1));0<a.length&&a.endswith(["+","-"," "])&&(k=a[a.length-1],a=a.slice(0,-1));0<a.length&&a.endswith(["<",">","=","^"])&&(g=a[a.length-1],a=a.slice(0,-1));0<a.length&&(c=a[0])}if(isNaN(d))d="nan";else if(Infinity==d)d="inf";else switch(e){case "b":d=Math.floor(d).toString(2);h&&(d="0b"+d);break;case "c":d=String.fromCharCode(Math.floor(d));
break;case "d":d=Math.floor(d).toString();b&&(d=d.replace(/\B(?=(\d{3})+(?!\d))/g,","));break;case "o":d=Math.floor(d).toString(8);h&&(d="0o"+d);break;case "x":case "X":d=Math.floor(d).toString(16);h&&(d="0x"+d);break;case "e":case "E":void 0==f&&(f=6);x=d.toExponential(f).split("e+");l=x[0];x=x[1];d=l.toString()+"e+"+v(x.toString(),2,"0");d=A(d);break;case "f":case "F":case "%":void 0==f&&(f=6);"%"==e&&(d*=100);d=d.toFixed(f);d=A(d);"%"==e&&(d+="%");break;case "g":case "G":void 0==f&&(f=l?1:6);0==
f&&(f=1);a=!1;l&&(x=d.toString().split("."),x[0].length+x[1].length>=f&&(a=!0));x=d.toExponential(f-1).split("e+");l=x[0];x=x[1];d=a|!(-4<=x&&x<f)?l.toString()+"e+"+v(x.toString(),2,"0"):d.toFixed(f-1-x);d=A(d);break;default:throw Q("Invalid format type: '"+e+"'",Error());}e===e.toUpperCase()&&(d=d.toUpperCase());"c"!=e&&("-"==k?q&&(d="-"+d):d=q?"-"+d:k+d);r&&(c="0",g="=");0<m&&(d=v(d,m,c,g));return d};var S=function(a){return!!p(a)};S.__name__="bool";S.__bases__=[T];n.bool=S;var Y=function(a){var b=
typeof a;if("object"==b)try{return"__class__"in a?a.__class__:I}catch(l){return b}else return"boolean"==b?S:"string"==b?H:"number"==b?0==a%1?T:Z:null};n.py_typeof=Y;var aa=function(a,b){if(b instanceof Array){b=$jscomp.makeIterator(b);for(var l=b.next();!l.done;l=b.next())if(aa(a,l.value))return!0;return!1}try{l=a;if(l==b)return!0;for(var m=[].slice.call(l.__bases__);m.length;){l=m.shift();if(l==b)return!0;l.__bases__.length&&(m=[].slice.call(l.__bases__).concat(m))}return!1}catch(r){return a==b||
b==I}};n.issubclass=aa;var ba=function(a,b){try{return"__class__"in a?aa(a.__class__,b):aa(Y(a),b)}catch(l){return aa(Y(a),b)}};n.isinstance=ba;n.callable=function(a){return a&&"object"==typeof a&&"__call__"in a?!0:"function"===typeof a};var U=function(a){try{return a.__repr__()}catch(h){try{return a.__str__()}catch(k){try{if(null==a)return"None";if(a.constructor==Object){var b="{",l=!1,m;for(m in a)if(!V(m)){var r=m.isnumeric()?m:"'"+m+"'";l?b+=", ":l=!0;b+=r+": "+U(a[m])}return b+"}"}return"boolean"==
typeof a?a.toString().capitalize():a.toString()}catch(g){return"<object of type: "+typeof a+">"}}}};n.repr=U;n.chr=function(a){return String.fromCharCode(a)};var X=function(a){return a.charCodeAt(0)};n.ord=X;n.max=function(a){return 1==arguments.length?Math.max.apply(Math,[].concat($jscomp.arrayFromIterable(a))):Math.max.apply(Math,[].concat($jscomp.arrayFromIterable(arguments)))};n.min=function(a){return 1==arguments.length?Math.min.apply(Math,[].concat($jscomp.arrayFromIterable(a))):Math.min.apply(Math,
[].concat($jscomp.arrayFromIterable(arguments)))};n.abs=Math.abs;n.round=function(a,b){if(b){var l=Math.pow(10,b);a*=l}var m=Math.round(a);.5==m-a&&m%2&&--m;b&&(m/=l);return m};var ia=function(a,b){if(void 0==a)return"None";b=b||"";switch(typeof a){case "number":case "string":return a.__format__(b);case "boolean":return b?(a?1:0).__format__(b):H(a);case "object":return"__format__"in a?a.__format__(b):H(a).__format__(b);default:return H(a).__format__(b)}};n.format=ia;w.prototype.__next__=function(){if(this.index<
this.iterable.length)return this.iterable[this.index++];throw ya(Error());};u.prototype.next=function(){return this.index<this.iterable.py_keys.length?{value:this.index++,done:!1}:{value:void 0,done:!0}};n.py_reversed=function(a){a=a.slice();a.reverse();return a};var ea=function(){for(var a=[].slice.call(arguments),b=0;b<a.length;b++)"string"==typeof a[b]?a[b]=a[b].split(""):Array.isArray(a[b])||(a[b]=Array.from(a[b]));return(0==a.length?[]:a.reduce(function(a,b){return a.length<b.length?a:b})).map(function(b,
m){return a.map(function(a){return a[m]})})};n.zip=ea;n.range=y;n.any=function(a){a=$jscomp.makeIterator(a);for(var b=a.next();!b.done;b=a.next())if(S(b.value))return!0;return!1};n.all=function(a){a=$jscomp.makeIterator(a);for(var b=a.next();!b.done;b=a.next())if(!S(b.value))return!1;return!0};n.sum=function(a){var b=0;a=$jscomp.makeIterator(a);for(var l=a.next();!l.done;l=a.next())b+=l.value;return b};n.enumerate=function(a){return ea(y(P(a)),a)};n.copy=L;n.deepcopy=M;n.list=D;Array.prototype.__class__=
D;D.__name__="list";D.__bases__=[I];Array.prototype.__iter__=function(){return new w(this)};Array.prototype.__getslice__=function(a,b,l){0>a&&(a=this.length+a);null==b?b=this.length:0>b?b=this.length+b:b>this.length&&(b=this.length);for(var m=D([]);a<b;a+=l)m.push(this[a]);return m};Array.prototype.__setslice__=function(a,b,l,m){0>a&&(a=this.length+a);null==b?b=this.length:0>b&&(b=this.length+b);if(null==l)Array.prototype.splice.apply(this,[a,b-a].concat(m));else for(var r=0;a<b;a+=l)this[a]=m[r++]};
Array.prototype.__repr__=function(){if(this.__class__==N&&!this.length)return"set()";for(var a=this.__class__&&this.__class__!=D?this.__class__==C?"(":"{":"[",b=0;b<this.length;b++)b&&(a+=", "),a+=U(this[b]);this.__class__==C&&1==this.length&&(a+=",");return a+=this.__class__&&this.__class__!=D?this.__class__==C?")":"}":"]"};Array.prototype.__str__=Array.prototype.__repr__;Array.prototype.append=function(a){this.push(a)};Array.prototype.py_clear=function(){this.length=0};Array.prototype.extend=function(a){this.push.apply(this,
a)};Array.prototype.insert=function(a,b){this.splice(a,0,b)};Array.prototype.remove=function(a){a=this.indexOf(a);if(-1==a)throw Q("list.remove(x): x not in list",Error());this.splice(a,1)};Array.prototype.index=function(a){return this.indexOf(a)};Array.prototype.py_pop=function(a){return void 0==a?this.pop():this.splice(a,1)[0]};Array.prototype.py_sort=function(){Aa.apply(null,[this].concat([].slice.apply(arguments)))};Array.prototype.__add__=function(a){return D(this.concat(a))};Array.prototype.__mul__=
function(a){for(var b=this,l=1;l<a;l++)b=b.concat(this);return b};Array.prototype.__rmul__=Array.prototype.__mul__;n.tuple=C;C.__name__="tuple";C.__bases__=[I];n.set=N;N.__name__="set";N.__bases__=[I];Array.prototype.__bindexOf__=function(a){a+="";for(var b=0,l=this.length-1;b<=l;){var m=(b+l)/2|0,r=this[m]+"";if(r<a)b=m+1;else if(r>a)l=m-1;else return m}return-1};Array.prototype.add=function(a){-1==this.indexOf(a)&&this.push(a)};Array.prototype.discard=function(a){a=this.indexOf(a);-1!=a&&this.splice(a,
1)};Array.prototype.isdisjoint=function(a){this.sort();for(var b=0;b<a.length;b++)if(-1!=this.__bindexOf__(a[b]))return!1;return!0};Array.prototype.issuperset=function(a){this.sort();for(var b=0;b<a.length;b++)if(-1==this.__bindexOf__(a[b]))return!1;return!0};Array.prototype.issubset=function(a){return N(a.slice()).issuperset(this)};Array.prototype.union=function(a){for(var b=N(this.slice().sort()),l=0;l<a.length;l++)-1==b.__bindexOf__(a[l])&&b.push(a[l]);return b};Array.prototype.intersection=function(a){this.sort();
for(var b=N(),l=0;l<a.length;l++)-1!=this.__bindexOf__(a[l])&&b.push(a[l]);return b};Array.prototype.difference=function(a){a=N(a.slice().sort());for(var b=N(),l=0;l<this.length;l++)-1==a.__bindexOf__(this[l])&&b.push(this[l]);return b};Array.prototype.symmetric_difference=function(a){return this.union(a).difference(this.intersection(a))};Array.prototype.py_update=function(){var a=[].concat.apply(this.slice(),arguments).sort();this.py_clear();for(var b=0;b<a.length;b++)a[b]!=a[b-1]&&this.push(a[b])};
Array.prototype.__eq__=function(a){if(this.length!=a.length)return!1;this.__class__==N&&(this.sort(),a.sort());for(var b=0;b<this.length;b++)if(this[b]!=a[b])return!1;return!0};Array.prototype.__ne__=function(a){return!this.__eq__(a)};Array.prototype.__le__=function(a){return this.issubset(a)};Array.prototype.__ge__=function(a){return this.issuperset(a)};Array.prototype.__lt__=function(a){return this.issubset(a)&&!this.issuperset(a)};Array.prototype.__gt__=function(a){return this.issuperset(a)&&!this.issubset(a)};
n.bytearray=fa;n.bytes=fa;Uint8Array.prototype.__add__=function(a){var b=new Uint8Array(this.length+a.length);b.set(this);b.set(a,this.length);return b};Uint8Array.prototype.__mul__=function(a){for(var b=new Uint8Array(a*this.length),l=0;l<a;l++)b.set(this,l*this.length);return b};Uint8Array.prototype.__rmul__=Uint8Array.prototype.__mul__;n.str=H;String.prototype.__class__=H;H.__name__="str";H.__bases__=[I];String.prototype.__iter__=function(){new w(this)};String.prototype.__repr__=function(){return(-1==
this.indexOf("'")?"'"+this+"'":'"'+this+'"').py_replace("\t","\\t").py_replace("\n","\\n")};String.prototype.__str__=function(){return this};String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.slice(1)};String.prototype.endswith=function(a){if(a instanceof Array)for(var b=0;b<a.length;b++){if(this.slice(-a[b].length)==a[b])return!0}else return""==a||this.slice(-a.length)==a;return!1};String.prototype.find=function(a,b){return this.indexOf(a,b)};String.prototype.__getslice__=
function(a,b,l){0>a&&(a=this.length+a);null==b?b=this.length:0>b&&(b=this.length+b);var m="";if(1==l)m=this.substring(a,b);else for(;a<b;a+=l)m=m.concat(this.charAt(a));return m};String.prototype.__format__=function(a){if(void 0==a||0==a.strip().length)return this.valueOf();var b=0,l="<",m=" ",r=this.valueOf();"s"==a[a.length-1]&&(a=a.slice(0,-1));if(0<a.length){for(var h="";a&&a[a.length-1].isnumeric();)h=a[a.length-1]+h,a=a.slice(0,-1);0<h.length&&(b=parseInt(h));0<a.length&&a.endswith(["<",">",
"^"])&&(l=a[a.length-1],a=a.slice(0,-1));0<a.length&&(m=a[0])}if(0<b)a:switch(a=r,b-=a.length,l){case ">":r=O(m,b)+a;break a;case "<":r=a+O(m,b);break a;case "^":l=(b%2+2)%2;b=Math.floor(b/2);r=O(m,b)+a+O(m,b+l);break a;default:r=a}return r};E(String.prototype,"format",{get:function(){return t(this,function(a){var b=C([].slice.apply(arguments).slice(1)),l=0;return a.replace(/\{([^\{]*)\}/g,function(a,r){var h=r.split(":");r=h[0];var k=h[1];h=r.split("!");r=h[0];h=h[1];var g=void 0;""==r&&(r=l++);
if(r==+r&&void 0!=b[r])g=b[r];else{var c=void 0,f=r.indexOf(".");-1!=f?(c=r.substring(f+1),r=r.substring(0,f)):(f=r.indexOf("["),-1!=f&&(c=r.substring(f+1).slice(0,-1),r=r.substring(0,f)));if(r==+r&&c&&void 0!=b[r])g=b[r][c];else for(f=0;f<b.length;f++)if("object"==typeof b[f]&&void 0!=b[f][r]){g=c?b[f][r][c]:b[f][r];break}}if(void 0==g)return a;if("r"==h)g=U(g);else if("s"==h)g=H(g);else if("a"==h)throw Q("Conversion to ascii not yet supported: '"+a+"'",Error());return ia(g,k)})})},enumerable:!0});
String.prototype.isalnum=function(){return/^[0-9a-zA-Z]{1,}$/.test(this)};String.prototype.isalpha=function(){return/^[a-zA-Z]{1,}$/.test(this)};String.prototype.isdecimal=function(){return/^[0-9]{1,}$/.test(this)};String.prototype.isdigit=function(){return this.isdecimal()};String.prototype.islower=function(){return/^[a-z]{1,}$/.test(this)};String.prototype.isupper=function(){return/^[A-Z]{1,}$/.test(this)};String.prototype.isspace=function(){return/^[\s]{1,}$/.test(this)};String.prototype.isnumeric=
function(){return!isNaN(parseFloat(this))&&isFinite(this)};String.prototype.join=function(a){a=Array.from(a);return a.join(this)};String.prototype.lower=function(){return this.toLowerCase()};String.prototype.py_replace=function(a,b,l){return this.split(a,l).join(b)};String.prototype.lstrip=function(){return this.replace(/^\s*/g,"")};String.prototype.rfind=function(a,b){return this.lastIndexOf(a,b)};String.prototype.rsplit=function(a,b){if(void 0==a||null==a){a=/\s+/;var l=this.strip()}else l=this;
if(void 0==b||-1==b)return l.split(a);l=l.split(a);return b<l.length?(b=l.length-b,[l.slice(0,b).join(a)].concat(l.slice(b))):l};String.prototype.rstrip=function(){return this.replace(/\s*$/g,"")};String.prototype.py_split=function(a,b){if(void 0==a||null==a){a=/\s+/;var l=this.strip()}else l=this;if(void 0==b||-1==b)return l.split(a);l=l.split(a);return b<l.length?l.slice(0,b).concat([l.slice(b).join(a)]):l};String.prototype.startswith=function(a){if(a instanceof Array)for(var b=0;b<a.length;b++){if(0==
this.indexOf(a[b]))return!0}else return 0==this.indexOf(a);return!1};String.prototype.strip=function(){return this.trim()};String.prototype.upper=function(){return this.toUpperCase()};String.prototype.__mul__=function(a){for(var b="",l=0;l<a;l++)b+=this;return b};String.prototype.__rmul__=String.prototype.__mul__;n.dict=F;F.__name__="dict";F.__bases__=[I];E(Function.prototype,"__setdoc__",{value:function(a){this.__doc__=a;return this},enumerable:!1});n.__jsmod__=function(a,b){return"object"==typeof a&&
"__mod__"in a?a.__mod__(b):"object"==typeof b&&"__rmod__"in b?b.__rmod__(a):a%b};n.mod=function(a,b){return"object"==typeof a&&"__mod__"in a?a.__mod__(b):"object"==typeof b&&"__rmod__"in b?b.__rmod__(a):(a%b+b)%b};n.pow=function(a,b){return"object"==typeof a&&"__pow__"in a?a.__pow__(b):"object"==typeof b&&"__rpow__"in b?b.__rpow__(a):Math.pow(a,b)};n.__neg__=function(a){return"object"==typeof a&&"__neg__"in a?a.__neg__():-a};n.__matmul__=function(a,b){return a.__matmul__(b)};var O=function(a,b){return"object"==
typeof a&&"__mul__"in a?a.__mul__(b):"object"==typeof b&&"__rmul__"in b?b.__rmul__(a):"string"==typeof a?a.__mul__(b):"string"==typeof b?b.__rmul__(a):a*b};n.__mul__=O;n.__truediv__=function(a,b){return"object"==typeof a&&"__truediv__"in a?a.__truediv__(b):"object"==typeof b&&"__rtruediv__"in b?b.__rtruediv__(a):"object"==typeof a&&"__div__"in a?a.__div__(b):"object"==typeof b&&"__rdiv__"in b?b.__rdiv__(a):a/b};n.__floordiv__=function(a,b){return"object"==typeof a&&"__floordiv__"in a?a.__floordiv__(b):
"object"==typeof b&&"__rfloordiv__"in b?b.__rfloordiv__(a):"object"==typeof a&&"__div__"in a?a.__div__(b):"object"==typeof b&&"__rdiv__"in b?b.__rdiv__(a):Math.floor(a/b)};n.__add__=function(a,b){return"object"==typeof a&&"__add__"in a?a.__add__(b):"object"==typeof b&&"__radd__"in b?b.__radd__(a):a+b};n.__sub__=function(a,b){return"object"==typeof a&&"__sub__"in a?a.__sub__(b):"object"==typeof b&&"__rsub__"in b?b.__rsub__(a):a-b};n.__lshift__=function(a,b){return"object"==typeof a&&"__lshift__"in
a?a.__lshift__(b):"object"==typeof b&&"__rlshift__"in b?b.__rlshift__(a):a<<b};n.__rshift__=function(a,b){return"object"==typeof a&&"__rshift__"in a?a.__rshift__(b):"object"==typeof b&&"__rrshift__"in b?b.__rrshift__(a):a>>b};n.__or__=function(a,b){return"object"==typeof a&&"__or__"in a?a.__or__(b):"object"==typeof b&&"__ror__"in b?b.__ror__(a):a|b};n.__xor__=function(a,b){return"object"==typeof a&&"__xor__"in a?a.__xor__(b):"object"==typeof b&&"__rxor__"in b?b.__rxor__(a):a^b};n.__and__=function(a,
b){return"object"==typeof a&&"__and__"in a?a.__and__(b):"object"==typeof b&&"__rand__"in b?b.__rand__(a):a&b};n.__eq__=function(a,b){return"object"==typeof a&&"__eq__"in a?a.__eq__(b):a==b};n.__ne__=function(a,b){return"object"==typeof a&&"__ne__"in a?a.__ne__(b):a!=b};n.__lt__=function(a,b){return"object"==typeof a&&"__lt__"in a?a.__lt__(b):a<b};n.__le__=function(a,b){return"object"==typeof a&&"__le__"in a?a.__le__(b):a<=b};n.__gt__=function(a,b){return"object"==typeof a&&"__gt__"in a?a.__gt__(b):
a>b};n.__ge__=function(a,b){return"object"==typeof a&&"__ge__"in a?a.__ge__(b):a>=b};n.__imatmul__=function(a,b){return"__imatmul__"in a?a.__imatmul__(b):a.__matmul__(b)};n.ipow=function(a,b){return"object"==typeof a&&"__pow__"in a?a.__ipow__(b):"object"==typeof a&&"__ipow__"in a?a.__pow__(b):"object"==typeof b&&"__rpow__"in b?b.__rpow__(a):Math.pow(a,b)};n.ijsmod__=function(a,b){return"object"==typeof a&&"__imod__"in a?a.__ismod__(b):"object"==typeof a&&"__mod__"in a?a.__mod__(b):"object"==typeof b&&
"__rpow__"in b?b.__rmod__(a):a%b};n.imod=function(a,b){return"object"==typeof a&&"__imod__"in a?a.__imod__(b):"object"==typeof a&&"__mod__"in a?a.__mod__(b):"object"==typeof b&&"__rmod__"in b?b.__rmod__(a):(a%b+b)%b};n.__imul__=function(a,b){return"object"==typeof a&&"__imul__"in a?a.__imul__(b):"object"==typeof a&&"__mul__"in a?a.__mul__(b):"object"==typeof b&&"__rmul__"in b?b.__rmul__(a):"string"==typeof a?a.__mul__(b):"string"==typeof b?b.__rmul__(a):a*b};n.__idiv__=function(a,b){return"object"==
typeof a&&"__idiv__"in a?a.__idiv__(b):"object"==typeof a&&"__div__"in a?a.__div__(b):"object"==typeof b&&"__rdiv__"in b?b.__rdiv__(a):a/b};n.__iadd__=function(a,b){return"object"==typeof a&&"__iadd__"in a?a.__iadd__(b):"object"==typeof a&&"__add__"in a?a.__add__(b):"object"==typeof b&&"__radd__"in b?b.__radd__(a):a+b};n.__isub__=function(a,b){return"object"==typeof a&&"__isub__"in a?a.__isub__(b):"object"==typeof a&&"__sub__"in a?a.__sub__(b):"object"==typeof b&&"__rsub__"in b?b.__rsub__(a):a-b};
n.__ilshift__=function(a,b){return"object"==typeof a&&"__ilshift__"in a?a.__ilshift__(b):"object"==typeof a&&"__lshift__"in a?a.__lshift__(b):"object"==typeof b&&"__rlshift__"in b?b.__rlshift__(a):a<<b};n.__irshift__=function(a,b){return"object"==typeof a&&"__irshift__"in a?a.__irshift__(b):"object"==typeof a&&"__rshift__"in a?a.__rshift__(b):"object"==typeof b&&"__rrshift__"in b?b.__rrshift__(a):a>>b};n.__ior__=function(a,b){return"object"==typeof a&&"__ior__"in a?a.__ior__(b):"object"==typeof a&&
"__or__"in a?a.__or__(b):"object"==typeof b&&"__ror__"in b?b.__ror__(a):a|b};n.__ixor__=function(a,b){return"object"==typeof a&&"__ixor__"in a?a.__ixor__(b):"object"==typeof a&&"__xor__"in a?a.__xor__(b):"object"==typeof b&&"__rxor__"in b?b.__rxor__(a):a^b};n.__iand__=function(a,b){return"object"==typeof a&&"__iand__"in a?a.__iand__(b):"object"==typeof a&&"__and__"in a?a.__and__(b):"object"==typeof b&&"__rand__"in b?b.__rand__(a):a&b};n.__getitem__=function(a,b){return"object"==typeof a&&"__getitem__"in
a?a.__getitem__(b):("string"==typeof a||a instanceof Array)&&0>b?a[a.length+b]:a[b]};n.__setitem__=function(a,b,l){"object"==typeof a&&"__setitem__"in a?a.__setitem__(b,l):("string"==typeof a||a instanceof Array)&&0>b?a[a.length+b]=l:a[b]=l};n.__getslice__=function(a,b,l,m){return"object"==typeof a&&"__getitem__"in a?a.__getitem__([b,l,m]):a.__getslice__(b,l,m)};n.__setslice__=function(a,b,l,m,r){"object"==typeof a&&"__setitem__"in a?a.__setitem__([b,l,m],r):a.__setslice__(b,l,m,r)};W(n,"com.fabricjs",
{__all__:{__inited__:!1,__init__:function(a){var b=function(){var a={},b=b||{version:"1.5.0"};"undefined"!==typeof a&&(a.fabric=b);"undefined"!==typeof document&&"undefined"!==typeof window?(b.document=document,b.window=window,window.fabric=b):(b.document=require("jsdom").jsdom("<!DOCTYPE html><html><head></head><body></body></html>"),b.window=b.document.createWindow?b.document.createWindow():b.document.parentWindow);b.isTouchSupported="ontouchstart"in b.document.documentElement;b.isLikelyNode="undefined"!==
typeof Buffer&&"undefined"===typeof window;b.SHARED_ATTRIBUTES="display transform fill fill-opacity fill-rule opacity stroke stroke-dasharray stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width".split(" ");b.DPI=96;b.reNum="(?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:e[-+]?\\d+)?)";(function(){function a(c,f){this.__eventListeners[c]&&(f?b.util.removeFromArray(this.__eventListeners[c],f):this.__eventListeners[c].length=0)}function h(c,f){this.__eventListeners||(this.__eventListeners={});
if(1===arguments.length)for(var e in c)this.on(e,c[e]);else this.__eventListeners[c]||(this.__eventListeners[c]=[]),this.__eventListeners[c].push(f);return this}function k(c,f){if(this.__eventListeners){if(0===arguments.length)this.__eventListeners={};else if(1===arguments.length&&"object"===typeof arguments[0])for(var e in c)a.call(this,e,c[e]);else a.call(this,c,f);return this}}function g(c,f){if(this.__eventListeners&&(c=this.__eventListeners[c])){for(var e=0,d=c.length;e<d;e++)c[e].call(this,
f||{});return this}}b.Observable={observe:h,stopObserving:k,fire:g,on:h,off:k,trigger:g}})();b.Collection={add:function(){this._objects.push.apply(this._objects,arguments);for(var a=0,b=arguments.length;a<b;a++)this._onObjectAdded(arguments[a]);this.renderOnAddRemove&&this.renderAll();return this},insertAt:function(a,b,k){var g=this.getObjects();k?g[b]=a:g.splice(b,0,a);this._onObjectAdded(a);this.renderOnAddRemove&&this.renderAll();return this},remove:function(){for(var a=this.getObjects(),b,k=0,
g=arguments.length;k<g;k++)b=a.indexOf(arguments[k]),-1!==b&&(a.splice(b,1),this._onObjectRemoved(arguments[k]));this.renderOnAddRemove&&this.renderAll();return this},forEachObject:function(a,b){for(var h=this.getObjects(),g=h.length;g--;)a.call(b,h[g],g,h);return this},getObjects:function(a){return"undefined"===typeof a?this._objects:this._objects.filter(function(b){return b.type===a})},item:function(a){return this.getObjects()[a]},isEmpty:function(){return 0===this.getObjects().length},size:function(){return this.getObjects().length},
contains:function(a){return-1<this.getObjects().indexOf(a)},complexity:function(){return this.getObjects().reduce(function(a,b){return a+=b.complexity?b.complexity():0},0)}};(function(a){var h=Math.sqrt,k=Math.atan2,g=Math.PI/180;b.util={removeFromArray:function(c,f){f=c.indexOf(f);-1!==f&&c.splice(f,1);return c},getRandomInt:function(c,f){return Math.floor(Math.random()*(f-c+1))+c},degreesToRadians:function(c){return c*g},radiansToDegrees:function(c){return c/g},rotatePoint:function(c,f,e){var d=
Math.sin(e);e=Math.cos(e);c.subtractEquals(f);return(new b.Point(c.x*e-c.y*d,c.x*d+c.y*e)).addEquals(f)},transformPoint:function(c,f,e){return e?new b.Point(f[0]*c.x+f[2]*c.y,f[1]*c.x+f[3]*c.y):new b.Point(f[0]*c.x+f[2]*c.y+f[4],f[1]*c.x+f[3]*c.y+f[5])},invertTransform:function(c){c.slice();var f=1/(c[0]*c[3]-c[1]*c[2]);f=[f*c[3],-f*c[1],-f*c[2],f*c[0],0,0];c=b.util.transformPoint({x:c[4],y:c[5]},f);f[4]=-c.x;f[5]=-c.y;return f},toFixed:function(c,f){return parseFloat(Number(c).toFixed(f))},parseUnit:function(c,
f){var e=/\D{0,2}$/.exec(c);c=parseFloat(c);f||(f=b.Text.DEFAULT_SVG_FONT_SIZE);switch(e[0]){case "mm":return c*b.DPI/25.4;case "cm":return c*b.DPI/2.54;case "in":return c*b.DPI;case "pt":return c*b.DPI/72;case "pc":return c*b.DPI/72*12;case "em":return c*f;default:return c}},falseFunction:function(){return!1},getKlass:function(c,f){c=b.util.string.camelize(c.charAt(0).toUpperCase()+c.slice(1));return b.util.resolveNamespace(f)[c]},resolveNamespace:function(c){if(!c)return b;c=c.split(".");for(var f=
c.length,e=a||b.window,d=0;d<f;++d)e=e[c[d]];return e},loadImage:function(c,f,e,d){if(c){var a=b.util.createImage();a.onload=function(){f&&f.call(e,a);a=a.onload=a.onerror=null};a.onerror=function(){b.log("Error loading "+a.src);f&&f.call(e,null,!0);a=a.onload=a.onerror=null};0!==c.indexOf("data")&&"undefined"!==typeof d&&(a.crossOrigin=d);a.src=c}else f&&f.call(e,c)},enlivenObjects:function(c,a,e,d){function f(){++h===k&&a&&a(g)}c=c||[];var g=[],h=0,k=c.length;k?c.forEach(function(c,a){if(c&&c.type){var h=
b.util.getKlass(c.type,e);h.async?h.fromObject(c,function(e,b){b||(g[a]=e,d&&d(c,g[a]));f()}):(g[a]=h.fromObject(c),d&&d(c,g[a]),f())}else f()}):a&&a(g)},groupSVGElements:function(c,a,e){c=new b.PathGroup(c,a);"undefined"!==typeof e&&c.setSourcePath(e);return c},populateWithProperties:function(c,a,e){if(e&&"[object Array]"===Object.prototype.toString.call(e))for(var d=0,f=e.length;d<f;d++)e[d]in c&&(a[e[d]]=c[e[d]])},drawDashedLine:function(c,a,e,d,b,g){d-=a;var f=b-e;b=h(d*d+f*f);d=k(f,d);f=g.length;
var q=0,v=!0;c.save();c.translate(a,e);c.moveTo(0,0);c.rotate(d);for(a=0;b>a;)a+=g[q++%f],a>b&&(a=b),c[v?"lineTo":"moveTo"](a,0),v=!v;c.restore()},createCanvasElement:function(c){c||(c=b.document.createElement("canvas"));c.getContext||"undefined"===typeof G_vmlCanvasManager||G_vmlCanvasManager.initElement(c);return c},createImage:function(){return b.isLikelyNode?new (require("canvas").Image):b.document.createElement("img")},createAccessors:function(c){c=c.prototype;for(var a=c.stateProperties.length;a--;){var e=
c.stateProperties[a],d=e.charAt(0).toUpperCase()+e.slice(1),b="set"+d;d="get"+d;c[d]||(c[d]=new Function('return this.get("'+e+'")'));c[b]||(c[b]=new Function("value",'return this.set("'+e+'", value)'))}},clipContext:function(c,a){a.save();a.beginPath();c.clipTo(a);a.clip()},multiplyTransformMatrices:function(c,a){return[c[0]*a[0]+c[2]*a[1],c[1]*a[0]+c[3]*a[1],c[0]*a[2]+c[2]*a[3],c[1]*a[2]+c[3]*a[3],c[0]*a[4]+c[2]*a[5]+c[4],c[1]*a[4]+c[3]*a[5]+c[5]]},getFunctionBody:function(c){return(String(c).match(/function[^{]*\{([\s\S]*)\}/)||
{})[1]},isTransparent:function(c,a,e,d){0<d&&(a=a>d?a-d:0,e=e>d?e-d:0);var f=!0;c=c.getImageData(a,e,2*d||1,2*d||1);a=3;for(e=c.data.length;a<e&&(f=0>=c.data[a],!1!==f);a+=4);return f}}})("undefined"!==typeof a?a:this);(function(){function a(e,a,f,b,g,r,l){var q=d.call(arguments);if(c[q])return c[q];var v=Math.PI,x=l*v/180,A=Math.sin(x);x=Math.cos(x);var J=0,G=0;f=Math.abs(f);b=Math.abs(b);var n=-x*e*.5-A*a*.5,z=-x*a*.5+A*e*.5,p=f*f,m=b*b,t=z*z,u=n*n,w=p*m-p*t-m*u,y=0;0>w?(p=Math.sqrt(1-w/(p*m)),
f*=p,b*=p):y=(g===r?-1:1)*Math.sqrt(w/(p*t+m*u));t=y*f*z/b;u=-y*b*n/f;y=x*t-A*u+.5*e;p=A*t+x*u+.5*a;m=k(1,0,(n-t)/f,(z-u)/b);z=k((n-t)/f,(z-u)/b,(-n-t)/f,(-z-u)/b);0===r&&0<z?z-=2*v:1===r&&0>z&&(z+=2*v);v=Math.ceil(Math.abs(z/v*2));n=[];z/=v;t=8/3*Math.sin(z/4)*Math.sin(z/4)/Math.sin(z/2);u=m+z;for(w=0;w<v;w++)n[w]=h(m,u,x,A,f,b,y,p,t,J,G),J=n[w][4],G=n[w][5],m=u,u+=z;return c[q]=n}function h(e,c,a,b,g,h,k,r,l,n,p){var q=d.call(arguments);if(f[q])return f[q];var v=Math.cos(e),x=Math.sin(e),A=Math.cos(c),
J=Math.sin(c),G=a*g*A-b*h*J+k,z=b*g*A+a*h*J+r;f[q]=[n+l*(-a*g*x-b*h*v),p+l*(-b*g*x+a*h*v),G+l*(a*g*J+b*h*A),z+l*(b*g*J-a*h*A),G,z];return f[q]}function k(d,e,c,a){d=Math.atan2(e,d);c=Math.atan2(a,c);return c>=d?c-d:2*Math.PI-(d-c)}function g(c,a,f,b,g,h,k,r){var q=d.call(arguments);if(e[q])return e[q];var v=Math.sqrt,x=Math.min,A=Math.max,l=Math.abs,J=[],G=[[],[]];var n=6*c-12*f+6*g;var z=-3*c+9*f-9*g+3*k;var da=3*f-3*c;for(var p=0;2>p;++p)if(0<p&&(n=6*a-12*b+6*h,z=-3*a+9*b-9*h+3*r,da=3*b-3*a),1E-12>
l(z)){if(!(1E-12>l(n))){var m=-da/n;0<m&&1>m&&J.push(m)}}else if(m=n*n-4*da*z,!(0>m)){var t=v(m);m=(-n+t)/(2*z);0<m&&1>m&&J.push(m);m=(-n-t)/(2*z);0<m&&1>m&&J.push(m)}for(l=v=J.length;v--;)m=J[v],n=1-m,z=n*n*n*c+3*n*n*m*f+3*n*m*m*g+m*m*m*k,G[0][v]=z,z=n*n*n*a+3*n*n*m*b+3*n*m*m*h+m*m*m*r,G[1][v]=z;G[0][l]=c;G[1][l]=a;G[0][l+1]=k;G[1][l+1]=r;x=[{x:x.apply(null,G[0]),y:x.apply(null,G[1])},{x:A.apply(null,G[0]),y:A.apply(null,G[1])}];return e[q]=x}var c={},f={},e={},d=Array.prototype.join;b.util.drawArc=
function(d,e,c,f){var b=[[],[],[],[]];f=a(f[5]-e,f[6]-c,f[0],f[1],f[3],f[4],f[2]);for(var g=0,h=f.length;g<h;g++)b[g][0]=f[g][0]+e,b[g][1]=f[g][1]+c,b[g][2]=f[g][2]+e,b[g][3]=f[g][3]+c,b[g][4]=f[g][4]+e,b[g][5]=f[g][5]+c,d.bezierCurveTo.apply(d,b[g])};b.util.getBoundsOfArc=function(d,e,c,f,b,h,k,r,l){var q=0,v=0,x=[];c=a(r-d,l-e,c,f,h,k,b);f=[[],[]];b=0;for(h=c.length;b<h;b++)q=g(q,v,c[b][0],c[b][1],c[b][2],c[b][3],c[b][4],c[b][5]),f[0].x=q[0].x+d,f[0].y=q[0].y+e,f[1].x=q[1].x+d,f[1].y=q[1].y+e,x.push(f[0]),
x.push(f[1]),q=c[b][4],v=c[b][5];return x};b.util.getBoundsOfCurve=g})();(function(){function a(a,b,c){if(a&&0!==a.length){var f=a.length-1,e=b?a[f][b]:a[f];if(b)for(;f--;)c(a[f][b],e)&&(e=a[f][b]);else for(;f--;)c(a[f],e)&&(e=a[f]);return e}}var h=Array.prototype.slice;Array.prototype.indexOf||(Array.prototype.indexOf=function(a){if(void 0===this||null===this)throw new TypeError;var b=Object(this),c=b.length>>>0;if(0===c)return-1;var f=0;0<arguments.length&&(f=Number(arguments[1]),f!==f?f=0:0!==
f&&f!==Number.POSITIVE_INFINITY&&f!==Number.NEGATIVE_INFINITY&&(f=(0<f||-1)*Math.floor(Math.abs(f))));if(f>=c)return-1;for(f=0<=f?f:Math.max(c-Math.abs(f),0);f<c;f++)if(f in b&&b[f]===a)return f;return-1});Array.prototype.forEach||(Array.prototype.forEach=function(a,b){for(var c=0,f=this.length>>>0;c<f;c++)c in this&&a.call(b,this[c],c,this)});Array.prototype.map||(Array.prototype.map=function(a,b){for(var c=[],f=0,e=this.length>>>0;f<e;f++)f in this&&(c[f]=a.call(b,this[f],f,this));return c});Array.prototype.every||
(Array.prototype.every=function(a,b){for(var c=0,f=this.length>>>0;c<f;c++)if(c in this&&!a.call(b,this[c],c,this))return!1;return!0});Array.prototype.some||(Array.prototype.some=function(a,b){for(var c=0,f=this.length>>>0;c<f;c++)if(c in this&&a.call(b,this[c],c,this))return!0;return!1});Array.prototype.filter||(Array.prototype.filter=function(a,b){for(var c=[],f,e=0,d=this.length>>>0;e<d;e++)e in this&&(f=this[e],a.call(b,f,e,this)&&c.push(f));return c});Array.prototype.reduce||(Array.prototype.reduce=
function(a){var b=this.length>>>0,c=0;if(1<arguments.length)var f=arguments[1];else{do{if(c in this){f=this[c++];break}if(++c>=b)throw new TypeError;}while(1)}for(;c<b;c++)c in this&&(f=a.call(null,f,this[c],c,this));return f});b.util.array={invoke:function(a,b){for(var c=h.call(arguments,2),f=[],e=0,d=a.length;e<d;e++)f[e]=c.length?a[e][b].apply(a[e],c):a[e][b].call(a[e]);return f},min:function(b,g){return a(b,g,function(c,a){return c<a})},max:function(b,g){return a(b,g,function(c,a){return c>=a})}}})();
(function(){function a(a,b){for(var g in b)a[g]=b[g];return a}b.util.object={extend:a,clone:function(b){return a({},b)}}})();(function(){String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^[\s\xA0]+/,"").replace(/[\s\xA0]+$/,"")});b.util.string={camelize:function(a){return a.replace(/-+(.)?/g,function(a,b){return b?b.toUpperCase():""})},capitalize:function(a,b){return a.charAt(0).toUpperCase()+(b?a.slice(1):a.slice(1).toLowerCase())},escapeXml:function(a){return a.replace(/&/g,
"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}}})();(function(){var a=Array.prototype.slice,b=Function.prototype.apply,k=function(){};Function.prototype.bind||(Function.prototype.bind=function(g){var c=this,f=a.call(arguments,1);var e=f.length?function(){return b.call(c,this instanceof k?this:g,f.concat(a.call(arguments)))}:function(){return b.call(c,this instanceof k?this:g,arguments)};k.prototype=this.prototype;e.prototype=new k;return e})})();
(function(){function a(){}function h(e){var d=this.constructor.superclass.prototype[e];return 1<arguments.length?d.apply(this,k.call(arguments,1)):d.call(this)}var k=Array.prototype.slice,g=function(){},c=function(){for(var e in{toString:1})if("toString"===e)return!1;return!0}(),f=function(e,d,a){for(var b in d)b in e.prototype&&"function"===typeof e.prototype[b]&&-1<(d[b]+"").indexOf("callSuper")?e.prototype[b]=function(e){return function(){var c=this.constructor.superclass;this.constructor.superclass=
a;var b=d[e].apply(this,arguments);this.constructor.superclass=c;if("initialize"!==e)return b}}(b):e.prototype[b]=d[b],c&&(d.toString!==Object.prototype.toString&&(e.prototype.toString=d.toString),d.valueOf!==Object.prototype.valueOf&&(e.prototype.valueOf=d.valueOf))};b.util.createClass=function(){function e(){this.initialize.apply(this,arguments)}var d=null,c=k.call(arguments,0);"function"===typeof c[0]&&(d=c.shift());e.superclass=d;e.subclasses=[];d&&(a.prototype=d.prototype,e.prototype=new a,d.subclasses.push(e));
for(var b=0,r=c.length;b<r;b++)f(e,c[b],d);e.prototype.initialize||(e.prototype.initialize=g);e.prototype.constructor=e;e.prototype.callSuper=h;return e}})();(function(){function a(d){var e=Array.prototype.slice.call(arguments,1),c,a=e.length;for(c=0;c<a;c++){var b=typeof d[e[c]];if(!/^(?:function|object|unknown)$/.test(b))return!1}return!0}function h(d,e){return function(a){e.call(c(d),a||b.window.event)}}function k(d,e){return function(c){if(A[d]&&A[d][e])for(var a=A[d][e],f=0,g=a.length;f<g;f++)a[f].call(this,
c||b.window.event)}}function g(d,e,c){var a="touchend"===d.type?"changedTouches":"touches";return d[a]&&d[a][0]?d[a][0][e]-(d[a][0][e]-d[a][0][c])||d[c]:d[c]}var c,f,e=function(){var d=0;return function(e){return e.__uniqueID||(e.__uniqueID="uniqueID__"+d++)}}();(function(){var d={};c=function(e){return d[e]};f=function(e,c){d[e]=c}})();var d=a(b.document.documentElement,"addEventListener","removeEventListener")&&a(b.window,"addEventListener","removeEventListener"),q=a(b.document.documentElement,
"attachEvent","detachEvent")&&a(b.window,"attachEvent","detachEvent"),v={},A={};d?(d=function(d,e,c){d.addEventListener(e,c,!1)},q=function(d,e,c){d.removeEventListener(e,c,!1)}):q?(d=function(d,c,a){var b=e(d);f(b,d);v[b]||(v[b]={});v[b][c]||(v[b][c]=[]);a={handler:a,wrappedHandler:h(b,a)};v[b][c].push(a);d.attachEvent("on"+c,a.wrappedHandler)},q=function(d,c,a){var b=e(d),f;if(v[b]&&v[b][c])for(var g=0,h=v[b][c].length;g<h;g++)(f=v[b][c][g])&&f.handler===a&&(d.detachEvent("on"+c,f.wrappedHandler),
v[b][c][g]=null)}):(d=function(d,c,a){var b=e(d);A[b]||(A[b]={});if(!A[b][c]){A[b][c]=[];var f=d["on"+c];f&&A[b][c].push(f);d["on"+c]=k(b,c)}A[b][c].push(a)},q=function(d,c,a){d=e(d);if(A[d]&&A[d][c]){c=A[d][c];d=0;for(var b=c.length;d<b;d++)c[d]===a&&c.splice(d,1)}});b.util.addListener=d;b.util.removeListener=q;var x=function(d){return"unknown"!==typeof d.clientX?d.clientX:0},l=function(d){return"unknown"!==typeof d.clientY?d.clientY:0};b.isTouchSupported&&(x=function(d){return g(d,"pageX","clientX")},
l=function(d){return g(d,"pageY","clientY")});b.util.getPointer=function(d,e){d||(d=b.window.event);e=b.util.getScrollLeftTop(d.target||("unknown"!==typeof d.srcElement?d.srcElement:null),e);return{x:x(d)+e.left,y:l(d)+e.top}};b.util.object.extend(b.util,b.Observable)})();(function(){var a=b.document.createElement("div"),h="string"===typeof a.style.filter,k=/alpha\s*\(\s*opacity\s*=\s*([^\)]+)\)/,g=function(c){return c};"string"===typeof a.style.opacity?g=function(c,a){c.style.opacity=a;return c}:
h&&(g=function(c,a){var e=c.style;c.currentStyle&&!c.currentStyle.hasLayout&&(e.zoom=1);k.test(e.filter)?e.filter=e.filter.replace(k,.9999<=a?"":"alpha(opacity="+100*a+")"):e.filter+=" alpha(opacity="+100*a+")";return c});b.util.setStyle=function(c,a){var e=c.style;if(!e)return c;if("string"===typeof a)return c.style.cssText+=";"+a,-1<a.indexOf("opacity")?g(c,a.match(/opacity:\s*(\d?\.?\d*)/)[1]):c;for(var d in a)"opacity"===d?g(c,a[d]):e["float"===d||"cssFloat"===d?"undefined"===typeof e.styleFloat?
"cssFloat":"styleFloat":d]=a[d];return c}})();(function(){function a(c,e){c=b.document.createElement(c);for(var d in e)"class"===d?c.className=e[d]:"for"===d?c.htmlFor=e[d]:c.setAttribute(d,e[d]);return c}var h=Array.prototype.slice,k=function(c){return h.call(c,0)};try{var g=k(b.document.childNodes)instanceof Array}catch(f){}g||(k=function(c){for(var e=Array(c.length),d=c.length;d--;)e[d]=c[d];return e});var c=b.document.defaultView&&b.document.defaultView.getComputedStyle?function(c,e){return(c=
b.document.defaultView.getComputedStyle(c,null))?c[e]:void 0}:function(c,e){var d=c.style[e];!d&&c.currentStyle&&(d=c.currentStyle[e]);return d};(function(){var c=b.document.documentElement.style,e="userSelect"in c?"userSelect":"MozUserSelect"in c?"MozUserSelect":"WebkitUserSelect"in c?"WebkitUserSelect":"KhtmlUserSelect"in c?"KhtmlUserSelect":"";b.util.makeElementUnselectable=function(d){"undefined"!==typeof d.onselectstart&&(d.onselectstart=b.util.falseFunction);e?d.style[e]="none":"string"===typeof d.unselectable&&
(d.unselectable="on");return d};b.util.makeElementSelectable=function(d){"undefined"!==typeof d.onselectstart&&(d.onselectstart=null);e?d.style[e]="":"string"===typeof d.unselectable&&(d.unselectable="");return d}})();(function(){b.util.getScript=function(c,e){var d=b.document.getElementsByTagName("head")[0],a=b.document.createElement("script"),f=!0;a.onload=a.onreadystatechange=function(d){!f||"string"===typeof this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState||(f=!1,e(d||
b.window.event),a=a.onload=a.onreadystatechange=null)};a.src=c;d.appendChild(a)}})();b.util.getById=function(c){return"string"===typeof c?b.document.getElementById(c):c};b.util.toArray=k;b.util.makeElement=a;b.util.addClass=function(c,e){c&&-1===(" "+c.className+" ").indexOf(" "+e+" ")&&(c.className+=(c.className?" ":"")+e)};b.util.wrapElement=function(c,e,d){"string"===typeof e&&(e=a(e,d));c.parentNode&&c.parentNode.replaceChild(e,c);e.appendChild(c);return e};b.util.getScrollLeftTop=function(c,
e){var d,a,f=0,g=0,h=b.document.documentElement,k=b.document.body||{scrollLeft:0,scrollTop:0};for(a=c;c&&c.parentNode&&!d;)c=c.parentNode,1===c.nodeType&&"fixed"===b.util.getElementStyle(c,"position")&&(d=c),1===c.nodeType&&a!==e&&"absolute"===b.util.getElementStyle(c,"position")?g=f=0:c===b.document?(f=k.scrollLeft||h.scrollLeft||0,g=k.scrollTop||h.scrollTop||0):(f+=c.scrollLeft||0,g+=c.scrollTop||0);return{left:f,top:g}};b.util.getElementOffset=function(a){var e=a&&a.ownerDocument;var d={left:0,
top:0},f={left:0,top:0},g={borderLeftWidth:"left",borderTopWidth:"top",paddingLeft:"left",paddingTop:"top"};if(!e)return{left:0,top:0};for(var h in g)f[g[h]]+=parseInt(c(a,h),10)||0;e=e.documentElement;"undefined"!==typeof a.getBoundingClientRect&&(d=a.getBoundingClientRect());a=b.util.getScrollLeftTop(a,null);return{left:d.left+a.left-(e.clientLeft||0)+f.left,top:d.top+a.top-(e.clientTop||0)+f.top}};b.util.getElementStyle=c})();(function(){function a(a,c){return a+(/\?/.test(a)?"&":"?")+c}function h(){}
var k=function(){for(var a=[function(){return new ActiveXObject("Microsoft.XMLHTTP")},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml2.XMLHTTP.3.0")},function(){return new XMLHttpRequest}],c=a.length;c--;)try{if(a[c]())return a[c]}catch(f){}}();b.util.request=function(b,c){c||(c={});var f=c.method?c.method.toUpperCase():"GET",e=c.onComplete||function(){},d=k();d.onreadystatechange=function(){4===d.readyState&&(e(d),d.onreadystatechange=h)};if("GET"===
f){var g=null;"string"===typeof c.parameters&&(b=a(b,c.parameters))}d.open(f,b,!0);"POST"!==f&&"PUT"!==f||d.setRequestHeader("Content-Type","application/x-www-form-urlencoded");d.send(g);return d}})();b.log=function(){};b.warn=function(){};"undefined"!==typeof console&&["log","warn"].forEach(function(a){"undefined"!==typeof console[a]&&"function"===typeof console[a].apply&&(b[a]=function(){return console[a].apply(console,arguments)})});(function(a){function b(a,b){this.x=a;this.y=b}a=a.fabric||(a.fabric=
{});a.Point?a.warn("fabric.Point is already defined"):(a.Point=b,b.prototype={constructor:b,add:function(a){return new b(this.x+a.x,this.y+a.y)},addEquals:function(a){this.x+=a.x;this.y+=a.y;return this},scalarAdd:function(a){return new b(this.x+a,this.y+a)},scalarAddEquals:function(a){this.x+=a;this.y+=a;return this},subtract:function(a){return new b(this.x-a.x,this.y-a.y)},subtractEquals:function(a){this.x-=a.x;this.y-=a.y;return this},scalarSubtract:function(a){return new b(this.x-a,this.y-a)},
scalarSubtractEquals:function(a){this.x-=a;this.y-=a;return this},multiply:function(a){return new b(this.x*a,this.y*a)},multiplyEquals:function(a){this.x*=a;this.y*=a;return this},divide:function(a){return new b(this.x/a,this.y/a)},divideEquals:function(a){this.x/=a;this.y/=a;return this},eq:function(a){return this.x===a.x&&this.y===a.y},lt:function(a){return this.x<a.x&&this.y<a.y},lte:function(a){return this.x<=a.x&&this.y<=a.y},gt:function(a){return this.x>a.x&&this.y>a.y},gte:function(a){return this.x>=
a.x&&this.y>=a.y},lerp:function(a,g){return new b(this.x+(a.x-this.x)*g,this.y+(a.y-this.y)*g)},distanceFrom:function(a){var b=this.x-a.x;a=this.y-a.y;return Math.sqrt(b*b+a*a)},midPointFrom:function(a){return new b(this.x+(a.x-this.x)/2,this.y+(a.y-this.y)/2)},min:function(a){return new b(Math.min(this.x,a.x),Math.min(this.y,a.y))},max:function(a){return new b(Math.max(this.x,a.x),Math.max(this.y,a.y))},toString:function(){return this.x+","+this.y},setXY:function(a,b){this.x=a;this.y=b},setFromPoint:function(a){this.x=
a.x;this.y=a.y},swap:function(a){var b=this.x,c=this.y;this.x=a.x;this.y=a.y;a.x=b;a.y=c}})})("undefined"!==typeof a?a:this);(function(a){function b(a){this.status=a;this.points=[]}var k=a.fabric||(a.fabric={});k.Intersection?k.warn("fabric.Intersection is already defined"):(k.Intersection=b,k.Intersection.prototype={appendPoint:function(a){this.points.push(a)},appendPoints:function(a){this.points=this.points.concat(a)}},k.Intersection.intersectLineLine=function(a,c,f,e){var d=(e.x-f.x)*(a.y-f.y)-
(e.y-f.y)*(a.x-f.x);var g=(c.x-a.x)*(a.y-f.y)-(c.y-a.y)*(a.x-f.x);f=(e.y-f.y)*(c.x-a.x)-(e.x-f.x)*(c.y-a.y);0!==f?(d/=f,g/=f,0<=d&&1>=d&&0<=g&&1>=g?(g=new b("Intersection"),g.points.push(new k.Point(a.x+d*(c.x-a.x),a.y+d*(c.y-a.y)))):g=new b):g=0===d||0===g?new b("Coincident"):new b("Parallel");return g},k.Intersection.intersectLinePolygon=function(a,c,f){for(var e=new b,d=f.length,g=0;g<d;g++){var h=b.intersectLineLine(a,c,f[g],f[(g+1)%d]);e.appendPoints(h.points)}0<e.points.length&&(e.status="Intersection");
return e},k.Intersection.intersectPolygonPolygon=function(a,c){for(var f=new b,e=a.length,d=0;d<e;d++){var g=b.intersectLinePolygon(a[d],a[(d+1)%e],c);f.appendPoints(g.points)}0<f.points.length&&(f.status="Intersection");return f},k.Intersection.intersectPolygonRectangle=function(a,c,f){var e=c.min(f),d=c.max(f);f=new k.Point(d.x,e.y);var g=new k.Point(e.x,d.y);c=b.intersectLinePolygon(e,f,a);f=b.intersectLinePolygon(f,d,a);d=b.intersectLinePolygon(d,g,a);a=b.intersectLinePolygon(g,e,a);e=new b;e.appendPoints(c.points);
e.appendPoints(f.points);e.appendPoints(d.points);e.appendPoints(a.points);0<e.points.length&&(e.status="Intersection");return e})})("undefined"!==typeof a?a:this);(function(a){function b(a){a?this._tryParsingColor(a):this.setSource([0,0,0,1])}function k(a,b,e){0>e&&(e+=1);1<e&&--e;return e<1/6?a+6*(b-a)*e:.5>e?b:e<2/3?a+(b-a)*(2/3-e)*6:a}var g=a.fabric||(a.fabric={});g.Color?g.warn("fabric.Color is already defined."):(g.Color=b,g.Color.prototype={_tryParsingColor:function(a){var c;a in b.colorNameMap&&
(a=b.colorNameMap[a]);"transparent"===a?this.setSource([255,255,255,0]):((c=b.sourceFromHex(a))||(c=b.sourceFromRgb(a)),c||(c=b.sourceFromHsl(a)),c&&this.setSource(c))},_rgbToHsl:function(a,b,e){a/=255;b/=255;e/=255;var d=g.util.array.max([a,b,e]);var c=g.util.array.min([a,b,e]);var f=(d+c)/2;if(d===c)var h=c=0;else{var k=d-c;c=.5<f?k/(2-d-c):k/(d+c);switch(d){case a:h=(b-e)/k+(b<e?6:0);break;case b:h=(e-a)/k+2;break;case e:h=(a-b)/k+4}h/=6}return[Math.round(360*h),Math.round(100*c),Math.round(100*
f)]},getSource:function(){return this._source},setSource:function(a){this._source=a},toRgb:function(){var a=this.getSource();return"rgb("+a[0]+","+a[1]+","+a[2]+")"},toRgba:function(){var a=this.getSource();return"rgba("+a[0]+","+a[1]+","+a[2]+","+a[3]+")"},toHsl:function(){var a=this.getSource();a=this._rgbToHsl(a[0],a[1],a[2]);return"hsl("+a[0]+","+a[1]+"%,"+a[2]+"%)"},toHsla:function(){var a=this.getSource(),b=this._rgbToHsl(a[0],a[1],a[2]);return"hsla("+b[0]+","+b[1]+"%,"+b[2]+"%,"+a[3]+")"},
toHex:function(){var a=this.getSource();var b=a[0].toString(16);b=1===b.length?"0"+b:b;var e=a[1].toString(16);e=1===e.length?"0"+e:e;a=a[2].toString(16);a=1===a.length?"0"+a:a;return b.toUpperCase()+e.toUpperCase()+a.toUpperCase()},getAlpha:function(){return this.getSource()[3]},setAlpha:function(a){var c=this.getSource();c[3]=a;this.setSource(c);return this},toGrayscale:function(){var a=this.getSource(),b=parseInt((.3*a[0]+.59*a[1]+.11*a[2]).toFixed(0),10);this.setSource([b,b,b,a[3]]);return this},
toBlackWhite:function(a){var c=this.getSource(),e=(.3*c[0]+.59*c[1]+.11*c[2]).toFixed(0);c=c[3];e=Number(e)<Number(a||127)?0:255;this.setSource([e,e,e,c]);return this},overlayWith:function(a){a instanceof b||(a=new b(a));var c=[],e=this.getAlpha(),d=this.getSource();a=a.getSource();for(var g=0;3>g;g++)c.push(Math.round(.5*d[g]+.5*a[g]));c[3]=e;this.setSource(c);return this}},g.Color.reRGBa=/^rgba?\(\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/,
g.Color.reHSLa=/^hsla?\(\s*(\d{1,3})\s*,\s*(\d{1,3}\%)\s*,\s*(\d{1,3}\%)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/,g.Color.reHex=/^#?([0-9a-f]{6}|[0-9a-f]{3})$/i,g.Color.colorNameMap={aqua:"#00FFFF",black:"#000000",blue:"#0000FF",fuchsia:"#FF00FF",gray:"#808080",green:"#008000",lime:"#00FF00",maroon:"#800000",navy:"#000080",olive:"#808000",orange:"#FFA500",purple:"#800080",red:"#FF0000",silver:"#C0C0C0",teal:"#008080",white:"#FFFFFF",yellow:"#FFFF00"},g.Color.fromRgb=function(a){return b.fromSource(b.sourceFromRgb(a))},
g.Color.sourceFromRgb=function(a){if(a=a.match(b.reRGBa)){var c=parseInt(a[1],10)/(/%$/.test(a[1])?100:1)*(/%$/.test(a[1])?255:1),e=parseInt(a[2],10)/(/%$/.test(a[2])?100:1)*(/%$/.test(a[2])?255:1),d=parseInt(a[3],10)/(/%$/.test(a[3])?100:1)*(/%$/.test(a[3])?255:1);return[parseInt(c,10),parseInt(e,10),parseInt(d,10),a[4]?parseFloat(a[4]):1]}},g.Color.fromRgba=b.fromRgb,g.Color.fromHsl=function(a){return b.fromSource(b.sourceFromHsl(a))},g.Color.sourceFromHsl=function(a){if(a=a.match(b.reHSLa)){var c=
(parseFloat(a[1])%360+360)%360/360,e=parseFloat(a[2])/(/%$/.test(a[2])?100:1),d=parseFloat(a[3])/(/%$/.test(a[3])?100:1);if(0===e)d=e=c=d;else{var g=.5>=d?d*(e+1):d+e-d*e,h=2*d-g;d=k(h,g,c+1/3);e=k(h,g,c);c=k(h,g,c-1/3)}return[Math.round(255*d),Math.round(255*e),Math.round(255*c),a[4]?parseFloat(a[4]):1]}},g.Color.fromHsla=b.fromHsl,g.Color.fromHex=function(a){return b.fromSource(b.sourceFromHex(a))},g.Color.sourceFromHex=function(a){if(a.match(b.reHex)){var c=a.slice(a.indexOf("#")+1),e=3===c.length;
a=e?c.charAt(0)+c.charAt(0):c.substring(0,2);var d=e?c.charAt(1)+c.charAt(1):c.substring(2,4);c=e?c.charAt(2)+c.charAt(2):c.substring(4,6);return[parseInt(a,16),parseInt(d,16),parseInt(c,16),1]}},g.Color.fromSource=function(a){var c=new b;c.setSource(a);return c})})("undefined"!==typeof a?a:this);(function(){if(b.StaticCanvas)b.warn("fabric.StaticCanvas is already defined.");else{var a=b.util.object.extend,h=b.util.getElementOffset,k=b.util.removeFromArray,g=Error("Could not initialize `canvas` element");
b.StaticCanvas=b.util.createClass({initialize:function(a,f){f||(f={});this._initStatic(a,f);b.StaticCanvas.activeInstance=this},backgroundColor:"",backgroundImage:null,overlayColor:"",overlayImage:null,includeDefaultValues:!0,stateful:!0,renderOnAddRemove:!0,clipTo:null,controlsAboveOverlay:!1,allowTouchScrolling:!1,imageSmoothingEnabled:!0,preserveObjectStacking:!1,viewportTransform:[1,0,0,1,0,0],onBeforeScaleRotate:function(){},_initStatic:function(a,b){this._objects=[];this._createLowerCanvas(a);
this._initOptions(b);this._setImageSmoothing();b.overlayImage&&this.setOverlayImage(b.overlayImage,this.renderAll.bind(this));b.backgroundImage&&this.setBackgroundImage(b.backgroundImage,this.renderAll.bind(this));b.backgroundColor&&this.setBackgroundColor(b.backgroundColor,this.renderAll.bind(this));b.overlayColor&&this.setOverlayColor(b.overlayColor,this.renderAll.bind(this));this.calcOffset()},calcOffset:function(){this._offset=h(this.lowerCanvasEl);return this},setOverlayImage:function(a,b,e){return this.__setBgOverlayImage("overlayImage",
a,b,e)},setBackgroundImage:function(a,b,e){return this.__setBgOverlayImage("backgroundImage",a,b,e)},setOverlayColor:function(a,b){return this.__setBgOverlayColor("overlayColor",a,b)},setBackgroundColor:function(a,b){return this.__setBgOverlayColor("backgroundColor",a,b)},_setImageSmoothing:function(){var a=this.getContext();a.imageSmoothingEnabled=this.imageSmoothingEnabled;a.webkitImageSmoothingEnabled=this.imageSmoothingEnabled;a.mozImageSmoothingEnabled=this.imageSmoothingEnabled;a.msImageSmoothingEnabled=
this.imageSmoothingEnabled;a.oImageSmoothingEnabled=this.imageSmoothingEnabled},__setBgOverlayImage:function(a,f,e,d){"string"===typeof f?b.util.loadImage(f,function(c){this[a]=new b.Image(c,d);e&&e()},this,d&&d.crossOrigin):(d&&f.setOptions(d),this[a]=f,e&&e());return this},__setBgOverlayColor:function(a,f,e){if(f&&f.source){var d=this;b.util.loadImage(f.source,function(c){d[a]=new b.Pattern({source:c,repeat:f.repeat,offsetX:f.offsetX,offsetY:f.offsetY});e&&e()})}else this[a]=f,e&&e();return this},
_createCanvasElement:function(){var a=b.document.createElement("canvas");a.style||(a.style={});if(!a)throw g;this._initCanvasElement(a);return a},_initCanvasElement:function(a){b.util.createCanvasElement(a);if("undefined"===typeof a.getContext)throw g;},_initOptions:function(a){for(var c in a)this[c]=a[c];this.width=this.width||parseInt(this.lowerCanvasEl.width,10)||0;this.height=this.height||parseInt(this.lowerCanvasEl.height,10)||0;this.lowerCanvasEl.style&&(this.lowerCanvasEl.width=this.width,
this.lowerCanvasEl.height=this.height,this.lowerCanvasEl.style.width=this.width+"px",this.lowerCanvasEl.style.height=this.height+"px",this.viewportTransform=this.viewportTransform.slice())},_createLowerCanvas:function(a){this.lowerCanvasEl=b.util.getById(a)||this._createCanvasElement();this._initCanvasElement(this.lowerCanvasEl);b.util.addClass(this.lowerCanvasEl,"lower-canvas");this.interactive&&this._applyCanvasStyle(this.lowerCanvasEl);this.contextContainer=this.lowerCanvasEl.getContext("2d")},
getWidth:function(){return this.width},getHeight:function(){return this.height},setWidth:function(a,b){return this.setDimensions({width:a},b)},setHeight:function(a,b){return this.setDimensions({height:a},b)},setDimensions:function(a,b){b=b||{};for(var e in a){var d=a[e];b.cssOnly||(this._setBackstoreDimension(e,a[e]),d+="px");b.backstoreOnly||this._setCssDimension(e,d)}b.cssOnly||this.renderAll();this.calcOffset();return this},_setBackstoreDimension:function(a,b){this.lowerCanvasEl[a]=b;this.upperCanvasEl&&
(this.upperCanvasEl[a]=b);this.cacheCanvasEl&&(this.cacheCanvasEl[a]=b);this[a]=b;return this},_setCssDimension:function(a,b){this.lowerCanvasEl.style[a]=b;this.upperCanvasEl&&(this.upperCanvasEl.style[a]=b);this.wrapperEl&&(this.wrapperEl.style[a]=b);return this},getZoom:function(){return Math.sqrt(this.viewportTransform[0]*this.viewportTransform[3])},setViewportTransform:function(a){var c=this.getActiveGroup();this.viewportTransform=a;this.renderAll();a=0;for(var e=this._objects.length;a<e;a++)this._objects[a].setCoords();
c&&c.setCoords();return this},zoomToPoint:function(a,f){var e=a;a=b.util.transformPoint(a,b.util.invertTransform(this.viewportTransform));this.viewportTransform[0]=f;this.viewportTransform[3]=f;a=b.util.transformPoint(a,this.viewportTransform);this.viewportTransform[4]+=e.x-a.x;this.viewportTransform[5]+=e.y-a.y;this.renderAll();e=0;for(a=this._objects.length;e<a;e++)this._objects[e].setCoords();return this},setZoom:function(a){this.zoomToPoint(new b.Point(0,0),a);return this},absolutePan:function(a){this.viewportTransform[4]=
-a.x;this.viewportTransform[5]=-a.y;this.renderAll();a=0;for(var b=this._objects.length;a<b;a++)this._objects[a].setCoords();return this},relativePan:function(a){return this.absolutePan(new b.Point(-a.x-this.viewportTransform[4],-a.y-this.viewportTransform[5]))},getElement:function(){return this.lowerCanvasEl},getActiveObject:function(){return null},getActiveGroup:function(){return null},_draw:function(a,b){if(b){a.save();var e=this.viewportTransform;a.transform(e[0],e[1],e[2],e[3],e[4],e[5]);this._shouldRenderObject(b)&&
b.render(a);a.restore();this.controlsAboveOverlay||b._renderControls(a)}},_shouldRenderObject:function(a){return a?a!==this.getActiveGroup()||!this.preserveObjectStacking:!1},_onObjectAdded:function(a){this.stateful&&a.setupState();a.canvas=this;a.setCoords();this.fire("object:added",{target:a});a.fire("added")},_onObjectRemoved:function(a){this.getActiveObject()===a&&(this.fire("before:selection:cleared",{target:a}),this._discardActiveObject(),this.fire("selection:cleared"));this.fire("object:removed",
{target:a});a.fire("removed")},clearContext:function(a){a.clearRect(0,0,this.width,this.height);return this},getContext:function(){return this.contextContainer},clear:function(){this._objects.length=0;this.discardActiveGroup&&this.discardActiveGroup();this.discardActiveObject&&this.discardActiveObject();this.clearContext(this.contextContainer);this.contextTop&&this.clearContext(this.contextTop);this.fire("canvas:cleared");this.renderAll();return this},renderAll:function(a){var c=this[!0===a&&this.interactive?
"contextTop":"contextContainer"],e=this.getActiveGroup();this.contextTop&&this.selection&&!this._groupSelector&&this.clearContext(this.contextTop);a||this.clearContext(c);this.fire("before:render");this.clipTo&&b.util.clipContext(this,c);this._renderBackground(c);this._renderObjects(c,e);this._renderActiveGroup(c,e);this.clipTo&&c.restore();this._renderOverlay(c);this.controlsAboveOverlay&&this.interactive&&this.drawControls(c);this.fire("after:render");return this},_renderObjects:function(a,b){var e;
if(!b||this.preserveObjectStacking){var d=0;for(e=this._objects.length;d<e;++d)this._draw(a,this._objects[d])}else for(d=0,e=this._objects.length;d<e;++d)this._objects[d]&&!b.contains(this._objects[d])&&this._draw(a,this._objects[d])},_renderActiveGroup:function(a,b){if(b){var e=[];this.forEachObject(function(a){b.contains(a)&&e.push(a)});b._set("objects",e);this._draw(a,b)}},_renderBackground:function(a){this.backgroundColor&&(a.fillStyle=this.backgroundColor.toLive?this.backgroundColor.toLive(a):
this.backgroundColor,a.fillRect(this.backgroundColor.offsetX||0,this.backgroundColor.offsetY||0,this.width,this.height));this.backgroundImage&&this._draw(a,this.backgroundImage)},_renderOverlay:function(a){this.overlayColor&&(a.fillStyle=this.overlayColor.toLive?this.overlayColor.toLive(a):this.overlayColor,a.fillRect(this.overlayColor.offsetX||0,this.overlayColor.offsetY||0,this.width,this.height));this.overlayImage&&this._draw(a,this.overlayImage)},renderTop:function(){var a=this.contextTop||this.contextContainer;
this.clearContext(a);this.selection&&this._groupSelector&&this._drawSelection();var b=this.getActiveGroup();b&&b.render(a);this._renderOverlay(a);this.fire("after:render");return this},getCenter:function(){return{top:this.getHeight()/2,left:this.getWidth()/2}},centerObjectH:function(a){this._centerObject(a,new b.Point(this.getCenter().left,a.getCenterPoint().y));this.renderAll();return this},centerObjectV:function(a){this._centerObject(a,new b.Point(a.getCenterPoint().x,this.getCenter().top));this.renderAll();
return this},centerObject:function(a){var c=this.getCenter();this._centerObject(a,new b.Point(c.left,c.top));this.renderAll();return this},_centerObject:function(a,b){a.setPositionByOrigin(b,"center","center");return this},toDatalessJSON:function(a){return this.toDatalessObject(a)},toObject:function(a){return this._toObjectMethod("toObject",a)},toDatalessObject:function(a){return this._toObjectMethod("toDatalessObject",a)},_toObjectMethod:function(c,f){c={objects:this._toObjects(c,f)};a(c,this.__serializeBgOverlay());
b.util.populateWithProperties(this,c,f);return c},_toObjects:function(a,b){return this.getObjects().map(function(e){return this._toObject(e,a,b)},this)},_toObject:function(a,b,e){if(!this.includeDefaultValues){var d=a.includeDefaultValues;a.includeDefaultValues=!1}var c=this._realizeGroupTransformOnObject(a);b=a[b](e);this.includeDefaultValues||(a.includeDefaultValues=d);this._unwindGroupTransformOnObject(a,c);return b},_realizeGroupTransformOnObject:function(a){var b="angle flipX flipY height left scaleX scaleY top width".split(" ");
if(a.group&&a.group===this.getActiveGroup()){var e={};b.forEach(function(d){e[d]=a[d]});this.getActiveGroup().realizeTransform(a);return e}return null},_unwindGroupTransformOnObject:function(a,b){b&&a.set(b)},__serializeBgOverlay:function(){var a={background:this.backgroundColor&&this.backgroundColor.toObject?this.backgroundColor.toObject():this.backgroundColor};this.overlayColor&&(a.overlay=this.overlayColor.toObject?this.overlayColor.toObject():this.overlayColor);this.backgroundImage&&(a.backgroundImage=
this.backgroundImage.toObject());this.overlayImage&&(a.overlayImage=this.overlayImage.toObject());return a},svgViewportTransformation:!0,toSVG:function(a,b){a||(a={});var e=[];this._setSVGPreamble(e,a);this._setSVGHeader(e,a);this._setSVGBgOverlayColor(e,"backgroundColor");this._setSVGBgOverlayImage(e,"backgroundImage");this._setSVGObjects(e,b);this._setSVGBgOverlayColor(e,"overlayColor");this._setSVGBgOverlayImage(e,"overlayImage");e.push("</svg>");return e.join("")},_setSVGPreamble:function(a,b){b.suppressPreamble||
a.push('<?xml version="1.0" encoding="',b.encoding||"UTF-8",'" standalone="no" ?>','<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ','"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\n')},_setSVGHeader:function(a,f){if(f.viewBox){var e=f.viewBox.width;var d=f.viewBox.height}else if(e=this.width,d=this.height,!this.svgViewportTransformation){var c=this.viewportTransform;e/=c[0];d/=c[3]}a.push("<svg ",'xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ',
'width="',e,'" ','height="',d,'" ',this.backgroundColor&&!this.backgroundColor.toLive?'style="background-color: '+this.backgroundColor+'" ':null,f.viewBox?'viewBox="'+f.viewBox.x+" "+f.viewBox.y+" "+f.viewBox.width+" "+f.viewBox.height+'" ':null,'xml:space="preserve">',"<desc>Created with Fabric.js ",b.version,"</desc>","<defs>",b.createSVGFontFacesMarkup(this.getObjects()),b.createSVGRefElementsMarkup(this),"</defs>")},_setSVGObjects:function(a,b){for(var e=0,d=this.getObjects(),c=d.length;e<c;e++){var f=
d[e],g=this._realizeGroupTransformOnObject(f);a.push(f.toSVG(b));this._unwindGroupTransformOnObject(f,g)}},_setSVGBgOverlayImage:function(a,b){this[b]&&this[b].toSVG&&a.push(this[b].toSVG())},_setSVGBgOverlayColor:function(a,b){this[b]&&this[b].source?a.push('<rect x="',this[b].offsetX,'" y="',this[b].offsetY,'" ','width="',"repeat-y"===this[b].repeat||"no-repeat"===this[b].repeat?this[b].source.width:this.width,'" height="',"repeat-x"===this[b].repeat||"no-repeat"===this[b].repeat?this[b].source.height:
this.height,'" fill="url(#'+b+'Pattern)"',"></rect>"):this[b]&&"overlayColor"===b&&a.push('<rect x="0" y="0" ','width="',this.width,'" height="',this.height,'" fill="',this[b],'"',"></rect>")},sendToBack:function(a){k(this._objects,a);this._objects.unshift(a);return this.renderAll&&this.renderAll()},bringToFront:function(a){k(this._objects,a);this._objects.push(a);return this.renderAll&&this.renderAll()},sendBackwards:function(a,b){var e=this._objects.indexOf(a);0!==e&&(b=this._findNewLowerIndex(a,
e,b),k(this._objects,a),this._objects.splice(b,0,a),this.renderAll&&this.renderAll());return this},_findNewLowerIndex:function(a,b,e){if(e)for(e=b,--b;0<=b;--b){if(a.intersectsWithObject(this._objects[b])||a.isContainedWithinObject(this._objects[b])||this._objects[b].isContainedWithinObject(a)){e=b;break}}else e=b-1;return e},bringForward:function(a,b){var e=this._objects.indexOf(a);e!==this._objects.length-1&&(b=this._findNewUpperIndex(a,e,b),k(this._objects,a),this._objects.splice(b,0,a),this.renderAll&&
this.renderAll());return this},_findNewUpperIndex:function(a,b,e){if(e)for(e=b,b+=1;b<this._objects.length;++b){if(a.intersectsWithObject(this._objects[b])||a.isContainedWithinObject(this._objects[b])||this._objects[b].isContainedWithinObject(a)){e=b;break}}else e=b+1;return e},moveTo:function(a,b){k(this._objects,a);this._objects.splice(b,0,a);return this.renderAll&&this.renderAll()},dispose:function(){this.clear();this.interactive&&this.removeListeners();return this},toString:function(){return"#<fabric.Canvas ("+
this.complexity()+"): { objects: "+this.getObjects().length+" }>"}});a(b.StaticCanvas.prototype,b.Observable);a(b.StaticCanvas.prototype,b.Collection);a(b.StaticCanvas.prototype,b.DataURLExporter);a(b.StaticCanvas,{EMPTY_JSON:'{"objects": [], "background": "white"}',supports:function(a){var c=b.util.createCanvasElement();if(!c||!c.getContext)return null;var e=c.getContext("2d");if(!e)return null;switch(a){case "getImageData":return"undefined"!==typeof e.getImageData;case "setLineDash":return"undefined"!==
typeof e.setLineDash;case "toDataURL":return"undefined"!==typeof c.toDataURL;case "toDataURLWithQuality":try{return c.toDataURL("image/jpeg",0),!0}catch(d){}return!1;default:return null}}});b.StaticCanvas.prototype.toJSON=b.StaticCanvas.prototype.toObject}})();(function(){var a=b.util.getPointer,h=b.util.degreesToRadians,k=b.util.radiansToDegrees,g=Math.atan2,c=Math.abs;b.Canvas=b.util.createClass(b.StaticCanvas,{initialize:function(a,d){d||(d={});this._initStatic(a,d);this._initInteractive();this._createCacheCanvas();
b.Canvas.activeInstance=this},uniScaleTransform:!1,centeredScaling:!1,centeredRotation:!1,interactive:!0,selection:!0,selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",rotationCursor:"crosshair",containerClass:"canvas-container",perPixelTargetFind:!1,targetFindTolerance:0,skipTargetFind:!1,_initInteractive:function(){this._groupSelector=
this._currentTransform=null;this._initWrapperElement();this._createUpperCanvas();this._initEventListeners();this.freeDrawingBrush=b.PencilBrush&&new b.PencilBrush(this);this.calcOffset()},_resetCurrentTransform:function(a){var d=this._currentTransform;d.target.set({scaleX:d.original.scaleX,scaleY:d.original.scaleY,left:d.original.left,top:d.original.top});this._shouldCenterTransform(a,d.target)?"rotate"===d.action?this._setOriginToCenter(d.target):("center"!==d.originX&&(d.mouseXSign="right"===d.originX?
-1:1),"center"!==d.originY&&(d.mouseYSign="bottom"===d.originY?-1:1),d.originX="center",d.originY="center"):(d.originX=d.original.originX,d.originY=d.original.originY)},containsPoint:function(a,d){a=this.getPointer(a,!0);var b=this._normalizePointer(d,a);return d.containsPoint(b)||d._findTargetCorner(a)},_normalizePointer:function(a,d){var e=this.getActiveGroup(),c=d.x;d=d.y;e&&"group"!==a.type&&e.contains(a)&&(a=new b.Point(e.left,e.top),a=b.util.transformPoint(a,this.viewportTransform,!0),c-=a.x,
d-=a.y);return{x:c,y:d}},isTargetTransparent:function(a,d,c){var e=a.hasBorders,f=a.transparentCorners;a.hasBorders=a.transparentCorners=!1;this._draw(this.contextCache,a);a.hasBorders=e;a.transparentCorners=f;a=b.util.isTransparent(this.contextCache,d,c,this.targetFindTolerance);this.clearContext(this.contextCache);return a},_shouldClearSelection:function(a,d){var b=this.getActiveGroup(),e=this.getActiveObject();return!d||d&&b&&!b.contains(d)&&b!==d&&!a.shiftKey||d&&!d.evented||d&&!d.selectable&&
e&&e!==d},_shouldCenterTransform:function(a,d){if(d){var b=this._currentTransform,e;"scale"===b.action||"scaleX"===b.action||"scaleY"===b.action?e=this.centeredScaling||d.centeredScaling:"rotate"===b.action&&(e=this.centeredRotation||d.centeredRotation);return e?!a.altKey:a.altKey}},_getOriginFromCorner:function(a,d){a={x:a.originX,y:a.originY};if("ml"===d||"tl"===d||"bl"===d)a.x="right";else if("mr"===d||"tr"===d||"br"===d)a.x="left";if("tl"===d||"mt"===d||"tr"===d)a.y="bottom";else if("bl"===d||
"mb"===d||"br"===d)a.y="top";return a},_getActionFromCorner:function(a,d){a="drag";d&&(a="ml"===d||"mr"===d?"scaleX":"mt"===d||"mb"===d?"scaleY":"mtr"===d?"rotate":"scale");return a},_setupCurrentTransform:function(a,d){if(d){var b=this.getPointer(a),e=d._findTargetCorner(this.getPointer(a,!0)),c=this._getActionFromCorner(d,e);e=this._getOriginFromCorner(d,e);this._currentTransform={target:d,action:c,scaleX:d.scaleX,scaleY:d.scaleY,offsetX:b.x-d.left,offsetY:b.y-d.top,originX:e.x,originY:e.y,ex:b.x,
ey:b.y,left:d.left,top:d.top,theta:h(d.angle),width:d.width*d.scaleX,mouseXSign:1,mouseYSign:1};this._currentTransform.original={left:d.left,top:d.top,scaleX:d.scaleX,scaleY:d.scaleY,originX:e.x,originY:e.y};this._resetCurrentTransform(a)}},_translateObject:function(a,d){var b=this._currentTransform.target;b.get("lockMovementX")||b.set("left",a-this._currentTransform.offsetX);b.get("lockMovementY")||b.set("top",d-this._currentTransform.offsetY)},_scaleObject:function(a,d,c){var e=this._currentTransform,
f=e.target,g=f.get("lockScalingX"),h=f.get("lockScalingY"),k=f.get("lockScalingFlip");if(!g||!h){var q=f.translateToOriginPoint(f.getCenterPoint(),e.originX,e.originY);a=f.toLocalPoint(new b.Point(a,d),e.originX,e.originY);this._setLocalMouse(a,e);this._setObjectScale(a,e,g,h,c,k);f.setPositionByOrigin(q,e.originX,e.originY)}},_setObjectScale:function(a,d,b,c,f,g){var e=d.target,h=!1,k=!1,q=e.stroke?e.strokeWidth:0;d.newScaleX=a.x/(e.width+q/2);d.newScaleY=a.y/(e.height+q/2);g&&0>=d.newScaleX&&d.newScaleX<
e.scaleX&&(h=!0);g&&0>=d.newScaleY&&d.newScaleY<e.scaleY&&(k=!0);"equally"!==f||b||c?f?"x"!==f||e.get("lockUniScaling")?"y"!==f||e.get("lockUniScaling")||k||c||e.set("scaleY",d.newScaleY):h||b||e.set("scaleX",d.newScaleX):(h||b||e.set("scaleX",d.newScaleX),k||c||e.set("scaleY",d.newScaleY)):h||k||this._scaleObjectEqually(a,e,d);h||k||this._flipObject(d,f)},_scaleObjectEqually:function(a,d,b){a=a.y+a.x;var e=d.stroke?d.strokeWidth:0;e=(d.height+e/2)*b.original.scaleY+(d.width+e/2)*b.original.scaleX;
b.newScaleX=b.original.scaleX*a/e;b.newScaleY=b.original.scaleY*a/e;d.set("scaleX",b.newScaleX);d.set("scaleY",b.newScaleY)},_flipObject:function(a,d){0>a.newScaleX&&"y"!==d&&("left"===a.originX?a.originX="right":"right"===a.originX&&(a.originX="left"));0>a.newScaleY&&"x"!==d&&("top"===a.originY?a.originY="bottom":"bottom"===a.originY&&(a.originY="top"))},_setLocalMouse:function(a,d){var b=d.target;"right"===d.originX?a.x*=-1:"center"===d.originX&&(a.x=2*a.x*d.mouseXSign,0>a.x&&(d.mouseXSign=-d.mouseXSign));
"bottom"===d.originY?a.y*=-1:"center"===d.originY&&(a.y=2*a.y*d.mouseYSign,0>a.y&&(d.mouseYSign=-d.mouseYSign));c(a.x)>b.padding?a.x=0>a.x?a.x+b.padding:a.x-b.padding:a.x=0;c(a.y)>b.padding?a.y=0>a.y?a.y+b.padding:a.y-b.padding:a.y=0},_rotateObject:function(a,d){var b=this._currentTransform;if(!b.target.get("lockRotation")){var e=g(b.ey-b.top,b.ex-b.left);a=g(d-b.top,a-b.left);e=k(a-e+b.theta);0>e&&(e=360+e);b.target.angle=e%360}},setCursor:function(a){this.upperCanvasEl.style.cursor=a},_resetObjectTransform:function(a){a.scaleX=
1;a.scaleY=1;a.setAngle(0)},_drawSelection:function(){var a=this.contextTop,d=this._groupSelector,f=d.left,g=d.top,h=c(f),k=c(g);a.fillStyle=this.selectionColor;a.fillRect(d.ex-(0<f?0:-f),d.ey-(0<g?0:-g),h,k);a.lineWidth=this.selectionLineWidth;a.strokeStyle=this.selectionBorderColor;1<this.selectionDashArray.length?(f=d.ex+.5-(0<f?0:h),d=d.ey+.5-(0<g?0:k),a.beginPath(),b.util.drawDashedLine(a,f,d,f+h,d,this.selectionDashArray),b.util.drawDashedLine(a,f,d+k-1,f+h,d+k-1,this.selectionDashArray),b.util.drawDashedLine(a,
f,d,f,d+k,this.selectionDashArray),b.util.drawDashedLine(a,f+h-1,d,f+h-1,d+k,this.selectionDashArray),a.closePath(),a.stroke()):a.strokeRect(d.ex+.5-(0<f?0:h),d.ey+.5-(0<g?0:k),h,k)},_isLastRenderedObject:function(a){return this.controlsAboveOverlay&&this.lastRenderedObjectWithControlsAboveOverlay&&this.lastRenderedObjectWithControlsAboveOverlay.visible&&this.containsPoint(a,this.lastRenderedObjectWithControlsAboveOverlay)&&this.lastRenderedObjectWithControlsAboveOverlay._findTargetCorner(this.getPointer(a,
!0))},findTarget:function(a,d){if(!this.skipTargetFind){if(this._isLastRenderedObject(a))return this.lastRenderedObjectWithControlsAboveOverlay;var b=this.getActiveGroup();if(b&&!d&&this.containsPoint(a,b))return b;a=this._searchPossibleTargets(a);this._fireOverOutEvents(a);return a}},_fireOverOutEvents:function(a){a?this._hoveredTarget!==a&&(this.fire("mouse:over",{target:a}),a.fire("mouseover"),this._hoveredTarget&&(this.fire("mouse:out",{target:this._hoveredTarget}),this._hoveredTarget.fire("mouseout")),
this._hoveredTarget=a):this._hoveredTarget&&(this.fire("mouse:out",{target:this._hoveredTarget}),this._hoveredTarget.fire("mouseout"),this._hoveredTarget=null)},_checkTarget:function(a,d,b){if(d&&d.visible&&d.evented&&this.containsPoint(a,d)&&(!this.perPixelTargetFind&&!d.perPixelTargetFind||d.isEditing||!this.isTargetTransparent(d,b.x,b.y)))return!0},_searchPossibleTargets:function(a){for(var d,b=this.getPointer(a,!0),e=this._objects.length;e--;)if(!this._objects[e].group&&this._checkTarget(a,this._objects[e],
b)){this.relatedTarget=this._objects[e];d=this._objects[e];break}return d},getPointer:function(e,d,c){c||(c=this.upperCanvasEl);e=a(e,c);var f=c.getBoundingClientRect(),g=f.width||0,h=f.height||0;g&&h||("top"in f&&"bottom"in f&&(h=Math.abs(f.top-f.bottom)),"right"in f&&"left"in f&&(g=Math.abs(f.right-f.left)));this.calcOffset();e.x-=this._offset.left;e.y-=this._offset.top;d||(e=b.util.transformPoint(e,b.util.invertTransform(this.viewportTransform)));0===g||0===h?c=d=1:(d=c.width/g,c=c.height/h);return{x:e.x*
d,y:e.y*c}},_createUpperCanvas:function(){var a=this.lowerCanvasEl.className.replace(/\s*lower-canvas\s*/,"");this.upperCanvasEl=this._createCanvasElement();b.util.addClass(this.upperCanvasEl,"upper-canvas "+a);this.wrapperEl.appendChild(this.upperCanvasEl);this._copyCanvasStyle(this.lowerCanvasEl,this.upperCanvasEl);this._applyCanvasStyle(this.upperCanvasEl);this.contextTop=this.upperCanvasEl.getContext("2d")},_createCacheCanvas:function(){this.cacheCanvasEl=this._createCanvasElement();this.cacheCanvasEl.setAttribute("width",
this.width);this.cacheCanvasEl.setAttribute("height",this.height);this.contextCache=this.cacheCanvasEl.getContext("2d")},_initWrapperElement:function(){this.wrapperEl=b.util.wrapElement(this.lowerCanvasEl,"div",{"class":this.containerClass});b.util.setStyle(this.wrapperEl,{width:this.getWidth()+"px",height:this.getHeight()+"px",position:"relative"});b.util.makeElementUnselectable(this.wrapperEl)},_applyCanvasStyle:function(a){var d=this.getWidth()||a.width,e=this.getHeight()||a.height;b.util.setStyle(a,
{position:"absolute",width:d+"px",height:e+"px",left:0,top:0});a.width=d;a.height=e;b.util.makeElementUnselectable(a)},_copyCanvasStyle:function(a,d){d.style.cssText=a.style.cssText},getSelectionContext:function(){return this.contextTop},getSelectionElement:function(){return this.upperCanvasEl},_setActiveObject:function(a){this._activeObject&&this._activeObject.set("active",!1);this._activeObject=a;a.set("active",!0)},setActiveObject:function(a,d){this._setActiveObject(a);this.renderAll();this.fire("object:selected",
{target:a,e:d});a.fire("selected",{e:d});return this},getActiveObject:function(){return this._activeObject},_discardActiveObject:function(){this._activeObject&&this._activeObject.set("active",!1);this._activeObject=null},discardActiveObject:function(a){this._discardActiveObject();this.renderAll();this.fire("selection:cleared",{e:a});return this},_setActiveGroup:function(a){(this._activeGroup=a)&&a.set("active",!0)},setActiveGroup:function(a,d){this._setActiveGroup(a);a&&(this.fire("object:selected",
{target:a,e:d}),a.fire("selected",{e:d}));return this},getActiveGroup:function(){return this._activeGroup},_discardActiveGroup:function(){var a=this.getActiveGroup();a&&a.destroy();this.setActiveGroup(null)},discardActiveGroup:function(a){this._discardActiveGroup();this.fire("selection:cleared",{e:a});return this},deactivateAll:function(){for(var a=this.getObjects(),d=0,b=a.length;d<b;d++)a[d].set("active",!1);this._discardActiveGroup();this._discardActiveObject();return this},deactivateAllWithDispatch:function(a){var d=
this.getActiveGroup()||this.getActiveObject();d&&this.fire("before:selection:cleared",{target:d,e:a});this.deactivateAll();d&&this.fire("selection:cleared",{e:a});return this},drawControls:function(a){var d=this.getActiveGroup();d?this._drawGroupControls(a,d):this._drawObjectsControls(a)},_drawGroupControls:function(a,d){d._renderControls(a)},_drawObjectsControls:function(a){for(var d=0,b=this._objects.length;d<b;++d)this._objects[d]&&this._objects[d].active&&(this._objects[d]._renderControls(a),
this.lastRenderedObjectWithControlsAboveOverlay=this._objects[d])}});for(var f in b.StaticCanvas)"prototype"!==f&&(b.Canvas[f]=b.StaticCanvas[f]);b.isTouchSupported&&(b.Canvas.prototype._setCursorFromEvent=function(){});b.Element=b.Canvas})();(function(){var a={mt:0,tr:1,mr:2,br:3,mb:4,bl:5,ml:6,tl:7},h=b.util.addListener,k=b.util.removeListener;b.util.object.extend(b.Canvas.prototype,{cursorMap:"n-resize ne-resize e-resize se-resize s-resize sw-resize w-resize nw-resize".split(" "),_initEventListeners:function(){this._bindEvents();
h(b.window,"resize",this._onResize);h(this.upperCanvasEl,"mousedown",this._onMouseDown);h(this.upperCanvasEl,"mousemove",this._onMouseMove);h(this.upperCanvasEl,"mousewheel",this._onMouseWheel);h(this.upperCanvasEl,"touchstart",this._onMouseDown);h(this.upperCanvasEl,"touchmove",this._onMouseMove);"undefined"!==typeof eventjs&&"add"in eventjs&&(eventjs.add(this.upperCanvasEl,"gesture",this._onGesture),eventjs.add(this.upperCanvasEl,"drag",this._onDrag),eventjs.add(this.upperCanvasEl,"orientation",
this._onOrientationChange),eventjs.add(this.upperCanvasEl,"shake",this._onShake),eventjs.add(this.upperCanvasEl,"longpress",this._onLongPress))},_bindEvents:function(){this._onMouseDown=this._onMouseDown.bind(this);this._onMouseMove=this._onMouseMove.bind(this);this._onMouseUp=this._onMouseUp.bind(this);this._onResize=this._onResize.bind(this);this._onGesture=this._onGesture.bind(this);this._onDrag=this._onDrag.bind(this);this._onShake=this._onShake.bind(this);this._onLongPress=this._onLongPress.bind(this);
this._onOrientationChange=this._onOrientationChange.bind(this);this._onMouseWheel=this._onMouseWheel.bind(this)},removeListeners:function(){k(b.window,"resize",this._onResize);k(this.upperCanvasEl,"mousedown",this._onMouseDown);k(this.upperCanvasEl,"mousemove",this._onMouseMove);k(this.upperCanvasEl,"mousewheel",this._onMouseWheel);k(this.upperCanvasEl,"touchstart",this._onMouseDown);k(this.upperCanvasEl,"touchmove",this._onMouseMove);"undefined"!==typeof eventjs&&"remove"in eventjs&&(eventjs.remove(this.upperCanvasEl,
"gesture",this._onGesture),eventjs.remove(this.upperCanvasEl,"drag",this._onDrag),eventjs.remove(this.upperCanvasEl,"orientation",this._onOrientationChange),eventjs.remove(this.upperCanvasEl,"shake",this._onShake),eventjs.remove(this.upperCanvasEl,"longpress",this._onLongPress))},_onGesture:function(a,b){this.__onTransformGesture&&this.__onTransformGesture(a,b)},_onDrag:function(a,b){this.__onDrag&&this.__onDrag(a,b)},_onMouseWheel:function(a,b){this.__onMouseWheel&&this.__onMouseWheel(a,b)},_onOrientationChange:function(a,
b){this.__onOrientationChange&&this.__onOrientationChange(a,b)},_onShake:function(a,b){this.__onShake&&this.__onShake(a,b)},_onLongPress:function(a,b){this.__onLongPress&&this.__onLongPress(a,b)},_onMouseDown:function(a){this.__onMouseDown(a);h(b.document,"touchend",this._onMouseUp);h(b.document,"touchmove",this._onMouseMove);k(this.upperCanvasEl,"mousemove",this._onMouseMove);k(this.upperCanvasEl,"touchmove",this._onMouseMove);"touchstart"===a.type?k(this.upperCanvasEl,"mousedown",this._onMouseDown):
(h(b.document,"mouseup",this._onMouseUp),h(b.document,"mousemove",this._onMouseMove))},_onMouseUp:function(a){this.__onMouseUp(a);k(b.document,"mouseup",this._onMouseUp);k(b.document,"touchend",this._onMouseUp);k(b.document,"mousemove",this._onMouseMove);k(b.document,"touchmove",this._onMouseMove);h(this.upperCanvasEl,"mousemove",this._onMouseMove);h(this.upperCanvasEl,"touchmove",this._onMouseMove);if("touchend"===a.type){var c=this;setTimeout(function(){h(c.upperCanvasEl,"mousedown",c._onMouseDown)},
400)}},_onMouseMove:function(a){!this.allowTouchScrolling&&a.preventDefault&&a.preventDefault();this.__onMouseMove(a)},_onResize:function(){this.calcOffset()},_shouldRender:function(a,b){var c=this.getActiveGroup()||this.getActiveObject();return!!(a&&(a.isMoving||a!==c)||!a&&c||!a&&!c&&!this._groupSelector||b&&this._previousPointer&&this.selection&&(b.x!==this._previousPointer.x||b.y!==this._previousPointer.y))},__onMouseUp:function(a){if(this.isDrawingMode&&this._isCurrentlyDrawing)this._onMouseUpInDrawingMode(a);
else{if(this._currentTransform){this._finalizeCurrentTransform();var b=this._currentTransform.target}else b=this.findTarget(a,!0);var f=this._shouldRender(b,this.getPointer(a));this._maybeGroupObjects(a);b&&(b.isMoving=!1);f&&this.renderAll();this._handleCursorAndEvent(a,b)}},_handleCursorAndEvent:function(a,b){this._setCursorFromEvent(a,b);var c=this;setTimeout(function(){c._setCursorFromEvent(a,b)},50);this.fire("mouse:up",{target:b,e:a});b&&b.fire("mouseup",{e:a})},_finalizeCurrentTransform:function(){var a=
this._currentTransform.target;a._scaling&&(a._scaling=!1);a.setCoords();this.stateful&&a.hasStateChanged()&&(this.fire("object:modified",{target:a}),a.fire("modified"));this._restoreOriginXY(a)},_restoreOriginXY:function(a){if(this._previousOriginX&&this._previousOriginY){var b=a.translateToOriginPoint(a.getCenterPoint(),this._previousOriginX,this._previousOriginY);a.originX=this._previousOriginX;a.originY=this._previousOriginY;a.left=b.x;a.top=b.y;this._previousOriginY=this._previousOriginX=null}},
_onMouseDownInDrawingMode:function(a){this._isCurrentlyDrawing=!0;this.discardActiveObject(a).renderAll();this.clipTo&&b.util.clipContext(this,this.contextTop);var c=b.util.invertTransform(this.viewportTransform);c=b.util.transformPoint(this.getPointer(a,!0),c);this.freeDrawingBrush.onMouseDown(c);this.fire("mouse:down",{e:a});c=this.findTarget(a);"undefined"!==typeof c&&c.fire("mousedown",{e:a,target:c})},_onMouseMoveInDrawingMode:function(a){if(this._isCurrentlyDrawing){var c=b.util.invertTransform(this.viewportTransform);
c=b.util.transformPoint(this.getPointer(a,!0),c);this.freeDrawingBrush.onMouseMove(c)}this.setCursor(this.freeDrawingCursor);this.fire("mouse:move",{e:a});c=this.findTarget(a);"undefined"!==typeof c&&c.fire("mousemove",{e:a,target:c})},_onMouseUpInDrawingMode:function(a){this._isCurrentlyDrawing=!1;this.clipTo&&this.contextTop.restore();this.freeDrawingBrush.onMouseUp();this.fire("mouse:up",{e:a});var b=this.findTarget(a);"undefined"!==typeof b&&b.fire("mouseup",{e:a,target:b})},__onMouseDown:function(a){if(("which"in
a?1===a.which:1===a.button)||b.isTouchSupported)if(this.isDrawingMode)this._onMouseDownInDrawingMode(a);else if(!this._currentTransform){var c=this.findTarget(a),f=this.getPointer(a,!0);this._previousPointer=f;var e=this._shouldRender(c,f),d=this._shouldGroup(a,c);this._shouldClearSelection(a,c)?this._clearSelection(a,c,f):d&&(this._handleGrouping(a,c),c=this.getActiveGroup());c&&c.selectable&&!d&&(this._beforeTransform(a,c),this._setupCurrentTransform(a,c));e&&this.renderAll();this.fire("mouse:down",
{target:c,e:a});c&&c.fire("mousedown",{e:a})}},_beforeTransform:function(a,b){this.stateful&&b.saveState();if(b._findTargetCorner(this.getPointer(a)))this.onBeforeScaleRotate(b);b!==this.getActiveGroup()&&b!==this.getActiveObject()&&(this.deactivateAll(),this.setActiveObject(b,a))},_clearSelection:function(a,b,f){this.deactivateAllWithDispatch(a);b&&b.selectable?this.setActiveObject(b,a):this.selection&&(this._groupSelector={ex:f.x,ey:f.y,top:0,left:0})},_setOriginToCenter:function(a){this._previousOriginX=
this._currentTransform.target.originX;this._previousOriginY=this._currentTransform.target.originY;var b=a.getCenterPoint();a.originX="center";a.originY="center";a.left=b.x;a.top=b.y;this._currentTransform.left=a.left;this._currentTransform.top=a.top},_setCenterToOrigin:function(a){var b=a.translateToOriginPoint(a.getCenterPoint(),this._previousOriginX,this._previousOriginY);a.originX=this._previousOriginX;a.originY=this._previousOriginY;a.left=b.x;a.top=b.y;this._previousOriginY=this._previousOriginX=
null},__onMouseMove:function(a){if(this.isDrawingMode)this._onMouseMoveInDrawingMode(a);else if(!("undefined"!==typeof a.touches&&1<a.touches.length)){var b=this._groupSelector;if(b){var f=this.getPointer(a,!0);b.left=f.x-b.ex;b.top=f.y-b.ey;this.renderTop()}else if(this._currentTransform)this._transformObject(a);else{var e=this.findTarget(a);!e||e&&!e.selectable?this.setCursor(this.defaultCursor):this._setCursorFromEvent(a,e)}this.fire("mouse:move",{target:e,e:a});e&&e.fire("mousemove",{e:a})}},
_transformObject:function(a){var b=this.getPointer(a),f=this._currentTransform;f.reset=!1;f.target.isMoving=!0;this._beforeScaleTransform(a,f);this._performTransformAction(a,f,b);this.renderAll()},_performTransformAction:function(a,b,f){var e=f.x;f=f.y;var d=b.target,c=b.action;"rotate"===c?(this._rotateObject(e,f),this._fire("rotating",d,a)):"scale"===c?(this._onScale(a,b,e,f),this._fire("scaling",d,a)):"scaleX"===c?(this._scaleObject(e,f,"x"),this._fire("scaling",d,a)):"scaleY"===c?(this._scaleObject(e,
f,"y"),this._fire("scaling",d,a)):(this._translateObject(e,f),this._fire("moving",d,a),this.setCursor(this.moveCursor))},_fire:function(a,b,f){this.fire("object:"+a,{target:b,e:f});b.fire(a,{e:f})},_beforeScaleTransform:function(a,b){if("scale"===b.action||"scaleX"===b.action||"scaleY"===b.action){var c=this._shouldCenterTransform(a,b.target);if(c&&("center"!==b.originX||"center"!==b.originY)||!c&&"center"===b.originX&&"center"===b.originY)this._resetCurrentTransform(a),b.reset=!0}},_onScale:function(a,
b,f,e){!a.shiftKey&&!this.uniScaleTransform||b.target.get("lockUniScaling")?(b.reset||"scale"!==b.currentAction||this._resetCurrentTransform(a,b.target),b.currentAction="scaleEqually",this._scaleObject(f,e,"equally")):(b.currentAction="scale",this._scaleObject(f,e))},_setCursorFromEvent:function(a,b){if(b&&b.selectable){var c=this.getActiveGroup();(a=b._findTargetCorner&&(!c||!c.contains(b))&&b._findTargetCorner(this.getPointer(a,!0)))?this._setCornerCursor(a,b):this.setCursor(b.hoverCursor||this.hoverCursor)}else return this.setCursor(this.defaultCursor),
!1;return!0},_setCornerCursor:function(b,c){if(b in a)this.setCursor(this._getRotatedCornerCursor(b,c));else if("mtr"===b&&c.hasRotatingPoint)this.setCursor(this.rotationCursor);else return this.setCursor(this.defaultCursor),!1},_getRotatedCornerCursor:function(b,c){c=Math.round(c.getAngle()%360/45);0>c&&(c+=8);c+=a[b];return this.cursorMap[c%8]}})})();(function(){var a=Math.min,h=Math.max;b.util.object.extend(b.Canvas.prototype,{_shouldGroup:function(a,b){var c=this.getActiveObject();return a.shiftKey&&
(this.getActiveGroup()||c&&c!==b)&&this.selection},_handleGrouping:function(a,b){if(b===this.getActiveGroup()&&(b=this.findTarget(a,!0),!b||b.isType("group")))return;this.getActiveGroup()?this._updateActiveGroup(b,a):this._createActiveGroup(b,a);this._activeGroup&&this._activeGroup.saveCoords()},_updateActiveGroup:function(a,b){var c=this.getActiveGroup();if(c.contains(a)){if(c.removeWithUpdate(a),this._resetObjectTransform(c),a.set("active",!1),1===c.size()){this.discardActiveGroup(b);this.setActiveObject(c.item(0));
return}}else c.addWithUpdate(a),this._resetObjectTransform(c);this.fire("selection:created",{target:c,e:b});c.set("active",!0)},_createActiveGroup:function(a,b){if(this._activeObject&&a!==this._activeObject){var c=this._createGroup(a);c.addWithUpdate();this.setActiveGroup(c);this._activeObject=null;this.fire("selection:created",{target:c,e:b})}a.set("active",!0)},_createGroup:function(a){var h=this.getObjects();a=h.indexOf(this._activeObject)<h.indexOf(a)?[this._activeObject,a]:[a,this._activeObject];
return new b.Group(a,{canvas:this})},_groupSelectedObjects:function(a){var h=this._collectObjects();1===h.length?this.setActiveObject(h[0],a):1<h.length&&(h=new b.Group(h.reverse(),{canvas:this}),h.addWithUpdate(),this.setActiveGroup(h,a),h.saveCoords(),this.fire("selection:created",{target:h}),this.renderAll())},_collectObjects:function(){var k=[];var g=this._groupSelector.ex;var c=this._groupSelector.ey,f=g+this._groupSelector.left,e=c+this._groupSelector.top,d=new b.Point(a(g,f),a(c,e)),q=new b.Point(h(g,
f),h(c,e));c=g===f&&c===e;for(f=this._objects.length;f--&&!((g=this._objects[f])&&g.selectable&&g.visible&&(g.intersectsWithRect(d,q)||g.isContainedWithinRect(d,q)||g.containsPoint(d)||g.containsPoint(q))&&(g.set("active",!0),k.push(g),c)););return k},_maybeGroupObjects:function(a){this.selection&&this._groupSelector&&this._groupSelectedObjects(a);if(a=this.getActiveGroup())a.setObjectsCoords().setCoords(),a.isMoving=!1,this.setCursor(this.defaultCursor);this._currentTransform=this._groupSelector=
null}})})();b.util.object.extend(b.StaticCanvas.prototype,{toDataURL:function(a){a||(a={});var b=a.format||"png",k=a.quality||1,g=a.multiplier||1;a={left:a.left,top:a.top,width:a.width,height:a.height};return 1!==g?this.__toDataURLWithMultiplier(b,k,a,g):this.__toDataURL(b,k,a)},__toDataURL:function(a,h,k){this.renderAll(!0);var g=this.upperCanvasEl||this.lowerCanvasEl;k=this.__getCroppedCanvas(g,k);"jpg"===a&&(a="jpeg");a=b.StaticCanvas.supports("toDataURLWithQuality")?(k||g).toDataURL("image/"+
a,h):(k||g).toDataURL("image/"+a);this.contextTop&&this.clearContext(this.contextTop);this.renderAll();return a},__getCroppedCanvas:function(a,h){if("left"in h||"top"in h||"width"in h||"height"in h){var k=b.util.createCanvasElement();var g=k.getContext("2d");k.width=h.width||this.width;k.height=h.height||this.height;g.drawImage(a,-h.left||0,-h.top||0)}return k},__toDataURLWithMultiplier:function(a,b,k,g){var c=this.getWidth(),f=this.getHeight(),e=c*g,d=f*g,h=this.getActiveObject(),v=this.getActiveGroup(),
l=this.contextTop||this.contextContainer;1<g&&this.setWidth(e).setHeight(d);l.scale(g,g);k.left&&(k.left*=g);k.top&&(k.top*=g);k.width?k.width*=g:1>g&&(k.width=e);k.height?k.height*=g:1>g&&(k.height=d);v?this._tempRemoveBordersControlsFromGroup(v):h&&this.deactivateAll&&this.deactivateAll();this.renderAll(!0);a=this.__toDataURL(a,b,k);this.width=c;this.height=f;l.scale(1/g,1/g);this.setWidth(c).setHeight(f);v?this._restoreBordersControlsOnGroup(v):h&&this.setActiveObject&&this.setActiveObject(h);
this.contextTop&&this.clearContext(this.contextTop);this.renderAll();return a},toDataURLWithMultiplier:function(a,b,k){return this.toDataURL({format:a,multiplier:b,quality:k})},_tempRemoveBordersControlsFromGroup:function(a){a.origHasControls=a.hasControls;a.origBorderColor=a.borderColor;a.hasControls=!0;a.borderColor="rgba(0,0,0,0)";a.forEachObject(function(a){a.origBorderColor=a.borderColor;a.borderColor="rgba(0,0,0,0)"})},_restoreBordersControlsOnGroup:function(a){a.hideControls=a.origHideControls;
a.borderColor=a.origBorderColor;a.forEachObject(function(a){a.borderColor=a.origBorderColor;delete a.origBorderColor})}});(function(a){var b=a.fabric||(a.fabric={});a=b.util.object.extend;var k=b.util.toFixed,g=b.util.string.capitalize,c=b.util.degreesToRadians,f=b.StaticCanvas.supports("setLineDash");b.Object||(b.Object=b.util.createClass({type:"object",originX:"left",originY:"top",top:0,left:0,width:0,height:0,scaleX:1,scaleY:1,flipX:!1,flipY:!1,opacity:1,angle:0,cornerSize:12,transparentCorners:!0,
hoverCursor:null,padding:0,borderColor:"rgba(102,153,255,0.75)",cornerColor:"rgba(102,153,255,0.5)",centeredScaling:!1,centeredRotation:!0,fill:"rgb(0,0,0)",fillRule:"nonzero",globalCompositeOperation:"source-over",backgroundColor:"",stroke:null,strokeWidth:1,strokeDashArray:null,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:10,shadow:null,borderOpacityWhenMoving:.4,borderScaleFactor:1,transformMatrix:null,minScaleLimit:.01,selectable:!0,evented:!0,visible:!0,hasControls:!0,hasBorders:!0,
hasRotatingPoint:!0,rotatingPointOffset:40,perPixelTargetFind:!1,includeDefaultValues:!0,clipTo:null,lockMovementX:!1,lockMovementY:!1,lockRotation:!1,lockScalingX:!1,lockScalingY:!1,lockUniScaling:!1,lockScalingFlip:!1,stateProperties:"top left width height scaleX scaleY flipX flipY originX originY transformMatrix stroke strokeWidth strokeDashArray strokeLineCap strokeLineJoin strokeMiterLimit angle opacity fill fillRule globalCompositeOperation shadow clipTo visible backgroundColor".split(" "),
initialize:function(a){a&&this.setOptions(a)},_initGradient:function(a){!a.fill||!a.fill.colorStops||a.fill instanceof b.Gradient||this.set("fill",new b.Gradient(a.fill))},_initPattern:function(a){!a.fill||!a.fill.source||a.fill instanceof b.Pattern||this.set("fill",new b.Pattern(a.fill));!a.stroke||!a.stroke.source||a.stroke instanceof b.Pattern||this.set("stroke",new b.Pattern(a.stroke))},_initClipping:function(a){a.clipTo&&"string"===typeof a.clipTo&&(a=b.util.getFunctionBody(a.clipTo),"undefined"!==
typeof a&&(this.clipTo=new Function("ctx",a)))},setOptions:function(a){for(var b in a)this.set(b,a[b]);this._initGradient(a);this._initPattern(a);this._initClipping(a)},transform:function(a,b){b=b?this._getLeftTopCoords():this.getCenterPoint();a.translate(b.x,b.y);a.rotate(c(this.angle));a.scale(this.scaleX*(this.flipX?-1:1),this.scaleY*(this.flipY?-1:1))},toObject:function(a){var d=b.Object.NUM_FRACTION_DIGITS;d={type:this.type,originX:this.originX,originY:this.originY,left:k(this.left,d),top:k(this.top,
d),width:k(this.width,d),height:k(this.height,d),fill:this.fill&&this.fill.toObject?this.fill.toObject():this.fill,stroke:this.stroke&&this.stroke.toObject?this.stroke.toObject():this.stroke,strokeWidth:k(this.strokeWidth,d),strokeDashArray:this.strokeDashArray,strokeLineCap:this.strokeLineCap,strokeLineJoin:this.strokeLineJoin,strokeMiterLimit:k(this.strokeMiterLimit,d),scaleX:k(this.scaleX,d),scaleY:k(this.scaleY,d),angle:k(this.getAngle(),d),flipX:this.flipX,flipY:this.flipY,opacity:k(this.opacity,
d),shadow:this.shadow&&this.shadow.toObject?this.shadow.toObject():this.shadow,visible:this.visible,clipTo:this.clipTo&&String(this.clipTo),backgroundColor:this.backgroundColor,fillRule:this.fillRule,globalCompositeOperation:this.globalCompositeOperation};this.includeDefaultValues||(d=this._removeDefaultValues(d));b.util.populateWithProperties(this,d,a);return d},toDatalessObject:function(a){return this.toObject(a)},_removeDefaultValues:function(a){var d=b.util.getKlass(a.type).prototype;d.stateProperties.forEach(function(b){a[b]===
d[b]&&delete a[b]});return a},toString:function(){return"#<fabric."+g(this.type)+">"},get:function(a){return this[a]},_setObject:function(a){for(var b in a)this._set(b,a[b])},set:function(a,b){"object"===typeof a?this._setObject(a):"function"===typeof b&&"clipTo"!==a?this._set(a,b(this.get(a))):this._set(a,b);return this},_set:function(a,d){if("scaleX"===a||"scaleY"===a)d=this._constrainScale(d);"scaleX"===a&&0>d?(this.flipX=!this.flipX,d*=-1):"scaleY"===a&&0>d?(this.flipY=!this.flipY,d*=-1):"width"===
a||"height"===a?this.minScaleLimit=k(Math.min(.1,1/Math.max(this.width,this.height)),2):"shadow"!==a||!d||d instanceof b.Shadow||(d=new b.Shadow(d));this[a]=d;return this},toggle:function(a){var b=this.get(a);"boolean"===typeof b&&this.set(a,!b);return this},setSourcePath:function(a){this.sourcePath=a;return this},getViewportTransform:function(){return this.canvas&&this.canvas.viewportTransform?this.canvas.viewportTransform:[1,0,0,1,0,0]},render:function(a,d){0===this.width&&0===this.height||!this.visible||
(a.save(),this._setupCompositeOperation(a),d||this.transform(a),this._setStrokeStyles(a),this._setFillStyles(a),this.transformMatrix&&a.transform.apply(a,this.transformMatrix),this._setOpacity(a),this._setShadow(a),this.clipTo&&b.util.clipContext(this,a),this._render(a,d),this.clipTo&&a.restore(),this._removeShadow(a),this._restoreCompositeOperation(a),a.restore())},_setOpacity:function(a){this.group&&this.group._setOpacity(a);a.globalAlpha*=this.opacity},_setStrokeStyles:function(a){this.stroke&&
(a.lineWidth=this.strokeWidth,a.lineCap=this.strokeLineCap,a.lineJoin=this.strokeLineJoin,a.miterLimit=this.strokeMiterLimit,a.strokeStyle=this.stroke.toLive?this.stroke.toLive(a,this):this.stroke)},_setFillStyles:function(a){this.fill&&(a.fillStyle=this.fill.toLive?this.fill.toLive(a,this):this.fill)},_renderControls:function(a,d){if(this.active&&!d){d=this.getViewportTransform();a.save();if(this.group){var e=b.util.transformPoint(this.group.getCenterPoint(),d);a.translate(e.x,e.y);a.rotate(c(this.group.angle))}e=
b.util.transformPoint(this.getCenterPoint(),d,null!=this.group);this.group&&(e.x*=this.group.scaleX,e.y*=this.group.scaleY);a.translate(e.x,e.y);a.rotate(c(this.angle));this.drawBorders(a);this.drawControls(a);a.restore()}},_setShadow:function(a){if(this.shadow){var b=this.canvas&&this.canvas.viewportTransform[0]||1,e=this.canvas&&this.canvas.viewportTransform[3]||1;a.shadowColor=this.shadow.color;a.shadowBlur=this.shadow.blur*(b+e)*(this.scaleX+this.scaleY)/4;a.shadowOffsetX=this.shadow.offsetX*
b*this.scaleX;a.shadowOffsetY=this.shadow.offsetY*e*this.scaleY}},_removeShadow:function(a){this.shadow&&(a.shadowColor="",a.shadowBlur=a.shadowOffsetX=a.shadowOffsetY=0)},_renderFill:function(a){this.fill&&(a.save(),this.fill.gradientTransform&&a.transform.apply(a,this.fill.gradientTransform),this.fill.toLive&&a.translate(-this.width/2+this.fill.offsetX||0,-this.height/2+this.fill.offsetY||0),"evenodd"===this.fillRule?a.fill("evenodd"):a.fill(),a.restore(),this.shadow&&!this.shadow.affectStroke&&
this._removeShadow(a))},_renderStroke:function(a){this.stroke&&0!==this.strokeWidth&&(a.save(),this.strokeDashArray?(1&this.strokeDashArray.length&&this.strokeDashArray.push.apply(this.strokeDashArray,this.strokeDashArray),f?(a.setLineDash(this.strokeDashArray),this._stroke&&this._stroke(a)):this._renderDashedStroke&&this._renderDashedStroke(a),a.stroke()):(this.stroke.gradientTransform&&a.transform.apply(a,this.stroke.gradientTransform),this._stroke?this._stroke(a):a.stroke()),this._removeShadow(a),
a.restore())},clone:function(a,d){return this.constructor.fromObject?this.constructor.fromObject(this.toObject(d),a):new b.Object(this.toObject(d))},cloneAsImage:function(a){var d=this.toDataURL();b.util.loadImage(d,function(d){a&&a(new b.Image(d))});return this},toDataURL:function(a){a||(a={});var d=b.util.createCanvasElement(),c=this.getBoundingRect();d.width=c.width;d.height=c.height;b.util.wrapElement(d,"div");c=new b.StaticCanvas(d);"jpg"===a.format&&(a.format="jpeg");"jpeg"===a.format&&(c.backgroundColor=
"#fff");var e={active:this.get("active"),left:this.getLeft(),top:this.getTop()};this.set("active",!1);this.setPositionByOrigin(new b.Point(d.width/2,d.height/2),"center","center");d=this.canvas;c.add(this);a=c.toDataURL(a);this.set(e).setCoords();this.canvas=d;c.dispose();return a},isType:function(a){return this.type===a},complexity:function(){return 0},toJSON:function(a){return this.toObject(a)},setGradient:function(a,d){d||(d={});var c={colorStops:[]};c.type=d.type||(d.r1||d.r2?"radial":"linear");
c.coords={x1:d.x1,y1:d.y1,x2:d.x2,y2:d.y2};if(d.r1||d.r2)c.coords.r1=d.r1,c.coords.r2=d.r2;for(var e in d.colorStops){var f=new b.Color(d.colorStops[e]);c.colorStops.push({offset:e,color:f.toRgb(),opacity:f.getAlpha()})}return this.set(a,b.Gradient.forObject(this,c))},setPatternFill:function(a){return this.set("fill",new b.Pattern(a))},setShadow:function(a){return this.set("shadow",a?new b.Shadow(a):null)},setColor:function(a){this.set("fill",a);return this},setAngle:function(a){var b=("center"!==
this.originX||"center"!==this.originY)&&this.centeredRotation;b&&this._setOriginToCenter();this.set("angle",a);b&&this._resetOrigin();return this},centerH:function(){this.canvas.centerObjectH(this);return this},centerV:function(){this.canvas.centerObjectV(this);return this},center:function(){this.canvas.centerObject(this);return this},remove:function(){this.canvas.remove(this);return this},getLocalPointer:function(a,b){b=b||this.canvas.getPointer(a);a=this.translateToOriginPoint(this.getCenterPoint(),
"left","top");return{x:b.x-a.x,y:b.y-a.y}},_setupCompositeOperation:function(a){this.globalCompositeOperation&&(this._prevGlobalCompositeOperation=a.globalCompositeOperation,a.globalCompositeOperation=this.globalCompositeOperation)},_restoreCompositeOperation:function(a){this.globalCompositeOperation&&this._prevGlobalCompositeOperation&&(a.globalCompositeOperation=this._prevGlobalCompositeOperation)}}),b.util.createAccessors(b.Object),b.Object.prototype.rotate=b.Object.prototype.setAngle,a(b.Object.prototype,
b.Observable),b.Object.NUM_FRACTION_DIGITS=2,b.Object.__uid=0)})("undefined"!==typeof a?a:this);(function(){var a=b.util.degreesToRadians;b.util.object.extend(b.Object.prototype,{translateToCenterPoint:function(h,k,g){var c=h.x,f=h.y,e=this.stroke?this.strokeWidth:0;"left"===k?c=h.x+(this.getWidth()+e*this.scaleX)/2:"right"===k&&(c=h.x-(this.getWidth()+e*this.scaleX)/2);"top"===g?f=h.y+(this.getHeight()+e*this.scaleY)/2:"bottom"===g&&(f=h.y-(this.getHeight()+e*this.scaleY)/2);return b.util.rotatePoint(new b.Point(c,
f),h,a(this.angle))},translateToOriginPoint:function(h,k,g){var c=h.x,f=h.y,e=this.stroke?this.strokeWidth:0;"left"===k?c=h.x-(this.getWidth()+e*this.scaleX)/2:"right"===k&&(c=h.x+(this.getWidth()+e*this.scaleX)/2);"top"===g?f=h.y-(this.getHeight()+e*this.scaleY)/2:"bottom"===g&&(f=h.y+(this.getHeight()+e*this.scaleY)/2);return b.util.rotatePoint(new b.Point(c,f),h,a(this.angle))},getCenterPoint:function(){var a=new b.Point(this.left,this.top);return this.translateToCenterPoint(a,this.originX,this.originY)},
getPointByOrigin:function(a,b){var h=this.getCenterPoint();return this.translateToOriginPoint(h,a,b)},toLocalPoint:function(h,k,g){var c=this.getCenterPoint(),f=this.stroke?this.strokeWidth:0;k&&g?(k="left"===k?c.x-(this.getWidth()+f*this.scaleX)/2:"right"===k?c.x+(this.getWidth()+f*this.scaleX)/2:c.x,g="top"===g?c.y-(this.getHeight()+f*this.scaleY)/2:"bottom"===g?c.y+(this.getHeight()+f*this.scaleY)/2:c.y):(k=this.left,g=this.top);return b.util.rotatePoint(new b.Point(h.x,h.y),c,-a(this.angle)).subtractEquals(new b.Point(k,
g))},setPositionByOrigin:function(a,b,g){a=this.translateToCenterPoint(a,b,g);a=this.translateToOriginPoint(a,this.originX,this.originY);this.set("left",a.x);this.set("top",a.y)},adjustPosition:function(b){var h=a(this.angle),g=this.getWidth()/2,c=Math.cos(h)*g;g*=Math.sin(h);var f=this.getWidth(),e=Math.cos(h)*f;h=Math.sin(h)*f;"center"===this.originX&&"left"===b||"right"===this.originX&&"center"===b?(this.left-=c,this.top-=g):"left"===this.originX&&"center"===b||"center"===this.originX&&"right"===
b?(this.left+=c,this.top+=g):"left"===this.originX&&"right"===b?(this.left+=e,this.top+=h):"right"===this.originX&&"left"===b&&(this.left-=e,this.top-=h);this.setCoords();this.originX=b},_setOriginToCenter:function(){this._originalOriginX=this.originX;this._originalOriginY=this.originY;var a=this.getCenterPoint();this.originY=this.originX="center";this.left=a.x;this.top=a.y},_resetOrigin:function(){var a=this.translateToOriginPoint(this.getCenterPoint(),this._originalOriginX,this._originalOriginY);
this.originX=this._originalOriginX;this.originY=this._originalOriginY;this.left=a.x;this.top=a.y;this._originalOriginY=this._originalOriginX=null},_getLeftTopCoords:function(){return this.translateToOriginPoint(this.getCenterPoint(),"left","center")}})})();(function(){var a=b.util.degreesToRadians;b.util.object.extend(b.Object.prototype,{oCoords:null,intersectsWithRect:function(a,k){var h=this.oCoords,c=new b.Point(h.tl.x,h.tl.y),f=new b.Point(h.tr.x,h.tr.y),e=new b.Point(h.bl.x,h.bl.y);h=new b.Point(h.br.x,
h.br.y);return"Intersection"===b.Intersection.intersectPolygonRectangle([c,f,h,e],a,k).status},intersectsWithObject:function(a){function h(a){return{tl:new b.Point(a.tl.x,a.tl.y),tr:new b.Point(a.tr.x,a.tr.y),bl:new b.Point(a.bl.x,a.bl.y),br:new b.Point(a.br.x,a.br.y)}}var g=h(this.oCoords);a=h(a.oCoords);return"Intersection"===b.Intersection.intersectPolygonPolygon([g.tl,g.tr,g.br,g.bl],[a.tl,a.tr,a.br,a.bl]).status},isContainedWithinObject:function(a){var h=a.getBoundingRect();a=new b.Point(h.left,
h.top);h=new b.Point(h.left+h.width,h.top+h.height);return this.isContainedWithinRect(a,h)},isContainedWithinRect:function(a,b){var h=this.getBoundingRect();return h.left>=a.x&&h.left+h.width<=b.x&&h.top>=a.y&&h.top+h.height<=b.y},containsPoint:function(a){var b=this._getImageLines(this.oCoords);a=this._findCrossPoints(a,b);return 0!==a&&1===a%2},_getImageLines:function(a){return{topline:{o:a.tl,d:a.tr},rightline:{o:a.tr,d:a.br},bottomline:{o:a.br,d:a.bl},leftline:{o:a.bl,d:a.tl}}},_findCrossPoints:function(a,
b){var h=0,c;for(c in b){var f=b[c];if(!(f.o.y<a.y&&f.d.y<a.y||f.o.y>=a.y&&f.d.y>=a.y)){if(f.o.x===f.d.x&&f.o.x>=a.x)var e=f.o.x;else{e=(f.d.y-f.o.y)/(f.d.x-f.o.x);var d=a.y-0*a.x;f=f.o.y-e*f.o.x;e=-(d-f)/(0-e)}e>=a.x&&(h+=1);if(2===h)break}}return h},getBoundingRectWidth:function(){return this.getBoundingRect().width},getBoundingRectHeight:function(){return this.getBoundingRect().height},getBoundingRect:function(){this.oCoords||this.setCoords();var a=[this.oCoords.tl.x,this.oCoords.tr.x,this.oCoords.br.x,
this.oCoords.bl.x],k=b.util.array.min(a);a=b.util.array.max(a);a=Math.abs(k-a);var g=[this.oCoords.tl.y,this.oCoords.tr.y,this.oCoords.br.y,this.oCoords.bl.y],c=b.util.array.min(g);g=b.util.array.max(g);return{left:k,top:c,width:a,height:Math.abs(c-g)}},getWidth:function(){return this.width*this.scaleX},getHeight:function(){return this.height*this.scaleY},_constrainScale:function(a){return Math.abs(a)<this.minScaleLimit?0>a?-this.minScaleLimit:this.minScaleLimit:a},scale:function(a){a=this._constrainScale(a);
0>a&&(this.flipX=!this.flipX,this.flipY=!this.flipY,a*=-1);this.scaleY=this.scaleX=a;this.setCoords();return this},scaleToWidth:function(a){var b=this.getBoundingRectWidth()/this.getWidth();return this.scale(a/this.width/b)},scaleToHeight:function(a){var b=this.getBoundingRectHeight()/this.getHeight();return this.scale(a/this.height/b)},setCoords:function(){var h=a(this.angle),k=this.getViewportTransform(),g=this._calculateCurrentDimensions(!1),c=g.x,f=g.y;0>c&&(c=Math.abs(c));g=Math.sqrt(Math.pow(c/
2,2)+Math.pow(f/2,2));var e=Math.atan(isFinite(f/c)?f/c:0),d=Math.cos(e+h)*g;e=Math.sin(e+h)*g;g=Math.sin(h);h=Math.cos(h);var q=this.getCenterPoint();f=new b.Point(c,f);q=new b.Point(q.x-d,q.y-e);e=new b.Point(q.x+f.x*h,q.y+f.x*g);c=b.util.transformPoint(new b.Point(q.x-f.y*g,q.y+f.y*h),k);d=b.util.transformPoint(new b.Point(e.x-f.y*g,e.y+f.y*h),k);f=b.util.transformPoint(q,k);k=b.util.transformPoint(e,k);e=new b.Point((f.x+c.x)/2,(f.y+c.y)/2);q=new b.Point((k.x+f.x)/2,(k.y+f.y)/2);var v=new b.Point((d.x+
k.x)/2,(d.y+k.y)/2),l=new b.Point((d.x+c.x)/2,(d.y+c.y)/2);g=new b.Point(q.x+g*this.rotatingPointOffset,q.y-h*this.rotatingPointOffset);this.oCoords={tl:f,tr:k,br:d,bl:c,ml:e,mt:q,mr:v,mb:l,mtr:g};this._setCornerCoords&&this._setCornerCoords();return this}})})();b.util.object.extend(b.Object.prototype,{sendToBack:function(){this.group?b.StaticCanvas.prototype.sendToBack.call(this.group,this):this.canvas.sendToBack(this);return this},bringToFront:function(){this.group?b.StaticCanvas.prototype.bringToFront.call(this.group,
this):this.canvas.bringToFront(this);return this},sendBackwards:function(a){this.group?b.StaticCanvas.prototype.sendBackwards.call(this.group,this,a):this.canvas.sendBackwards(this,a);return this},bringForward:function(a){this.group?b.StaticCanvas.prototype.bringForward.call(this.group,this,a):this.canvas.bringForward(this,a);return this},moveTo:function(a){this.group?b.StaticCanvas.prototype.moveTo.call(this.group,this,a):this.canvas.moveTo(this,a);return this}});b.util.object.extend(b.Object.prototype,
{getSvgStyles:function(){var a=this.fill?this.fill.toLive?"url(#SVGID_"+this.fill.id+")":this.fill:"none",b=this.fillRule,k=this.stroke?this.stroke.toLive?"url(#SVGID_"+this.stroke.id+")":this.stroke:"none",g=this.strokeWidth?this.strokeWidth:"0",c=this.strokeDashArray?this.strokeDashArray.join(" "):"";return["stroke: ",k,"; stroke-width: ",g,"; stroke-dasharray: ",c,"; stroke-linecap: ",this.strokeLineCap?this.strokeLineCap:"butt","; stroke-linejoin: ",this.strokeLineJoin?this.strokeLineJoin:"miter",
"; stroke-miterlimit: ",this.strokeMiterLimit?this.strokeMiterLimit:"4","; fill: ",a,"; fill-rule: ",b,"; opacity: ","undefined"!==typeof this.opacity?this.opacity:"1",";",this.shadow?"filter: url(#SVGID_"+this.shadow.id+");":"",this.visible?"":" visibility: hidden;"].join("")},getSvgTransform:function(){if(this.group&&"path-group"===this.group.type)return"";var a=b.util.toFixed,h=this.getAngle(),k=!this.canvas||this.canvas.svgViewportTransformation?this.getViewportTransform():[1,0,0,1,0,0],g=b.util.transformPoint(this.getCenterPoint(),
k),c=b.Object.NUM_FRACTION_DIGITS;g="path-group"===this.type?"":"translate("+a(g.x,c)+" "+a(g.y,c)+")";h=0!==h?" rotate("+a(h,c)+")":"";a=1===this.scaleX&&1===this.scaleY&&1===k[0]&&1===k[3]?"":" scale("+a(this.scaleX*k[0],c)+" "+a(this.scaleY*k[3],c)+")";c="path-group"===this.type?this.width*k[0]:0;k="path-group"===this.type?this.height*k[3]:0;return[g,h,a,this.flipX?" matrix(-1 0 0 1 "+c+" 0) ":"",this.flipY?" matrix(1 0 0 -1 0 "+k+")":""].join("")},getSvgTransformMatrix:function(){return this.transformMatrix?
" matrix("+this.transformMatrix.join(" ")+") ":""},_createBaseSVGMarkup:function(){var a=[];this.fill&&this.fill.toLive&&a.push(this.fill.toSVG(this,!1));this.stroke&&this.stroke.toLive&&a.push(this.stroke.toSVG(this,!1));this.shadow&&a.push(this.shadow.toSVG(this));return a}});b.util.object.extend(b.Object.prototype,{hasStateChanged:function(){return this.stateProperties.some(function(a){return this.get(a)!==this.originalState[a]},this)},saveState:function(a){this.stateProperties.forEach(function(a){this.originalState[a]=
this.get(a)},this);a&&a.stateProperties&&a.stateProperties.forEach(function(a){this.originalState[a]=this.get(a)},this);return this},setupState:function(){this.originalState={};this.saveState();return this}});(function(){var a=b.util.degreesToRadians;b.util.object.extend(b.Object.prototype,{_controlsVisibility:null,_findTargetCorner:function(a){if(!this.hasControls||!this.active)return!1;var b=a.x;a=a.y;var h;for(h in this.oCoords)if(this.isControlVisible(h)&&("mtr"!==h||this.hasRotatingPoint)&&(!this.get("lockUniScaling")||
"mt"!==h&&"mr"!==h&&"mb"!==h&&"ml"!==h)){var c=this._getImageLines(this.oCoords[h].corner);c=this._findCrossPoints({x:b,y:a},c);if(0!==c&&1===c%2)return this.__corner=h}return!1},_setCornerCoords:function(){var b=this.oCoords,k=a(45-this.angle),g=Math.sqrt(2*Math.pow(this.cornerSize,2))/2,c=g*Math.cos(k);k=g*Math.sin(k);var f;for(f in b){g=b[f].x;var e=b[f].y;b[f].corner={tl:{x:g-k,y:e-c},tr:{x:g+c,y:e-k},bl:{x:g-c,y:e+k},br:{x:g+k,y:e+c}}}},_calculateCurrentDimensions:function(a){var h=this.getViewportTransform(),
g=this.strokeWidth,c=this.width,f=this.height,e="round"===this.strokeLineCap||"square"===this.strokeLineCap,d="line"===this.type&&0===this.width,q="line"===this.type&&0===this.height,v=d||q;d?c=g:q&&(f=g);if(e&&q||!v)c+=0>c?-g:g;if(e&&d||!v)f+=0>f?-g:g;c=c*this.scaleX+2*this.padding;f=f*this.scaleY+2*this.padding;return a?b.util.transformPoint(new b.Point(c,f),h,!0):{x:c,y:f}},drawBorders:function(a){if(!this.hasBorders)return this;a.save();a.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:
1;a.strokeStyle=this.borderColor;a.lineWidth=1/this.borderScaleFactor;var b=this._calculateCurrentDimensions(!0),h=b.x;b=b.y;this.group&&(h*=this.group.scaleX,b*=this.group.scaleY);a.strokeRect(~~-(h/2)-.5,~~-(b/2)-.5,~~h+1,~~b+1);this.hasRotatingPoint&&this.isControlVisible("mtr")&&!this.get("lockRotation")&&this.hasControls&&(h=-b/2,a.beginPath(),a.moveTo(0,h),a.lineTo(0,h-this.rotatingPointOffset),a.closePath(),a.stroke());a.restore();return this},drawControls:function(a){if(!this.hasControls)return this;
var b=this._calculateCurrentDimensions(!0),h=b.x;b=b.y;var c=-(h/2),f=-(b/2),e=this.cornerSize/2,d=this.transparentCorners?"strokeRect":"fillRect";a.save();a.lineWidth=1;a.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1;a.strokeStyle=a.fillStyle=this.cornerColor;this._drawControl("tl",a,d,c-e,f-e);this._drawControl("tr",a,d,c+h-e,f-e);this._drawControl("bl",a,d,c-e,f+b-e);this._drawControl("br",a,d,c+h-e,f+b-e);this.get("lockUniScaling")||(this._drawControl("mt",a,d,c+h/2-e,f-e),this._drawControl("mb",
a,d,c+h/2-e,f+b-e),this._drawControl("mr",a,d,c+h-e,f+b/2-e),this._drawControl("ml",a,d,c-e,f+b/2-e));this.hasRotatingPoint&&this._drawControl("mtr",a,d,c+h/2-e,f-this.rotatingPointOffset-e);a.restore();return this},_drawControl:function(a,b,g,c,f){this.isControlVisible(a)&&(a=this.cornerSize,"undefined"!==typeof G_vmlCanvasManager||this.transparentCorners||b.clearRect(c,f,a,a),b[g](c,f,a,a))},isControlVisible:function(a){return this._getControlsVisibility()[a]},setControlVisible:function(a,b){this._getControlsVisibility()[a]=
b;return this},setControlsVisibility:function(a){a||(a={});for(var b in a)this.setControlVisible(b,a[b]);return this},_getControlsVisibility:function(){this._controlsVisibility||(this._controlsVisibility={tl:!0,tr:!0,br:!0,bl:!0,ml:!0,mt:!0,mr:!0,mb:!0,mtr:!0});return this._controlsVisibility}})})();(function(a){function b(a,b){var d=a.origin,c=a.axis1,e=a.axis2,f=a.dimension,h=b.nearest,g=b.center,k=b.farthest;return function(){switch(this.get(d)){case h:return Math.min(this.get(c),this.get(e));
case g:return Math.min(this.get(c),this.get(e))+.5*this.get(f);case k:return Math.max(this.get(c),this.get(e))}}}var k=a.fabric||(a.fabric={}),g=k.util.object.extend,c={x1:1,x2:1,y1:1,y2:1},f=k.StaticCanvas.supports("setLineDash");k.Line?k.warn("fabric.Line is already defined"):(k.Line=k.util.createClass(k.Object,{type:"line",x1:0,y1:0,x2:0,y2:0,initialize:function(a,b){b=b||{};a||(a=[0,0,0,0]);this.callSuper("initialize",b);this.set("x1",a[0]);this.set("y1",a[1]);this.set("x2",a[2]);this.set("y2",
a[3]);this._setWidthHeight(b)},_setWidthHeight:function(a){a||(a={});this.width=Math.abs(this.x2-this.x1);this.height=Math.abs(this.y2-this.y1);this.left="left"in a?a.left:this._getLeftToOriginX();this.top="top"in a?a.top:this._getTopToOriginY()},_set:function(a,b){this.callSuper("_set",a,b);"undefined"!==typeof c[a]&&this._setWidthHeight();return this},_getLeftToOriginX:b({origin:"originX",axis1:"x1",axis2:"x2",dimension:"width"},{nearest:"left",center:"center",farthest:"right"}),_getTopToOriginY:b({origin:"originY",
axis1:"y1",axis2:"y2",dimension:"height"},{nearest:"top",center:"center",farthest:"bottom"}),_render:function(a,b){a.beginPath();b&&(b=this.getCenterPoint(),a.translate(b.x-this.strokeWidth/2,b.y-this.strokeWidth/2));if(!this.strokeDashArray||this.strokeDashArray&&f)b=this.calcLinePoints(),a.moveTo(b.x1,b.y1),a.lineTo(b.x2,b.y2);a.lineWidth=this.strokeWidth;b=a.strokeStyle;a.strokeStyle=this.stroke||a.fillStyle;this.stroke&&this._renderStroke(a);a.strokeStyle=b},_renderDashedStroke:function(a){var b=
this.calcLinePoints();a.beginPath();k.util.drawDashedLine(a,b.x1,b.y1,b.x2,b.y2,this.strokeDashArray);a.closePath()},toObject:function(a){return g(this.callSuper("toObject",a),this.calcLinePoints())},calcLinePoints:function(){var a=this.x1<=this.x2?-1:1,b=this.y1<=this.y2?-1:1;return{x1:a*this.width*.5,x2:a*this.width*-.5,y1:b*this.height*.5,y2:b*this.height*-.5}},toSVG:function(a){var b=this._createBaseSVGMarkup(),c={x1:this.x1,x2:this.x2,y1:this.y1,y2:this.y2};this.group&&"path-group"===this.group.type||
(c=this.calcLinePoints());b.push("<line ",'x1="',c.x1,'" y1="',c.y1,'" x2="',c.x2,'" y2="',c.y2,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'"/>\n');return a?a(b.join("")):b.join("")},complexity:function(){return 1}}),k.Line.ATTRIBUTE_NAMES=k.SHARED_ATTRIBUTES.concat(["x1","y1","x2","y2"]),k.Line.fromElement=function(a,b){a=k.parseAttributes(a,k.Line.ATTRIBUTE_NAMES);return new k.Line([a.x1||0,a.y1||0,a.x2||0,a.y2||0],g(a,b))},k.Line.fromObject=
function(a){return new k.Line([a.x1,a.y1,a.x2,a.y2],a)})})("undefined"!==typeof a?a:this);(function(a){var b=a.fabric||(a.fabric={}),k=Math.PI,g=b.util.object.extend;b.Circle?b.warn("fabric.Circle is already defined."):(b.Circle=b.util.createClass(b.Object,{type:"circle",radius:0,startAngle:0,endAngle:2*k,initialize:function(a){a=a||{};this.callSuper("initialize",a);this.set("radius",a.radius||0);this.startAngle=a.startAngle||this.startAngle;this.endAngle=a.endAngle||this.endAngle},_set:function(a,
b){this.callSuper("_set",a,b);"radius"===a&&this.setRadius(b);return this},toObject:function(a){return g(this.callSuper("toObject",a),{radius:this.get("radius"),startAngle:this.startAngle,endAngle:this.endAngle})},toSVG:function(a){var b=this._createBaseSVGMarkup(),c=0,d=0,h=(this.endAngle-this.startAngle)%(2*k);0===h?(this.group&&"path-group"===this.group.type&&(c=this.left+this.radius,d=this.top+this.radius),b.push("<circle ",'cx="'+c+'" cy="'+d+'" ','r="',this.radius,'" style="',this.getSvgStyles(),
'" transform="',this.getSvgTransform()," ",this.getSvgTransformMatrix(),'"/>\n')):b.push('<path d="M '+Math.cos(this.startAngle)*this.radius+" "+Math.sin(this.startAngle)*this.radius," A "+this.radius+" "+this.radius," 0 ",+(h>k?1:0)+" 1"," "+Math.cos(this.endAngle)*this.radius+" "+Math.sin(this.endAngle)*this.radius,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform()," ",this.getSvgTransformMatrix(),'"/>\n');return a?a(b.join("")):b.join("")},_render:function(a,b){a.beginPath();
a.arc(b?this.left+this.radius:0,b?this.top+this.radius:0,this.radius,this.startAngle,this.endAngle,!1);this._renderFill(a);this._renderStroke(a)},getRadiusX:function(){return this.get("radius")*this.get("scaleX")},getRadiusY:function(){return this.get("radius")*this.get("scaleY")},setRadius:function(a){this.radius=a;this.set("width",2*a).set("height",2*a)},complexity:function(){return 1}}),b.Circle.ATTRIBUTE_NAMES=b.SHARED_ATTRIBUTES.concat(["cx","cy","r"]),b.Circle.fromElement=function(a,f){f||(f=
{});a=b.parseAttributes(a,b.Circle.ATTRIBUTE_NAMES);if(!("radius"in a&&0<=a.radius))throw Error("value of `r` attribute is required and can not be negative");a.left=a.left||0;a.top=a.top||0;f=new b.Circle(g(a,f));f.left-=f.radius;f.top-=f.radius;return f},b.Circle.fromObject=function(a){return new b.Circle(a)})})("undefined"!==typeof a?a:this);(function(a){var b=a.fabric||(a.fabric={});b.Triangle?b.warn("fabric.Triangle is already defined"):(b.Triangle=b.util.createClass(b.Object,{type:"triangle",
initialize:function(a){a=a||{};this.callSuper("initialize",a);this.set("width",a.width||100).set("height",a.height||100)},_render:function(a){var b=this.width/2,c=this.height/2;a.beginPath();a.moveTo(-b,c);a.lineTo(0,-c);a.lineTo(b,c);a.closePath();this._renderFill(a);this._renderStroke(a)},_renderDashedStroke:function(a){var h=this.width/2,c=this.height/2;a.beginPath();b.util.drawDashedLine(a,-h,c,0,-c,this.strokeDashArray);b.util.drawDashedLine(a,0,-c,h,c,this.strokeDashArray);b.util.drawDashedLine(a,
h,c,-h,c,this.strokeDashArray);a.closePath()},toSVG:function(a){var b=this._createBaseSVGMarkup(),c=this.width/2,f=this.height/2;c=[-c+" "+f,"0 "+-f,c+" "+f].join();b.push("<polygon ",'points="',c,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),'"/>');return a?a(b.join("")):b.join("")},complexity:function(){return 1}}),b.Triangle.fromObject=function(a){return new b.Triangle(a)})})("undefined"!==typeof a?a:this);(function(a){var b=a.fabric||(a.fabric={}),k=2*Math.PI,g=b.util.object.extend;
b.Ellipse?b.warn("fabric.Ellipse is already defined."):(b.Ellipse=b.util.createClass(b.Object,{type:"ellipse",rx:0,ry:0,initialize:function(a){a=a||{};this.callSuper("initialize",a);this.set("rx",a.rx||0);this.set("ry",a.ry||0)},_set:function(a,b){this.callSuper("_set",a,b);switch(a){case "rx":this.rx=b;this.set("width",2*b);break;case "ry":this.ry=b,this.set("height",2*b)}return this},getRx:function(){return this.get("rx")*this.get("scaleX")},getRy:function(){return this.get("ry")*this.get("scaleY")},
toObject:function(a){return g(this.callSuper("toObject",a),{rx:this.get("rx"),ry:this.get("ry")})},toSVG:function(a){var b=this._createBaseSVGMarkup(),c=0,d=0;this.group&&"path-group"===this.group.type&&(c=this.left+this.rx,d=this.top+this.ry);b.push("<ellipse ",'cx="',c,'" cy="',d,'" ','rx="',this.rx,'" ry="',this.ry,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'"/>\n');return a?a(b.join("")):b.join("")},_render:function(a,b){a.beginPath();a.save();
a.transform(1,0,0,this.ry/this.rx,0,0);a.arc(b?this.left+this.rx:0,b?(this.top+this.ry)*this.rx/this.ry:0,this.rx,0,k,!1);a.restore();this._renderFill(a);this._renderStroke(a)},complexity:function(){return 1}}),b.Ellipse.ATTRIBUTE_NAMES=b.SHARED_ATTRIBUTES.concat(["cx","cy","rx","ry"]),b.Ellipse.fromElement=function(a,f){f||(f={});a=b.parseAttributes(a,b.Ellipse.ATTRIBUTE_NAMES);a.left=a.left||0;a.top=a.top||0;f=new b.Ellipse(g(a,f));f.top-=f.ry;f.left-=f.rx;return f},b.Ellipse.fromObject=function(a){return new b.Ellipse(a)})})("undefined"!==
typeof a?a:this);(function(a){var b=a.fabric||(a.fabric={}),k=b.util.object.extend;b.Rect?console.warn("fabric.Rect is already defined"):(a=b.Object.prototype.stateProperties.concat(),a.push("rx","ry","x","y"),b.Rect=b.util.createClass(b.Object,{stateProperties:a,type:"rect",rx:0,ry:0,strokeDashArray:null,initialize:function(a){a=a||{};this.callSuper("initialize",a);this._initRxRy()},_initRxRy:function(){this.rx&&!this.ry?this.ry=this.rx:this.ry&&!this.rx&&(this.rx=this.ry)},_render:function(a,b){if(1===
this.width&&1===this.height)a.fillRect(0,0,1,1);else{var c=this.rx?Math.min(this.rx,this.width/2):0,e=this.ry?Math.min(this.ry,this.height/2):0,d=this.width,h=this.height,g=b?this.left:-this.width/2;b=b?this.top:-this.height/2;var k=0!==c||0!==e;a.beginPath();a.moveTo(g+c,b);a.lineTo(g+d-c,b);k&&a.bezierCurveTo(g+d-.4477152502*c,b,g+d,b+.4477152502*e,g+d,b+e);a.lineTo(g+d,b+h-e);k&&a.bezierCurveTo(g+d,b+h-.4477152502*e,g+d-.4477152502*c,b+h,g+d-c,b+h);a.lineTo(g+c,b+h);k&&a.bezierCurveTo(g+.4477152502*
c,b+h,g,b+h-.4477152502*e,g,b+h-e);a.lineTo(g,b+e);k&&a.bezierCurveTo(g,b+.4477152502*e,g+.4477152502*c,b,g+c,b);a.closePath();this._renderFill(a);this._renderStroke(a)}},_renderDashedStroke:function(a){var c=-this.width/2,f=-this.height/2,e=this.width,d=this.height;a.beginPath();b.util.drawDashedLine(a,c,f,c+e,f,this.strokeDashArray);b.util.drawDashedLine(a,c+e,f,c+e,f+d,this.strokeDashArray);b.util.drawDashedLine(a,c+e,f+d,c,f+d,this.strokeDashArray);b.util.drawDashedLine(a,c,f+d,c,f,this.strokeDashArray);
a.closePath()},toObject:function(a){a=k(this.callSuper("toObject",a),{rx:this.get("rx")||0,ry:this.get("ry")||0});this.includeDefaultValues||this._removeDefaultValues(a);return a},toSVG:function(a){var b=this._createBaseSVGMarkup(),f=this.left,e=this.top;this.group&&"path-group"===this.group.type||(f=-this.width/2,e=-this.height/2);b.push("<rect ",'x="',f,'" y="',e,'" rx="',this.get("rx"),'" ry="',this.get("ry"),'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),'" transform="',
this.getSvgTransform(),this.getSvgTransformMatrix(),'"/>\n');return a?a(b.join("")):b.join("")},complexity:function(){return 1}}),b.Rect.ATTRIBUTE_NAMES=b.SHARED_ATTRIBUTES.concat("x y rx ry width height".split(" ")),b.Rect.fromElement=function(a,c){if(!a)return null;c=c||{};a=b.parseAttributes(a,b.Rect.ATTRIBUTE_NAMES);a.left=a.left||0;a.top=a.top||0;c=new b.Rect(k(c?b.util.object.clone(c):{},a));c.visible=0<c.width&&0<c.height;return c},b.Rect.fromObject=function(a){return new b.Rect(a)})})("undefined"!==
typeof a?a:this);(function(a){var b=a.fabric||(a.fabric={});b.Polyline?b.warn("fabric.Polyline is already defined"):(b.Polyline=b.util.createClass(b.Object,{type:"polyline",points:null,minX:0,minY:0,initialize:function(a,g){return b.Polygon.prototype.initialize.call(this,a,g)},_calcDimensions:function(){return b.Polygon.prototype._calcDimensions.call(this)},_applyPointOffset:function(){return b.Polygon.prototype._applyPointOffset.call(this)},toObject:function(a){return b.Polygon.prototype.toObject.call(this,
a)},toSVG:function(a){return b.Polygon.prototype.toSVG.call(this,a)},_render:function(a){b.Polygon.prototype.commonRender.call(this,a)&&(this._renderFill(a),this._renderStroke(a))},_renderDashedStroke:function(a){a.beginPath();for(var g=0,c=this.points.length;g<c;g++){var f=this.points[g];var e=this.points[g+1]||f;b.util.drawDashedLine(a,f.x,f.y,e.x,e.y,this.strokeDashArray)}},complexity:function(){return this.get("points").length}}),b.Polyline.ATTRIBUTE_NAMES=b.SHARED_ATTRIBUTES.concat(),b.Polyline.fromElement=
function(a,g){if(!a)return null;g||(g={});var c=b.parsePointsAttribute(a.getAttribute("points"));a=b.parseAttributes(a,b.Polyline.ATTRIBUTE_NAMES);return new b.Polyline(c,b.util.object.extend(a,g))},b.Polyline.fromObject=function(a){return new b.Polyline(a.points,a,!0)})})("undefined"!==typeof a?a:this);(function(a){var b=a.fabric||(a.fabric={}),k=b.util.object.extend,g=b.util.array.min,c=b.util.array.max,f=b.util.toFixed;b.Polygon?b.warn("fabric.Polygon is already defined"):(b.Polygon=b.util.createClass(b.Object,
{type:"polygon",points:null,minX:0,minY:0,initialize:function(a,b){b=b||{};this.points=a||[];this.callSuper("initialize",b);this._calcDimensions();"top"in b||(this.top=this.minY);"left"in b||(this.left=this.minX)},_calcDimensions:function(){var a=this.points,b=g(a,"x"),f=g(a,"y"),h=c(a,"x");a=c(a,"y");this.width=h-b||0;this.height=a-f||0;this.minX=b||0;this.minY=f||0},_applyPointOffset:function(){this.points.forEach(function(a){a.x-=this.minX+this.width/2;a.y-=this.minY+this.height/2},this)},toObject:function(a){return k(this.callSuper("toObject",
a),{points:this.points.concat()})},toSVG:function(a){for(var b=[],c=this._createBaseSVGMarkup(),e=0,g=this.points.length;e<g;e++)b.push(f(this.points[e].x,2),",",f(this.points[e].y,2)," ");c.push("<",this.type," ",'points="',b.join(""),'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform()," ",this.getSvgTransformMatrix(),'"/>\n');return a?a(c.join("")):c.join("")},_render:function(a){this.commonRender(a)&&(this._renderFill(a),this.stroke||this.strokeDashArray)&&(a.closePath(),this._renderStroke(a))},
commonRender:function(a){var b=this.points.length;if(!b||isNaN(this.points[b-1].y))return!1;a.beginPath();this._applyPointOffset&&(this.group&&"path-group"===this.group.type||this._applyPointOffset(),this._applyPointOffset=null);a.moveTo(this.points[0].x,this.points[0].y);for(var c=0;c<b;c++){var e=this.points[c];a.lineTo(e.x,e.y)}return!0},_renderDashedStroke:function(a){b.Polyline.prototype._renderDashedStroke.call(this,a);a.closePath()},complexity:function(){return this.points.length}}),b.Polygon.ATTRIBUTE_NAMES=
b.SHARED_ATTRIBUTES.concat(),b.Polygon.fromElement=function(a,d){if(!a)return null;d||(d={});var c=b.parsePointsAttribute(a.getAttribute("points"));a=b.parseAttributes(a,b.Polygon.ATTRIBUTE_NAMES);return new b.Polygon(c,k(a,d))},b.Polygon.fromObject=function(a){return new b.Polygon(a.points,a,!0)})})("undefined"!==typeof a?a:this);(function(a){var b=a.fabric||(a.fabric={}),k=b.util.array.min,g=b.util.array.max,c=b.util.object.extend,f=Object.prototype.toString,e=b.util.drawArc,d={m:2,l:2,h:1,v:1,
c:6,s:4,q:4,t:2,a:7},q={m:"l",M:"L"};b.Path?b.warn("fabric.Path is already defined"):(b.Path=b.util.createClass(b.Object,{type:"path",path:null,minX:0,minY:0,initialize:function(a,b){b=b||{};this.setOptions(b);if(!a)throw Error("`path` argument is required");var d="[object Array]"===f.call(a);if(this.path=d?a:a.match&&a.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi))d||(this.path=this._parsePath()),this._setPositionDimensions(),b.sourcePath&&this.setSourcePath(b.sourcePath)},_setPositionDimensions:function(){var a=
this._parseDimensions();this.minX=a.left;this.minY=a.top;this.width=a.width;this.height=a.height;a.left+="center"===this.originX?this.width/2:"right"===this.originX?this.width:0;a.top+="center"===this.originY?this.height/2:"bottom"===this.originY?this.height:0;this.top=this.top||a.top;this.left=this.left||a.left;this.pathOffset=this.pathOffset||{x:this.minX+this.width/2,y:this.minY+this.height/2}},_render:function(a){var b=null,d=0,c=0,f=0,g=0,h=0,k=0,q=-this.pathOffset.x,l=-this.pathOffset.y;this.group&&
"path-group"===this.group.type&&(l=q=0);a.beginPath();for(var v=0,n=this.path.length;v<n;++v){var m=this.path[v];switch(m[0]){case "l":f+=m[1];g+=m[2];a.lineTo(f+q,g+l);break;case "L":f=m[1];g=m[2];a.lineTo(f+q,g+l);break;case "h":f+=m[1];a.lineTo(f+q,g+l);break;case "H":f=m[1];a.lineTo(f+q,g+l);break;case "v":g+=m[1];a.lineTo(f+q,g+l);break;case "V":g=m[1];a.lineTo(f+q,g+l);break;case "m":f+=m[1];g+=m[2];d=f;c=g;a.moveTo(f+q,g+l);break;case "M":f=m[1];g=m[2];d=f;c=g;a.moveTo(f+q,g+l);break;case "c":var p=
f+m[5];var r=g+m[6];h=f+m[3];k=g+m[4];a.bezierCurveTo(f+m[1]+q,g+m[2]+l,h+q,k+l,p+q,r+l);f=p;g=r;break;case "C":f=m[5];g=m[6];h=m[3];k=m[4];a.bezierCurveTo(m[1]+q,m[2]+l,h+q,k+l,f+q,g+l);break;case "s":p=f+m[3];r=g+m[4];null===b[0].match(/[CcSs]/)?(h=f,k=g):(h=2*f-h,k=2*g-k);a.bezierCurveTo(h+q,k+l,f+m[1]+q,g+m[2]+l,p+q,r+l);h=f+m[1];k=g+m[2];f=p;g=r;break;case "S":p=m[3];r=m[4];null===b[0].match(/[CcSs]/)?(h=f,k=g):(h=2*f-h,k=2*g-k);a.bezierCurveTo(h+q,k+l,m[1]+q,m[2]+l,p+q,r+l);f=p;g=r;h=m[1];k=
m[2];break;case "q":p=f+m[3];r=g+m[4];h=f+m[1];k=g+m[2];a.quadraticCurveTo(h+q,k+l,p+q,r+l);f=p;g=r;break;case "Q":p=m[3];r=m[4];a.quadraticCurveTo(m[1]+q,m[2]+l,p+q,r+l);f=p;g=r;h=m[1];k=m[2];break;case "t":p=f+m[1];r=g+m[2];null===b[0].match(/[QqTt]/)?(h=f,k=g):(h=2*f-h,k=2*g-k);a.quadraticCurveTo(h+q,k+l,p+q,r+l);f=p;g=r;break;case "T":p=m[1];r=m[2];null===b[0].match(/[QqTt]/)?(h=f,k=g):(h=2*f-h,k=2*g-k);a.quadraticCurveTo(h+q,k+l,p+q,r+l);f=p;g=r;break;case "a":e(a,f+q,g+l,[m[1],m[2],m[3],m[4],
m[5],m[6]+f+q,m[7]+g+l]);f+=m[6];g+=m[7];break;case "A":e(a,f+q,g+l,[m[1],m[2],m[3],m[4],m[5],m[6]+q,m[7]+l]);f=m[6];g=m[7];break;case "z":case "Z":f=d,g=c,a.closePath()}b=m}this._renderFill(a);this._renderStroke(a)},toString:function(){return"#<fabric.Path ("+this.complexity()+'): { "top": '+this.top+', "left": '+this.left+" }>"},toObject:function(a){a=c(this.callSuper("toObject",a),{path:this.path.map(function(a){return a.slice()}),pathOffset:this.pathOffset});this.sourcePath&&(a.sourcePath=this.sourcePath);
this.transformMatrix&&(a.transformMatrix=this.transformMatrix);return a},toDatalessObject:function(a){a=this.toObject(a);this.sourcePath&&(a.path=this.sourcePath);delete a.sourcePath;return a},toSVG:function(a){for(var b=[],d=this._createBaseSVGMarkup(),c="",e=0,f=this.path.length;e<f;e++)b.push(this.path[e].join(" "));b=b.join(" ");this.group&&"path-group"===this.group.type||(c=" translate("+-this.pathOffset.x+", "+-this.pathOffset.y+") ");d.push("<path ",'d="',b,'" style="',this.getSvgStyles(),
'" transform="',this.getSvgTransform(),c,this.getSvgTransformMatrix(),'" stroke-linecap="round" ',"/>\n");return a?a(d.join("")):d.join("")},complexity:function(){return this.path.length},_parsePath:function(){for(var a=[],b=[],c,e,f=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:e[-+]?\d+)?)/ig,g,h=0,k=this.path.length;h<k;h++){c=this.path[h];g=c.slice(1).trim();for(b.length=0;e=f.exec(g);)b.push(e[0]);c=[c.charAt(0)];g=0;for(var l=b.length;g<l;g++)e=parseFloat(b[g]),isNaN(e)||c.push(e);e=c[0];g=d[e.toLowerCase()];
l=q[e]||e;if(c.length-1>g)for(var m=1,n=c.length;m<n;m+=g)a.push([e].concat(c.slice(m,m+g))),e=l;else a.push(c)}return a},_parseDimensions:function(){for(var a=[],d=[],c,e=null,f=0,h=0,q=0,l=0,m=0,n=0,p,r,t,u=0,w=this.path.length;u<w;++u){c=this.path[u];switch(c[0]){case "l":q+=c[1];l+=c[2];t=[];break;case "L":q=c[1];l=c[2];t=[];break;case "h":q+=c[1];t=[];break;case "H":q=c[1];t=[];break;case "v":l+=c[1];t=[];break;case "V":l=c[1];t=[];break;case "m":q+=c[1];l+=c[2];f=q;h=l;t=[];break;case "M":q=
c[1];l=c[2];f=q;h=l;t=[];break;case "c":p=q+c[5];r=l+c[6];m=q+c[3];n=l+c[4];t=b.util.getBoundsOfCurve(q,l,q+c[1],l+c[2],m,n,p,r);q=p;l=r;break;case "C":q=c[5];l=c[6];m=c[3];n=c[4];t=b.util.getBoundsOfCurve(q,l,c[1],c[2],m,n,q,l);break;case "s":p=q+c[3];r=l+c[4];null===e[0].match(/[CcSs]/)?(m=q,n=l):(m=2*q-m,n=2*l-n);t=b.util.getBoundsOfCurve(q,l,m,n,q+c[1],l+c[2],p,r);m=q+c[1];n=l+c[2];q=p;l=r;break;case "S":p=c[3];r=c[4];null===e[0].match(/[CcSs]/)?(m=q,n=l):(m=2*q-m,n=2*l-n);t=b.util.getBoundsOfCurve(q,
l,m,n,c[1],c[2],p,r);q=p;l=r;m=c[1];n=c[2];break;case "q":p=q+c[3];r=l+c[4];m=q+c[1];n=l+c[2];t=b.util.getBoundsOfCurve(q,l,m,n,m,n,p,r);q=p;l=r;break;case "Q":m=c[1];n=c[2];t=b.util.getBoundsOfCurve(q,l,m,n,m,n,c[3],c[4]);q=c[3];l=c[4];break;case "t":p=q+c[1];r=l+c[2];null===e[0].match(/[QqTt]/)?(m=q,n=l):(m=2*q-m,n=2*l-n);t=b.util.getBoundsOfCurve(q,l,m,n,m,n,p,r);q=p;l=r;break;case "T":p=c[1];r=c[2];null===e[0].match(/[QqTt]/)?(m=q,n=l):(m=2*q-m,n=2*l-n);t=b.util.getBoundsOfCurve(q,l,m,n,m,n,p,
r);q=p;l=r;break;case "a":t=b.util.getBoundsOfArc(q,l,c[1],c[2],c[3],c[4],c[5],c[6]+q,c[7]+l);q+=c[6];l+=c[7];break;case "A":t=b.util.getBoundsOfArc(q,l,c[1],c[2],c[3],c[4],c[5],c[6],c[7]);q=c[6];l=c[7];break;case "z":case "Z":q=f,l=h}e=c;t.forEach(function(b){a.push(b.x);d.push(b.y)});a.push(q);d.push(l)}c=k(a);e=k(d);f=g(a);h=g(d);return{left:c,top:e,width:f-c,height:h-e}}}),b.Path.fromObject=function(a,d){"string"===typeof a.path?b.loadSVGFromURL(a.path,function(c){c=c[0];var e=a.path;delete a.path;
b.util.object.extend(c,a);c.setSourcePath(e);d(c)}):d(new b.Path(a.path,a))},b.Path.ATTRIBUTE_NAMES=b.SHARED_ATTRIBUTES.concat(["d"]),b.Path.fromElement=function(a,d,e){a=b.parseAttributes(a,b.Path.ATTRIBUTE_NAMES);d&&d(new b.Path(a.d,c(a,e)))},b.Path.async=!0)})("undefined"!==typeof a?a:this);(function(a){var b=a.fabric||(a.fabric={}),k=b.util.object.extend,g=b.util.array.invoke,c=b.Object.prototype.toObject;b.PathGroup?b.warn("fabric.PathGroup is already defined"):(b.PathGroup=b.util.createClass(b.Path,
{type:"path-group",fill:"",initialize:function(a,b){b=b||{};this.paths=a||[];for(a=this.paths.length;a--;)this.paths[a].group=this;b.toBeParsed&&(this.parseDimensionsFromPaths(b),delete b.toBeParsed);this.setOptions(b);this.setCoords();b.sourcePath&&this.setSourcePath(b.sourcePath)},parseDimensionsFromPaths:function(a){for(var c,d,f=[],g=[],h,k=this.transformMatrix,l=this.paths.length;l--;)for(c=this.paths[l],d=c.height+c.strokeWidth,h=c.width+c.strokeWidth,c=[{x:c.left,y:c.top},{x:c.left+h,y:c.top},
{x:c.left,y:c.top+d},{x:c.left+h,y:c.top+d}],h=0;h<c.length;h++)d=c[h],k&&(d=b.util.transformPoint(d,k,!1)),f.push(d.x),g.push(d.y);a.width=Math.max.apply(null,f);a.height=Math.max.apply(null,g)},render:function(a){if(this.visible){a.save();this.transformMatrix&&a.transform.apply(a,this.transformMatrix);this.transform(a);this._setShadow(a);this.clipTo&&b.util.clipContext(this,a);a.translate(-this.width/2,-this.height/2);for(var c=0,d=this.paths.length;c<d;++c)this.paths[c].render(a,!0);this.clipTo&&
a.restore();this._removeShadow(a);a.restore()}},_set:function(a,b){if("fill"===a&&b&&this.isSameColor())for(var d=this.paths.length;d--;)this.paths[d]._set(a,b);return this.callSuper("_set",a,b)},toObject:function(a){a=k(c.call(this,a),{paths:g(this.getObjects(),"toObject",a)});this.sourcePath&&(a.sourcePath=this.sourcePath);return a},toDatalessObject:function(a){a=this.toObject(a);this.sourcePath&&(a.paths=this.sourcePath);return a},toSVG:function(a){var b=this.getObjects(),d=this.getPointByOrigin("left",
"top");d="translate("+d.x+" "+d.y+")";d=["<g ",'style="',this.getSvgStyles(),'" ','transform="',this.getSvgTransformMatrix(),d,this.getSvgTransform(),'" ',">\n"];for(var c=0,f=b.length;c<f;c++)d.push(b[c].toSVG(a));d.push("</g>\n");return a?a(d.join("")):d.join("")},toString:function(){return"#<fabric.PathGroup ("+this.complexity()+"): { top: "+this.top+", left: "+this.left+" }>"},isSameColor:function(){var a=(this.getObjects()[0].get("fill")||"").toLowerCase();return this.getObjects().every(function(b){return(b.get("fill")||
"").toLowerCase()===a})},complexity:function(){return this.paths.reduce(function(a,b){return a+(b&&b.complexity?b.complexity():0)},0)},getObjects:function(){return this.paths}}),b.PathGroup.fromObject=function(a,c){"string"===typeof a.paths?b.loadSVGFromURL(a.paths,function(d){var e=a.paths;delete a.paths;d=b.util.groupSVGElements(d,a,e);c(d)}):b.util.enlivenObjects(a.paths,function(d){delete a.paths;c(new b.PathGroup(d,a))})},b.PathGroup.async=!0)})("undefined"!==typeof a?a:this);(function(a){var b=
a.fabric||(a.fabric={}),k=b.util.object.extend,g=b.util.array.min,c=b.util.array.max,f=b.util.array.invoke;if(!b.Group){var e={lockMovementX:!0,lockMovementY:!0,lockRotation:!0,lockScalingX:!0,lockScalingY:!0,lockUniScaling:!0};b.Group=b.util.createClass(b.Object,b.Collection,{type:"group",initialize:function(a,b){b=b||{};this._objects=a||[];for(a=this._objects.length;a--;)this._objects[a].group=this;this.originalState={};this.callSuper("initialize");b.originX&&(this.originX=b.originX);b.originY&&
(this.originY=b.originY);this._calcBounds();this._updateObjectsCoords();this.callSuper("initialize",b);this.setCoords();this.saveCoords()},_updateObjectsCoords:function(){this.forEachObject(this._updateObjectCoords,this)},_updateObjectCoords:function(a){var b=a.getLeft(),d=a.getTop(),c=this.getCenterPoint();a.set({originalLeft:b,originalTop:d,left:b-c.x,top:d-c.y});a.setCoords();a.__origHasControls=a.hasControls;a.hasControls=!1},toString:function(){return"#<fabric.Group: ("+this.complexity()+")>"},
addWithUpdate:function(a){this._restoreObjectsState();a&&(this._objects.push(a),a.group=this);this.forEachObject(this._setObjectActive,this);this._calcBounds();this._updateObjectsCoords();return this},_setObjectActive:function(a){a.set("active",!0);a.group=this},removeWithUpdate:function(a){this._moveFlippedObject(a);this._restoreObjectsState();this.forEachObject(this._setObjectActive,this);this.remove(a);this._calcBounds();this._updateObjectsCoords();return this},_onObjectAdded:function(a){a.group=
this},_onObjectRemoved:function(a){delete a.group;a.set("active",!1)},delegatedProperties:{fill:!0,opacity:!0,fontFamily:!0,fontWeight:!0,fontSize:!0,fontStyle:!0,lineHeight:!0,textDecoration:!0,textAlign:!0,backgroundColor:!0},_set:function(a,b){if(a in this.delegatedProperties)for(var d=this._objects.length;d--;)this._objects[d].set(a,b);this.callSuper("_set",a,b)},toObject:function(a){return k(this.callSuper("toObject",a),{objects:f(this._objects,"toObject",a)})},render:function(a){if(this.visible){a.save();
this.clipTo&&b.util.clipContext(this,a);this.transform(a);for(var d=0,c=this._objects.length;d<c;d++)this._renderObject(this._objects[d],a);this.clipTo&&a.restore();a.restore()}},_renderControls:function(a,b){this.callSuper("_renderControls",a,b);b=0;for(var d=this._objects.length;b<d;b++)this._objects[b]._renderControls(a)},_renderObject:function(a,b){var d=a.hasRotatingPoint;a.visible&&(a.hasRotatingPoint=!1,a.render(b),a.hasRotatingPoint=d)},_restoreObjectsState:function(){this._objects.forEach(this._restoreObjectState,
this);return this},realizeTransform:function(a){this._moveFlippedObject(a);this._setObjectPosition(a);return a},_moveFlippedObject:function(a){var b=a.get("originX"),d=a.get("originY"),c=a.getCenterPoint();a.set({originX:"center",originY:"center",left:c.x,top:c.y});this._toggleFlipping(a);c=a.getPointByOrigin(b,d);a.set({originX:b,originY:d,left:c.x,top:c.y});return this},_toggleFlipping:function(a){this.flipX&&(a.toggle("flipX"),a.set("left",-a.get("left")),a.setAngle(-a.getAngle()));this.flipY&&
(a.toggle("flipY"),a.set("top",-a.get("top")),a.setAngle(-a.getAngle()))},_restoreObjectState:function(a){this._setObjectPosition(a);a.setCoords();a.hasControls=a.__origHasControls;delete a.__origHasControls;a.set("active",!1);a.setCoords();delete a.group;return this},_setObjectPosition:function(a){var b=this.getCenterPoint(),d=this._getRotatedLeftTop(a);a.set({angle:a.getAngle()+this.getAngle(),left:b.x+d.left,top:b.y+d.top,scaleX:a.get("scaleX")*this.get("scaleX"),scaleY:a.get("scaleY")*this.get("scaleY")})},
_getRotatedLeftTop:function(a){var b=this.getAngle()*(Math.PI/180);return{left:-Math.sin(b)*a.getTop()*this.get("scaleY")+Math.cos(b)*a.getLeft()*this.get("scaleX"),top:Math.cos(b)*a.getTop()*this.get("scaleY")+Math.sin(b)*a.getLeft()*this.get("scaleX")}},destroy:function(){this._objects.forEach(this._moveFlippedObject,this);return this._restoreObjectsState()},saveCoords:function(){this._originalLeft=this.get("left");this._originalTop=this.get("top");return this},hasMoved:function(){return this._originalLeft!==
this.get("left")||this._originalTop!==this.get("top")},setObjectsCoords:function(){this.forEachObject(function(a){a.setCoords()});return this},_calcBounds:function(a){for(var b=[],d=[],c,e,f=["tr","br","bl","tl"],g=0,k=this._objects.length;g<k;++g){c=this._objects[g];c.setCoords();for(var h=0;h<f.length;h++)e=f[h],b.push(c.oCoords[e].x),d.push(c.oCoords[e].y)}this.set(this._getBounds(b,d,a))},_getBounds:function(a,e,f){var d=b.util.invertTransform(this.getViewportTransform()),k=b.util.transformPoint(new b.Point(g(a),
g(e)),d);a=b.util.transformPoint(new b.Point(c(a),c(e)),d);a={width:a.x-k.x||0,height:a.y-k.y||0};f||(a.left=k.x||0,a.top=k.y||0,"center"===this.originX&&(a.left+=a.width/2),"right"===this.originX&&(a.left+=a.width),"center"===this.originY&&(a.top+=a.height/2),"bottom"===this.originY&&(a.top+=a.height));return a},toSVG:function(a){for(var b=["<g ",'transform="',this.getSvgTransform(),'">\n'],d=0,c=this._objects.length;d<c;d++)b.push(this._objects[d].toSVG(a));b.push("</g>\n");return a?a(b.join("")):
b.join("")},get:function(a){if(a in e){if(this[a])return this[a];for(var b=0,d=this._objects.length;b<d;b++)if(this._objects[b][a])return!0;return!1}return a in this.delegatedProperties?this._objects[0]&&this._objects[0].get(a):this[a]}});b.Group.fromObject=function(a,c){b.util.enlivenObjects(a.objects,function(d){delete a.objects;c&&c(new b.Group(d,a))})};b.Group.async=!0}})("undefined"!==typeof a?a:this);(function(a){var h=b.util.object.extend;a.fabric||(a.fabric={});a.fabric.Image?b.warn("fabric.Image is already defined."):
(b.Image=b.util.createClass(b.Object,{type:"image",crossOrigin:"",alignX:"none",alignY:"none",meetOrSlice:"meet",_lastScaleX:1,_lastScaleY:1,initialize:function(a,b){b||(b={});this.filters=[];this.resizeFilters=[];this.callSuper("initialize",b);this._initElement(a,b);this._initConfig(b);b.filters&&(this.filters=b.filters,this.applyFilters())},getElement:function(){return this._element},setElement:function(a,b,c){this._originalElement=this._element=a;this._initConfig(c);0!==this.filters.length?this.applyFilters(b):
b&&b();return this},setCrossOrigin:function(a){this.crossOrigin=a;this._element.crossOrigin=a;return this},getOriginalSize:function(){var a=this.getElement();return{width:a.width,height:a.height}},_stroke:function(a){a.save();this._setStrokeStyles(a);a.beginPath();a.strokeRect(-this.width/2,-this.height/2,this.width,this.height);a.closePath();a.restore()},_renderDashedStroke:function(a){var g=-this.width/2,c=-this.height/2,f=this.width,e=this.height;a.save();this._setStrokeStyles(a);a.beginPath();
b.util.drawDashedLine(a,g,c,g+f,c,this.strokeDashArray);b.util.drawDashedLine(a,g+f,c,g+f,c+e,this.strokeDashArray);b.util.drawDashedLine(a,g+f,c+e,g,c+e,this.strokeDashArray);b.util.drawDashedLine(a,g,c+e,g,c,this.strokeDashArray);a.closePath();a.restore()},toObject:function(a){return h(this.callSuper("toObject",a),{src:this._originalElement.src||this._originalElement._src,filters:this.filters.map(function(a){return a&&a.toObject()}),crossOrigin:this.crossOrigin,alignX:this.alignX,alignY:this.alignY,
meetOrSlice:this.meetOrSlice})},toSVG:function(a){var b=[],c=-this.width/2,f=-this.height/2,e="none";this.group&&"path-group"===this.group.type&&(c=this.left,f=this.top);"none"!==this.alignX&&"none"!==this.alignY&&(e="x"+this.alignX+"Y"+this.alignY+" "+this.meetOrSlice);b.push('<g transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'">\n','<image xlink:href="',this.getSvgSrc(),'" x="',c,'" y="',f,'" style="',this.getSvgStyles(),'" width="',this.width,'" height="',this.height,'" preserveAspectRatio="',
e,'"',"></image>\n");if(this.stroke||this.strokeDashArray)e=this.fill,this.fill=null,b.push("<rect ",'x="',c,'" y="',f,'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),'"/>\n'),this.fill=e;b.push("</g>\n");return a?a(b.join("")):b.join("")},getSrc:function(){if(this.getElement())return this.getElement().src||this.getElement()._src},setSrc:function(a,g,c){b.util.loadImage(a,function(a){return this.setElement(a,g,c)},this,c&&c.crossOrigin)},toString:function(){return'#<fabric.Image: { src: "'+
this.getSrc()+'" }>'},clone:function(a,b){this.constructor.fromObject(this.toObject(b),a)},applyFilters:function(a,g,c,f){g=g||this.filters;if(c=c||this._originalElement){var e=c,d=b.util.createCanvasElement(),h=b.util.createImage(),k=this;d.width=e.width;d.height=e.height;d.getContext("2d").drawImage(e,0,0,e.width,e.height);if(0===g.length)return this._element=c,a&&a(),d;g.forEach(function(a){a&&a.applyTo(d,a.scaleX||k.scaleX,a.scaleY||k.scaleY);!f&&a&&"Resize"===a.type&&(k.width*=a.scaleX,k.height*=
a.scaleY)});h.width=d.width;h.height=d.height;b.isLikelyNode?(h.src=d.toBuffer(void 0,b.Image.pngCompression),k._element=h,!f&&(k._filteredEl=h),a&&a()):(h.onload=function(){k._element=h;!f&&(k._filteredEl=h);a&&a();h.onload=d=e=null},h.src=d.toDataURL("image/png"));return d}},_render:function(a,b){var c=this._findMargins();var f=b?this.left:-this.width/2;b=b?this.top:-this.height/2;"slice"===this.meetOrSlice&&(a.beginPath(),a.rect(f,b,this.width,this.height),a.clip());if(!1===this.isMoving&&this.resizeFilters.length&&
this._needsResize()){this._lastScaleX=this.scaleX;this._lastScaleY=this.scaleY;var e=this.applyFilters(null,this.resizeFilters,this._filteredEl||this._originalElement,!0)}else e=this._element;e&&a.drawImage(e,f+c.marginX,b+c.marginY,c.width,c.height);this._renderStroke(a)},_needsResize:function(){return this.scaleX!==this._lastScaleX||this.scaleY!==this._lastScaleY},_findMargins:function(){var a=this.width,b=this.height,c=0,f=0;if("none"!==this.alignX||"none"!==this.alignY)a=[this.width/this._element.width,
this.height/this._element.height],b="meet"===this.meetOrSlice?Math.min.apply(null,a):Math.max.apply(null,a),a=this._element.width*b,b*=this._element.height,"Mid"===this.alignX&&(c=(this.width-a)/2),"Max"===this.alignX&&(c=this.width-a),"Mid"===this.alignY&&(f=(this.height-b)/2),"Max"===this.alignY&&(f=this.height-b);return{width:a,height:b,marginX:c,marginY:f}},_resetWidthHeight:function(){var a=this.getElement();this.set("width",a.width);this.set("height",a.height)},_initElement:function(a){this.setElement(b.util.getById(a));
b.util.addClass(this.getElement(),b.Image.CSS_CANVAS)},_initConfig:function(a){a||(a={});this.setOptions(a);this._setWidthHeight(a);this._element&&this.crossOrigin&&(this._element.crossOrigin=this.crossOrigin)},_initFilters:function(a,g){a.filters&&a.filters.length?b.util.enlivenObjects(a.filters,function(a){g&&g(a)},"fabric.Image.filters"):g&&g()},_setWidthHeight:function(a){this.width="width"in a?a.width:this.getElement()?this.getElement().width||0:0;this.height="height"in a?a.height:this.getElement()?
this.getElement().height||0:0},complexity:function(){return 1}}),b.Image.CSS_CANVAS="canvas-img",b.Image.prototype.getSvgSrc=b.Image.prototype.getSrc,b.Image.fromObject=function(a,g){b.util.loadImage(a.src,function(c){b.Image.prototype._initFilters.call(a,a,function(f){a.filters=f||[];f=new b.Image(c,a);g&&g(f)})},null,a.crossOrigin)},b.Image.fromURL=function(a,g,c){b.util.loadImage(a,function(a){g&&g(new b.Image(a,c))},null,c&&c.crossOrigin)},b.Image.ATTRIBUTE_NAMES=b.SHARED_ATTRIBUTES.concat("x y width height preserveAspectRatio xlink:href".split(" ")),
b.Image.fromElement=function(a,g,c){a=b.parseAttributes(a,b.Image.ATTRIBUTE_NAMES);var f="xMidYMid",e="meet",d;a.preserveAspectRatio&&(d=a.preserveAspectRatio.split(" "));d&&d.length&&(e=d.pop(),"meet"!==e&&"slice"!==e?(f=e,e="meet"):d.length&&(f=d.pop()));d="none"!==f?f.slice(1,4):"none";f="none"!==f?f.slice(5,8):"none";a.alignX=d;a.alignY=f;a.meetOrSlice=e;b.Image.fromURL(a["xlink:href"],g,h(c?b.util.object.clone(c):{},a))},b.Image.async=!0,b.Image.pngCompression=1)})("undefined"!==typeof a?a:this);
(function(a){var b=a.fabric||(a.fabric={}),k=b.util.object.extend,g=b.util.object.clone,c=b.util.toFixed,f=b.StaticCanvas.supports("setLineDash");b.Text?b.warn("fabric.Text is already defined"):(a=b.Object.prototype.stateProperties.concat(),a.push("fontFamily","fontWeight","fontSize","text","textDecoration","textAlign","fontStyle","lineHeight","textBackgroundColor"),b.Text=b.util.createClass(b.Object,{_dimensionAffectingProps:{fontSize:!0,fontWeight:!0,fontFamily:!0,fontStyle:!0,lineHeight:!0,stroke:!0,
strokeWidth:!0,text:!0,textAlign:!0},_reNewline:/\r?\n/,type:"text",fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",textDecoration:"",textAlign:"left",fontStyle:"",lineHeight:1.16,textBackgroundColor:"",stateProperties:a,stroke:null,shadow:null,_fontSizeFraction:.25,_fontSizeMult:1.13,initialize:function(a,b){b=b||{};this.text=a;this.__skipDimension=!0;this.setOptions(b);this.__skipDimension=!1;this._initDimensions()},_initDimensions:function(a){if(!this.__skipDimension){a||(a=b.util.createCanvasElement().getContext("2d"),
this._setTextStyles(a));this._textLines=this.text.split(this._reNewline);this._clearCache();var d=this.textAlign;this.textAlign="left";this.width=this._getTextWidth(a);this.textAlign=d;this.height=this._getTextHeight(a)}},toString:function(){return"#<fabric.Text ("+this.complexity()+'): { "text": "'+this.text+'", "fontFamily": "'+this.fontFamily+'" }>'},_render:function(a){this.clipTo&&b.util.clipContext(this,a);this._renderTextBackground(a);this._renderText(a);this._renderTextDecoration(a);this.clipTo&&
a.restore()},_renderText:function(a){a.save();this._translateForTextAlign(a);this._setOpacity(a);this._setShadow(a);this._setupCompositeOperation(a);this._renderTextFill(a);this._renderTextStroke(a);this._restoreCompositeOperation(a);this._removeShadow(a);a.restore()},_translateForTextAlign:function(a){"left"!==this.textAlign&&"justify"!==this.textAlign&&a.translate("center"===this.textAlign?this.width/2:this.width,0)},_setTextStyles:function(a){a.textBaseline="alphabetic";this.skipTextAlign||(a.textAlign=
this.textAlign);a.font=this._getFontDeclaration()},_getTextHeight:function(){return this._textLines.length*this._getHeightOfLine()},_getTextWidth:function(a){for(var b=this._getLineWidth(a,0),c=1,e=this._textLines.length;c<e;c++){var f=this._getLineWidth(a,c);f>b&&(b=f)}return b},_renderChars:function(a,b,c,f,g){b[a](c,f,g)},_renderTextLine:function(a,b,c,f,g,h){g-=this.fontSize*this._fontSizeFraction;if("justify"!==this.textAlign)this._renderChars(a,b,c,f,g,h);else{var d=this._getLineWidth(b,h),
e=this.width;if(e>=d){d=c.split(/\s+/);c=this._getWidthOfWords(b,c,h);e=(e-c)/(d.length-1);for(var k=c=0,l=d.length;k<l;k++)this._renderChars(a,b,d[k],f+c,g,h),c+=b.measureText(d[k]).width+e}else this._renderChars(a,b,c,f,g,h)}},_getWidthOfWords:function(a,b){return a.measureText(b.replace(/\s+/g,"")).width},_getLeftOffset:function(){return-this.width/2},_getTopOffset:function(){return-this.height/2},_renderTextFill:function(a){if(this.fill||this._skipFillStrokeCheck){for(var b=0,c=0,e=this._textLines.length;c<
e;c++){var f=this._getHeightOfLine(a,c),g=f/this.lineHeight;this._renderTextLine("fillText",a,this._textLines[c],this._getLeftOffset(),this._getTopOffset()+b+g,c);b+=f}this.shadow&&!this.shadow.affectStroke&&this._removeShadow(a)}},_renderTextStroke:function(a){if(this.stroke&&0!==this.strokeWidth||this._skipFillStrokeCheck){var b=0;a.save();this.strokeDashArray&&(1&this.strokeDashArray.length&&this.strokeDashArray.push.apply(this.strokeDashArray,this.strokeDashArray),f&&a.setLineDash(this.strokeDashArray));
a.beginPath();for(var c=0,e=this._textLines.length;c<e;c++){var g=this._getHeightOfLine(a,c),h=g/this.lineHeight;this._renderTextLine("strokeText",a,this._textLines[c],this._getLeftOffset(),this._getTopOffset()+b+h,c);b+=g}a.closePath();a.restore()}},_getHeightOfLine:function(){return this.fontSize*this._fontSizeMult*this.lineHeight},_renderTextBackground:function(a){this._renderTextBoxBackground(a);this._renderTextLinesBackground(a)},_renderTextBoxBackground:function(a){this.backgroundColor&&(a.save(),
a.fillStyle=this.backgroundColor,a.fillRect(this._getLeftOffset(),this._getTopOffset(),this.width,this.height),a.restore())},_renderTextLinesBackground:function(a){var b=0,c=this._getHeightOfLine();if(this.textBackgroundColor){a.save();a.fillStyle=this.textBackgroundColor;for(var e=0,f=this._textLines.length;e<f;e++){if(""!==this._textLines[e]){var g=this._getLineWidth(a,e),h=this._getLineLeftOffset(g);a.fillRect(this._getLeftOffset()+h,this._getTopOffset()+b,g,this.fontSize*this._fontSizeMult)}b+=
c}a.restore()}},_getLineLeftOffset:function(a){return"center"===this.textAlign?(this.width-a)/2:"right"===this.textAlign?this.width-a:0},_clearCache:function(){this.__lineWidths=[];this.__lineHeights=[];this.__lineOffsets=[]},_shouldClearCache:function(){var a=!1,b;for(b in this._dimensionAffectingProps)this["__"+b]!==this[b]&&(this["__"+b]=this[b],a=!0);return a},_getLineWidth:function(a,b){if(this.__lineWidths[b])return this.__lineWidths[b];this.__lineWidths[b]=a.measureText(this._textLines[b]).width;
return this.__lineWidths[b]},_renderTextDecoration:function(a){if(this.textDecoration){var b=this.height/2,c=[];-1<this.textDecoration.indexOf("underline")&&c.push(.85);-1<this.textDecoration.indexOf("line-through")&&c.push(.43);-1<this.textDecoration.indexOf("overline")&&c.push(-.12);if(0<c.length){var e=0,f,g;var h=0;for(f=this._textLines.length;h<f;h++){var k=this._getLineWidth(a,h),l=this._getLineLeftOffset(k),m=this._getHeightOfLine(a,h);var n=0;for(g=c.length;n<g;n++)a.fillRect(this._getLeftOffset()+
l,e+(this._fontSizeMult-1+c[n])*this.fontSize-b,k,this.fontSize/15);e+=m}}}},_getFontDeclaration:function(){return[b.isLikelyNode?this.fontWeight:this.fontStyle,b.isLikelyNode?this.fontStyle:this.fontWeight,this.fontSize+"px",b.isLikelyNode?'"'+this.fontFamily+'"':this.fontFamily].join(" ")},render:function(a,b){this.visible&&(a.save(),this._setTextStyles(a),this._shouldClearCache()&&this._initDimensions(a),b||this.transform(a),this._setStrokeStyles(a),this._setFillStyles(a),this.transformMatrix&&
a.transform.apply(a,this.transformMatrix),this.group&&"path-group"===this.group.type&&a.translate(this.left,this.top),this._render(a),a.restore())},toObject:function(a){a=k(this.callSuper("toObject",a),{text:this.text,fontSize:this.fontSize,fontWeight:this.fontWeight,fontFamily:this.fontFamily,fontStyle:this.fontStyle,lineHeight:this.lineHeight,textDecoration:this.textDecoration,textAlign:this.textAlign,textBackgroundColor:this.textBackgroundColor});this.includeDefaultValues||this._removeDefaultValues(a);
return a},toSVG:function(a){var b=this._createBaseSVGMarkup(),c=this._getSVGLeftTopOffsets(this.ctx);c=this._getSVGTextAndBg(c.textTop,c.textLeft);this._wrapSVGTextAndBg(b,c);return a?a(b.join("")):b.join("")},_getSVGLeftTopOffsets:function(a){a=this._getHeightOfLine(a,0);return{textLeft:-this.width/2+(this.group&&"path-group"===this.group.type?this.left:0),textTop:0+(this.group&&"path-group"===this.group.type?-this.top:0),lineTop:a}},_wrapSVGTextAndBg:function(a,b){a.push('\t<g transform="',this.getSvgTransform(),
this.getSvgTransformMatrix(),'">\n',b.textBgRects.join(""),"\t\t<text ",this.fontFamily?'font-family="'+this.fontFamily.replace(/"/g,"'")+'" ':"",this.fontSize?'font-size="'+this.fontSize+'" ':"",this.fontStyle?'font-style="'+this.fontStyle+'" ':"",this.fontWeight?'font-weight="'+this.fontWeight+'" ':"",this.textDecoration?'text-decoration="'+this.textDecoration+'" ':"",'style="',this.getSvgStyles(),'" >',b.textSpans.join(""),"</text>\n","\t</g>\n")},_getSVGTextAndBg:function(a,b){var d=[],c=[],e=
0;this._setSVGBg(c);for(var f=0,g=this._textLines.length;f<g;f++)this.textBackgroundColor&&this._setSVGTextLineBg(c,f,b,a,e),this._setSVGTextLineText(f,d,e,b,a,c),e+=this._getHeightOfLine(this.ctx,f);return{textSpans:d,textBgRects:c}},_setSVGTextLineText:function(a,d,f,g,h){f=this.fontSize*(this._fontSizeMult-this._fontSizeFraction)-h+f-this.height/2;d.push('<tspan x="',c(g+this._getLineLeftOffset(this.__lineWidths[a]),4),'" ','y="',c(f,4),'" ',this._getFillAttributes(this.fill),">",b.util.string.escapeXml(this._textLines[a]),
"</tspan>")},_setSVGTextLineBg:function(a,b,f,g,h){a.push("\t\t<rect ",this._getFillAttributes(this.textBackgroundColor),' x="',c(f+this._getLineLeftOffset(this.__lineWidths[b]),4),'" y="',c(h-this.height/2,4),'" width="',c(this.__lineWidths[b],4),'" height="',c(this._getHeightOfLine(this.ctx,b)/this.lineHeight,4),'"></rect>\n')},_setSVGBg:function(a){this.backgroundColor&&a.push("\t\t<rect ",this._getFillAttributes(this.backgroundColor),' x="',c(-this.width/2,4),'" y="',c(-this.height/2,4),'" width="',
c(this.width,4),'" height="',c(this.height,4),'"></rect>\n')},_getFillAttributes:function(a){var d=a&&"string"===typeof a?new b.Color(a):"";return d&&d.getSource()&&1!==d.getAlpha()?'opacity="'+d.getAlpha()+'" fill="'+d.setAlpha(1).toRgb()+'"':'fill="'+a+'"'},_set:function(a,b){this.callSuper("_set",a,b);a in this._dimensionAffectingProps&&(this._initDimensions(),this.setCoords())},complexity:function(){return 1}}),b.Text.ATTRIBUTE_NAMES=b.SHARED_ATTRIBUTES.concat("x y dx dy font-family font-style font-weight font-size text-decoration text-anchor".split(" ")),
b.Text.DEFAULT_SVG_FONT_SIZE=16,b.Text.fromElement=function(a,d){if(!a)return null;var c=b.parseAttributes(a,b.Text.ATTRIBUTE_NAMES);d=b.util.object.extend(d?b.util.object.clone(d):{},c);d.top=d.top||0;d.left=d.left||0;"dx"in c&&(d.left+=c.dx);"dy"in c&&(d.top+=c.dy);"fontSize"in d||(d.fontSize=b.Text.DEFAULT_SVG_FONT_SIZE);d.originX||(d.originX="left");a=a.textContent.replace(/^\s+|\s+$|\n+/g,"").replace(/\s+/g," ");d=new b.Text(a,d);a=0;"left"===d.originX&&(a=d.getWidth()/2);"right"===d.originX&&
(a=-d.getWidth()/2);d.set({left:d.getLeft()+a,top:d.getTop()-d.getHeight()/2+d.fontSize*(.18+d._fontSizeFraction)});return d},b.Text.fromObject=function(a){return new b.Text(a.text,g(a))},b.util.createAccessors(b.Text))})("undefined"!==typeof a?a:this);delete window.fabric;return a}().fabric;a.__name__="com.fabricjs";a.fabric=b}}});(function(){var a=ca(n.com.fabricjs).fabric,b=C([13,27,32]),l=b[0],m=b[1],p=b[2];window.onkeydown=function(a){return a.keyCode!=p};var h=B("Attribute",[I],{__module__:"__main__",
get __init__(){return t(this,function(a,b){a.game=b;a.game.attributes.append(a);a.install();a.reset()})},get reset(){return t(this,function(a){a.commit()})},get predict(){return t(this,function(a){})},get interact(){return t(this,function(a){})},get commit(){return t(this,function(a){})}}),k=B("Sprite",[h],{__module__:"__main__",get __init__(){return t(this,function(a,b,c,e){a.width=c;a.height=e;h.__init__(a,b)})},get install(){return t(this,function(b){b.image=new a.Rect(F({width:b.game.scaleX(b.width),
height:b.game.scaleY(b.height),originX:"center",originY:"center",fill:"white"}))})},get reset(){return t(this,function(a,b,c,e,f){if("undefined"==typeof b||null!=b&&b.hasOwnProperty("__kwargtrans__"))b=0;if("undefined"==typeof c||null!=c&&c.hasOwnProperty("__kwargtrans__"))c=0;if("undefined"==typeof e||null!=e&&e.hasOwnProperty("__kwargtrans__"))e=0;if("undefined"==typeof f||null!=f&&f.hasOwnProperty("__kwargtrans__"))f=0;if(arguments.length){var d=arguments.length-1;if(arguments[d]&&arguments[d].hasOwnProperty("__kwargtrans__")){d=
arguments[d--];for(var g in d)switch(g){case "self":a=d[g];break;case "vX":b=d[g];break;case "vY":c=d[g];break;case "x":e=d[g];break;case "y":f=d[g]}}}a.vX=b;a.vY=c;a.x=e;a.y=f;h.reset(a)})},get predict(){return t(this,function(a){a.x+=a.vX*a.game.deltaT;a.y+=a.vY*a.game.deltaT})},get commit(){return t(this,function(a){a.image.left=a.game.orthoX(a.x);a.image.top=a.game.orthoY(a.y)})},get draw(){return t(this,function(a){a.game.canvas.add(a.image)})}}),g=B("Paddle",[k],{__module__:"__main__",margin:30,
width:10,height:100,speed:400,get __init__(){return t(this,function(a,b,c){a.index=c;k.__init__(a,b,a.width,a.height)})},get reset(){return t(this,function(a){k.reset(a,K({x:a.index?Math.floor(500)-a.margin:Math.floor(-500)+a.margin,y:0}))})},get predict(){return t(this,function(a){a.vY=0;a.index?a.game.keyCode==X("K")?a.vY=a.speed:a.game.keyCode==X("M")&&(a.vY=-a.speed):a.game.keyCode==X("A")?a.vY=a.speed:a.game.keyCode==X("Z")&&(a.vY=-a.speed);k.predict(a)})},get interact(){return t(this,function(a){a.y=
Math.max(Math.floor(a.height/2)-Math.floor(325),Math.min(a.y,Math.floor(325)-Math.floor(a.height/2)));a.y-Math.floor(a.height/2)<a.game.ball.y&&a.game.ball.y<a.y+Math.floor(a.height/2)&&(0==a.index&&a.game.ball.x<a.x||1==a.index&&a.game.ball.x>a.x)&&(a.game.ball.x=a.x,a.game.ball.vX=-a.game.ball.vX,a.game.ball.speedUp(a))})}}),c=B("Ball",[k],{__module__:"__main__",side:8,speed:300,get __init__(){return t(this,function(a,b){k.__init__(a,b,a.side,a.side)})},get reset(){return t(this,function(a){var b=
a.game.serviceIndex*Math.PI+(.5<Math.random()?1:-1)*Math.random()*Math.atan(.65);k.reset(a,K({vX:a.speed*Math.cos(b),vY:a.speed*Math.sin(b)}))})},get predict(){return t(this,function(a){k.predict(a);a.x<Math.floor(-500)?a.game.scored(1):a.x>Math.floor(500)&&a.game.scored(0);a.y>Math.floor(325)?(a.y=Math.floor(325),a.vY=-a.vY):a.y<Math.floor(-325)&&(a.y=Math.floor(-325),a.vY=-a.vY)})},get speedUp(){return t(this,function(a,b){b=1+.15*Math.pow(1-Math.abs(a.y-b.y)/Math.floor(b.height/2),2);Math.abs(a.vX)<
3*a.speed&&(a.vX*=b,a.vY*=b)})}}),f=B("Scoreboard",[h],{__module__:"__main__",nameShift:75,hintShift:25,get install(){return t(this,function(b){for(var c=[],d=$jscomp.makeIterator(C([C(["AZ keys:",-.4375]),C(["KM keys:",.0625])])),e=d.next();!e.done;e=d.next()){var f=$jscomp.makeIterator(e.value);e=f.next().value;f=f.next().value;c.append(new a.Text("Player {}".format(e),F({fill:"white",fontFamily:"arial",fontSize:"{}".format(b.game.canvas.width/30),left:b.game.orthoX(1E3*f),top:b.game.orthoY(Math.floor(325)+
b.nameShift)})))}b.playerLabels=c;b.hintLabel=new a.Text("[spacebar] starts game, [enter] resets score",F({fill:"white",fontFamily:"arial",fontSize:"{}".format(b.game.canvas.width/70),left:b.game.orthoX(-437.5),top:b.game.orthoY(Math.floor(325)+b.hintShift)}));b.image=new a.Line(D([b.game.orthoX(Math.floor(-500)),b.game.orthoY(Math.floor(325)),b.game.orthoX(Math.floor(500)),b.game.orthoY(Math.floor(325))]),F({stroke:"white"}))})},get increment(){return t(this,function(a,b){a.scores[b]++})},get reset(){return t(this,
function(a){a.scores=D([0,0]);h.reset(a)})},get commit(){return t(this,function(b){for(var c=[],d=$jscomp.makeIterator(ea(b.scores,C([-.125,.375]))),e=d.next();!e.done;e=d.next()){var f=$jscomp.makeIterator(e.value);e=f.next().value;f=f.next().value;c.append(new a.Text("{}".format(e),F({fill:"white",fontFamily:"arial",fontSize:"{}".format(b.game.canvas.width/30),left:b.game.orthoX(1E3*f),top:b.game.orthoY(Math.floor(325)+b.nameShift)})))}b.scoreLabels=c})},get draw(){return t(this,function(a){for(var b=
$jscomp.makeIterator(ea(a.playerLabels,a.scoreLabels)),c=b.next();!c.done;c=b.next()){var d=$jscomp.makeIterator(c.value);c=d.next().value;d=d.next().value;a.game.canvas.add(c);a.game.canvas.add(d);a.game.canvas.add(a.hintLabel)}a.game.canvas.add(a.image)})}});b=B("Game",[I],{__module__:"__main__",get __init__(){return t(this,function(b){b.serviceIndex=.5<Math.random()?1:0;b.pause=!0;b.keyCode=null;b.textFrame=document.getElementById("text_frame");b.canvasFrame=document.getElementById("canvas_frame");
b.buttonsFrame=document.getElementById("buttons_frame");b.canvas=new a.Canvas("canvas",F({backgroundColor:"black",originX:"center",originY:"center"}));b.canvas.onWindowDraw=b.draw;b.canvas.lineWidth=2;b.canvas.clear();b.attributes=D([]);b.paddles=function(){for(var a=[],c=0;2>c;c++)a.append(g(b,c));return a}();b.ball=c(b);b.scoreboard=f(b);window.setInterval(b.py_update,10);window.setInterval(b.draw,20);window.addEventListener("keydown",b.keydown);window.addEventListener("keyup",b.keyup);b.buttons=
D([]);for(var d=$jscomp.makeIterator(C("A Z K M space enter".split(" "))),e=d.next();!e.done;e=d.next()){e=e.value;var h=document.getElementById(e);h.addEventListener("mousedown",function(a){return function(){return b.mouseOrTouch(a,!0)}}(e));h.addEventListener("touchstart",function(a){return function(){return b.mouseOrTouch(a,!0)}}(e));h.addEventListener("mouseup",function(a){return function(){return b.mouseOrTouch(a,!1)}}(e));h.addEventListener("touchend",function(a){return function(){return b.mouseOrTouch(a,
!1)}}(e));h.style.cursor="pointer";h.style.userSelect="none";b.buttons.append(h)}b.time=+new Date;window.onresize=b.resize;b.resize()})},get install(){return t(this,function(a){a=$jscomp.makeIterator(a.attributes);for(var b=a.next();!b.done;b=a.next())b.value.install()})},get mouseOrTouch(){return t(this,function(a,b,c){a.keyCode=c?"space"==b?p:"enter"==b?l:X(b):null})},get py_update(){return t(this,function(a){var b=a.time;a.time=+new Date;a.deltaT=(a.time-b)/1E3;if(a.pause)a.keyCode==p?a.pause=
!1:a.keyCode==l&&a.scoreboard.reset();else{var c=$jscomp.makeIterator(a.attributes);for(b=c.next();!b.done;b=c.next())b=b.value,b.predict();c=$jscomp.makeIterator(a.attributes);for(b=c.next();!b.done;b=c.next())b=b.value,b.interact();a=$jscomp.makeIterator(a.attributes);for(b=a.next();!b.done;b=a.next())b=b.value,b.commit()}})},get scored(){return t(this,function(a,b){a.scoreboard.increment(b);a.serviceIndex=1-b;b=$jscomp.makeIterator(a.paddles);for(var c=b.next();!c.done;c=b.next())c.value.reset();
a.ball.reset();a.pause=!0})},get commit(){return t(this,function(a){a=$jscomp.makeIterator(a.attributes);for(var b=a.next();!b.done;b=a.next())b.value.commit()})},get draw(){return t(this,function(a){a.canvas.clear();a=$jscomp.makeIterator(a.attributes);for(var b=a.next();!b.done;b=a.next())b.value.draw()})},get resize(){return t(this,function(a){a.pageWidth=window.innerWidth;a.pageHeight=window.innerHeight;a.textTop=0;a.pageHeight>1.2*a.pageWidth?(a.canvasWidth=a.pageWidth,a.canvasTop=a.textTop+
300):(a.canvasWidth=.6*a.pageWidth,a.canvasTop=a.textTop+200);a.canvasLeft=.5*(a.pageWidth-a.canvasWidth);a.canvasHeight=.6*a.canvasWidth;a.buttonsTop=a.canvasTop+a.canvasHeight+50;a.buttonsWidth=500;a.textFrame.style.top=a.textTop;a.textFrame.style.left=a.canvasLeft+.05*a.canvasWidth;a.textFrame.style.width=.9*a.canvasWidth;a.canvasFrame.style.top=a.canvasTop;a.canvasFrame.style.left=a.canvasLeft;a.canvas.setDimensions(F({width:a.canvasWidth,height:a.canvasHeight}));a.buttonsFrame.style.top=a.buttonsTop;
a.buttonsFrame.style.left=.5*(a.pageWidth-a.buttonsWidth);a.buttonsFrame.style.width=a.canvasWidth;a.install();a.commit();a.draw()})},get scaleX(){return t(this,function(a,b){return a.canvas.width/1E3*b})},get scaleY(){return t(this,function(a,b){return a.canvas.height/750*b})},get orthoX(){return t(this,function(a,b){return a.scaleX(b+Math.floor(500))})},get orthoY(){return t(this,function(a,b){return a.scaleY(750-Math.floor(325)-b)})},get keydown(){return t(this,function(a,b){a.keyCode=b.keyCode})},
get keyup(){return t(this,function(a,b){a.keyCode=null})}});var e=b();n.Attribute=h;n.Ball=c;n.Game=b;n.Paddle=g;n.Scoreboard=f;n.Sprite=k;n.__name__="__main__";n.enter=l;n.esc=m;n.fabric=a;n.fieldHeight=650;n.game=e;n.orthoHeight=750;n.orthoWidth=1E3;n.space=p})();return n}window.pong=pong();

//# sourceMappingURL=extra/sourcemap/pong.min.js.map
