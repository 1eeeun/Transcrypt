function pong(){function P(h,m,p){"undefined"==typeof m&&(m=h,h=0);"undefined"==typeof p&&(p=1);if(0<p&&h>=m||0>p&&h<=m)return[];for(var f=[];0<p?h<m:h>m;h+=p)f.push(h);return f}function Q(h){if(null==h||"object"==typeof h)return h;var m={},p;for(p in obj)h.hasOwnProperty(p)&&(m[p]=h[p]);return m}function R(h){if(null==h||"object"==typeof h)return h;var m={},p;for(p in obj)h.hasOwnProperty(p)&&(m[p]=R(h[p]));return m}function x(h){h=h?[].slice.apply(h):[];h.__class__=x;return h}function C(h){h=h?
[].slice.apply(h):[];h.__class__=C;return h}function K(h){var m=x();if(h)for(var p=0;p<h.length;p++)-1==m.indexOf(h[p])&&m.push(h[p]);m.__class__=K;return m}function S(){keys=[];for(attrib in this)__normalattrib__(attrib)&&keys.push(key);return keys}function M(h){var m={};if(h)for(var p=0;p<h.length;p++)m[pair[0]]=pair[1];m.__class__=M;m.keys=S;return m}function G(h){return new String(h)}var n={},H=function(h,m,p){if(""!=m){m=m.split(".");for(var f=m.length,l=0;l<m.length;l++){if(!h.hasOwnProperty(m[l])){f=
l;break}h=h[m[l]]}for(l=f;l<m.length;l++)h[m[l]]={},h=h[m[l]]}for(var e in p)h[e]=p[e]};n.__nest__=H;var L=function(h){h.__inited__||h.__all__.__init__(h.__all__);return h.__all__};n.__init__=L;var r=function(h,m){return h?h.hasOwnProperty("__class__")?function(p){p=[].slice.apply(arguments);return m.apply(null,[h].concat(p))}:m:m};n.__get__=r;var E=function(h,m,p){for(var f=function(){var a=[].slice.apply(arguments);return f.__new__(a)},l=m.length-1;0<=l;l--){var e=m[l],g;for(g in e){var c=Object.getOwnPropertyDescriptor(e,
g);Object.defineProperty(f,g,c)}}f.__name__=h;f.__bases__=m;for(g in p)c=Object.getOwnPropertyDescriptor(p,g),Object.defineProperty(f,g,c);return f};n.__class__=E;var I=n.__class__("object",[],{__init__:function(h){},__name__:"object",__bases__:[],__new__:function(h){var m=Object.create(this,{__class__:{value:this,enumerable:!0}});this.__init__.apply(null,[m].concat(h));return m}});n.object=I;H(n,"org.transcrypt.__base__",{__all__:{__inited__:!1,__init__:function(h){var m=E("__Envir__",[I],{get __init__(){return r(this,
function(f){f.transpilerName="transcrypt";f.transpilerVersion="0.0.49";f.targetSubDir="__javascript__"})}}),p=m();h.__Envir__=m;h.__envir__=p}}});H(n,"org.transcrypt.__standard__",{__all__:{__inited__:!1,__init__:function(h){var m=E("Exception",[I],{get __init__(){return r(this,function(f){var l=C([].slice.apply(arguments).slice(1));f.args=l})},get __repr__(){return r(this,function(f){return J(f.args)?"{}{}".format(f.__class__.__name__,T(C(f.args))):"???"})},get __str__(){return r(this,function(f){return 1<
J(f.args)?G(C(f.args)):J(f.args)?G(f.args[0]):"???"})}}),p=function(f,l,e){if("undefined"==typeof f||f.__class__==t)f=null;if("undefined"==typeof l||l.__class__==t)l=!1;if(arguments.length){var g=arguments.length-1;if(arguments[g]&&arguments[g].__class__==t){var g=arguments[g--],c;for(c in g)switch(c){case "iterable":f=g[c];break;case "key":l=g[c];break;case "reverse":e=g[c]}}}l?f.sort(function(a,b){if(arguments.length){var d=arguments.length-1;if(arguments[d]&&arguments[d].__class__==t){var d=arguments[d--],
k;for(k in d)switch(k){case "a":a=d[k];break;case "b":b=d[k]}}}return l(a)>l(b)}):f.sort();e&&f.reverse()};h.Exception=m;h.sort=p;h.sorted=function(f,l,e){if("undefined"==typeof f||f.__class__==t)f=null;if("undefined"==typeof l||l.__class__==t)l=!1;if(arguments.length){var g=arguments.length-1;if(arguments[g]&&arguments[g].__class__==t){var g=arguments[g--],c;for(c in g)switch(c){case "iterable":f=g[c];break;case "key":l=g[c];break;case "reverse":e=g[c]}}}c=Q(f);p(c,l,e);return c}}}});H(n,"",L(n.org.transcrypt.__base__));
var U=n.__envir__;H(n,"",L(n.org.transcrypt.__standard__));U.executorName=U.transpilerName;n.main={__file__:""};n.__except__=null;var t=function(h){t.__name__="__kwargdict__";h.__class__=t;h.constructor=Object;return h};n.___kwargdict__=t;n.__merge__=function(h,m){var p={},f;for(f in h)p[f]=h[f];for(f in m)p[f]=m[f];return p};var V=function(){console.log([].slice.apply(arguments).join(" "))};n.print=V;console.log.apply=function(){V([].slice.apply(arguments).slice(1))};n.__in__=function(h,m){return-1<
m.indexOf(h)};var N=function(h){return h.startswith("__")&&h.endswith("__")||"constructor"==h};n.__specialattrib__=N;var J=function(h){try{return h.length}catch(m){result=0;for(attrib in h)N(attrib)||result++;return result}};n.len=J;var W={__name__:"bool"};n.bool=W;var X={__name__:"int"};n.int=X;var Y={__name__:"float"};n.float=Y;n.type=function(h){try{return h.__class__}catch(p){var m=typeof h;return"boolean"==m?W:"number"==m?0==h%1?X:Y:m}};n.isinstance=function(h,m){function p(f){if(f==m)return!0;
for(var l=0;l<f.__bases__.length;l++)if(p(f.__bases__[l],m))return!0;return!1}return p(h.__class__)};var T=function(h){try{return h.__repr__()}catch(e){try{return h.__str__()}catch(g){try{if(h.constructor==Object){var m="{",p=!1,f;for(f in h)if(!N(f)){var l=f.isnumeric()?f:"'"+f+"'";p?m+=", ":p=!0;try{m+=l+": "+h[f].__repr__()}catch(c){m+=l+": "+h[f].toString()}}return m+"}"}return"boolean"==typeof h?h.toString().capitalize():h.toString()}catch(c){return console.log("ERROR: Could not evaluate repr (<object of type "+
typeof h+">)"),"???"}}}};n.repr=T;var Z=function(){var h=[].slice.call(arguments);return(0==h.length?[]:h.reduce(function(h,p){return h.length<p.length?h:p})).map(function(m,p){return h.map(function(f){return f[p]})})};n.zip=Z;n.range=P;n.enumerate=function(h){return Z(P(J(h)),h)};n.copy=Q;n.deepcopy=R;n.list=x;Array.prototype.__class__=x;x.__name__="list";Array.prototype.__getslice__=function(h,m,p){0>h&&(h=this.length+1-h);null==m?m=this.length:0>m&&(m=this.length+1-m);for(var f=[];h<m;h+=p)f.push(this[h]);
return f};Array.prototype.__repr__=function(){if(this.__class__==K&&!this.length)return"set()";for(var h=this.__class__&&this.__class__!=x?this.__class__==C?"(":"{":"[",m=0;m<this.length;m++){m&&(h+=", ");try{h+=this[m].__repr__()}catch(p){h+=this[m].toString()}}this.__class__==C&&1==this.length&&(h+=",");return h+=this.__class__&&this.__class__!=x?this.__class__==C?")":"}":"]"};Array.prototype.__setslice__=function(h,m,p,f){0>h&&(h=this.length+1-h);null==m?m=this.length:0>m&&(m=this.length+1-m);
if(null==p)Array.prototype.splice.apply(this,[h,m-h].concat(f));else for(var l=0;h<m;h+=p)this[h]=f[l++]};Array.prototype.__str__=Array.prototype.__repr__;Array.prototype.append=function(h){this.push(h)};Array.prototype.clear=function(h){h.splice(0,h.length)};Array.prototype.extend=function(h){this.push.apply(this,h)};n.tuple=C;C.__name__="tuple";n.set=K;K.__name__="set";n.__keys__=S;n.dict=M;M.__name__="dict";n.str=G;String.prototype.__class__=G;G.__name__="str";String.prototype.__repr__=function(){return(-1==
this.indexOf("'")?"'"+this+"'":'"'+this+'"').replace("\n","\\n")};String.prototype.__str__=function(){return this};String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.slice(1)};String.prototype.endswith=function(h){return""==h||this.slice(-h.length)==h};String.prototype.find=function(h,m){return this.indexOf(h,m)};String.prototype.format=function(){var h=arguments,m=0;return this.replace(/\{(\w*)\}/g,function(p,f){""==f&&(f=m++);if(f==+f)return"undefined"==h[f]?p:h[f];
for(var l=0;l<h.length;l++)if("object"==typeof h[l]&&"undefined"!=typeof h[l][f])return h[l][f];return p})};String.prototype.isnumeric=function(){return!isNaN(parseFloat(this))&&isFinite(this)};String.prototype.join=function(h){return h.join(this)};String.prototype.jsSplit=String.prototype.split;String.prototype.lower=function(){return this.toLowerCase()};String.prototype.lstrip=function(){return this.replace(/^\s*/g,"")};String.prototype.rfind=function(h,m){return this.lastIndexOf(h,m)};String.prototype.rsplit=
function(h,m){var p=this.split(h||/s+/);return m?[p.slice(0,-m).join(h)].concat(p.slice(-m)):p};String.prototype.rstrip=function(){return this.replace(/\s*$/g,"")};String.prototype.split=function(h,m){h||(h=" ");return this.jsSplit(h||/s+/,m)};String.prototype.startswith=function(h){return 0==this.indexOf(h)};String.prototype.strip=function(){return this.trim()};String.prototype.upper=function(){return this.toUpperCase()};n.str=G;H(n,"org.transcrypt.fabric",{__all__:{__inited__:!1,__init__:function(h){var m=
function(){var h={},f=f||{version:"1.5.0"};"undefined"!==typeof h&&(h.fabric=f);"undefined"!==typeof document&&"undefined"!==typeof window?(f.document=document,f.window=window,window.fabric=f):(f.document=require("jsdom").jsdom("<!DOCTYPE html><html><head></head><body></body></html>"),f.window=f.document.createWindow?f.document.createWindow():f.document.parentWindow);f.isTouchSupported="ontouchstart"in f.document.documentElement;f.isLikelyNode="undefined"!==typeof Buffer&&"undefined"===typeof window;
f.SHARED_ATTRIBUTES="display transform fill fill-opacity fill-rule opacity stroke stroke-dasharray stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width".split(" ");f.DPI=96;f.reNum="(?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:e[-+]?\\d+)?)";(function(){function l(a,b){this.__eventListeners[a]&&(b?f.util.removeFromArray(this.__eventListeners[a],b):this.__eventListeners[a].length=0)}function e(a,b){this.__eventListeners||(this.__eventListeners={});if(1===arguments.length)for(var d in a)this.on(d,
a[d]);else this.__eventListeners[a]||(this.__eventListeners[a]=[]),this.__eventListeners[a].push(b);return this}function g(a,b){if(this.__eventListeners){if(0===arguments.length)this.__eventListeners={};else if(1===arguments.length&&"object"===typeof arguments[0])for(var d in a)l.call(this,d,a[d]);else l.call(this,a,b);return this}}function c(a,b){if(this.__eventListeners){var d=this.__eventListeners[a];if(d){for(var k=0,c=d.length;k<c;k++)d[k].call(this,b||{});return this}}}f.Observable={observe:e,
stopObserving:g,fire:c,on:e,off:g,trigger:c}})();f.Collection={add:function(){this._objects.push.apply(this._objects,arguments);for(var f=0,e=arguments.length;f<e;f++)this._onObjectAdded(arguments[f]);this.renderOnAddRemove&&this.renderAll();return this},insertAt:function(f,e,g){var c=this.getObjects();g?c[e]=f:c.splice(e,0,f);this._onObjectAdded(f);this.renderOnAddRemove&&this.renderAll();return this},remove:function(){for(var f=this.getObjects(),e,g=0,c=arguments.length;g<c;g++)e=f.indexOf(arguments[g]),
-1!==e&&(f.splice(e,1),this._onObjectRemoved(arguments[g]));this.renderOnAddRemove&&this.renderAll();return this},forEachObject:function(f,e){for(var g=this.getObjects(),c=g.length;c--;)f.call(e,g[c],c,g);return this},getObjects:function(f){return"undefined"===typeof f?this._objects:this._objects.filter(function(e){return e.type===f})},item:function(f){return this.getObjects()[f]},isEmpty:function(){return 0===this.getObjects().length},size:function(){return this.getObjects().length},contains:function(f){return-1<
this.getObjects().indexOf(f)},complexity:function(){return this.getObjects().reduce(function(f,e){return f+=e.complexity?e.complexity():0},0)}};(function(l){var e=Math.sqrt,g=Math.atan2,c=Math.PI/180;f.util={removeFromArray:function(a,b){var d=a.indexOf(b);-1!==d&&a.splice(d,1);return a},getRandomInt:function(a,b){return Math.floor(Math.random()*(b-a+1))+a},degreesToRadians:function(a){return a*c},radiansToDegrees:function(a){return a/c},rotatePoint:function(a,b,d){var k=Math.sin(d);d=Math.cos(d);
a.subtractEquals(b);return(new f.Point(a.x*d-a.y*k,a.x*k+a.y*d)).addEquals(b)},transformPoint:function(a,b,d){return d?new f.Point(b[0]*a.x+b[2]*a.y,b[1]*a.x+b[3]*a.y):new f.Point(b[0]*a.x+b[2]*a.y+b[4],b[1]*a.x+b[3]*a.y+b[5])},invertTransform:function(a){var b=a.slice(),b=1/(a[0]*a[3]-a[1]*a[2]),b=[b*a[3],-b*a[1],-b*a[2],b*a[0],0,0];a=f.util.transformPoint({x:a[4],y:a[5]},b);b[4]=-a.x;b[5]=-a.y;return b},toFixed:function(a,b){return parseFloat(Number(a).toFixed(b))},parseUnit:function(a,b){var d=
/\D{0,2}$/.exec(a),k=parseFloat(a);b||(b=f.Text.DEFAULT_SVG_FONT_SIZE);switch(d[0]){case "mm":return k*f.DPI/25.4;case "cm":return k*f.DPI/2.54;case "in":return k*f.DPI;case "pt":return k*f.DPI/72;case "pc":return k*f.DPI/72*12;case "em":return k*b;default:return k}},falseFunction:function(){return!1},getKlass:function(a,b){a=f.util.string.camelize(a.charAt(0).toUpperCase()+a.slice(1));return f.util.resolveNamespace(b)[a]},resolveNamespace:function(a){if(!a)return f;a=a.split(".");for(var b=a.length,
d=l||f.window,k=0;k<b;++k)d=d[a[k]];return d},loadImage:function(a,b,d,k){if(a){var c=f.util.createImage();c.onload=function(){b&&b.call(d,c);c=c.onload=c.onerror=null};c.onerror=function(){f.log("Error loading "+c.src);b&&b.call(d,null,!0);c=c.onload=c.onerror=null};0!==a.indexOf("data")&&"undefined"!==typeof k&&(c.crossOrigin=k);c.src=a}else b&&b.call(d,a)},enlivenObjects:function(a,b,d,k){function c(){++g===l&&b&&b(e)}a=a||[];var e=[],g=0,l=a.length;l?a.forEach(function(a,b){if(a&&a.type){var g=
f.util.getKlass(a.type,d);g.async?g.fromObject(a,function(d,g){g||(e[b]=d,k&&k(a,e[b]));c()}):(e[b]=g.fromObject(a),k&&k(a,e[b]),c())}else c()}):b&&b(e)},groupSVGElements:function(a,b,d){a=new f.PathGroup(a,b);"undefined"!==typeof d&&a.setSourcePath(d);return a},populateWithProperties:function(a,b,d){if(d&&"[object Array]"===Object.prototype.toString.call(d))for(var k=0,c=d.length;k<c;k++)d[k]in a&&(b[d[k]]=a[d[k]])},drawDashedLine:function(a,b,d,k,c,f){k-=b;var y=c-d;c=e(k*k+y*y);k=g(y,k);var y=
f.length,l=0,h=!0;a.save();a.translate(b,d);a.moveTo(0,0);a.rotate(k);for(b=0;c>b;)b+=f[l++%y],b>c&&(b=c),a[h?"lineTo":"moveTo"](b,0),h=!h;a.restore()},createCanvasElement:function(a){a||(a=f.document.createElement("canvas"));a.getContext||"undefined"===typeof G_vmlCanvasManager||G_vmlCanvasManager.initElement(a);return a},createImage:function(){return f.isLikelyNode?new (require("canvas").Image):f.document.createElement("img")},createAccessors:function(a){a=a.prototype;for(var b=a.stateProperties.length;b--;){var d=
a.stateProperties[b],k=d.charAt(0).toUpperCase()+d.slice(1),c="set"+k,k="get"+k;a[k]||(a[k]=new Function('return this.get("'+d+'")'));a[c]||(a[c]=new Function("value",'return this.set("'+d+'", value)'))}},clipContext:function(a,b){b.save();b.beginPath();a.clipTo(b);b.clip()},multiplyTransformMatrices:function(a,b){return[a[0]*b[0]+a[2]*b[1],a[1]*b[0]+a[3]*b[1],a[0]*b[2]+a[2]*b[3],a[1]*b[2]+a[3]*b[3],a[0]*b[4]+a[2]*b[5]+a[4],a[1]*b[4]+a[3]*b[5]+a[5]]},getFunctionBody:function(a){return(String(a).match(/function[^{]*\{([\s\S]*)\}/)||
{})[1]},isTransparent:function(a,b,d,k){0<k&&(b=b>k?b-k:0,d=d>k?d-k:0);var c=!0;a=a.getImageData(b,d,2*k||1,2*k||1);b=3;for(d=a.data.length;b<d&&(c=0>=a.data[b],!1!==c);b+=4);return c}}})("undefined"!==typeof h?h:this);(function(){function l(d,b,c,f,l,h,ba){var O=k.call(arguments);if(a[O])return a[O];var A=Math.PI,m=ba*A/180,F=Math.sin(m),m=Math.cos(m),p=0,D=0;c=Math.abs(c);f=Math.abs(f);var z=-m*d*.5-F*b*.5,n=-m*b*.5+F*d*.5,r=c*c,v=f*f,B=n*n,u=z*z,t=r*v-r*B-v*u,x=0;0>t?(r=Math.sqrt(1-t/(r*v)),c*=
r,f*=r):x=(l===h?-1:1)*Math.sqrt(t/(r*B+v*u));B=x*c*n/f;u=-x*f*z/c;x=m*B-F*u+.5*d;r=F*B+m*u+.5*b;v=g(1,0,(z-B)/c,(n-u)/f);n=g((z-B)/c,(n-u)/f,(-z-B)/c,(-n-u)/f);0===h&&0<n?n-=2*A:1===h&&0>n&&(n+=2*A);A=Math.ceil(Math.abs(n/A*2));z=[];n/=A;B=8/3*Math.sin(n/4)*Math.sin(n/4)/Math.sin(n/2);u=v+n;for(t=0;t<A;t++)z[t]=e(v,u,m,F,c,f,x,r,B,p,D),p=z[t][4],D=z[t][5],v=u,u+=n;return a[O]=z}function e(d,a,c,e,g,f,l,h,A,m,F){var n=k.call(arguments);if(b[n])return b[n];var p=Math.cos(d),z=Math.sin(d),r=Math.cos(a),
t=Math.sin(a),v=c*g*r-e*f*t+l,B=e*g*r+c*f*t+h;b[n]=[m+A*(-c*g*z-e*f*p),F+A*(-e*g*z+c*f*p),v+A*(c*g*t+e*f*r),B+A*(e*g*t-c*f*r),v,B];return b[n]}function g(d,a,k,b){d=Math.atan2(a,d);k=Math.atan2(b,k);return k>=d?k-d:2*Math.PI-(d-k)}function c(a,b,c,e,g,f,l,h){var A=k.call(arguments);if(d[A])return d[A];var m=Math.sqrt,n=Math.min,p=Math.max,D=Math.abs,z=[],r=[[],[]],t,v,B,u,x;v=6*a-12*c+6*g;t=-3*a+9*c-9*g+3*l;B=3*c-3*a;for(var C=0;2>C;++C)0<C&&(v=6*b-12*e+6*f,t=-3*b+9*e-9*f+3*h,B=3*e-3*b),1E-12>D(t)?
1E-12>D(v)||(u=-B/v,0<u&&1>u&&z.push(u)):(u=v*v-4*B*t,0>u||(x=m(u),u=(-v+x)/(2*t),0<u&&1>u&&z.push(u),u=(-v-x)/(2*t),0<u&&1>u&&z.push(u)));for(D=m=z.length;m--;)u=z[m],v=1-u,t=v*v*v*a+3*v*v*u*c+3*v*u*u*g+u*u*u*l,r[0][m]=t,t=v*v*v*b+3*v*v*u*e+3*v*u*u*f+u*u*u*h,r[1][m]=t;r[0][D]=a;r[1][D]=b;r[0][D+1]=l;r[1][D+1]=h;n=[{x:n.apply(null,r[0]),y:n.apply(null,r[1])},{x:p.apply(null,r[0]),y:p.apply(null,r[1])}];return d[A]=n}var a={},b={},d={},k=Array.prototype.join;f.util.drawArc=function(d,a,k,b){var c=
[[],[],[],[]];b=l(b[5]-a,b[6]-k,b[0],b[1],b[3],b[4],b[2]);for(var e=0,g=b.length;e<g;e++)c[e][0]=b[e][0]+a,c[e][1]=b[e][1]+k,c[e][2]=b[e][2]+a,c[e][3]=b[e][3]+k,c[e][4]=b[e][4]+a,c[e][5]=b[e][5]+k,d.bezierCurveTo.apply(d,c[e])};f.util.getBoundsOfArc=function(d,a,k,b,e,g,f,h,A){var m=0,n=0,p=[],D=[];k=l(h-d,A-a,k,b,g,f,e);b=[[],[]];e=0;for(g=k.length;e<g;e++)p=c(m,n,k[e][0],k[e][1],k[e][2],k[e][3],k[e][4],k[e][5]),b[0].x=p[0].x+d,b[0].y=p[0].y+a,b[1].x=p[1].x+d,b[1].y=p[1].y+a,D.push(b[0]),D.push(b[1]),
m=k[e][4],n=k[e][5];return D};f.util.getBoundsOfCurve=c})();(function(){function l(e,c,a){if(e&&0!==e.length){var b=e.length-1,d=c?e[b][c]:e[b];if(c)for(;b--;)a(e[b][c],d)&&(d=e[b][c]);else for(;b--;)a(e[b],d)&&(d=e[b]);return d}}var e=Array.prototype.slice;Array.prototype.indexOf||(Array.prototype.indexOf=function(e){if(void 0===this||null===this)throw new TypeError;var c=Object(this),a=c.length>>>0;if(0===a)return-1;var b=0;0<arguments.length&&(b=Number(arguments[1]),b!==b?b=0:0!==b&&b!==Number.POSITIVE_INFINITY&&
b!==Number.NEGATIVE_INFINITY&&(b=(0<b||-1)*Math.floor(Math.abs(b))));if(b>=a)return-1;for(b=0<=b?b:Math.max(a-Math.abs(b),0);b<a;b++)if(b in c&&c[b]===e)return b;return-1});Array.prototype.forEach||(Array.prototype.forEach=function(e,c){for(var a=0,b=this.length>>>0;a<b;a++)a in this&&e.call(c,this[a],a,this)});Array.prototype.map||(Array.prototype.map=function(e,c){for(var a=[],b=0,d=this.length>>>0;b<d;b++)b in this&&(a[b]=e.call(c,this[b],b,this));return a});Array.prototype.every||(Array.prototype.every=
function(e,c){for(var a=0,b=this.length>>>0;a<b;a++)if(a in this&&!e.call(c,this[a],a,this))return!1;return!0});Array.prototype.some||(Array.prototype.some=function(e,c){for(var a=0,b=this.length>>>0;a<b;a++)if(a in this&&e.call(c,this[a],a,this))return!0;return!1});Array.prototype.filter||(Array.prototype.filter=function(e,c){for(var a=[],b,d=0,k=this.length>>>0;d<k;d++)d in this&&(b=this[d],e.call(c,b,d,this)&&a.push(b));return a});Array.prototype.reduce||(Array.prototype.reduce=function(e){var c=
this.length>>>0,a=0,b;if(1<arguments.length)b=arguments[1];else{do{if(a in this){b=this[a++];break}if(++a>=c)throw new TypeError;}while(1)}for(;a<c;a++)a in this&&(b=e.call(null,b,this[a],a,this));return b});f.util.array={invoke:function(g,c){for(var a=e.call(arguments,2),b=[],d=0,k=g.length;d<k;d++)b[d]=a.length?g[d][c].apply(g[d],a):g[d][c].call(g[d]);return b},min:function(e,c){return l(e,c,function(a,b){return a<b})},max:function(e,c){return l(e,c,function(a,b){return a>=b})}}})();(function(){function l(e,
g){for(var c in g)e[c]=g[c];return e}f.util.object={extend:l,clone:function(e){return l({},e)}}})();(function(){String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^[\s\xA0]+/,"").replace(/[\s\xA0]+$/,"")});f.util.string={camelize:function(f){return f.replace(/-+(.)?/g,function(e,g){return g?g.toUpperCase():""})},capitalize:function(f,e){return f.charAt(0).toUpperCase()+(e?f.slice(1):f.slice(1).toLowerCase())},escapeXml:function(f){return f.replace(/&/g,"&amp;").replace(/"/g,
"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}}})();(function(){var f=Array.prototype.slice,e=Function.prototype.apply,g=function(){};Function.prototype.bind||(Function.prototype.bind=function(c){var a=this,b=f.call(arguments,1),d;d=b.length?function(){return e.call(a,this instanceof g?this:c,b.concat(f.call(arguments)))}:function(){return e.call(a,this instanceof g?this:c,arguments)};g.prototype=this.prototype;d.prototype=new g;return d})})();(function(){function l(){}
function e(d){var a=this.constructor.superclass.prototype[d];return 1<arguments.length?a.apply(this,g.call(arguments,1)):a.call(this)}var g=Array.prototype.slice,c=function(){},a=function(){for(var d in{toString:1})if("toString"===d)return!1;return!0}(),b=function(d,k,b){for(var c in k)c in d.prototype&&"function"===typeof d.prototype[c]&&-1<(k[c]+"").indexOf("callSuper")?d.prototype[c]=function(d){return function(){var a=this.constructor.superclass;this.constructor.superclass=b;var c=k[d].apply(this,
arguments);this.constructor.superclass=a;if("initialize"!==d)return c}}(c):d.prototype[c]=k[c],a&&(k.toString!==Object.prototype.toString&&(d.prototype.toString=k.toString),k.valueOf!==Object.prototype.valueOf&&(d.prototype.valueOf=k.valueOf))};f.util.createClass=function(){function d(){this.initialize.apply(this,arguments)}var a=null,q=g.call(arguments,0);"function"===typeof q[0]&&(a=q.shift());d.superclass=a;d.subclasses=[];a&&(l.prototype=a.prototype,d.prototype=new l,a.subclasses.push(d));for(var f=
0,y=q.length;f<y;f++)b(d,q[f],a);d.prototype.initialize||(d.prototype.initialize=c);d.prototype.constructor=d;d.prototype.callSuper=e;return d}})();(function(){function l(d){var a=Array.prototype.slice.call(arguments,1),k,b,c=a.length;for(b=0;b<c;b++)if(k=typeof d[a[b]],!/^(?:function|object|unknown)$/.test(k))return!1;return!0}function e(d,k){return function(b){k.call(a(d),b||f.window.event)}}function g(d,a){return function(k){if(y[d]&&y[d][a])for(var b=y[d][a],c=0,e=b.length;c<e;c++)b[c].call(this,
k||f.window.event)}}function c(d,a,k){var b="touchend"===d.type?"changedTouches":"touches";return d[b]&&d[b][0]?d[b][0][a]-(d[b][0][a]-d[b][0][k])||d[k]:d[k]}var a,b,d=function(){var d=0;return function(a){return a.__uniqueID||(a.__uniqueID="uniqueID__"+d++)}}();(function(){var d={};a=function(a){return d[a]};b=function(a,k){d[a]=k}})();var k=l(f.document.documentElement,"addEventListener","removeEventListener")&&l(f.window,"addEventListener","removeEventListener"),q=l(f.document.documentElement,
"attachEvent","detachEvent")&&l(f.window,"attachEvent","detachEvent"),w={},y={};k?(k=function(d,a,k){d.addEventListener(a,k,!1)},q=function(d,a,k){d.removeEventListener(a,k,!1)}):q?(k=function(a,k,c){var g=d(a);b(g,a);w[g]||(w[g]={});w[g][k]||(w[g][k]=[]);c={handler:c,wrappedHandler:e(g,c)};w[g][k].push(c);a.attachEvent("on"+k,c.wrappedHandler)},q=function(a,k,b){var c=d(a),e;if(w[c]&&w[c][k])for(var g=0,q=w[c][k].length;g<q;g++)(e=w[c][k][g])&&e.handler===b&&(a.detachEvent("on"+k,e.wrappedHandler),
w[c][k][g]=null)}):(k=function(a,k,b){var c=d(a);y[c]||(y[c]={});if(!y[c][k]){y[c][k]=[];var e=a["on"+k];e&&y[c][k].push(e);a["on"+k]=g(c,k)}y[c][k].push(b)},q=function(a,k,b){a=d(a);if(y[a]&&y[a][k]){k=y[a][k];a=0;for(var c=k.length;a<c;a++)k[a]===b&&k.splice(a,1)}});f.util.addListener=k;f.util.removeListener=q;var h=function(d){return"unknown"!==typeof d.clientX?d.clientX:0},m=function(d){return"unknown"!==typeof d.clientY?d.clientY:0};f.isTouchSupported&&(h=function(d){return c(d,"pageX","clientX")},
m=function(d){return c(d,"pageY","clientY")});f.util.getPointer=function(d,a){d||(d=f.window.event);var k=f.util.getScrollLeftTop(d.target||("unknown"!==typeof d.srcElement?d.srcElement:null),a);return{x:h(d)+k.left,y:m(d)+k.top}};f.util.object.extend(f.util,f.Observable)})();(function(){var l=f.document.createElement("div"),e="string"===typeof l.style.filter,g=/alpha\s*\(\s*opacity\s*=\s*([^\)]+)\)/,c=function(a){return a};"string"===typeof l.style.opacity?c=function(a,b){a.style.opacity=b;return a}:
e&&(c=function(a,b){var d=a.style;a.currentStyle&&!a.currentStyle.hasLayout&&(d.zoom=1);g.test(d.filter)?d.filter=d.filter.replace(g,.9999<=b?"":"alpha(opacity="+100*b+")"):d.filter+=" alpha(opacity="+100*b+")";return a});f.util.setStyle=function(a,b){var d=a.style;if(!d)return a;if("string"===typeof b)return a.style.cssText+=";"+b,-1<b.indexOf("opacity")?c(a,b.match(/opacity:\s*(\d?\.?\d*)/)[1]):a;for(var k in b)"opacity"===k?c(a,b[k]):d["float"===k||"cssFloat"===k?"undefined"===typeof d.styleFloat?
"cssFloat":"styleFloat":k]=b[k];return a}})();(function(){function l(a,d){var k=f.document.createElement(a),c;for(c in d)"class"===c?k.className=d[c]:"for"===c?k.htmlFor=d[c]:k.setAttribute(c,d[c]);return k}var e=Array.prototype.slice,g,c=function(a){return e.call(a,0)};try{g=c(f.document.childNodes)instanceof Array}catch(b){}g||(c=function(a){for(var d=Array(a.length),k=a.length;k--;)d[k]=a[k];return d});var a;a=f.document.defaultView&&f.document.defaultView.getComputedStyle?function(a,d){var k=
f.document.defaultView.getComputedStyle(a,null);return k?k[d]:void 0}:function(a,d){var k=a.style[d];!k&&a.currentStyle&&(k=a.currentStyle[d]);return k};(function(){var a=f.document.documentElement.style,d="userSelect"in a?"userSelect":"MozUserSelect"in a?"MozUserSelect":"WebkitUserSelect"in a?"WebkitUserSelect":"KhtmlUserSelect"in a?"KhtmlUserSelect":"";f.util.makeElementUnselectable=function(a){"undefined"!==typeof a.onselectstart&&(a.onselectstart=f.util.falseFunction);d?a.style[d]="none":"string"===
typeof a.unselectable&&(a.unselectable="on");return a};f.util.makeElementSelectable=function(a){"undefined"!==typeof a.onselectstart&&(a.onselectstart=null);d?a.style[d]="":"string"===typeof a.unselectable&&(a.unselectable="");return a}})();(function(){f.util.getScript=function(a,d){var k=f.document.getElementsByTagName("head")[0],c=f.document.createElement("script"),e=!0;c.onload=c.onreadystatechange=function(a){!e||"string"===typeof this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState||
(e=!1,d(a||f.window.event),c=c.onload=c.onreadystatechange=null)};c.src=a;k.appendChild(c)}})();f.util.getById=function(a){return"string"===typeof a?f.document.getElementById(a):a};f.util.toArray=c;f.util.makeElement=l;f.util.addClass=function(a,d){a&&-1===(" "+a.className+" ").indexOf(" "+d+" ")&&(a.className+=(a.className?" ":"")+d)};f.util.wrapElement=function(a,d,k){"string"===typeof d&&(d=l(d,k));a.parentNode&&a.parentNode.replaceChild(d,a);d.appendChild(a);return d};f.util.getScrollLeftTop=
function(a,d){var k,c,e=0,g=0,l=f.document.documentElement,h=f.document.body||{scrollLeft:0,scrollTop:0};for(c=a;a&&a.parentNode&&!k;)a=a.parentNode,1===a.nodeType&&"fixed"===f.util.getElementStyle(a,"position")&&(k=a),1===a.nodeType&&c!==d&&"absolute"===f.util.getElementStyle(a,"position")?g=e=0:a===f.document?(e=h.scrollLeft||l.scrollLeft||0,g=h.scrollTop||l.scrollTop||0):(e+=a.scrollLeft||0,g+=a.scrollTop||0);return{left:e,top:g}};f.util.getElementOffset=function(b){var d;d=b&&b.ownerDocument;
var k={left:0,top:0},c={left:0,top:0},e={borderLeftWidth:"left",borderTopWidth:"top",paddingLeft:"left",paddingTop:"top"};if(!d)return{left:0,top:0};for(var g in e)c[e[g]]+=parseInt(a(b,g),10)||0;d=d.documentElement;"undefined"!==typeof b.getBoundingClientRect&&(k=b.getBoundingClientRect());b=f.util.getScrollLeftTop(b,null);return{left:k.left+b.left-(d.clientLeft||0)+c.left,top:k.top+b.top-(d.clientTop||0)+c.top}};f.util.getElementStyle=a})();(function(){function l(c,a){return c+(/\?/.test(c)?"&":
"?")+a}function e(){}var g=function(){for(var c=[function(){return new ActiveXObject("Microsoft.XMLHTTP")},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml2.XMLHTTP.3.0")},function(){return new XMLHttpRequest}],a=c.length;a--;)try{if(c[a]())return c[a]}catch(b){}}();f.util.request=function(c,a){a||(a={});var b=a.method?a.method.toUpperCase():"GET",d=a.onComplete||function(){},k=g(),q;k.onreadystatechange=function(){4===k.readyState&&(d(k),k.onreadystatechange=
e)};"GET"===b&&(q=null,"string"===typeof a.parameters&&(c=l(c,a.parameters)));k.open(b,c,!0);"POST"!==b&&"PUT"!==b||k.setRequestHeader("Content-Type","application/x-www-form-urlencoded");k.send(q);return k}})();f.log=function(){};f.warn=function(){};"undefined"!==typeof console&&["log","warn"].forEach(function(l){"undefined"!==typeof console[l]&&"function"===typeof console[l].apply&&(f[l]=function(){return console[l].apply(console,arguments)})});(function(f){function e(e,c){this.x=e;this.y=c}f=f.fabric||
(f.fabric={});f.Point?f.warn("fabric.Point is already defined"):(f.Point=e,e.prototype={constructor:e,add:function(g){return new e(this.x+g.x,this.y+g.y)},addEquals:function(e){this.x+=e.x;this.y+=e.y;return this},scalarAdd:function(g){return new e(this.x+g,this.y+g)},scalarAddEquals:function(e){this.x+=e;this.y+=e;return this},subtract:function(g){return new e(this.x-g.x,this.y-g.y)},subtractEquals:function(e){this.x-=e.x;this.y-=e.y;return this},scalarSubtract:function(g){return new e(this.x-g,
this.y-g)},scalarSubtractEquals:function(e){this.x-=e;this.y-=e;return this},multiply:function(g){return new e(this.x*g,this.y*g)},multiplyEquals:function(e){this.x*=e;this.y*=e;return this},divide:function(g){return new e(this.x/g,this.y/g)},divideEquals:function(e){this.x/=e;this.y/=e;return this},eq:function(e){return this.x===e.x&&this.y===e.y},lt:function(e){return this.x<e.x&&this.y<e.y},lte:function(e){return this.x<=e.x&&this.y<=e.y},gt:function(e){return this.x>e.x&&this.y>e.y},gte:function(e){return this.x>=
e.x&&this.y>=e.y},lerp:function(g,c){return new e(this.x+(g.x-this.x)*c,this.y+(g.y-this.y)*c)},distanceFrom:function(e){var c=this.x-e.x;e=this.y-e.y;return Math.sqrt(c*c+e*e)},midPointFrom:function(g){return new e(this.x+(g.x-this.x)/2,this.y+(g.y-this.y)/2)},min:function(g){return new e(Math.min(this.x,g.x),Math.min(this.y,g.y))},max:function(g){return new e(Math.max(this.x,g.x),Math.max(this.y,g.y))},toString:function(){return this.x+","+this.y},setXY:function(e,c){this.x=e;this.y=c},setFromPoint:function(e){this.x=
e.x;this.y=e.y},swap:function(e){var c=this.x,a=this.y;this.x=e.x;this.y=e.y;e.x=c;e.y=a}})})("undefined"!==typeof h?h:this);(function(f){function e(c){this.status=c;this.points=[]}var g=f.fabric||(f.fabric={});g.Intersection?g.warn("fabric.Intersection is already defined"):(g.Intersection=e,g.Intersection.prototype={appendPoint:function(c){this.points.push(c)},appendPoints:function(c){this.points=this.points.concat(c)}},g.Intersection.intersectLineLine=function(c,a,b,d){var k,q=(d.x-b.x)*(c.y-b.y)-
(d.y-b.y)*(c.x-b.x);k=(a.x-c.x)*(c.y-b.y)-(a.y-c.y)*(c.x-b.x);b=(d.y-b.y)*(a.x-c.x)-(d.x-b.x)*(a.y-c.y);0!==b?(q/=b,k/=b,0<=q&&1>=q&&0<=k&&1>=k?(k=new e("Intersection"),k.points.push(new g.Point(c.x+q*(a.x-c.x),c.y+q*(a.y-c.y)))):k=new e):k=0===q||0===k?new e("Coincident"):new e("Parallel");return k},g.Intersection.intersectLinePolygon=function(c,a,b){for(var d=new e,k=b.length,g=0;g<k;g++){var f=e.intersectLineLine(c,a,b[g],b[(g+1)%k]);d.appendPoints(f.points)}0<d.points.length&&(d.status="Intersection");
return d},g.Intersection.intersectPolygonPolygon=function(c,a){for(var b=new e,d=c.length,k=0;k<d;k++){var g=e.intersectLinePolygon(c[k],c[(k+1)%d],a);b.appendPoints(g.points)}0<b.points.length&&(b.status="Intersection");return b},g.Intersection.intersectPolygonRectangle=function(c,a,b){var d=a.min(b),k=a.max(b);b=new g.Point(k.x,d.y);var f=new g.Point(d.x,k.y);a=e.intersectLinePolygon(d,b,c);b=e.intersectLinePolygon(b,k,c);k=e.intersectLinePolygon(k,f,c);c=e.intersectLinePolygon(f,d,c);d=new e;d.appendPoints(a.points);
d.appendPoints(b.points);d.appendPoints(k.points);d.appendPoints(c.points);0<d.points.length&&(d.status="Intersection");return d})})("undefined"!==typeof h?h:this);(function(f){function e(a){a?this._tryParsingColor(a):this.setSource([0,0,0,1])}function g(a,b,d){0>d&&(d+=1);1<d&&--d;return d<1/6?a+6*(b-a)*d:.5>d?b:d<2/3?a+(b-a)*(2/3-d)*6:a}var c=f.fabric||(f.fabric={});c.Color?c.warn("fabric.Color is already defined."):(c.Color=e,c.Color.prototype={_tryParsingColor:function(a){var b;a in e.colorNameMap&&
(a=e.colorNameMap[a]);"transparent"===a?this.setSource([255,255,255,0]):((b=e.sourceFromHex(a))||(b=e.sourceFromRgb(a)),b||(b=e.sourceFromHsl(a)),b&&this.setSource(b))},_rgbToHsl:function(a,b,d){a/=255;b/=255;d/=255;var k,e,g,f=c.util.array.max([a,b,d]);e=c.util.array.min([a,b,d]);g=(f+e)/2;if(f===e)k=e=0;else{var l=f-e;e=.5<g?l/(2-f-e):l/(f+e);switch(f){case a:k=(b-d)/l+(b<d?6:0);break;case b:k=(d-a)/l+2;break;case d:k=(a-b)/l+4}k/=6}return[Math.round(360*k),Math.round(100*e),Math.round(100*g)]},
getSource:function(){return this._source},setSource:function(a){this._source=a},toRgb:function(){var a=this.getSource();return"rgb("+a[0]+","+a[1]+","+a[2]+")"},toRgba:function(){var a=this.getSource();return"rgba("+a[0]+","+a[1]+","+a[2]+","+a[3]+")"},toHsl:function(){var a=this.getSource(),a=this._rgbToHsl(a[0],a[1],a[2]);return"hsl("+a[0]+","+a[1]+"%,"+a[2]+"%)"},toHsla:function(){var a=this.getSource(),b=this._rgbToHsl(a[0],a[1],a[2]);return"hsla("+b[0]+","+b[1]+"%,"+b[2]+"%,"+a[3]+")"},toHex:function(){var a=
this.getSource(),b,d;b=a[0].toString(16);b=1===b.length?"0"+b:b;d=a[1].toString(16);d=1===d.length?"0"+d:d;a=a[2].toString(16);a=1===a.length?"0"+a:a;return b.toUpperCase()+d.toUpperCase()+a.toUpperCase()},getAlpha:function(){return this.getSource()[3]},setAlpha:function(a){var b=this.getSource();b[3]=a;this.setSource(b);return this},toGrayscale:function(){var a=this.getSource(),b=parseInt((.3*a[0]+.59*a[1]+.11*a[2]).toFixed(0),10);this.setSource([b,b,b,a[3]]);return this},toBlackWhite:function(a){var b=
this.getSource(),d=(.3*b[0]+.59*b[1]+.11*b[2]).toFixed(0),b=b[3],d=Number(d)<Number(a||127)?0:255;this.setSource([d,d,d,b]);return this},overlayWith:function(a){a instanceof e||(a=new e(a));var b=[],d=this.getAlpha(),k=this.getSource();a=a.getSource();for(var c=0;3>c;c++)b.push(Math.round(.5*k[c]+.5*a[c]));b[3]=d;this.setSource(b);return this}},c.Color.reRGBa=/^rgba?\(\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/,c.Color.reHSLa=
/^hsla?\(\s*(\d{1,3})\s*,\s*(\d{1,3}\%)\s*,\s*(\d{1,3}\%)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/,c.Color.reHex=/^#?([0-9a-f]{6}|[0-9a-f]{3})$/i,c.Color.colorNameMap={aqua:"#00FFFF",black:"#000000",blue:"#0000FF",fuchsia:"#FF00FF",gray:"#808080",green:"#008000",lime:"#00FF00",maroon:"#800000",navy:"#000080",olive:"#808000",orange:"#FFA500",purple:"#800080",red:"#FF0000",silver:"#C0C0C0",teal:"#008080",white:"#FFFFFF",yellow:"#FFFF00"},c.Color.fromRgb=function(a){return e.fromSource(e.sourceFromRgb(a))},
c.Color.sourceFromRgb=function(a){if(a=a.match(e.reRGBa)){var b=parseInt(a[1],10)/(/%$/.test(a[1])?100:1)*(/%$/.test(a[1])?255:1),d=parseInt(a[2],10)/(/%$/.test(a[2])?100:1)*(/%$/.test(a[2])?255:1),k=parseInt(a[3],10)/(/%$/.test(a[3])?100:1)*(/%$/.test(a[3])?255:1);return[parseInt(b,10),parseInt(d,10),parseInt(k,10),a[4]?parseFloat(a[4]):1]}},c.Color.fromRgba=e.fromRgb,c.Color.fromHsl=function(a){return e.fromSource(e.sourceFromHsl(a))},c.Color.sourceFromHsl=function(a){if(a=a.match(e.reHSLa)){var b=
(parseFloat(a[1])%360+360)%360/360,d=parseFloat(a[2])/(/%$/.test(a[2])?100:1),k=parseFloat(a[3])/(/%$/.test(a[3])?100:1);if(0===d)k=d=b=k;else var c=.5>=k?k*(d+1):k+d-k*d,f=2*k-c,k=g(f,c,b+1/3),d=g(f,c,b),b=g(f,c,b-1/3);return[Math.round(255*k),Math.round(255*d),Math.round(255*b),a[4]?parseFloat(a[4]):1]}},c.Color.fromHsla=e.fromHsl,c.Color.fromHex=function(a){return e.fromSource(e.sourceFromHex(a))},c.Color.sourceFromHex=function(a){if(a.match(e.reHex)){var b=a.slice(a.indexOf("#")+1),d=3===b.length;
a=d?b.charAt(0)+b.charAt(0):b.substring(0,2);var k=d?b.charAt(1)+b.charAt(1):b.substring(2,4),b=d?b.charAt(2)+b.charAt(2):b.substring(4,6);return[parseInt(a,16),parseInt(k,16),parseInt(b,16),1]}},c.Color.fromSource=function(a){var b=new e;b.setSource(a);return b})})("undefined"!==typeof h?h:this);(function(){if(f.StaticCanvas)f.warn("fabric.StaticCanvas is already defined.");else{var l=f.util.object.extend,e=f.util.getElementOffset,g=f.util.removeFromArray,c=Error("Could not initialize `canvas` element");
f.StaticCanvas=f.util.createClass({initialize:function(a,b){b||(b={});this._initStatic(a,b);f.StaticCanvas.activeInstance=this},backgroundColor:"",backgroundImage:null,overlayColor:"",overlayImage:null,includeDefaultValues:!0,stateful:!0,renderOnAddRemove:!0,clipTo:null,controlsAboveOverlay:!1,allowTouchScrolling:!1,imageSmoothingEnabled:!0,preserveObjectStacking:!1,viewportTransform:[1,0,0,1,0,0],onBeforeScaleRotate:function(){},_initStatic:function(a,b){this._objects=[];this._createLowerCanvas(a);
this._initOptions(b);this._setImageSmoothing();b.overlayImage&&this.setOverlayImage(b.overlayImage,this.renderAll.bind(this));b.backgroundImage&&this.setBackgroundImage(b.backgroundImage,this.renderAll.bind(this));b.backgroundColor&&this.setBackgroundColor(b.backgroundColor,this.renderAll.bind(this));b.overlayColor&&this.setOverlayColor(b.overlayColor,this.renderAll.bind(this));this.calcOffset()},calcOffset:function(){this._offset=e(this.lowerCanvasEl);return this},setOverlayImage:function(a,b,d){return this.__setBgOverlayImage("overlayImage",
a,b,d)},setBackgroundImage:function(a,b,d){return this.__setBgOverlayImage("backgroundImage",a,b,d)},setOverlayColor:function(a,b){return this.__setBgOverlayColor("overlayColor",a,b)},setBackgroundColor:function(a,b){return this.__setBgOverlayColor("backgroundColor",a,b)},_setImageSmoothing:function(){var a=this.getContext();a.imageSmoothingEnabled=this.imageSmoothingEnabled;a.webkitImageSmoothingEnabled=this.imageSmoothingEnabled;a.mozImageSmoothingEnabled=this.imageSmoothingEnabled;a.msImageSmoothingEnabled=
this.imageSmoothingEnabled;a.oImageSmoothingEnabled=this.imageSmoothingEnabled},__setBgOverlayImage:function(a,b,d,k){"string"===typeof b?f.util.loadImage(b,function(b){this[a]=new f.Image(b,k);d&&d()},this,k&&k.crossOrigin):(k&&b.setOptions(k),this[a]=b,d&&d());return this},__setBgOverlayColor:function(a,b,d){if(b&&b.source){var k=this;f.util.loadImage(b.source,function(c){k[a]=new f.Pattern({source:c,repeat:b.repeat,offsetX:b.offsetX,offsetY:b.offsetY});d&&d()})}else this[a]=b,d&&d();return this},
_createCanvasElement:function(){var a=f.document.createElement("canvas");a.style||(a.style={});if(!a)throw c;this._initCanvasElement(a);return a},_initCanvasElement:function(a){f.util.createCanvasElement(a);if("undefined"===typeof a.getContext)throw c;},_initOptions:function(a){for(var b in a)this[b]=a[b];this.width=this.width||parseInt(this.lowerCanvasEl.width,10)||0;this.height=this.height||parseInt(this.lowerCanvasEl.height,10)||0;this.lowerCanvasEl.style&&(this.lowerCanvasEl.width=this.width,
this.lowerCanvasEl.height=this.height,this.lowerCanvasEl.style.width=this.width+"px",this.lowerCanvasEl.style.height=this.height+"px",this.viewportTransform=this.viewportTransform.slice())},_createLowerCanvas:function(a){this.lowerCanvasEl=f.util.getById(a)||this._createCanvasElement();this._initCanvasElement(this.lowerCanvasEl);f.util.addClass(this.lowerCanvasEl,"lower-canvas");this.interactive&&this._applyCanvasStyle(this.lowerCanvasEl);this.contextContainer=this.lowerCanvasEl.getContext("2d")},
getWidth:function(){return this.width},getHeight:function(){return this.height},setWidth:function(a,b){return this.setDimensions({width:a},b)},setHeight:function(a,b){return this.setDimensions({height:a},b)},setDimensions:function(a,b){var d;b=b||{};for(var k in a)d=a[k],b.cssOnly||(this._setBackstoreDimension(k,a[k]),d+="px"),b.backstoreOnly||this._setCssDimension(k,d);b.cssOnly||this.renderAll();this.calcOffset();return this},_setBackstoreDimension:function(a,b){this.lowerCanvasEl[a]=b;this.upperCanvasEl&&
(this.upperCanvasEl[a]=b);this.cacheCanvasEl&&(this.cacheCanvasEl[a]=b);this[a]=b;return this},_setCssDimension:function(a,b){this.lowerCanvasEl.style[a]=b;this.upperCanvasEl&&(this.upperCanvasEl.style[a]=b);this.wrapperEl&&(this.wrapperEl.style[a]=b);return this},getZoom:function(){return Math.sqrt(this.viewportTransform[0]*this.viewportTransform[3])},setViewportTransform:function(a){var b=this.getActiveGroup();this.viewportTransform=a;this.renderAll();a=0;for(var d=this._objects.length;a<d;a++)this._objects[a].setCoords();
b&&b.setCoords();return this},zoomToPoint:function(a,b){var d=a;a=f.util.transformPoint(a,f.util.invertTransform(this.viewportTransform));this.viewportTransform[0]=b;this.viewportTransform[3]=b;var k=f.util.transformPoint(a,this.viewportTransform);this.viewportTransform[4]+=d.x-k.x;this.viewportTransform[5]+=d.y-k.y;this.renderAll();d=0;for(k=this._objects.length;d<k;d++)this._objects[d].setCoords();return this},setZoom:function(a){this.zoomToPoint(new f.Point(0,0),a);return this},absolutePan:function(a){this.viewportTransform[4]=
-a.x;this.viewportTransform[5]=-a.y;this.renderAll();a=0;for(var b=this._objects.length;a<b;a++)this._objects[a].setCoords();return this},relativePan:function(a){return this.absolutePan(new f.Point(-a.x-this.viewportTransform[4],-a.y-this.viewportTransform[5]))},getElement:function(){return this.lowerCanvasEl},getActiveObject:function(){return null},getActiveGroup:function(){return null},_draw:function(a,b){if(b){a.save();var d=this.viewportTransform;a.transform(d[0],d[1],d[2],d[3],d[4],d[5]);this._shouldRenderObject(b)&&
b.render(a);a.restore();this.controlsAboveOverlay||b._renderControls(a)}},_shouldRenderObject:function(a){return a?a!==this.getActiveGroup()||!this.preserveObjectStacking:!1},_onObjectAdded:function(a){this.stateful&&a.setupState();a.canvas=this;a.setCoords();this.fire("object:added",{target:a});a.fire("added")},_onObjectRemoved:function(a){this.getActiveObject()===a&&(this.fire("before:selection:cleared",{target:a}),this._discardActiveObject(),this.fire("selection:cleared"));this.fire("object:removed",
{target:a});a.fire("removed")},clearContext:function(a){a.clearRect(0,0,this.width,this.height);return this},getContext:function(){return this.contextContainer},clear:function(){this._objects.length=0;this.discardActiveGroup&&this.discardActiveGroup();this.discardActiveObject&&this.discardActiveObject();this.clearContext(this.contextContainer);this.contextTop&&this.clearContext(this.contextTop);this.fire("canvas:cleared");this.renderAll();return this},renderAll:function(a){var b=this[!0===a&&this.interactive?
"contextTop":"contextContainer"],d=this.getActiveGroup();this.contextTop&&this.selection&&!this._groupSelector&&this.clearContext(this.contextTop);a||this.clearContext(b);this.fire("before:render");this.clipTo&&f.util.clipContext(this,b);this._renderBackground(b);this._renderObjects(b,d);this._renderActiveGroup(b,d);this.clipTo&&b.restore();this._renderOverlay(b);this.controlsAboveOverlay&&this.interactive&&this.drawControls(b);this.fire("after:render");return this},_renderObjects:function(a,b){var d,
k;if(!b||this.preserveObjectStacking)for(d=0,k=this._objects.length;d<k;++d)this._draw(a,this._objects[d]);else for(d=0,k=this._objects.length;d<k;++d)this._objects[d]&&!b.contains(this._objects[d])&&this._draw(a,this._objects[d])},_renderActiveGroup:function(a,b){if(b){var d=[];this.forEachObject(function(a){b.contains(a)&&d.push(a)});b._set("objects",d);this._draw(a,b)}},_renderBackground:function(a){this.backgroundColor&&(a.fillStyle=this.backgroundColor.toLive?this.backgroundColor.toLive(a):this.backgroundColor,
a.fillRect(this.backgroundColor.offsetX||0,this.backgroundColor.offsetY||0,this.width,this.height));this.backgroundImage&&this._draw(a,this.backgroundImage)},_renderOverlay:function(a){this.overlayColor&&(a.fillStyle=this.overlayColor.toLive?this.overlayColor.toLive(a):this.overlayColor,a.fillRect(this.overlayColor.offsetX||0,this.overlayColor.offsetY||0,this.width,this.height));this.overlayImage&&this._draw(a,this.overlayImage)},renderTop:function(){var a=this.contextTop||this.contextContainer;this.clearContext(a);
this.selection&&this._groupSelector&&this._drawSelection();var b=this.getActiveGroup();b&&b.render(a);this._renderOverlay(a);this.fire("after:render");return this},getCenter:function(){return{top:this.getHeight()/2,left:this.getWidth()/2}},centerObjectH:function(a){this._centerObject(a,new f.Point(this.getCenter().left,a.getCenterPoint().y));this.renderAll();return this},centerObjectV:function(a){this._centerObject(a,new f.Point(a.getCenterPoint().x,this.getCenter().top));this.renderAll();return this},
centerObject:function(a){var b=this.getCenter();this._centerObject(a,new f.Point(b.left,b.top));this.renderAll();return this},_centerObject:function(a,b){a.setPositionByOrigin(b,"center","center");return this},toDatalessJSON:function(a){return this.toDatalessObject(a)},toObject:function(a){return this._toObjectMethod("toObject",a)},toDatalessObject:function(a){return this._toObjectMethod("toDatalessObject",a)},_toObjectMethod:function(a,b){var d={objects:this._toObjects(a,b)};l(d,this.__serializeBgOverlay());
f.util.populateWithProperties(this,d,b);return d},_toObjects:function(a,b){return this.getObjects().map(function(d){return this._toObject(d,a,b)},this)},_toObject:function(a,b,d){var k;this.includeDefaultValues||(k=a.includeDefaultValues,a.includeDefaultValues=!1);var c=this._realizeGroupTransformOnObject(a);b=a[b](d);this.includeDefaultValues||(a.includeDefaultValues=k);this._unwindGroupTransformOnObject(a,c);return b},_realizeGroupTransformOnObject:function(a){var b="angle flipX flipY height left scaleX scaleY top width".split(" ");
if(a.group&&a.group===this.getActiveGroup()){var d={};b.forEach(function(k){d[k]=a[k]});this.getActiveGroup().realizeTransform(a);return d}return null},_unwindGroupTransformOnObject:function(a,b){b&&a.set(b)},__serializeBgOverlay:function(){var a={background:this.backgroundColor&&this.backgroundColor.toObject?this.backgroundColor.toObject():this.backgroundColor};this.overlayColor&&(a.overlay=this.overlayColor.toObject?this.overlayColor.toObject():this.overlayColor);this.backgroundImage&&(a.backgroundImage=
this.backgroundImage.toObject());this.overlayImage&&(a.overlayImage=this.overlayImage.toObject());return a},svgViewportTransformation:!0,toSVG:function(a,b){a||(a={});var d=[];this._setSVGPreamble(d,a);this._setSVGHeader(d,a);this._setSVGBgOverlayColor(d,"backgroundColor");this._setSVGBgOverlayImage(d,"backgroundImage");this._setSVGObjects(d,b);this._setSVGBgOverlayColor(d,"overlayColor");this._setSVGBgOverlayImage(d,"overlayImage");d.push("</svg>");return d.join("")},_setSVGPreamble:function(a,b){b.suppressPreamble||
a.push('<?xml version="1.0" encoding="',b.encoding||"UTF-8",'" standalone="no" ?>','<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ','"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\n')},_setSVGHeader:function(a,b){var d,k,c;b.viewBox?(d=b.viewBox.width,k=b.viewBox.height):(d=this.width,k=this.height,this.svgViewportTransformation||(c=this.viewportTransform,d/=c[0],k/=c[3]));a.push("<svg ",'xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',
d,'" ','height="',k,'" ',this.backgroundColor&&!this.backgroundColor.toLive?'style="background-color: '+this.backgroundColor+'" ':null,b.viewBox?'viewBox="'+b.viewBox.x+" "+b.viewBox.y+" "+b.viewBox.width+" "+b.viewBox.height+'" ':null,'xml:space="preserve">',"<desc>Created with Fabric.js ",f.version,"</desc>","<defs>",f.createSVGFontFacesMarkup(this.getObjects()),f.createSVGRefElementsMarkup(this),"</defs>")},_setSVGObjects:function(a,b){for(var d=0,k=this.getObjects(),c=k.length;d<c;d++){var e=
k[d],g=this._realizeGroupTransformOnObject(e);a.push(e.toSVG(b));this._unwindGroupTransformOnObject(e,g)}},_setSVGBgOverlayImage:function(a,b){this[b]&&this[b].toSVG&&a.push(this[b].toSVG())},_setSVGBgOverlayColor:function(a,b){this[b]&&this[b].source?a.push('<rect x="',this[b].offsetX,'" y="',this[b].offsetY,'" ','width="',"repeat-y"===this[b].repeat||"no-repeat"===this[b].repeat?this[b].source.width:this.width,'" height="',"repeat-x"===this[b].repeat||"no-repeat"===this[b].repeat?this[b].source.height:
this.height,'" fill="url(#'+b+'Pattern)"',"></rect>"):this[b]&&"overlayColor"===b&&a.push('<rect x="0" y="0" ','width="',this.width,'" height="',this.height,'" fill="',this[b],'"',"></rect>")},sendToBack:function(a){g(this._objects,a);this._objects.unshift(a);return this.renderAll&&this.renderAll()},bringToFront:function(a){g(this._objects,a);this._objects.push(a);return this.renderAll&&this.renderAll()},sendBackwards:function(a,b){var d=this._objects.indexOf(a);0!==d&&(d=this._findNewLowerIndex(a,
d,b),g(this._objects,a),this._objects.splice(d,0,a),this.renderAll&&this.renderAll());return this},_findNewLowerIndex:function(a,b,d){if(d)for(d=b,--b;0<=b;--b){if(a.intersectsWithObject(this._objects[b])||a.isContainedWithinObject(this._objects[b])||this._objects[b].isContainedWithinObject(a)){d=b;break}}else d=b-1;return d},bringForward:function(a,b){var d=this._objects.indexOf(a);d!==this._objects.length-1&&(d=this._findNewUpperIndex(a,d,b),g(this._objects,a),this._objects.splice(d,0,a),this.renderAll&&
this.renderAll());return this},_findNewUpperIndex:function(a,b,d){if(d)for(d=b,b+=1;b<this._objects.length;++b){if(a.intersectsWithObject(this._objects[b])||a.isContainedWithinObject(this._objects[b])||this._objects[b].isContainedWithinObject(a)){d=b;break}}else d=b+1;return d},moveTo:function(a,b){g(this._objects,a);this._objects.splice(b,0,a);return this.renderAll&&this.renderAll()},dispose:function(){this.clear();this.interactive&&this.removeListeners();return this},toString:function(){return"#<fabric.Canvas ("+
this.complexity()+"): { objects: "+this.getObjects().length+" }>"}});l(f.StaticCanvas.prototype,f.Observable);l(f.StaticCanvas.prototype,f.Collection);l(f.StaticCanvas.prototype,f.DataURLExporter);l(f.StaticCanvas,{EMPTY_JSON:'{"objects": [], "background": "white"}',supports:function(a){var b=f.util.createCanvasElement();if(!b||!b.getContext)return null;var d=b.getContext("2d");if(!d)return null;switch(a){case "getImageData":return"undefined"!==typeof d.getImageData;case "setLineDash":return"undefined"!==
typeof d.setLineDash;case "toDataURL":return"undefined"!==typeof b.toDataURL;case "toDataURLWithQuality":try{return b.toDataURL("image/jpeg",0),!0}catch(k){}return!1;default:return null}}});f.StaticCanvas.prototype.toJSON=f.StaticCanvas.prototype.toObject}})();(function(){var l=f.util.getPointer,e=f.util.degreesToRadians,g=f.util.radiansToDegrees,c=Math.atan2,a=Math.abs;f.Canvas=f.util.createClass(f.StaticCanvas,{initialize:function(d,a){a||(a={});this._initStatic(d,a);this._initInteractive();this._createCacheCanvas();
f.Canvas.activeInstance=this},uniScaleTransform:!1,centeredScaling:!1,centeredRotation:!1,interactive:!0,selection:!0,selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",rotationCursor:"crosshair",containerClass:"canvas-container",perPixelTargetFind:!1,targetFindTolerance:0,skipTargetFind:!1,_initInteractive:function(){this._groupSelector=
this._currentTransform=null;this._initWrapperElement();this._createUpperCanvas();this._initEventListeners();this.freeDrawingBrush=f.PencilBrush&&new f.PencilBrush(this);this.calcOffset()},_resetCurrentTransform:function(d){var a=this._currentTransform;a.target.set({scaleX:a.original.scaleX,scaleY:a.original.scaleY,left:a.original.left,top:a.original.top});this._shouldCenterTransform(d,a.target)?"rotate"===a.action?this._setOriginToCenter(a.target):("center"!==a.originX&&(a.mouseXSign="right"===a.originX?
-1:1),"center"!==a.originY&&(a.mouseYSign="bottom"===a.originY?-1:1),a.originX="center",a.originY="center"):(a.originX=a.original.originX,a.originY=a.original.originY)},containsPoint:function(d,a){var b=this.getPointer(d,!0),c=this._normalizePointer(a,b);return a.containsPoint(c)||a._findTargetCorner(b)},_normalizePointer:function(d,a){var b=this.getActiveGroup(),c=a.x,e=a.y;b&&"group"!==d.type&&b.contains(d)&&(b=new f.Point(b.left,b.top),b=f.util.transformPoint(b,this.viewportTransform,!0),c-=b.x,
e-=b.y);return{x:c,y:e}},isTargetTransparent:function(d,a,b){var c=d.hasBorders,e=d.transparentCorners;d.hasBorders=d.transparentCorners=!1;this._draw(this.contextCache,d);d.hasBorders=c;d.transparentCorners=e;d=f.util.isTransparent(this.contextCache,a,b,this.targetFindTolerance);this.clearContext(this.contextCache);return d},_shouldClearSelection:function(d,a){var b=this.getActiveGroup(),c=this.getActiveObject();return!a||a&&b&&!b.contains(a)&&b!==a&&!d.shiftKey||a&&!a.evented||a&&!a.selectable&&
c&&c!==a},_shouldCenterTransform:function(d,a){if(a){var b=this._currentTransform,c;"scale"===b.action||"scaleX"===b.action||"scaleY"===b.action?c=this.centeredScaling||a.centeredScaling:"rotate"===b.action&&(c=this.centeredRotation||a.centeredRotation);return c?!d.altKey:d.altKey}},_getOriginFromCorner:function(d,a){var b={x:d.originX,y:d.originY};if("ml"===a||"tl"===a||"bl"===a)b.x="right";else if("mr"===a||"tr"===a||"br"===a)b.x="left";if("tl"===a||"mt"===a||"tr"===a)b.y="bottom";else if("bl"===
a||"mb"===a||"br"===a)b.y="top";return b},_getActionFromCorner:function(d,a){var b="drag";a&&(b="ml"===a||"mr"===a?"scaleX":"mt"===a||"mb"===a?"scaleY":"mtr"===a?"rotate":"scale");return b},_setupCurrentTransform:function(d,a){if(a){var b=this.getPointer(d),c=a._findTargetCorner(this.getPointer(d,!0)),g=this._getActionFromCorner(a,c),c=this._getOriginFromCorner(a,c);this._currentTransform={target:a,action:g,scaleX:a.scaleX,scaleY:a.scaleY,offsetX:b.x-a.left,offsetY:b.y-a.top,originX:c.x,originY:c.y,
ex:b.x,ey:b.y,left:a.left,top:a.top,theta:e(a.angle),width:a.width*a.scaleX,mouseXSign:1,mouseYSign:1};this._currentTransform.original={left:a.left,top:a.top,scaleX:a.scaleX,scaleY:a.scaleY,originX:c.x,originY:c.y};this._resetCurrentTransform(d)}},_translateObject:function(d,a){var b=this._currentTransform.target;b.get("lockMovementX")||b.set("left",d-this._currentTransform.offsetX);b.get("lockMovementY")||b.set("top",a-this._currentTransform.offsetY)},_scaleObject:function(d,a,b){var c=this._currentTransform,
e=c.target,g=e.get("lockScalingX"),l=e.get("lockScalingY"),h=e.get("lockScalingFlip");if(!g||!l){var m=e.translateToOriginPoint(e.getCenterPoint(),c.originX,c.originY);d=e.toLocalPoint(new f.Point(d,a),c.originX,c.originY);this._setLocalMouse(d,c);this._setObjectScale(d,c,g,l,b,h);e.setPositionByOrigin(m,c.originX,c.originY)}},_setObjectScale:function(d,a,b,c,e,g){var f=a.target,l=!1,h=!1,m=f.stroke?f.strokeWidth:0;a.newScaleX=d.x/(f.width+m/2);a.newScaleY=d.y/(f.height+m/2);g&&0>=a.newScaleX&&a.newScaleX<
f.scaleX&&(l=!0);g&&0>=a.newScaleY&&a.newScaleY<f.scaleY&&(h=!0);"equally"!==e||b||c?e?"x"!==e||f.get("lockUniScaling")?"y"!==e||f.get("lockUniScaling")||h||c||f.set("scaleY",a.newScaleY):l||b||f.set("scaleX",a.newScaleX):(l||b||f.set("scaleX",a.newScaleX),h||c||f.set("scaleY",a.newScaleY)):l||h||this._scaleObjectEqually(d,f,a);l||h||this._flipObject(a,e)},_scaleObjectEqually:function(d,a,b){d=d.y+d.x;var c=a.stroke?a.strokeWidth:0,c=(a.height+c/2)*b.original.scaleY+(a.width+c/2)*b.original.scaleX;
b.newScaleX=b.original.scaleX*d/c;b.newScaleY=b.original.scaleY*d/c;a.set("scaleX",b.newScaleX);a.set("scaleY",b.newScaleY)},_flipObject:function(d,a){0>d.newScaleX&&"y"!==a&&("left"===d.originX?d.originX="right":"right"===d.originX&&(d.originX="left"));0>d.newScaleY&&"x"!==a&&("top"===d.originY?d.originY="bottom":"bottom"===d.originY&&(d.originY="top"))},_setLocalMouse:function(d,b){var c=b.target;"right"===b.originX?d.x*=-1:"center"===b.originX&&(d.x=2*d.x*b.mouseXSign,0>d.x&&(b.mouseXSign=-b.mouseXSign));
"bottom"===b.originY?d.y*=-1:"center"===b.originY&&(d.y=2*d.y*b.mouseYSign,0>d.y&&(b.mouseYSign=-b.mouseYSign));a(d.x)>c.padding?d.x=0>d.x?d.x+c.padding:d.x-c.padding:d.x=0;a(d.y)>c.padding?d.y=0>d.y?d.y+c.padding:d.y-c.padding:d.y=0},_rotateObject:function(d,a){var b=this._currentTransform;if(!b.target.get("lockRotation")){var e=c(b.ey-b.top,b.ex-b.left),f=c(a-b.top,d-b.left),e=g(f-e+b.theta);0>e&&(e=360+e);b.target.angle=e%360}},setCursor:function(d){this.upperCanvasEl.style.cursor=d},_resetObjectTransform:function(d){d.scaleX=
1;d.scaleY=1;d.setAngle(0)},_drawSelection:function(){var d=this.contextTop,b=this._groupSelector,c=b.left,e=b.top,g=a(c),l=a(e);d.fillStyle=this.selectionColor;d.fillRect(b.ex-(0<c?0:-c),b.ey-(0<e?0:-e),g,l);d.lineWidth=this.selectionLineWidth;d.strokeStyle=this.selectionBorderColor;1<this.selectionDashArray.length?(c=b.ex+.5-(0<c?0:g),b=b.ey+.5-(0<e?0:l),d.beginPath(),f.util.drawDashedLine(d,c,b,c+g,b,this.selectionDashArray),f.util.drawDashedLine(d,c,b+l-1,c+g,b+l-1,this.selectionDashArray),f.util.drawDashedLine(d,
c,b,c,b+l,this.selectionDashArray),f.util.drawDashedLine(d,c+g-1,b,c+g-1,b+l,this.selectionDashArray),d.closePath(),d.stroke()):d.strokeRect(b.ex+.5-(0<c?0:g),b.ey+.5-(0<e?0:l),g,l)},_isLastRenderedObject:function(d){return this.controlsAboveOverlay&&this.lastRenderedObjectWithControlsAboveOverlay&&this.lastRenderedObjectWithControlsAboveOverlay.visible&&this.containsPoint(d,this.lastRenderedObjectWithControlsAboveOverlay)&&this.lastRenderedObjectWithControlsAboveOverlay._findTargetCorner(this.getPointer(d,
!0))},findTarget:function(d,a){if(!this.skipTargetFind){if(this._isLastRenderedObject(d))return this.lastRenderedObjectWithControlsAboveOverlay;var b=this.getActiveGroup();if(b&&!a&&this.containsPoint(d,b))return b;b=this._searchPossibleTargets(d);this._fireOverOutEvents(b);return b}},_fireOverOutEvents:function(d){d?this._hoveredTarget!==d&&(this.fire("mouse:over",{target:d}),d.fire("mouseover"),this._hoveredTarget&&(this.fire("mouse:out",{target:this._hoveredTarget}),this._hoveredTarget.fire("mouseout")),
this._hoveredTarget=d):this._hoveredTarget&&(this.fire("mouse:out",{target:this._hoveredTarget}),this._hoveredTarget.fire("mouseout"),this._hoveredTarget=null)},_checkTarget:function(d,a,b){if(a&&a.visible&&a.evented&&this.containsPoint(d,a)&&(!this.perPixelTargetFind&&!a.perPixelTargetFind||a.isEditing||!this.isTargetTransparent(a,b.x,b.y)))return!0},_searchPossibleTargets:function(d){for(var a,b=this.getPointer(d,!0),c=this._objects.length;c--;)if(!this._objects[c].group&&this._checkTarget(d,this._objects[c],
b)){this.relatedTarget=this._objects[c];a=this._objects[c];break}return a},getPointer:function(d,a,b){b||(b=this.upperCanvasEl);d=l(d,b);var c=b.getBoundingClientRect(),e=c.width||0,g=c.height||0;e&&g||("top"in c&&"bottom"in c&&(g=Math.abs(c.top-c.bottom)),"right"in c&&"left"in c&&(e=Math.abs(c.right-c.left)));this.calcOffset();d.x-=this._offset.left;d.y-=this._offset.top;a||(d=f.util.transformPoint(d,f.util.invertTransform(this.viewportTransform)));0===e||0===g?b=a=1:(a=b.width/e,b=b.height/g);return{x:d.x*
a,y:d.y*b}},_createUpperCanvas:function(){var d=this.lowerCanvasEl.className.replace(/\s*lower-canvas\s*/,"");this.upperCanvasEl=this._createCanvasElement();f.util.addClass(this.upperCanvasEl,"upper-canvas "+d);this.wrapperEl.appendChild(this.upperCanvasEl);this._copyCanvasStyle(this.lowerCanvasEl,this.upperCanvasEl);this._applyCanvasStyle(this.upperCanvasEl);this.contextTop=this.upperCanvasEl.getContext("2d")},_createCacheCanvas:function(){this.cacheCanvasEl=this._createCanvasElement();this.cacheCanvasEl.setAttribute("width",
this.width);this.cacheCanvasEl.setAttribute("height",this.height);this.contextCache=this.cacheCanvasEl.getContext("2d")},_initWrapperElement:function(){this.wrapperEl=f.util.wrapElement(this.lowerCanvasEl,"div",{"class":this.containerClass});f.util.setStyle(this.wrapperEl,{width:this.getWidth()+"px",height:this.getHeight()+"px",position:"relative"});f.util.makeElementUnselectable(this.wrapperEl)},_applyCanvasStyle:function(d){var a=this.getWidth()||d.width,b=this.getHeight()||d.height;f.util.setStyle(d,
{position:"absolute",width:a+"px",height:b+"px",left:0,top:0});d.width=a;d.height=b;f.util.makeElementUnselectable(d)},_copyCanvasStyle:function(d,a){a.style.cssText=d.style.cssText},getSelectionContext:function(){return this.contextTop},getSelectionElement:function(){return this.upperCanvasEl},_setActiveObject:function(d){this._activeObject&&this._activeObject.set("active",!1);this._activeObject=d;d.set("active",!0)},setActiveObject:function(d,a){this._setActiveObject(d);this.renderAll();this.fire("object:selected",
{target:d,e:a});d.fire("selected",{e:a});return this},getActiveObject:function(){return this._activeObject},_discardActiveObject:function(){this._activeObject&&this._activeObject.set("active",!1);this._activeObject=null},discardActiveObject:function(d){this._discardActiveObject();this.renderAll();this.fire("selection:cleared",{e:d});return this},_setActiveGroup:function(d){(this._activeGroup=d)&&d.set("active",!0)},setActiveGroup:function(d,a){this._setActiveGroup(d);d&&(this.fire("object:selected",
{target:d,e:a}),d.fire("selected",{e:a}));return this},getActiveGroup:function(){return this._activeGroup},_discardActiveGroup:function(){var d=this.getActiveGroup();d&&d.destroy();this.setActiveGroup(null)},discardActiveGroup:function(d){this._discardActiveGroup();this.fire("selection:cleared",{e:d});return this},deactivateAll:function(){for(var d=this.getObjects(),a=0,b=d.length;a<b;a++)d[a].set("active",!1);this._discardActiveGroup();this._discardActiveObject();return this},deactivateAllWithDispatch:function(d){var a=
this.getActiveGroup()||this.getActiveObject();a&&this.fire("before:selection:cleared",{target:a,e:d});this.deactivateAll();a&&this.fire("selection:cleared",{e:d});return this},drawControls:function(d){var a=this.getActiveGroup();a?this._drawGroupControls(d,a):this._drawObjectsControls(d)},_drawGroupControls:function(d,a){a._renderControls(d)},_drawObjectsControls:function(d){for(var a=0,b=this._objects.length;a<b;++a)this._objects[a]&&this._objects[a].active&&(this._objects[a]._renderControls(d),
this.lastRenderedObjectWithControlsAboveOverlay=this._objects[a])}});for(var b in f.StaticCanvas)"prototype"!==b&&(f.Canvas[b]=f.StaticCanvas[b]);f.isTouchSupported&&(f.Canvas.prototype._setCursorFromEvent=function(){});f.Element=f.Canvas})();(function(){var l={mt:0,tr:1,mr:2,br:3,mb:4,bl:5,ml:6,tl:7},e=f.util.addListener,g=f.util.removeListener;f.util.object.extend(f.Canvas.prototype,{cursorMap:"n-resize ne-resize e-resize se-resize s-resize sw-resize w-resize nw-resize".split(" "),_initEventListeners:function(){this._bindEvents();
e(f.window,"resize",this._onResize);e(this.upperCanvasEl,"mousedown",this._onMouseDown);e(this.upperCanvasEl,"mousemove",this._onMouseMove);e(this.upperCanvasEl,"mousewheel",this._onMouseWheel);e(this.upperCanvasEl,"touchstart",this._onMouseDown);e(this.upperCanvasEl,"touchmove",this._onMouseMove);"undefined"!==typeof eventjs&&"add"in eventjs&&(eventjs.add(this.upperCanvasEl,"gesture",this._onGesture),eventjs.add(this.upperCanvasEl,"drag",this._onDrag),eventjs.add(this.upperCanvasEl,"orientation",
this._onOrientationChange),eventjs.add(this.upperCanvasEl,"shake",this._onShake),eventjs.add(this.upperCanvasEl,"longpress",this._onLongPress))},_bindEvents:function(){this._onMouseDown=this._onMouseDown.bind(this);this._onMouseMove=this._onMouseMove.bind(this);this._onMouseUp=this._onMouseUp.bind(this);this._onResize=this._onResize.bind(this);this._onGesture=this._onGesture.bind(this);this._onDrag=this._onDrag.bind(this);this._onShake=this._onShake.bind(this);this._onLongPress=this._onLongPress.bind(this);
this._onOrientationChange=this._onOrientationChange.bind(this);this._onMouseWheel=this._onMouseWheel.bind(this)},removeListeners:function(){g(f.window,"resize",this._onResize);g(this.upperCanvasEl,"mousedown",this._onMouseDown);g(this.upperCanvasEl,"mousemove",this._onMouseMove);g(this.upperCanvasEl,"mousewheel",this._onMouseWheel);g(this.upperCanvasEl,"touchstart",this._onMouseDown);g(this.upperCanvasEl,"touchmove",this._onMouseMove);"undefined"!==typeof eventjs&&"remove"in eventjs&&(eventjs.remove(this.upperCanvasEl,
"gesture",this._onGesture),eventjs.remove(this.upperCanvasEl,"drag",this._onDrag),eventjs.remove(this.upperCanvasEl,"orientation",this._onOrientationChange),eventjs.remove(this.upperCanvasEl,"shake",this._onShake),eventjs.remove(this.upperCanvasEl,"longpress",this._onLongPress))},_onGesture:function(c,a){this.__onTransformGesture&&this.__onTransformGesture(c,a)},_onDrag:function(c,a){this.__onDrag&&this.__onDrag(c,a)},_onMouseWheel:function(c,a){this.__onMouseWheel&&this.__onMouseWheel(c,a)},_onOrientationChange:function(c,
a){this.__onOrientationChange&&this.__onOrientationChange(c,a)},_onShake:function(c,a){this.__onShake&&this.__onShake(c,a)},_onLongPress:function(c,a){this.__onLongPress&&this.__onLongPress(c,a)},_onMouseDown:function(c){this.__onMouseDown(c);e(f.document,"touchend",this._onMouseUp);e(f.document,"touchmove",this._onMouseMove);g(this.upperCanvasEl,"mousemove",this._onMouseMove);g(this.upperCanvasEl,"touchmove",this._onMouseMove);"touchstart"===c.type?g(this.upperCanvasEl,"mousedown",this._onMouseDown):
(e(f.document,"mouseup",this._onMouseUp),e(f.document,"mousemove",this._onMouseMove))},_onMouseUp:function(c){this.__onMouseUp(c);g(f.document,"mouseup",this._onMouseUp);g(f.document,"touchend",this._onMouseUp);g(f.document,"mousemove",this._onMouseMove);g(f.document,"touchmove",this._onMouseMove);e(this.upperCanvasEl,"mousemove",this._onMouseMove);e(this.upperCanvasEl,"touchmove",this._onMouseMove);if("touchend"===c.type){var a=this;setTimeout(function(){e(a.upperCanvasEl,"mousedown",a._onMouseDown)},
400)}},_onMouseMove:function(c){!this.allowTouchScrolling&&c.preventDefault&&c.preventDefault();this.__onMouseMove(c)},_onResize:function(){this.calcOffset()},_shouldRender:function(c,a){var b=this.getActiveGroup()||this.getActiveObject();return!!(c&&(c.isMoving||c!==b)||!c&&b||!c&&!b&&!this._groupSelector||a&&this._previousPointer&&this.selection&&(a.x!==this._previousPointer.x||a.y!==this._previousPointer.y))},__onMouseUp:function(c){var a;if(this.isDrawingMode&&this._isCurrentlyDrawing)this._onMouseUpInDrawingMode(c);
else{this._currentTransform?(this._finalizeCurrentTransform(),a=this._currentTransform.target):a=this.findTarget(c,!0);var b=this._shouldRender(a,this.getPointer(c));this._maybeGroupObjects(c);a&&(a.isMoving=!1);b&&this.renderAll();this._handleCursorAndEvent(c,a)}},_handleCursorAndEvent:function(c,a){this._setCursorFromEvent(c,a);var b=this;setTimeout(function(){b._setCursorFromEvent(c,a)},50);this.fire("mouse:up",{target:a,e:c});a&&a.fire("mouseup",{e:c})},_finalizeCurrentTransform:function(){var c=
this._currentTransform.target;c._scaling&&(c._scaling=!1);c.setCoords();this.stateful&&c.hasStateChanged()&&(this.fire("object:modified",{target:c}),c.fire("modified"));this._restoreOriginXY(c)},_restoreOriginXY:function(c){if(this._previousOriginX&&this._previousOriginY){var a=c.translateToOriginPoint(c.getCenterPoint(),this._previousOriginX,this._previousOriginY);c.originX=this._previousOriginX;c.originY=this._previousOriginY;c.left=a.x;c.top=a.y;this._previousOriginY=this._previousOriginX=null}},
_onMouseDownInDrawingMode:function(c){this._isCurrentlyDrawing=!0;this.discardActiveObject(c).renderAll();this.clipTo&&f.util.clipContext(this,this.contextTop);var a=f.util.invertTransform(this.viewportTransform),a=f.util.transformPoint(this.getPointer(c,!0),a);this.freeDrawingBrush.onMouseDown(a);this.fire("mouse:down",{e:c});a=this.findTarget(c);"undefined"!==typeof a&&a.fire("mousedown",{e:c,target:a})},_onMouseMoveInDrawingMode:function(c){if(this._isCurrentlyDrawing){var a=f.util.invertTransform(this.viewportTransform),
a=f.util.transformPoint(this.getPointer(c,!0),a);this.freeDrawingBrush.onMouseMove(a)}this.setCursor(this.freeDrawingCursor);this.fire("mouse:move",{e:c});a=this.findTarget(c);"undefined"!==typeof a&&a.fire("mousemove",{e:c,target:a})},_onMouseUpInDrawingMode:function(c){this._isCurrentlyDrawing=!1;this.clipTo&&this.contextTop.restore();this.freeDrawingBrush.onMouseUp();this.fire("mouse:up",{e:c});var a=this.findTarget(c);"undefined"!==typeof a&&a.fire("mouseup",{e:c,target:a})},__onMouseDown:function(c){if(("which"in
c?1===c.which:1===c.button)||f.isTouchSupported)if(this.isDrawingMode)this._onMouseDownInDrawingMode(c);else if(!this._currentTransform){var a=this.findTarget(c),b=this.getPointer(c,!0);this._previousPointer=b;var d=this._shouldRender(a,b),k=this._shouldGroup(c,a);this._shouldClearSelection(c,a)?this._clearSelection(c,a,b):k&&(this._handleGrouping(c,a),a=this.getActiveGroup());a&&a.selectable&&!k&&(this._beforeTransform(c,a),this._setupCurrentTransform(c,a));d&&this.renderAll();this.fire("mouse:down",
{target:a,e:c});a&&a.fire("mousedown",{e:c})}},_beforeTransform:function(c,a){this.stateful&&a.saveState();if(a._findTargetCorner(this.getPointer(c)))this.onBeforeScaleRotate(a);a!==this.getActiveGroup()&&a!==this.getActiveObject()&&(this.deactivateAll(),this.setActiveObject(a,c))},_clearSelection:function(c,a,b){this.deactivateAllWithDispatch(c);a&&a.selectable?this.setActiveObject(a,c):this.selection&&(this._groupSelector={ex:b.x,ey:b.y,top:0,left:0})},_setOriginToCenter:function(c){this._previousOriginX=
this._currentTransform.target.originX;this._previousOriginY=this._currentTransform.target.originY;var a=c.getCenterPoint();c.originX="center";c.originY="center";c.left=a.x;c.top=a.y;this._currentTransform.left=c.left;this._currentTransform.top=c.top},_setCenterToOrigin:function(c){var a=c.translateToOriginPoint(c.getCenterPoint(),this._previousOriginX,this._previousOriginY);c.originX=this._previousOriginX;c.originY=this._previousOriginY;c.left=a.x;c.top=a.y;this._previousOriginY=this._previousOriginX=
null},__onMouseMove:function(c){var a,b;if(this.isDrawingMode)this._onMouseMoveInDrawingMode(c);else if(!("undefined"!==typeof c.touches&&1<c.touches.length)){var d=this._groupSelector;d?(b=this.getPointer(c,!0),d.left=b.x-d.ex,d.top=b.y-d.ey,this.renderTop()):this._currentTransform?this._transformObject(c):(a=this.findTarget(c),!a||a&&!a.selectable?this.setCursor(this.defaultCursor):this._setCursorFromEvent(c,a));this.fire("mouse:move",{target:a,e:c});a&&a.fire("mousemove",{e:c})}},_transformObject:function(c){var a=
this.getPointer(c),b=this._currentTransform;b.reset=!1;b.target.isMoving=!0;this._beforeScaleTransform(c,b);this._performTransformAction(c,b,a);this.renderAll()},_performTransformAction:function(c,a,b){var d=b.x;b=b.y;var k=a.target,e=a.action;"rotate"===e?(this._rotateObject(d,b),this._fire("rotating",k,c)):"scale"===e?(this._onScale(c,a,d,b),this._fire("scaling",k,c)):"scaleX"===e?(this._scaleObject(d,b,"x"),this._fire("scaling",k,c)):"scaleY"===e?(this._scaleObject(d,b,"y"),this._fire("scaling",
k,c)):(this._translateObject(d,b),this._fire("moving",k,c),this.setCursor(this.moveCursor))},_fire:function(c,a,b){this.fire("object:"+c,{target:a,e:b});a.fire(c,{e:b})},_beforeScaleTransform:function(c,a){if("scale"===a.action||"scaleX"===a.action||"scaleY"===a.action){var b=this._shouldCenterTransform(c,a.target);if(b&&("center"!==a.originX||"center"!==a.originY)||!b&&"center"===a.originX&&"center"===a.originY)this._resetCurrentTransform(c),a.reset=!0}},_onScale:function(c,a,b,d){!c.shiftKey&&!this.uniScaleTransform||
a.target.get("lockUniScaling")?(a.reset||"scale"!==a.currentAction||this._resetCurrentTransform(c,a.target),a.currentAction="scaleEqually",this._scaleObject(b,d,"equally")):(a.currentAction="scale",this._scaleObject(b,d))},_setCursorFromEvent:function(c,a){if(a&&a.selectable){var b=this.getActiveGroup();(b=a._findTargetCorner&&(!b||!b.contains(a))&&a._findTargetCorner(this.getPointer(c,!0)))?this._setCornerCursor(b,a):this.setCursor(a.hoverCursor||this.hoverCursor)}else return this.setCursor(this.defaultCursor),
!1;return!0},_setCornerCursor:function(c,a){if(c in l)this.setCursor(this._getRotatedCornerCursor(c,a));else if("mtr"===c&&a.hasRotatingPoint)this.setCursor(this.rotationCursor);else return this.setCursor(this.defaultCursor),!1},_getRotatedCornerCursor:function(c,a){var b=Math.round(a.getAngle()%360/45);0>b&&(b+=8);b+=l[c];return this.cursorMap[b%8]}})})();(function(){var l=Math.min,e=Math.max;f.util.object.extend(f.Canvas.prototype,{_shouldGroup:function(e,c){var a=this.getActiveObject();return e.shiftKey&&
(this.getActiveGroup()||a&&a!==c)&&this.selection},_handleGrouping:function(e,c){if(c===this.getActiveGroup()&&(c=this.findTarget(e,!0),!c||c.isType("group")))return;this.getActiveGroup()?this._updateActiveGroup(c,e):this._createActiveGroup(c,e);this._activeGroup&&this._activeGroup.saveCoords()},_updateActiveGroup:function(e,c){var a=this.getActiveGroup();if(a.contains(e)){if(a.removeWithUpdate(e),this._resetObjectTransform(a),e.set("active",!1),1===a.size()){this.discardActiveGroup(c);this.setActiveObject(a.item(0));
return}}else a.addWithUpdate(e),this._resetObjectTransform(a);this.fire("selection:created",{target:a,e:c});a.set("active",!0)},_createActiveGroup:function(e,c){if(this._activeObject&&e!==this._activeObject){var a=this._createGroup(e);a.addWithUpdate();this.setActiveGroup(a);this._activeObject=null;this.fire("selection:created",{target:a,e:c})}e.set("active",!0)},_createGroup:function(e){var c=this.getObjects();e=c.indexOf(this._activeObject)<c.indexOf(e)?[this._activeObject,e]:[e,this._activeObject];
return new f.Group(e,{canvas:this})},_groupSelectedObjects:function(e){var c=this._collectObjects();1===c.length?this.setActiveObject(c[0],e):1<c.length&&(c=new f.Group(c.reverse(),{canvas:this}),c.addWithUpdate(),this.setActiveGroup(c,e),c.saveCoords(),this.fire("selection:created",{target:c}),this.renderAll())},_collectObjects:function(){var g=[],c;c=this._groupSelector.ex;for(var a=this._groupSelector.ey,b=c+this._groupSelector.left,d=a+this._groupSelector.top,k=new f.Point(l(c,b),l(a,d)),q=new f.Point(e(c,
b),e(a,d)),a=c===b&&a===d,b=this._objects.length;b--&&!((c=this._objects[b])&&c.selectable&&c.visible&&(c.intersectsWithRect(k,q)||c.isContainedWithinRect(k,q)||c.containsPoint(k)||c.containsPoint(q))&&(c.set("active",!0),g.push(c),a)););return g},_maybeGroupObjects:function(e){this.selection&&this._groupSelector&&this._groupSelectedObjects(e);if(e=this.getActiveGroup())e.setObjectsCoords().setCoords(),e.isMoving=!1,this.setCursor(this.defaultCursor);this._currentTransform=this._groupSelector=null}})})();
f.util.object.extend(f.StaticCanvas.prototype,{toDataURL:function(f){f||(f={});var e=f.format||"png",g=f.quality||1,c=f.multiplier||1;f={left:f.left,top:f.top,width:f.width,height:f.height};return 1!==c?this.__toDataURLWithMultiplier(e,g,f,c):this.__toDataURL(e,g,f)},__toDataURL:function(l,e,g){this.renderAll(!0);var c=this.upperCanvasEl||this.lowerCanvasEl;g=this.__getCroppedCanvas(c,g);"jpg"===l&&(l="jpeg");l=f.StaticCanvas.supports("toDataURLWithQuality")?(g||c).toDataURL("image/"+l,e):(g||c).toDataURL("image/"+
l);this.contextTop&&this.clearContext(this.contextTop);this.renderAll();return l},__getCroppedCanvas:function(l,e){var g,c;if("left"in e||"top"in e||"width"in e||"height"in e)g=f.util.createCanvasElement(),c=g.getContext("2d"),g.width=e.width||this.width,g.height=e.height||this.height,c.drawImage(l,-e.left||0,-e.top||0);return g},__toDataURLWithMultiplier:function(f,e,g,c){var a=this.getWidth(),b=this.getHeight(),d=a*c,k=b*c,q=this.getActiveObject(),w=this.getActiveGroup(),h=this.contextTop||this.contextContainer;
1<c&&this.setWidth(d).setHeight(k);h.scale(c,c);g.left&&(g.left*=c);g.top&&(g.top*=c);g.width?g.width*=c:1>c&&(g.width=d);g.height?g.height*=c:1>c&&(g.height=k);w?this._tempRemoveBordersControlsFromGroup(w):q&&this.deactivateAll&&this.deactivateAll();this.renderAll(!0);f=this.__toDataURL(f,e,g);this.width=a;this.height=b;h.scale(1/c,1/c);this.setWidth(a).setHeight(b);w?this._restoreBordersControlsOnGroup(w):q&&this.setActiveObject&&this.setActiveObject(q);this.contextTop&&this.clearContext(this.contextTop);
this.renderAll();return f},toDataURLWithMultiplier:function(f,e,g){return this.toDataURL({format:f,multiplier:e,quality:g})},_tempRemoveBordersControlsFromGroup:function(f){f.origHasControls=f.hasControls;f.origBorderColor=f.borderColor;f.hasControls=!0;f.borderColor="rgba(0,0,0,0)";f.forEachObject(function(e){e.origBorderColor=e.borderColor;e.borderColor="rgba(0,0,0,0)"})},_restoreBordersControlsOnGroup:function(f){f.hideControls=f.origHideControls;f.borderColor=f.origBorderColor;f.forEachObject(function(e){e.borderColor=
e.origBorderColor;delete e.origBorderColor})}});(function(f){var e=f.fabric||(f.fabric={});f=e.util.object.extend;var g=e.util.toFixed,c=e.util.string.capitalize,a=e.util.degreesToRadians,b=e.StaticCanvas.supports("setLineDash");e.Object||(e.Object=e.util.createClass({type:"object",originX:"left",originY:"top",top:0,left:0,width:0,height:0,scaleX:1,scaleY:1,flipX:!1,flipY:!1,opacity:1,angle:0,cornerSize:12,transparentCorners:!0,hoverCursor:null,padding:0,borderColor:"rgba(102,153,255,0.75)",cornerColor:"rgba(102,153,255,0.5)",
centeredScaling:!1,centeredRotation:!0,fill:"rgb(0,0,0)",fillRule:"nonzero",globalCompositeOperation:"source-over",backgroundColor:"",stroke:null,strokeWidth:1,strokeDashArray:null,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:10,shadow:null,borderOpacityWhenMoving:.4,borderScaleFactor:1,transformMatrix:null,minScaleLimit:.01,selectable:!0,evented:!0,visible:!0,hasControls:!0,hasBorders:!0,hasRotatingPoint:!0,rotatingPointOffset:40,perPixelTargetFind:!1,includeDefaultValues:!0,clipTo:null,
lockMovementX:!1,lockMovementY:!1,lockRotation:!1,lockScalingX:!1,lockScalingY:!1,lockUniScaling:!1,lockScalingFlip:!1,stateProperties:"top left width height scaleX scaleY flipX flipY originX originY transformMatrix stroke strokeWidth strokeDashArray strokeLineCap strokeLineJoin strokeMiterLimit angle opacity fill fillRule globalCompositeOperation shadow clipTo visible backgroundColor".split(" "),initialize:function(d){d&&this.setOptions(d)},_initGradient:function(d){!d.fill||!d.fill.colorStops||
d.fill instanceof e.Gradient||this.set("fill",new e.Gradient(d.fill))},_initPattern:function(d){!d.fill||!d.fill.source||d.fill instanceof e.Pattern||this.set("fill",new e.Pattern(d.fill));!d.stroke||!d.stroke.source||d.stroke instanceof e.Pattern||this.set("stroke",new e.Pattern(d.stroke))},_initClipping:function(d){d.clipTo&&"string"===typeof d.clipTo&&(d=e.util.getFunctionBody(d.clipTo),"undefined"!==typeof d&&(this.clipTo=new Function("ctx",d)))},setOptions:function(d){for(var a in d)this.set(a,
d[a]);this._initGradient(d);this._initPattern(d);this._initClipping(d)},transform:function(d,b){var c=b?this._getLeftTopCoords():this.getCenterPoint();d.translate(c.x,c.y);d.rotate(a(this.angle));d.scale(this.scaleX*(this.flipX?-1:1),this.scaleY*(this.flipY?-1:1))},toObject:function(d){var a=e.Object.NUM_FRACTION_DIGITS,a={type:this.type,originX:this.originX,originY:this.originY,left:g(this.left,a),top:g(this.top,a),width:g(this.width,a),height:g(this.height,a),fill:this.fill&&this.fill.toObject?
this.fill.toObject():this.fill,stroke:this.stroke&&this.stroke.toObject?this.stroke.toObject():this.stroke,strokeWidth:g(this.strokeWidth,a),strokeDashArray:this.strokeDashArray,strokeLineCap:this.strokeLineCap,strokeLineJoin:this.strokeLineJoin,strokeMiterLimit:g(this.strokeMiterLimit,a),scaleX:g(this.scaleX,a),scaleY:g(this.scaleY,a),angle:g(this.getAngle(),a),flipX:this.flipX,flipY:this.flipY,opacity:g(this.opacity,a),shadow:this.shadow&&this.shadow.toObject?this.shadow.toObject():this.shadow,
visible:this.visible,clipTo:this.clipTo&&String(this.clipTo),backgroundColor:this.backgroundColor,fillRule:this.fillRule,globalCompositeOperation:this.globalCompositeOperation};this.includeDefaultValues||(a=this._removeDefaultValues(a));e.util.populateWithProperties(this,a,d);return a},toDatalessObject:function(d){return this.toObject(d)},_removeDefaultValues:function(d){var a=e.util.getKlass(d.type).prototype;a.stateProperties.forEach(function(b){d[b]===a[b]&&delete d[b]});return d},toString:function(){return"#<fabric."+
c(this.type)+">"},get:function(d){return this[d]},_setObject:function(d){for(var a in d)this._set(a,d[a])},set:function(d,a){"object"===typeof d?this._setObject(d):"function"===typeof a&&"clipTo"!==d?this._set(d,a(this.get(d))):this._set(d,a);return this},_set:function(d,a){if("scaleX"===d||"scaleY"===d)a=this._constrainScale(a);"scaleX"===d&&0>a?(this.flipX=!this.flipX,a*=-1):"scaleY"===d&&0>a?(this.flipY=!this.flipY,a*=-1):"width"===d||"height"===d?this.minScaleLimit=g(Math.min(.1,1/Math.max(this.width,
this.height)),2):"shadow"!==d||!a||a instanceof e.Shadow||(a=new e.Shadow(a));this[d]=a;return this},toggle:function(d){var a=this.get(d);"boolean"===typeof a&&this.set(d,!a);return this},setSourcePath:function(d){this.sourcePath=d;return this},getViewportTransform:function(){return this.canvas&&this.canvas.viewportTransform?this.canvas.viewportTransform:[1,0,0,1,0,0]},render:function(d,a){0===this.width&&0===this.height||!this.visible||(d.save(),this._setupCompositeOperation(d),a||this.transform(d),
this._setStrokeStyles(d),this._setFillStyles(d),this.transformMatrix&&d.transform.apply(d,this.transformMatrix),this._setOpacity(d),this._setShadow(d),this.clipTo&&e.util.clipContext(this,d),this._render(d,a),this.clipTo&&d.restore(),this._removeShadow(d),this._restoreCompositeOperation(d),d.restore())},_setOpacity:function(d){this.group&&this.group._setOpacity(d);d.globalAlpha*=this.opacity},_setStrokeStyles:function(d){this.stroke&&(d.lineWidth=this.strokeWidth,d.lineCap=this.strokeLineCap,d.lineJoin=
this.strokeLineJoin,d.miterLimit=this.strokeMiterLimit,d.strokeStyle=this.stroke.toLive?this.stroke.toLive(d,this):this.stroke)},_setFillStyles:function(d){this.fill&&(d.fillStyle=this.fill.toLive?this.fill.toLive(d,this):this.fill)},_renderControls:function(d,b){if(this.active&&!b){var c=this.getViewportTransform();d.save();var g;this.group&&(g=e.util.transformPoint(this.group.getCenterPoint(),c),d.translate(g.x,g.y),d.rotate(a(this.group.angle)));g=e.util.transformPoint(this.getCenterPoint(),c,
null!=this.group);this.group&&(g.x*=this.group.scaleX,g.y*=this.group.scaleY);d.translate(g.x,g.y);d.rotate(a(this.angle));this.drawBorders(d);this.drawControls(d);d.restore()}},_setShadow:function(d){if(this.shadow){var a=this.canvas&&this.canvas.viewportTransform[0]||1,b=this.canvas&&this.canvas.viewportTransform[3]||1;d.shadowColor=this.shadow.color;d.shadowBlur=this.shadow.blur*(a+b)*(this.scaleX+this.scaleY)/4;d.shadowOffsetX=this.shadow.offsetX*a*this.scaleX;d.shadowOffsetY=this.shadow.offsetY*
b*this.scaleY}},_removeShadow:function(d){this.shadow&&(d.shadowColor="",d.shadowBlur=d.shadowOffsetX=d.shadowOffsetY=0)},_renderFill:function(d){this.fill&&(d.save(),this.fill.gradientTransform&&d.transform.apply(d,this.fill.gradientTransform),this.fill.toLive&&d.translate(-this.width/2+this.fill.offsetX||0,-this.height/2+this.fill.offsetY||0),"evenodd"===this.fillRule?d.fill("evenodd"):d.fill(),d.restore(),this.shadow&&!this.shadow.affectStroke&&this._removeShadow(d))},_renderStroke:function(d){this.stroke&&
0!==this.strokeWidth&&(d.save(),this.strokeDashArray?(1&this.strokeDashArray.length&&this.strokeDashArray.push.apply(this.strokeDashArray,this.strokeDashArray),b?(d.setLineDash(this.strokeDashArray),this._stroke&&this._stroke(d)):this._renderDashedStroke&&this._renderDashedStroke(d),d.stroke()):(this.stroke.gradientTransform&&d.transform.apply(d,this.stroke.gradientTransform),this._stroke?this._stroke(d):d.stroke()),this._removeShadow(d),d.restore())},clone:function(d,a){return this.constructor.fromObject?
this.constructor.fromObject(this.toObject(a),d):new e.Object(this.toObject(a))},cloneAsImage:function(d){var a=this.toDataURL();e.util.loadImage(a,function(a){d&&d(new e.Image(a))});return this},toDataURL:function(d){d||(d={});var a=e.util.createCanvasElement(),b=this.getBoundingRect();a.width=b.width;a.height=b.height;e.util.wrapElement(a,"div");b=new e.StaticCanvas(a);"jpg"===d.format&&(d.format="jpeg");"jpeg"===d.format&&(b.backgroundColor="#fff");var c={active:this.get("active"),left:this.getLeft(),
top:this.getTop()};this.set("active",!1);this.setPositionByOrigin(new e.Point(a.width/2,a.height/2),"center","center");a=this.canvas;b.add(this);d=b.toDataURL(d);this.set(c).setCoords();this.canvas=a;b.dispose();return d},isType:function(a){return this.type===a},complexity:function(){return 0},toJSON:function(a){return this.toObject(a)},setGradient:function(a,b){b||(b={});var c={colorStops:[]};c.type=b.type||(b.r1||b.r2?"radial":"linear");c.coords={x1:b.x1,y1:b.y1,x2:b.x2,y2:b.y2};if(b.r1||b.r2)c.coords.r1=
b.r1,c.coords.r2=b.r2;for(var g in b.colorStops){var f=new e.Color(b.colorStops[g]);c.colorStops.push({offset:g,color:f.toRgb(),opacity:f.getAlpha()})}return this.set(a,e.Gradient.forObject(this,c))},setPatternFill:function(a){return this.set("fill",new e.Pattern(a))},setShadow:function(a){return this.set("shadow",a?new e.Shadow(a):null)},setColor:function(a){this.set("fill",a);return this},setAngle:function(a){var b=("center"!==this.originX||"center"!==this.originY)&&this.centeredRotation;b&&this._setOriginToCenter();
this.set("angle",a);b&&this._resetOrigin();return this},centerH:function(){this.canvas.centerObjectH(this);return this},centerV:function(){this.canvas.centerObjectV(this);return this},center:function(){this.canvas.centerObject(this);return this},remove:function(){this.canvas.remove(this);return this},getLocalPointer:function(a,b){b=b||this.canvas.getPointer(a);var c=this.translateToOriginPoint(this.getCenterPoint(),"left","top");return{x:b.x-c.x,y:b.y-c.y}},_setupCompositeOperation:function(a){this.globalCompositeOperation&&
(this._prevGlobalCompositeOperation=a.globalCompositeOperation,a.globalCompositeOperation=this.globalCompositeOperation)},_restoreCompositeOperation:function(a){this.globalCompositeOperation&&this._prevGlobalCompositeOperation&&(a.globalCompositeOperation=this._prevGlobalCompositeOperation)}}),e.util.createAccessors(e.Object),e.Object.prototype.rotate=e.Object.prototype.setAngle,f(e.Object.prototype,e.Observable),e.Object.NUM_FRACTION_DIGITS=2,e.Object.__uid=0)})("undefined"!==typeof h?h:this);(function(){var h=
f.util.degreesToRadians;f.util.object.extend(f.Object.prototype,{translateToCenterPoint:function(e,g,c){var a=e.x,b=e.y,d=this.stroke?this.strokeWidth:0;"left"===g?a=e.x+(this.getWidth()+d*this.scaleX)/2:"right"===g&&(a=e.x-(this.getWidth()+d*this.scaleX)/2);"top"===c?b=e.y+(this.getHeight()+d*this.scaleY)/2:"bottom"===c&&(b=e.y-(this.getHeight()+d*this.scaleY)/2);return f.util.rotatePoint(new f.Point(a,b),e,h(this.angle))},translateToOriginPoint:function(e,g,c){var a=e.x,b=e.y,d=this.stroke?this.strokeWidth:
0;"left"===g?a=e.x-(this.getWidth()+d*this.scaleX)/2:"right"===g&&(a=e.x+(this.getWidth()+d*this.scaleX)/2);"top"===c?b=e.y-(this.getHeight()+d*this.scaleY)/2:"bottom"===c&&(b=e.y+(this.getHeight()+d*this.scaleY)/2);return f.util.rotatePoint(new f.Point(a,b),e,h(this.angle))},getCenterPoint:function(){var e=new f.Point(this.left,this.top);return this.translateToCenterPoint(e,this.originX,this.originY)},getPointByOrigin:function(e,g){var c=this.getCenterPoint();return this.translateToOriginPoint(c,
e,g)},toLocalPoint:function(e,g,c){var a=this.getCenterPoint(),b=this.stroke?this.strokeWidth:0;g&&c?(g="left"===g?a.x-(this.getWidth()+b*this.scaleX)/2:"right"===g?a.x+(this.getWidth()+b*this.scaleX)/2:a.x,c="top"===c?a.y-(this.getHeight()+b*this.scaleY)/2:"bottom"===c?a.y+(this.getHeight()+b*this.scaleY)/2:a.y):(g=this.left,c=this.top);return f.util.rotatePoint(new f.Point(e.x,e.y),a,-h(this.angle)).subtractEquals(new f.Point(g,c))},setPositionByOrigin:function(e,g,c){e=this.translateToCenterPoint(e,
g,c);e=this.translateToOriginPoint(e,this.originX,this.originY);this.set("left",e.x);this.set("top",e.y)},adjustPosition:function(e){var g=h(this.angle),c=this.getWidth()/2,a=Math.cos(g)*c,c=Math.sin(g)*c,b=this.getWidth(),d=Math.cos(g)*b,g=Math.sin(g)*b;"center"===this.originX&&"left"===e||"right"===this.originX&&"center"===e?(this.left-=a,this.top-=c):"left"===this.originX&&"center"===e||"center"===this.originX&&"right"===e?(this.left+=a,this.top+=c):"left"===this.originX&&"right"===e?(this.left+=
d,this.top+=g):"right"===this.originX&&"left"===e&&(this.left-=d,this.top-=g);this.setCoords();this.originX=e},_setOriginToCenter:function(){this._originalOriginX=this.originX;this._originalOriginY=this.originY;var e=this.getCenterPoint();this.originY=this.originX="center";this.left=e.x;this.top=e.y},_resetOrigin:function(){var e=this.translateToOriginPoint(this.getCenterPoint(),this._originalOriginX,this._originalOriginY);this.originX=this._originalOriginX;this.originY=this._originalOriginY;this.left=
e.x;this.top=e.y;this._originalOriginY=this._originalOriginX=null},_getLeftTopCoords:function(){return this.translateToOriginPoint(this.getCenterPoint(),"left","center")}})})();(function(){var h=f.util.degreesToRadians;f.util.object.extend(f.Object.prototype,{oCoords:null,intersectsWithRect:function(e,g){var c=this.oCoords,a=new f.Point(c.tl.x,c.tl.y),b=new f.Point(c.tr.x,c.tr.y),d=new f.Point(c.bl.x,c.bl.y),c=new f.Point(c.br.x,c.br.y);return"Intersection"===f.Intersection.intersectPolygonRectangle([a,
b,c,d],e,g).status},intersectsWithObject:function(e){function g(a){return{tl:new f.Point(a.tl.x,a.tl.y),tr:new f.Point(a.tr.x,a.tr.y),bl:new f.Point(a.bl.x,a.bl.y),br:new f.Point(a.br.x,a.br.y)}}var c=g(this.oCoords);e=g(e.oCoords);return"Intersection"===f.Intersection.intersectPolygonPolygon([c.tl,c.tr,c.br,c.bl],[e.tl,e.tr,e.br,e.bl]).status},isContainedWithinObject:function(e){var g=e.getBoundingRect();e=new f.Point(g.left,g.top);g=new f.Point(g.left+g.width,g.top+g.height);return this.isContainedWithinRect(e,
g)},isContainedWithinRect:function(e,g){var c=this.getBoundingRect();return c.left>=e.x&&c.left+c.width<=g.x&&c.top>=e.y&&c.top+c.height<=g.y},containsPoint:function(e){var g=this._getImageLines(this.oCoords);e=this._findCrossPoints(e,g);return 0!==e&&1===e%2},_getImageLines:function(e){return{topline:{o:e.tl,d:e.tr},rightline:{o:e.tr,d:e.br},bottomline:{o:e.br,d:e.bl},leftline:{o:e.bl,d:e.tl}}},_findCrossPoints:function(e,g){var c,a,b,d=0,k;for(k in g)if(b=g[k],!(b.o.y<e.y&&b.d.y<e.y||b.o.y>=e.y&&
b.d.y>=e.y)&&(b.o.x===b.d.x&&b.o.x>=e.x?c=b.o.x:(c=(b.d.y-b.o.y)/(b.d.x-b.o.x),a=e.y-0*e.x,b=b.o.y-c*b.o.x,c=-(a-b)/(0-c)),c>=e.x&&(d+=1),2===d))break;return d},getBoundingRectWidth:function(){return this.getBoundingRect().width},getBoundingRectHeight:function(){return this.getBoundingRect().height},getBoundingRect:function(){this.oCoords||this.setCoords();var e=[this.oCoords.tl.x,this.oCoords.tr.x,this.oCoords.br.x,this.oCoords.bl.x],g=f.util.array.min(e),e=f.util.array.max(e),e=Math.abs(g-e),c=
[this.oCoords.tl.y,this.oCoords.tr.y,this.oCoords.br.y,this.oCoords.bl.y],a=f.util.array.min(c),c=f.util.array.max(c);return{left:g,top:a,width:e,height:Math.abs(a-c)}},getWidth:function(){return this.width*this.scaleX},getHeight:function(){return this.height*this.scaleY},_constrainScale:function(e){return Math.abs(e)<this.minScaleLimit?0>e?-this.minScaleLimit:this.minScaleLimit:e},scale:function(e){e=this._constrainScale(e);0>e&&(this.flipX=!this.flipX,this.flipY=!this.flipY,e*=-1);this.scaleY=this.scaleX=
e;this.setCoords();return this},scaleToWidth:function(e){var g=this.getBoundingRectWidth()/this.getWidth();return this.scale(e/this.width/g)},scaleToHeight:function(e){var g=this.getBoundingRectHeight()/this.getHeight();return this.scale(e/this.height/g)},setCoords:function(){var e=h(this.angle),g=this.getViewportTransform(),c=function(a){return f.util.transformPoint(a,g)},a=this._calculateCurrentDimensions(!1),b=a.x,d=a.y;0>b&&(b=Math.abs(b));var a=Math.sqrt(Math.pow(b/2,2)+Math.pow(d/2,2)),k=Math.atan(isFinite(d/
b)?d/b:0),q=Math.cos(k+e)*a,k=Math.sin(k+e)*a,a=Math.sin(e),e=Math.cos(e),w=this.getCenterPoint(),d=new f.Point(b,d),w=new f.Point(w.x-q,w.y-k),k=new f.Point(w.x+d.x*e,w.y+d.x*a),b=c(new f.Point(w.x-d.y*a,w.y+d.y*e)),q=c(new f.Point(k.x-d.y*a,k.y+d.y*e)),d=c(w),c=c(k),k=new f.Point((d.x+b.x)/2,(d.y+b.y)/2),w=new f.Point((c.x+d.x)/2,(c.y+d.y)/2),y=new f.Point((q.x+c.x)/2,(q.y+c.y)/2),aa=new f.Point((q.x+b.x)/2,(q.y+b.y)/2),a=new f.Point(w.x+a*this.rotatingPointOffset,w.y-e*this.rotatingPointOffset);
this.oCoords={tl:d,tr:c,br:q,bl:b,ml:k,mt:w,mr:y,mb:aa,mtr:a};this._setCornerCoords&&this._setCornerCoords();return this}})})();f.util.object.extend(f.Object.prototype,{sendToBack:function(){this.group?f.StaticCanvas.prototype.sendToBack.call(this.group,this):this.canvas.sendToBack(this);return this},bringToFront:function(){this.group?f.StaticCanvas.prototype.bringToFront.call(this.group,this):this.canvas.bringToFront(this);return this},sendBackwards:function(h){this.group?f.StaticCanvas.prototype.sendBackwards.call(this.group,
this,h):this.canvas.sendBackwards(this,h);return this},bringForward:function(h){this.group?f.StaticCanvas.prototype.bringForward.call(this.group,this,h):this.canvas.bringForward(this,h);return this},moveTo:function(h){this.group?f.StaticCanvas.prototype.moveTo.call(this.group,this,h):this.canvas.moveTo(this,h);return this}});f.util.object.extend(f.Object.prototype,{getSvgStyles:function(){var f=this.fill?this.fill.toLive?"url(#SVGID_"+this.fill.id+")":this.fill:"none",e=this.fillRule,g=this.stroke?
this.stroke.toLive?"url(#SVGID_"+this.stroke.id+")":this.stroke:"none",c=this.strokeWidth?this.strokeWidth:"0",a=this.strokeDashArray?this.strokeDashArray.join(" "):"";return["stroke: ",g,"; stroke-width: ",c,"; stroke-dasharray: ",a,"; stroke-linecap: ",this.strokeLineCap?this.strokeLineCap:"butt","; stroke-linejoin: ",this.strokeLineJoin?this.strokeLineJoin:"miter","; stroke-miterlimit: ",this.strokeMiterLimit?this.strokeMiterLimit:"4","; fill: ",f,"; fill-rule: ",e,"; opacity: ","undefined"!==
typeof this.opacity?this.opacity:"1",";",this.shadow?"filter: url(#SVGID_"+this.shadow.id+");":"",this.visible?"":" visibility: hidden;"].join("")},getSvgTransform:function(){if(this.group&&"path-group"===this.group.type)return"";var h=f.util.toFixed,e=this.getAngle(),g=!this.canvas||this.canvas.svgViewportTransformation?this.getViewportTransform():[1,0,0,1,0,0],c=f.util.transformPoint(this.getCenterPoint(),g),a=f.Object.NUM_FRACTION_DIGITS,c="path-group"===this.type?"":"translate("+h(c.x,a)+" "+
h(c.y,a)+")",e=0!==e?" rotate("+h(e,a)+")":"",h=1===this.scaleX&&1===this.scaleY&&1===g[0]&&1===g[3]?"":" scale("+h(this.scaleX*g[0],a)+" "+h(this.scaleY*g[3],a)+")",a="path-group"===this.type?this.width*g[0]:0,g="path-group"===this.type?this.height*g[3]:0;return[c,e,h,this.flipX?" matrix(-1 0 0 1 "+a+" 0) ":"",this.flipY?" matrix(1 0 0 -1 0 "+g+")":""].join("")},getSvgTransformMatrix:function(){return this.transformMatrix?" matrix("+this.transformMatrix.join(" ")+") ":""},_createBaseSVGMarkup:function(){var f=
[];this.fill&&this.fill.toLive&&f.push(this.fill.toSVG(this,!1));this.stroke&&this.stroke.toLive&&f.push(this.stroke.toSVG(this,!1));this.shadow&&f.push(this.shadow.toSVG(this));return f}});f.util.object.extend(f.Object.prototype,{hasStateChanged:function(){return this.stateProperties.some(function(f){return this.get(f)!==this.originalState[f]},this)},saveState:function(f){this.stateProperties.forEach(function(e){this.originalState[e]=this.get(e)},this);f&&f.stateProperties&&f.stateProperties.forEach(function(e){this.originalState[e]=
this.get(e)},this);return this},setupState:function(){this.originalState={};this.saveState();return this}});(function(){var h=f.util.degreesToRadians;f.util.object.extend(f.Object.prototype,{_controlsVisibility:null,_findTargetCorner:function(e){if(!this.hasControls||!this.active)return!1;var g=e.x;e=e.y;var c,a;for(a in this.oCoords)if(this.isControlVisible(a)&&("mtr"!==a||this.hasRotatingPoint)&&(!this.get("lockUniScaling")||"mt"!==a&&"mr"!==a&&"mb"!==a&&"ml"!==a)&&(c=this._getImageLines(this.oCoords[a].corner),
c=this._findCrossPoints({x:g,y:e},c),0!==c&&1===c%2))return this.__corner=a;return!1},_setCornerCoords:function(){var e=this.oCoords,g=h(45-this.angle),c=Math.sqrt(2*Math.pow(this.cornerSize,2))/2,a=c*Math.cos(g),g=c*Math.sin(g),b,d;for(d in e)c=e[d].x,b=e[d].y,e[d].corner={tl:{x:c-g,y:b-a},tr:{x:c+a,y:b-g},bl:{x:c-a,y:b+g},br:{x:c+g,y:b+a}}},_calculateCurrentDimensions:function(e){var g=this.getViewportTransform(),c=this.strokeWidth,a=this.width,b=this.height,d="round"===this.strokeLineCap||"square"===
this.strokeLineCap,k="line"===this.type&&0===this.width,h="line"===this.type&&0===this.height,w=k||h;k?a=c:h&&(b=c);(d&&h||!w)&&(a+=0>a?-c:c);(d&&k||!w)&&(b+=0>b?-c:c);a=a*this.scaleX+2*this.padding;b=b*this.scaleY+2*this.padding;return e?f.util.transformPoint(new f.Point(a,b),g,!0):{x:a,y:b}},drawBorders:function(e){if(!this.hasBorders)return this;e.save();e.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1;e.strokeStyle=this.borderColor;e.lineWidth=1/this.borderScaleFactor;var g=this._calculateCurrentDimensions(!0),
c=g.x,g=g.y;this.group&&(c*=this.group.scaleX,g*=this.group.scaleY);e.strokeRect(~~-(c/2)-.5,~~-(g/2)-.5,~~c+1,~~g+1);this.hasRotatingPoint&&this.isControlVisible("mtr")&&!this.get("lockRotation")&&this.hasControls&&(c=-g/2,e.beginPath(),e.moveTo(0,c),e.lineTo(0,c-this.rotatingPointOffset),e.closePath(),e.stroke());e.restore();return this},drawControls:function(e){if(!this.hasControls)return this;var g=this._calculateCurrentDimensions(!0),c=g.x,g=g.y,a=-(c/2),b=-(g/2),d=this.cornerSize/2,k=this.transparentCorners?
"strokeRect":"fillRect";e.save();e.lineWidth=1;e.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1;e.strokeStyle=e.fillStyle=this.cornerColor;this._drawControl("tl",e,k,a-d,b-d);this._drawControl("tr",e,k,a+c-d,b-d);this._drawControl("bl",e,k,a-d,b+g-d);this._drawControl("br",e,k,a+c-d,b+g-d);this.get("lockUniScaling")||(this._drawControl("mt",e,k,a+c/2-d,b-d),this._drawControl("mb",e,k,a+c/2-d,b+g-d),this._drawControl("mr",e,k,a+c-d,b+g/2-d),this._drawControl("ml",e,k,a-d,b+g/2-d));this.hasRotatingPoint&&
this._drawControl("mtr",e,k,a+c/2-d,b-this.rotatingPointOffset-d);e.restore();return this},_drawControl:function(e,g,c,a,b){this.isControlVisible(e)&&(e=this.cornerSize,"undefined"!==typeof G_vmlCanvasManager||this.transparentCorners||g.clearRect(a,b,e,e),g[c](a,b,e,e))},isControlVisible:function(e){return this._getControlsVisibility()[e]},setControlVisible:function(e,g){this._getControlsVisibility()[e]=g;return this},setControlsVisibility:function(e){e||(e={});for(var g in e)this.setControlVisible(g,
e[g]);return this},_getControlsVisibility:function(){this._controlsVisibility||(this._controlsVisibility={tl:!0,tr:!0,br:!0,bl:!0,ml:!0,mt:!0,mr:!0,mb:!0,mtr:!0});return this._controlsVisibility}})})();(function(f){function e(a,b){var c=a.origin,e=a.axis1,g=a.axis2,f=a.dimension,h=b.nearest,l=b.center,m=b.farthest;return function(){switch(this.get(c)){case h:return Math.min(this.get(e),this.get(g));case l:return Math.min(this.get(e),this.get(g))+.5*this.get(f);case m:return Math.max(this.get(e),this.get(g))}}}
var g=f.fabric||(f.fabric={}),c=g.util.object.extend,a={x1:1,x2:1,y1:1,y2:1},b=g.StaticCanvas.supports("setLineDash");g.Line?g.warn("fabric.Line is already defined"):(g.Line=g.util.createClass(g.Object,{type:"line",x1:0,y1:0,x2:0,y2:0,initialize:function(a,b){b=b||{};a||(a=[0,0,0,0]);this.callSuper("initialize",b);this.set("x1",a[0]);this.set("y1",a[1]);this.set("x2",a[2]);this.set("y2",a[3]);this._setWidthHeight(b)},_setWidthHeight:function(a){a||(a={});this.width=Math.abs(this.x2-this.x1);this.height=
Math.abs(this.y2-this.y1);this.left="left"in a?a.left:this._getLeftToOriginX();this.top="top"in a?a.top:this._getTopToOriginY()},_set:function(d,b){this.callSuper("_set",d,b);"undefined"!==typeof a[d]&&this._setWidthHeight();return this},_getLeftToOriginX:e({origin:"originX",axis1:"x1",axis2:"x2",dimension:"width"},{nearest:"left",center:"center",farthest:"right"}),_getTopToOriginY:e({origin:"originY",axis1:"y1",axis2:"y2",dimension:"height"},{nearest:"top",center:"center",farthest:"bottom"}),_render:function(a,
c){a.beginPath();if(c){var e=this.getCenterPoint();a.translate(e.x-this.strokeWidth/2,e.y-this.strokeWidth/2)}if(!this.strokeDashArray||this.strokeDashArray&&b)e=this.calcLinePoints(),a.moveTo(e.x1,e.y1),a.lineTo(e.x2,e.y2);a.lineWidth=this.strokeWidth;e=a.strokeStyle;a.strokeStyle=this.stroke||a.fillStyle;this.stroke&&this._renderStroke(a);a.strokeStyle=e},_renderDashedStroke:function(a){var b=this.calcLinePoints();a.beginPath();g.util.drawDashedLine(a,b.x1,b.y1,b.x2,b.y2,this.strokeDashArray);a.closePath()},
toObject:function(a){return c(this.callSuper("toObject",a),this.calcLinePoints())},calcLinePoints:function(){var a=this.x1<=this.x2?-1:1,b=this.y1<=this.y2?-1:1;return{x1:a*this.width*.5,x2:a*this.width*-.5,y1:b*this.height*.5,y2:b*this.height*-.5}},toSVG:function(a){var b=this._createBaseSVGMarkup(),c={x1:this.x1,x2:this.x2,y1:this.y1,y2:this.y2};this.group&&"path-group"===this.group.type||(c=this.calcLinePoints());b.push("<line ",'x1="',c.x1,'" y1="',c.y1,'" x2="',c.x2,'" y2="',c.y2,'" style="',
this.getSvgStyles(),'" transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'"/>\n');return a?a(b.join("")):b.join("")},complexity:function(){return 1}}),g.Line.ATTRIBUTE_NAMES=g.SHARED_ATTRIBUTES.concat(["x1","y1","x2","y2"]),g.Line.fromElement=function(a,b){var e=g.parseAttributes(a,g.Line.ATTRIBUTE_NAMES);return new g.Line([e.x1||0,e.y1||0,e.x2||0,e.y2||0],c(e,b))},g.Line.fromObject=function(a){return new g.Line([a.x1,a.y1,a.x2,a.y2],a)})})("undefined"!==typeof h?h:this);(function(f){var e=
f.fabric||(f.fabric={}),g=Math.PI,c=e.util.object.extend;e.Circle?e.warn("fabric.Circle is already defined."):(e.Circle=e.util.createClass(e.Object,{type:"circle",radius:0,startAngle:0,endAngle:2*g,initialize:function(a){a=a||{};this.callSuper("initialize",a);this.set("radius",a.radius||0);this.startAngle=a.startAngle||this.startAngle;this.endAngle=a.endAngle||this.endAngle},_set:function(a,b){this.callSuper("_set",a,b);"radius"===a&&this.setRadius(b);return this},toObject:function(a){return c(this.callSuper("toObject",
a),{radius:this.get("radius"),startAngle:this.startAngle,endAngle:this.endAngle})},toSVG:function(a){var b=this._createBaseSVGMarkup(),d=0,c=0,e=(this.endAngle-this.startAngle)%(2*g);0===e?(this.group&&"path-group"===this.group.type&&(d=this.left+this.radius,c=this.top+this.radius),b.push("<circle ",'cx="'+d+'" cy="'+c+'" ','r="',this.radius,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform()," ",this.getSvgTransformMatrix(),'"/>\n')):b.push('<path d="M '+Math.cos(this.startAngle)*
this.radius+" "+Math.sin(this.startAngle)*this.radius," A "+this.radius+" "+this.radius," 0 ",+(e>g?1:0)+" 1"," "+Math.cos(this.endAngle)*this.radius+" "+Math.sin(this.endAngle)*this.radius,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform()," ",this.getSvgTransformMatrix(),'"/>\n');return a?a(b.join("")):b.join("")},_render:function(a,b){a.beginPath();a.arc(b?this.left+this.radius:0,b?this.top+this.radius:0,this.radius,this.startAngle,this.endAngle,!1);this._renderFill(a);this._renderStroke(a)},
getRadiusX:function(){return this.get("radius")*this.get("scaleX")},getRadiusY:function(){return this.get("radius")*this.get("scaleY")},setRadius:function(a){this.radius=a;this.set("width",2*a).set("height",2*a)},complexity:function(){return 1}}),e.Circle.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat(["cx","cy","r"]),e.Circle.fromElement=function(a,b){b||(b={});var d=e.parseAttributes(a,e.Circle.ATTRIBUTE_NAMES);if(!("radius"in d&&0<=d.radius))throw Error("value of `r` attribute is required and can not be negative");
d.left=d.left||0;d.top=d.top||0;d=new e.Circle(c(d,b));d.left-=d.radius;d.top-=d.radius;return d},e.Circle.fromObject=function(a){return new e.Circle(a)})})("undefined"!==typeof h?h:this);(function(f){var e=f.fabric||(f.fabric={});e.Triangle?e.warn("fabric.Triangle is already defined"):(e.Triangle=e.util.createClass(e.Object,{type:"triangle",initialize:function(e){e=e||{};this.callSuper("initialize",e);this.set("width",e.width||100).set("height",e.height||100)},_render:function(e){var c=this.width/
2,a=this.height/2;e.beginPath();e.moveTo(-c,a);e.lineTo(0,-a);e.lineTo(c,a);e.closePath();this._renderFill(e);this._renderStroke(e)},_renderDashedStroke:function(g){var c=this.width/2,a=this.height/2;g.beginPath();e.util.drawDashedLine(g,-c,a,0,-a,this.strokeDashArray);e.util.drawDashedLine(g,0,-a,c,a,this.strokeDashArray);e.util.drawDashedLine(g,c,a,-c,a,this.strokeDashArray);g.closePath()},toSVG:function(e){var c=this._createBaseSVGMarkup(),a=this.width/2,b=this.height/2,a=[-a+" "+b,"0 "+-b,a+" "+
b].join();c.push("<polygon ",'points="',a,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),'"/>');return e?e(c.join("")):c.join("")},complexity:function(){return 1}}),e.Triangle.fromObject=function(g){return new e.Triangle(g)})})("undefined"!==typeof h?h:this);(function(f){var e=f.fabric||(f.fabric={}),g=2*Math.PI,c=e.util.object.extend;e.Ellipse?e.warn("fabric.Ellipse is already defined."):(e.Ellipse=e.util.createClass(e.Object,{type:"ellipse",rx:0,ry:0,initialize:function(a){a=
a||{};this.callSuper("initialize",a);this.set("rx",a.rx||0);this.set("ry",a.ry||0)},_set:function(a,b){this.callSuper("_set",a,b);switch(a){case "rx":this.rx=b;this.set("width",2*b);break;case "ry":this.ry=b,this.set("height",2*b)}return this},getRx:function(){return this.get("rx")*this.get("scaleX")},getRy:function(){return this.get("ry")*this.get("scaleY")},toObject:function(a){return c(this.callSuper("toObject",a),{rx:this.get("rx"),ry:this.get("ry")})},toSVG:function(a){var b=this._createBaseSVGMarkup(),
d=0,c=0;this.group&&"path-group"===this.group.type&&(d=this.left+this.rx,c=this.top+this.ry);b.push("<ellipse ",'cx="',d,'" cy="',c,'" ','rx="',this.rx,'" ry="',this.ry,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'"/>\n');return a?a(b.join("")):b.join("")},_render:function(a,b){a.beginPath();a.save();a.transform(1,0,0,this.ry/this.rx,0,0);a.arc(b?this.left+this.rx:0,b?(this.top+this.ry)*this.rx/this.ry:0,this.rx,0,g,!1);a.restore();this._renderFill(a);
this._renderStroke(a)},complexity:function(){return 1}}),e.Ellipse.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat(["cx","cy","rx","ry"]),e.Ellipse.fromElement=function(a,b){b||(b={});var d=e.parseAttributes(a,e.Ellipse.ATTRIBUTE_NAMES);d.left=d.left||0;d.top=d.top||0;d=new e.Ellipse(c(d,b));d.top-=d.ry;d.left-=d.rx;return d},e.Ellipse.fromObject=function(a){return new e.Ellipse(a)})})("undefined"!==typeof h?h:this);(function(f){var e=f.fabric||(f.fabric={}),g=e.util.object.extend;e.Rect?console.warn("fabric.Rect is already defined"):
(f=e.Object.prototype.stateProperties.concat(),f.push("rx","ry","x","y"),e.Rect=e.util.createClass(e.Object,{stateProperties:f,type:"rect",rx:0,ry:0,strokeDashArray:null,initialize:function(c){c=c||{};this.callSuper("initialize",c);this._initRxRy()},_initRxRy:function(){this.rx&&!this.ry?this.ry=this.rx:this.ry&&!this.rx&&(this.rx=this.ry)},_render:function(c,a){if(1===this.width&&1===this.height)c.fillRect(0,0,1,1);else{var b=this.rx?Math.min(this.rx,this.width/2):0,d=this.ry?Math.min(this.ry,this.height/
2):0,e=this.width,f=this.height,g=a?this.left:-this.width/2,h=a?this.top:-this.height/2,l=0!==b||0!==d;c.beginPath();c.moveTo(g+b,h);c.lineTo(g+e-b,h);l&&c.bezierCurveTo(g+e-.4477152502*b,h,g+e,h+.4477152502*d,g+e,h+d);c.lineTo(g+e,h+f-d);l&&c.bezierCurveTo(g+e,h+f-.4477152502*d,g+e-.4477152502*b,h+f,g+e-b,h+f);c.lineTo(g+b,h+f);l&&c.bezierCurveTo(g+.4477152502*b,h+f,g,h+f-.4477152502*d,g,h+f-d);c.lineTo(g,h+d);l&&c.bezierCurveTo(g,h+.4477152502*d,g+.4477152502*b,h,g+b,h);c.closePath();this._renderFill(c);
this._renderStroke(c)}},_renderDashedStroke:function(c){var a=-this.width/2,b=-this.height/2,d=this.width,k=this.height;c.beginPath();e.util.drawDashedLine(c,a,b,a+d,b,this.strokeDashArray);e.util.drawDashedLine(c,a+d,b,a+d,b+k,this.strokeDashArray);e.util.drawDashedLine(c,a+d,b+k,a,b+k,this.strokeDashArray);e.util.drawDashedLine(c,a,b+k,a,b,this.strokeDashArray);c.closePath()},toObject:function(c){c=g(this.callSuper("toObject",c),{rx:this.get("rx")||0,ry:this.get("ry")||0});this.includeDefaultValues||
this._removeDefaultValues(c);return c},toSVG:function(c){var a=this._createBaseSVGMarkup(),b=this.left,d=this.top;this.group&&"path-group"===this.group.type||(b=-this.width/2,d=-this.height/2);a.push("<rect ",'x="',b,'" y="',d,'" rx="',this.get("rx"),'" ry="',this.get("ry"),'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'"/>\n');return c?c(a.join("")):a.join("")},complexity:function(){return 1}}),
e.Rect.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat("x y rx ry width height".split(" ")),e.Rect.fromElement=function(c,a){if(!c)return null;a=a||{};var b=e.parseAttributes(c,e.Rect.ATTRIBUTE_NAMES);b.left=b.left||0;b.top=b.top||0;b=new e.Rect(g(a?e.util.object.clone(a):{},b));b.visible=0<b.width&&0<b.height;return b},e.Rect.fromObject=function(c){return new e.Rect(c)})})("undefined"!==typeof h?h:this);(function(f){var e=f.fabric||(f.fabric={});e.Polyline?e.warn("fabric.Polyline is already defined"):
(e.Polyline=e.util.createClass(e.Object,{type:"polyline",points:null,minX:0,minY:0,initialize:function(g,c){return e.Polygon.prototype.initialize.call(this,g,c)},_calcDimensions:function(){return e.Polygon.prototype._calcDimensions.call(this)},_applyPointOffset:function(){return e.Polygon.prototype._applyPointOffset.call(this)},toObject:function(g){return e.Polygon.prototype.toObject.call(this,g)},toSVG:function(g){return e.Polygon.prototype.toSVG.call(this,g)},_render:function(g){e.Polygon.prototype.commonRender.call(this,
g)&&(this._renderFill(g),this._renderStroke(g))},_renderDashedStroke:function(g){var c,a;g.beginPath();for(var b=0,d=this.points.length;b<d;b++)c=this.points[b],a=this.points[b+1]||c,e.util.drawDashedLine(g,c.x,c.y,a.x,a.y,this.strokeDashArray)},complexity:function(){return this.get("points").length}}),e.Polyline.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat(),e.Polyline.fromElement=function(g,c){if(!g)return null;c||(c={});var a=e.parsePointsAttribute(g.getAttribute("points")),b=e.parseAttributes(g,
e.Polyline.ATTRIBUTE_NAMES);return new e.Polyline(a,e.util.object.extend(b,c))},e.Polyline.fromObject=function(g){return new e.Polyline(g.points,g,!0)})})("undefined"!==typeof h?h:this);(function(f){var e=f.fabric||(f.fabric={}),g=e.util.object.extend,c=e.util.array.min,a=e.util.array.max,b=e.util.toFixed;e.Polygon?e.warn("fabric.Polygon is already defined"):(e.Polygon=e.util.createClass(e.Object,{type:"polygon",points:null,minX:0,minY:0,initialize:function(a,b){b=b||{};this.points=a||[];this.callSuper("initialize",
b);this._calcDimensions();"top"in b||(this.top=this.minY);"left"in b||(this.left=this.minX)},_calcDimensions:function(){var d=this.points,b=c(d,"x"),e=c(d,"y"),f=a(d,"x"),d=a(d,"y");this.width=f-b||0;this.height=d-e||0;this.minX=b||0;this.minY=e||0},_applyPointOffset:function(){this.points.forEach(function(a){a.x-=this.minX+this.width/2;a.y-=this.minY+this.height/2},this)},toObject:function(a){return g(this.callSuper("toObject",a),{points:this.points.concat()})},toSVG:function(a){for(var c=[],e=this._createBaseSVGMarkup(),
f=0,g=this.points.length;f<g;f++)c.push(b(this.points[f].x,2),",",b(this.points[f].y,2)," ");e.push("<",this.type," ",'points="',c.join(""),'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform()," ",this.getSvgTransformMatrix(),'"/>\n');return a?a(e.join("")):e.join("")},_render:function(a){this.commonRender(a)&&(this._renderFill(a),this.stroke||this.strokeDashArray)&&(a.closePath(),this._renderStroke(a))},commonRender:function(a){var b,c=this.points.length;if(!c||isNaN(this.points[c-
1].y))return!1;a.beginPath();this._applyPointOffset&&(this.group&&"path-group"===this.group.type||this._applyPointOffset(),this._applyPointOffset=null);a.moveTo(this.points[0].x,this.points[0].y);for(var e=0;e<c;e++)b=this.points[e],a.lineTo(b.x,b.y);return!0},_renderDashedStroke:function(a){e.Polyline.prototype._renderDashedStroke.call(this,a);a.closePath()},complexity:function(){return this.points.length}}),e.Polygon.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat(),e.Polygon.fromElement=function(a,
b){if(!a)return null;b||(b={});var c=e.parsePointsAttribute(a.getAttribute("points")),f=e.parseAttributes(a,e.Polygon.ATTRIBUTE_NAMES);return new e.Polygon(c,g(f,b))},e.Polygon.fromObject=function(a){return new e.Polygon(a.points,a,!0)})})("undefined"!==typeof h?h:this);(function(f){var e=f.fabric||(f.fabric={}),g=e.util.array.min,c=e.util.array.max,a=e.util.object.extend,b=Object.prototype.toString,d=e.util.drawArc,k={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},h={m:"l",M:"L"};e.Path?e.warn("fabric.Path is already defined"):
(e.Path=e.util.createClass(e.Object,{type:"path",path:null,minX:0,minY:0,initialize:function(a,d){d=d||{};this.setOptions(d);if(!a)throw Error("`path` argument is required");var c="[object Array]"===b.call(a);if(this.path=c?a:a.match&&a.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi))c||(this.path=this._parsePath()),this._setPositionDimensions(),d.sourcePath&&this.setSourcePath(d.sourcePath)},_setPositionDimensions:function(){var a=this._parseDimensions();this.minX=a.left;this.minY=a.top;this.width=a.width;
this.height=a.height;a.left+="center"===this.originX?this.width/2:"right"===this.originX?this.width:0;a.top+="center"===this.originY?this.height/2:"bottom"===this.originY?this.height:0;this.top=this.top||a.top;this.left=this.left||a.left;this.pathOffset=this.pathOffset||{x:this.minX+this.width/2,y:this.minY+this.height/2}},_render:function(a){var b,c=null,e=0,k=0,f=0,g=0,h=0,q=0,l,m,n=-this.pathOffset.x,p=-this.pathOffset.y;this.group&&"path-group"===this.group.type&&(p=n=0);a.beginPath();for(var r=
0,t=this.path.length;r<t;++r){b=this.path[r];switch(b[0]){case "l":f+=b[1];g+=b[2];a.lineTo(f+n,g+p);break;case "L":f=b[1];g=b[2];a.lineTo(f+n,g+p);break;case "h":f+=b[1];a.lineTo(f+n,g+p);break;case "H":f=b[1];a.lineTo(f+n,g+p);break;case "v":g+=b[1];a.lineTo(f+n,g+p);break;case "V":g=b[1];a.lineTo(f+n,g+p);break;case "m":f+=b[1];g+=b[2];e=f;k=g;a.moveTo(f+n,g+p);break;case "M":f=b[1];g=b[2];e=f;k=g;a.moveTo(f+n,g+p);break;case "c":l=f+b[5];m=g+b[6];h=f+b[3];q=g+b[4];a.bezierCurveTo(f+b[1]+n,g+b[2]+
p,h+n,q+p,l+n,m+p);f=l;g=m;break;case "C":f=b[5];g=b[6];h=b[3];q=b[4];a.bezierCurveTo(b[1]+n,b[2]+p,h+n,q+p,f+n,g+p);break;case "s":l=f+b[3];m=g+b[4];null===c[0].match(/[CcSs]/)?(h=f,q=g):(h=2*f-h,q=2*g-q);a.bezierCurveTo(h+n,q+p,f+b[1]+n,g+b[2]+p,l+n,m+p);h=f+b[1];q=g+b[2];f=l;g=m;break;case "S":l=b[3];m=b[4];null===c[0].match(/[CcSs]/)?(h=f,q=g):(h=2*f-h,q=2*g-q);a.bezierCurveTo(h+n,q+p,b[1]+n,b[2]+p,l+n,m+p);f=l;g=m;h=b[1];q=b[2];break;case "q":l=f+b[3];m=g+b[4];h=f+b[1];q=g+b[2];a.quadraticCurveTo(h+
n,q+p,l+n,m+p);f=l;g=m;break;case "Q":l=b[3];m=b[4];a.quadraticCurveTo(b[1]+n,b[2]+p,l+n,m+p);f=l;g=m;h=b[1];q=b[2];break;case "t":l=f+b[1];m=g+b[2];null===c[0].match(/[QqTt]/)?(h=f,q=g):(h=2*f-h,q=2*g-q);a.quadraticCurveTo(h+n,q+p,l+n,m+p);f=l;g=m;break;case "T":l=b[1];m=b[2];null===c[0].match(/[QqTt]/)?(h=f,q=g):(h=2*f-h,q=2*g-q);a.quadraticCurveTo(h+n,q+p,l+n,m+p);f=l;g=m;break;case "a":d(a,f+n,g+p,[b[1],b[2],b[3],b[4],b[5],b[6]+f+n,b[7]+g+p]);f+=b[6];g+=b[7];break;case "A":d(a,f+n,g+p,[b[1],b[2],
b[3],b[4],b[5],b[6]+n,b[7]+p]);f=b[6];g=b[7];break;case "z":case "Z":f=e,g=k,a.closePath()}c=b}this._renderFill(a);this._renderStroke(a)},toString:function(){return"#<fabric.Path ("+this.complexity()+'): { "top": '+this.top+', "left": '+this.left+" }>"},toObject:function(d){d=a(this.callSuper("toObject",d),{path:this.path.map(function(a){return a.slice()}),pathOffset:this.pathOffset});this.sourcePath&&(d.sourcePath=this.sourcePath);this.transformMatrix&&(d.transformMatrix=this.transformMatrix);return d},
toDatalessObject:function(a){a=this.toObject(a);this.sourcePath&&(a.path=this.sourcePath);delete a.sourcePath;return a},toSVG:function(a){for(var d=[],b=this._createBaseSVGMarkup(),c="",e=0,k=this.path.length;e<k;e++)d.push(this.path[e].join(" "));d=d.join(" ");this.group&&"path-group"===this.group.type||(c=" translate("+-this.pathOffset.x+", "+-this.pathOffset.y+") ");b.push("<path ",'d="',d,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),c,this.getSvgTransformMatrix(),'" stroke-linecap="round" ',
"/>\n");return a?a(b.join("")):b.join("")},complexity:function(){return this.path.length},_parsePath:function(){for(var a=[],d=[],b,c,e=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:e[-+]?\d+)?)/ig,f,g=0,l=this.path.length;g<l;g++){b=this.path[g];f=b.slice(1).trim();for(d.length=0;c=e.exec(f);)d.push(c[0]);b=[b.charAt(0)];f=0;for(var m=d.length;f<m;f++)c=parseFloat(d[f]),isNaN(c)||b.push(c);c=b[0];f=k[c.toLowerCase()];m=h[c]||c;if(b.length-1>f)for(var n=1,p=b.length;n<p;n+=f)a.push([c].concat(b.slice(n,n+
f))),c=m;else a.push(b)}return a},_parseDimensions:function(){for(var a=[],d=[],b,k=null,f=0,h=0,q=0,l=0,m=0,n=0,p,r,t,x=0,C=this.path.length;x<C;++x){b=this.path[x];switch(b[0]){case "l":q+=b[1];l+=b[2];t=[];break;case "L":q=b[1];l=b[2];t=[];break;case "h":q+=b[1];t=[];break;case "H":q=b[1];t=[];break;case "v":l+=b[1];t=[];break;case "V":l=b[1];t=[];break;case "m":q+=b[1];l+=b[2];f=q;h=l;t=[];break;case "M":q=b[1];l=b[2];f=q;h=l;t=[];break;case "c":p=q+b[5];r=l+b[6];m=q+b[3];n=l+b[4];t=e.util.getBoundsOfCurve(q,
l,q+b[1],l+b[2],m,n,p,r);q=p;l=r;break;case "C":q=b[5];l=b[6];m=b[3];n=b[4];t=e.util.getBoundsOfCurve(q,l,b[1],b[2],m,n,q,l);break;case "s":p=q+b[3];r=l+b[4];null===k[0].match(/[CcSs]/)?(m=q,n=l):(m=2*q-m,n=2*l-n);t=e.util.getBoundsOfCurve(q,l,m,n,q+b[1],l+b[2],p,r);m=q+b[1];n=l+b[2];q=p;l=r;break;case "S":p=b[3];r=b[4];null===k[0].match(/[CcSs]/)?(m=q,n=l):(m=2*q-m,n=2*l-n);t=e.util.getBoundsOfCurve(q,l,m,n,b[1],b[2],p,r);q=p;l=r;m=b[1];n=b[2];break;case "q":p=q+b[3];r=l+b[4];m=q+b[1];n=l+b[2];t=
e.util.getBoundsOfCurve(q,l,m,n,m,n,p,r);q=p;l=r;break;case "Q":m=b[1];n=b[2];t=e.util.getBoundsOfCurve(q,l,m,n,m,n,b[3],b[4]);q=b[3];l=b[4];break;case "t":p=q+b[1];r=l+b[2];null===k[0].match(/[QqTt]/)?(m=q,n=l):(m=2*q-m,n=2*l-n);t=e.util.getBoundsOfCurve(q,l,m,n,m,n,p,r);q=p;l=r;break;case "T":p=b[1];r=b[2];null===k[0].match(/[QqTt]/)?(m=q,n=l):(m=2*q-m,n=2*l-n);t=e.util.getBoundsOfCurve(q,l,m,n,m,n,p,r);q=p;l=r;break;case "a":t=e.util.getBoundsOfArc(q,l,b[1],b[2],b[3],b[4],b[5],b[6]+q,b[7]+l);q+=
b[6];l+=b[7];break;case "A":t=e.util.getBoundsOfArc(q,l,b[1],b[2],b[3],b[4],b[5],b[6],b[7]);q=b[6];l=b[7];break;case "z":case "Z":q=f,l=h}k=b;t.forEach(function(b){a.push(b.x);d.push(b.y)});a.push(q);d.push(l)}b=g(a);k=g(d);f=c(a);h=c(d);return{left:b,top:k,width:f-b,height:h-k}}}),e.Path.fromObject=function(a,d){"string"===typeof a.path?e.loadSVGFromURL(a.path,function(b){b=b[0];var c=a.path;delete a.path;e.util.object.extend(b,a);b.setSourcePath(c);d(b)}):d(new e.Path(a.path,a))},e.Path.ATTRIBUTE_NAMES=
e.SHARED_ATTRIBUTES.concat(["d"]),e.Path.fromElement=function(d,b,c){d=e.parseAttributes(d,e.Path.ATTRIBUTE_NAMES);b&&b(new e.Path(d.d,a(d,c)))},e.Path.async=!0)})("undefined"!==typeof h?h:this);(function(f){var e=f.fabric||(f.fabric={}),g=e.util.object.extend,c=e.util.array.invoke,a=e.Object.prototype.toObject;e.PathGroup?e.warn("fabric.PathGroup is already defined"):(e.PathGroup=e.util.createClass(e.Path,{type:"path-group",fill:"",initialize:function(a,d){d=d||{};this.paths=a||[];for(var c=this.paths.length;c--;)this.paths[c].group=
this;d.toBeParsed&&(this.parseDimensionsFromPaths(d),delete d.toBeParsed);this.setOptions(d);this.setCoords();d.sourcePath&&this.setSourcePath(d.sourcePath)},parseDimensionsFromPaths:function(a){for(var d,c,f=[],g=[],h,l=this.transformMatrix,m=this.paths.length;m--;)for(d=this.paths[m],c=d.height+d.strokeWidth,h=d.width+d.strokeWidth,d=[{x:d.left,y:d.top},{x:d.left+h,y:d.top},{x:d.left,y:d.top+c},{x:d.left+h,y:d.top+c}],h=0;h<d.length;h++)c=d[h],l&&(c=e.util.transformPoint(c,l,!1)),f.push(c.x),g.push(c.y);
a.width=Math.max.apply(null,f);a.height=Math.max.apply(null,g)},render:function(a){if(this.visible){a.save();this.transformMatrix&&a.transform.apply(a,this.transformMatrix);this.transform(a);this._setShadow(a);this.clipTo&&e.util.clipContext(this,a);a.translate(-this.width/2,-this.height/2);for(var d=0,c=this.paths.length;d<c;++d)this.paths[d].render(a,!0);this.clipTo&&a.restore();this._removeShadow(a);a.restore()}},_set:function(a,d){if("fill"===a&&d&&this.isSameColor())for(var c=this.paths.length;c--;)this.paths[c]._set(a,
d);return this.callSuper("_set",a,d)},toObject:function(b){b=g(a.call(this,b),{paths:c(this.getObjects(),"toObject",b)});this.sourcePath&&(b.sourcePath=this.sourcePath);return b},toDatalessObject:function(a){a=this.toObject(a);this.sourcePath&&(a.paths=this.sourcePath);return a},toSVG:function(a){for(var d=this.getObjects(),c=this.getPointByOrigin("left","top"),c="translate("+c.x+" "+c.y+")",c=["<g ",'style="',this.getSvgStyles(),'" ','transform="',this.getSvgTransformMatrix(),c,this.getSvgTransform(),
'" ',">\n"],e=0,f=d.length;e<f;e++)c.push(d[e].toSVG(a));c.push("</g>\n");return a?a(c.join("")):c.join("")},toString:function(){return"#<fabric.PathGroup ("+this.complexity()+"): { top: "+this.top+", left: "+this.left+" }>"},isSameColor:function(){var a=(this.getObjects()[0].get("fill")||"").toLowerCase();return this.getObjects().every(function(d){return(d.get("fill")||"").toLowerCase()===a})},complexity:function(){return this.paths.reduce(function(a,d){return a+(d&&d.complexity?d.complexity():0)},
0)},getObjects:function(){return this.paths}}),e.PathGroup.fromObject=function(a,d){"string"===typeof a.paths?e.loadSVGFromURL(a.paths,function(c){var f=a.paths;delete a.paths;c=e.util.groupSVGElements(c,a,f);d(c)}):e.util.enlivenObjects(a.paths,function(c){delete a.paths;d(new e.PathGroup(c,a))})},e.PathGroup.async=!0)})("undefined"!==typeof h?h:this);(function(f){var e=f.fabric||(f.fabric={}),g=e.util.object.extend,c=e.util.array.min,a=e.util.array.max,b=e.util.array.invoke;if(!e.Group){var d={lockMovementX:!0,
lockMovementY:!0,lockRotation:!0,lockScalingX:!0,lockScalingY:!0,lockUniScaling:!0};e.Group=e.util.createClass(e.Object,e.Collection,{type:"group",initialize:function(a,d){d=d||{};this._objects=a||[];for(var b=this._objects.length;b--;)this._objects[b].group=this;this.originalState={};this.callSuper("initialize");d.originX&&(this.originX=d.originX);d.originY&&(this.originY=d.originY);this._calcBounds();this._updateObjectsCoords();this.callSuper("initialize",d);this.setCoords();this.saveCoords()},
_updateObjectsCoords:function(){this.forEachObject(this._updateObjectCoords,this)},_updateObjectCoords:function(a){var d=a.getLeft(),b=a.getTop(),c=this.getCenterPoint();a.set({originalLeft:d,originalTop:b,left:d-c.x,top:b-c.y});a.setCoords();a.__origHasControls=a.hasControls;a.hasControls=!1},toString:function(){return"#<fabric.Group: ("+this.complexity()+")>"},addWithUpdate:function(a){this._restoreObjectsState();a&&(this._objects.push(a),a.group=this);this.forEachObject(this._setObjectActive,this);
this._calcBounds();this._updateObjectsCoords();return this},_setObjectActive:function(a){a.set("active",!0);a.group=this},removeWithUpdate:function(a){this._moveFlippedObject(a);this._restoreObjectsState();this.forEachObject(this._setObjectActive,this);this.remove(a);this._calcBounds();this._updateObjectsCoords();return this},_onObjectAdded:function(a){a.group=this},_onObjectRemoved:function(a){delete a.group;a.set("active",!1)},delegatedProperties:{fill:!0,opacity:!0,fontFamily:!0,fontWeight:!0,
fontSize:!0,fontStyle:!0,lineHeight:!0,textDecoration:!0,textAlign:!0,backgroundColor:!0},_set:function(a,d){if(a in this.delegatedProperties)for(var b=this._objects.length;b--;)this._objects[b].set(a,d);this.callSuper("_set",a,d)},toObject:function(a){return g(this.callSuper("toObject",a),{objects:b(this._objects,"toObject",a)})},render:function(a){if(this.visible){a.save();this.clipTo&&e.util.clipContext(this,a);this.transform(a);for(var d=0,b=this._objects.length;d<b;d++)this._renderObject(this._objects[d],
a);this.clipTo&&a.restore();a.restore()}},_renderControls:function(a,d){this.callSuper("_renderControls",a,d);for(var b=0,c=this._objects.length;b<c;b++)this._objects[b]._renderControls(a)},_renderObject:function(a,d){var b=a.hasRotatingPoint;a.visible&&(a.hasRotatingPoint=!1,a.render(d),a.hasRotatingPoint=b)},_restoreObjectsState:function(){this._objects.forEach(this._restoreObjectState,this);return this},realizeTransform:function(a){this._moveFlippedObject(a);this._setObjectPosition(a);return a},
_moveFlippedObject:function(a){var d=a.get("originX"),b=a.get("originY"),c=a.getCenterPoint();a.set({originX:"center",originY:"center",left:c.x,top:c.y});this._toggleFlipping(a);c=a.getPointByOrigin(d,b);a.set({originX:d,originY:b,left:c.x,top:c.y});return this},_toggleFlipping:function(a){this.flipX&&(a.toggle("flipX"),a.set("left",-a.get("left")),a.setAngle(-a.getAngle()));this.flipY&&(a.toggle("flipY"),a.set("top",-a.get("top")),a.setAngle(-a.getAngle()))},_restoreObjectState:function(a){this._setObjectPosition(a);
a.setCoords();a.hasControls=a.__origHasControls;delete a.__origHasControls;a.set("active",!1);a.setCoords();delete a.group;return this},_setObjectPosition:function(a){var d=this.getCenterPoint(),b=this._getRotatedLeftTop(a);a.set({angle:a.getAngle()+this.getAngle(),left:d.x+b.left,top:d.y+b.top,scaleX:a.get("scaleX")*this.get("scaleX"),scaleY:a.get("scaleY")*this.get("scaleY")})},_getRotatedLeftTop:function(a){var d=this.getAngle()*(Math.PI/180);return{left:-Math.sin(d)*a.getTop()*this.get("scaleY")+
Math.cos(d)*a.getLeft()*this.get("scaleX"),top:Math.cos(d)*a.getTop()*this.get("scaleY")+Math.sin(d)*a.getLeft()*this.get("scaleX")}},destroy:function(){this._objects.forEach(this._moveFlippedObject,this);return this._restoreObjectsState()},saveCoords:function(){this._originalLeft=this.get("left");this._originalTop=this.get("top");return this},hasMoved:function(){return this._originalLeft!==this.get("left")||this._originalTop!==this.get("top")},setObjectsCoords:function(){this.forEachObject(function(a){a.setCoords()});
return this},_calcBounds:function(a){for(var d=[],b=[],c,e,f=["tr","br","bl","tl"],g=0,h=this._objects.length;g<h;++g){c=this._objects[g];c.setCoords();for(var l=0;l<f.length;l++)e=f[l],d.push(c.oCoords[e].x),b.push(c.oCoords[e].y)}this.set(this._getBounds(d,b,a))},_getBounds:function(d,b,f){var g=e.util.invertTransform(this.getViewportTransform()),h=e.util.transformPoint(new e.Point(c(d),c(b)),g);d=e.util.transformPoint(new e.Point(a(d),a(b)),g);d={width:d.x-h.x||0,height:d.y-h.y||0};f||(d.left=
h.x||0,d.top=h.y||0,"center"===this.originX&&(d.left+=d.width/2),"right"===this.originX&&(d.left+=d.width),"center"===this.originY&&(d.top+=d.height/2),"bottom"===this.originY&&(d.top+=d.height));return d},toSVG:function(a){for(var d=["<g ",'transform="',this.getSvgTransform(),'">\n'],b=0,c=this._objects.length;b<c;b++)d.push(this._objects[b].toSVG(a));d.push("</g>\n");return a?a(d.join("")):d.join("")},get:function(a){if(a in d){if(this[a])return this[a];for(var b=0,c=this._objects.length;b<c;b++)if(this._objects[b][a])return!0;
return!1}return a in this.delegatedProperties?this._objects[0]&&this._objects[0].get(a):this[a]}});e.Group.fromObject=function(a,d){e.util.enlivenObjects(a.objects,function(b){delete a.objects;d&&d(new e.Group(b,a))})};e.Group.async=!0}})("undefined"!==typeof h?h:this);(function(h){var e=f.util.object.extend;h.fabric||(h.fabric={});h.fabric.Image?f.warn("fabric.Image is already defined."):(f.Image=f.util.createClass(f.Object,{type:"image",crossOrigin:"",alignX:"none",alignY:"none",meetOrSlice:"meet",
_lastScaleX:1,_lastScaleY:1,initialize:function(e,c){c||(c={});this.filters=[];this.resizeFilters=[];this.callSuper("initialize",c);this._initElement(e,c);this._initConfig(c);c.filters&&(this.filters=c.filters,this.applyFilters())},getElement:function(){return this._element},setElement:function(e,c,a){this._originalElement=this._element=e;this._initConfig(a);0!==this.filters.length?this.applyFilters(c):c&&c();return this},setCrossOrigin:function(e){this.crossOrigin=e;this._element.crossOrigin=e;return this},
getOriginalSize:function(){var e=this.getElement();return{width:e.width,height:e.height}},_stroke:function(e){e.save();this._setStrokeStyles(e);e.beginPath();e.strokeRect(-this.width/2,-this.height/2,this.width,this.height);e.closePath();e.restore()},_renderDashedStroke:function(e){var c=-this.width/2,a=-this.height/2,b=this.width,d=this.height;e.save();this._setStrokeStyles(e);e.beginPath();f.util.drawDashedLine(e,c,a,c+b,a,this.strokeDashArray);f.util.drawDashedLine(e,c+b,a,c+b,a+d,this.strokeDashArray);
f.util.drawDashedLine(e,c+b,a+d,c,a+d,this.strokeDashArray);f.util.drawDashedLine(e,c,a+d,c,a,this.strokeDashArray);e.closePath();e.restore()},toObject:function(f){return e(this.callSuper("toObject",f),{src:this._originalElement.src||this._originalElement._src,filters:this.filters.map(function(c){return c&&c.toObject()}),crossOrigin:this.crossOrigin,alignX:this.alignX,alignY:this.alignY,meetOrSlice:this.meetOrSlice})},toSVG:function(e){var c=[],a=-this.width/2,b=-this.height/2,d="none";this.group&&
"path-group"===this.group.type&&(a=this.left,b=this.top);"none"!==this.alignX&&"none"!==this.alignY&&(d="x"+this.alignX+"Y"+this.alignY+" "+this.meetOrSlice);c.push('<g transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'">\n','<image xlink:href="',this.getSvgSrc(),'" x="',a,'" y="',b,'" style="',this.getSvgStyles(),'" width="',this.width,'" height="',this.height,'" preserveAspectRatio="',d,'"',"></image>\n");if(this.stroke||this.strokeDashArray)d=this.fill,this.fill=null,c.push("<rect ",
'x="',a,'" y="',b,'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),'"/>\n'),this.fill=d;c.push("</g>\n");return e?e(c.join("")):c.join("")},getSrc:function(){if(this.getElement())return this.getElement().src||this.getElement()._src},setSrc:function(e,c,a){f.util.loadImage(e,function(b){return this.setElement(b,c,a)},this,a&&a.crossOrigin)},toString:function(){return'#<fabric.Image: { src: "'+this.getSrc()+'" }>'},clone:function(e,c){this.constructor.fromObject(this.toObject(c),
e)},applyFilters:function(e,c,a,b){c=c||this.filters;if(a=a||this._originalElement){var d=a,k=f.util.createCanvasElement(),h=f.util.createImage(),l=this;k.width=d.width;k.height=d.height;k.getContext("2d").drawImage(d,0,0,d.width,d.height);if(0===c.length)return this._element=a,e&&e(),k;c.forEach(function(a){a&&a.applyTo(k,a.scaleX||l.scaleX,a.scaleY||l.scaleY);!b&&a&&"Resize"===a.type&&(l.width*=a.scaleX,l.height*=a.scaleY)});h.width=k.width;h.height=k.height;f.isLikelyNode?(h.src=k.toBuffer(void 0,
f.Image.pngCompression),l._element=h,!b&&(l._filteredEl=h),e&&e()):(h.onload=function(){l._element=h;!b&&(l._filteredEl=h);e&&e();h.onload=k=d=null},h.src=k.toDataURL("image/png"));return k}},_render:function(e,c){var a,b,d=this._findMargins(),f;a=c?this.left:-this.width/2;b=c?this.top:-this.height/2;"slice"===this.meetOrSlice&&(e.beginPath(),e.rect(a,b,this.width,this.height),e.clip());!1===this.isMoving&&this.resizeFilters.length&&this._needsResize()?(this._lastScaleX=this.scaleX,this._lastScaleY=
this.scaleY,f=this.applyFilters(null,this.resizeFilters,this._filteredEl||this._originalElement,!0)):f=this._element;f&&e.drawImage(f,a+d.marginX,b+d.marginY,d.width,d.height);this._renderStroke(e)},_needsResize:function(){return this.scaleX!==this._lastScaleX||this.scaleY!==this._lastScaleY},_findMargins:function(){var e=this.width,c=this.height,a=0,b=0;if("none"!==this.alignX||"none"!==this.alignY)e=[this.width/this._element.width,this.height/this._element.height],c="meet"===this.meetOrSlice?Math.min.apply(null,
e):Math.max.apply(null,e),e=this._element.width*c,c*=this._element.height,"Mid"===this.alignX&&(a=(this.width-e)/2),"Max"===this.alignX&&(a=this.width-e),"Mid"===this.alignY&&(b=(this.height-c)/2),"Max"===this.alignY&&(b=this.height-c);return{width:e,height:c,marginX:a,marginY:b}},_resetWidthHeight:function(){var e=this.getElement();this.set("width",e.width);this.set("height",e.height)},_initElement:function(e){this.setElement(f.util.getById(e));f.util.addClass(this.getElement(),f.Image.CSS_CANVAS)},
_initConfig:function(e){e||(e={});this.setOptions(e);this._setWidthHeight(e);this._element&&this.crossOrigin&&(this._element.crossOrigin=this.crossOrigin)},_initFilters:function(e,c){e.filters&&e.filters.length?f.util.enlivenObjects(e.filters,function(a){c&&c(a)},"fabric.Image.filters"):c&&c()},_setWidthHeight:function(e){this.width="width"in e?e.width:this.getElement()?this.getElement().width||0:0;this.height="height"in e?e.height:this.getElement()?this.getElement().height||0:0},complexity:function(){return 1}}),
f.Image.CSS_CANVAS="canvas-img",f.Image.prototype.getSvgSrc=f.Image.prototype.getSrc,f.Image.fromObject=function(e,c){f.util.loadImage(e.src,function(a){f.Image.prototype._initFilters.call(e,e,function(b){e.filters=b||[];b=new f.Image(a,e);c&&c(b)})},null,e.crossOrigin)},f.Image.fromURL=function(e,c,a){f.util.loadImage(e,function(b){c&&c(new f.Image(b,a))},null,a&&a.crossOrigin)},f.Image.ATTRIBUTE_NAMES=f.SHARED_ATTRIBUTES.concat("x y width height preserveAspectRatio xlink:href".split(" ")),f.Image.fromElement=
function(g,c,a){g=f.parseAttributes(g,f.Image.ATTRIBUTE_NAMES);var b="xMidYMid",d="meet",k;g.preserveAspectRatio&&(k=g.preserveAspectRatio.split(" "));k&&k.length&&(d=k.pop(),"meet"!==d&&"slice"!==d?(b=d,d="meet"):k.length&&(b=k.pop()));k="none"!==b?b.slice(1,4):"none";b="none"!==b?b.slice(5,8):"none";g.alignX=k;g.alignY=b;g.meetOrSlice=d;f.Image.fromURL(g["xlink:href"],c,e(a?f.util.object.clone(a):{},g))},f.Image.async=!0,f.Image.pngCompression=1)})("undefined"!==typeof h?h:this);(function(f){var e=
f.fabric||(f.fabric={}),g=e.util.object.extend,c=e.util.object.clone,a=e.util.toFixed,b=e.StaticCanvas.supports("setLineDash");e.Text?e.warn("fabric.Text is already defined"):(f=e.Object.prototype.stateProperties.concat(),f.push("fontFamily","fontWeight","fontSize","text","textDecoration","textAlign","fontStyle","lineHeight","textBackgroundColor"),e.Text=e.util.createClass(e.Object,{_dimensionAffectingProps:{fontSize:!0,fontWeight:!0,fontFamily:!0,fontStyle:!0,lineHeight:!0,stroke:!0,strokeWidth:!0,
text:!0,textAlign:!0},_reNewline:/\r?\n/,type:"text",fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",textDecoration:"",textAlign:"left",fontStyle:"",lineHeight:1.16,textBackgroundColor:"",stateProperties:f,stroke:null,shadow:null,_fontSizeFraction:.25,_fontSizeMult:1.13,initialize:function(a,b){b=b||{};this.text=a;this.__skipDimension=!0;this.setOptions(b);this.__skipDimension=!1;this._initDimensions()},_initDimensions:function(a){if(!this.__skipDimension){a||(a=e.util.createCanvasElement().getContext("2d"),
this._setTextStyles(a));this._textLines=this.text.split(this._reNewline);this._clearCache();var b=this.textAlign;this.textAlign="left";this.width=this._getTextWidth(a);this.textAlign=b;this.height=this._getTextHeight(a)}},toString:function(){return"#<fabric.Text ("+this.complexity()+'): { "text": "'+this.text+'", "fontFamily": "'+this.fontFamily+'" }>'},_render:function(a){this.clipTo&&e.util.clipContext(this,a);this._renderTextBackground(a);this._renderText(a);this._renderTextDecoration(a);this.clipTo&&
a.restore()},_renderText:function(a){a.save();this._translateForTextAlign(a);this._setOpacity(a);this._setShadow(a);this._setupCompositeOperation(a);this._renderTextFill(a);this._renderTextStroke(a);this._restoreCompositeOperation(a);this._removeShadow(a);a.restore()},_translateForTextAlign:function(a){"left"!==this.textAlign&&"justify"!==this.textAlign&&a.translate("center"===this.textAlign?this.width/2:this.width,0)},_setTextStyles:function(a){a.textBaseline="alphabetic";this.skipTextAlign||(a.textAlign=
this.textAlign);a.font=this._getFontDeclaration()},_getTextHeight:function(){return this._textLines.length*this._getHeightOfLine()},_getTextWidth:function(a){for(var b=this._getLineWidth(a,0),c=1,e=this._textLines.length;c<e;c++){var f=this._getLineWidth(a,c);f>b&&(b=f)}return b},_renderChars:function(a,b,c,e,f){b[a](c,e,f)},_renderTextLine:function(a,b,c,e,f,g){f-=this.fontSize*this._fontSizeFraction;if("justify"!==this.textAlign)this._renderChars(a,b,c,e,f,g);else{var h=this._getLineWidth(b,g),
l=this.width;if(l>=h){h=c.split(/\s+/);c=this._getWidthOfWords(b,c,g);for(var l=(l-c)/(h.length-1),m=c=0,n=h.length;m<n;m++)this._renderChars(a,b,h[m],e+c,f,g),c+=b.measureText(h[m]).width+l}else this._renderChars(a,b,c,e,f,g)}},_getWidthOfWords:function(a,b){return a.measureText(b.replace(/\s+/g,"")).width},_getLeftOffset:function(){return-this.width/2},_getTopOffset:function(){return-this.height/2},_renderTextFill:function(a){if(this.fill||this._skipFillStrokeCheck){for(var b=0,c=0,e=this._textLines.length;c<
e;c++){var f=this._getHeightOfLine(a,c),g=f/this.lineHeight;this._renderTextLine("fillText",a,this._textLines[c],this._getLeftOffset(),this._getTopOffset()+b+g,c);b+=f}this.shadow&&!this.shadow.affectStroke&&this._removeShadow(a)}},_renderTextStroke:function(a){if(this.stroke&&0!==this.strokeWidth||this._skipFillStrokeCheck){var c=0;a.save();this.strokeDashArray&&(1&this.strokeDashArray.length&&this.strokeDashArray.push.apply(this.strokeDashArray,this.strokeDashArray),b&&a.setLineDash(this.strokeDashArray));
a.beginPath();for(var e=0,f=this._textLines.length;e<f;e++){var g=this._getHeightOfLine(a,e),h=g/this.lineHeight;this._renderTextLine("strokeText",a,this._textLines[e],this._getLeftOffset(),this._getTopOffset()+c+h,e);c+=g}a.closePath();a.restore()}},_getHeightOfLine:function(){return this.fontSize*this._fontSizeMult*this.lineHeight},_renderTextBackground:function(a){this._renderTextBoxBackground(a);this._renderTextLinesBackground(a)},_renderTextBoxBackground:function(a){this.backgroundColor&&(a.save(),
a.fillStyle=this.backgroundColor,a.fillRect(this._getLeftOffset(),this._getTopOffset(),this.width,this.height),a.restore())},_renderTextLinesBackground:function(a){var b=0,c=this._getHeightOfLine();if(this.textBackgroundColor){a.save();a.fillStyle=this.textBackgroundColor;for(var e=0,f=this._textLines.length;e<f;e++){if(""!==this._textLines[e]){var g=this._getLineWidth(a,e),h=this._getLineLeftOffset(g);a.fillRect(this._getLeftOffset()+h,this._getTopOffset()+b,g,this.fontSize*this._fontSizeMult)}b+=
c}a.restore()}},_getLineLeftOffset:function(a){return"center"===this.textAlign?(this.width-a)/2:"right"===this.textAlign?this.width-a:0},_clearCache:function(){this.__lineWidths=[];this.__lineHeights=[];this.__lineOffsets=[]},_shouldClearCache:function(){var a=!1,b;for(b in this._dimensionAffectingProps)this["__"+b]!==this[b]&&(this["__"+b]=this[b],a=!0);return a},_getLineWidth:function(a,b){if(this.__lineWidths[b])return this.__lineWidths[b];this.__lineWidths[b]=a.measureText(this._textLines[b]).width;
return this.__lineWidths[b]},_renderTextDecoration:function(a){if(this.textDecoration){var b=this.height/2,c=[];-1<this.textDecoration.indexOf("underline")&&c.push(.85);-1<this.textDecoration.indexOf("line-through")&&c.push(.43);-1<this.textDecoration.indexOf("overline")&&c.push(-.12);if(0<c.length){var e,f=0,g,h,l;e=0;for(g=this._textLines.length;e<g;e++){var m=this._getLineWidth(a,e),n=this._getLineLeftOffset(m),p=this._getHeightOfLine(a,e);h=0;for(l=c.length;h<l;h++)a.fillRect(this._getLeftOffset()+
n,f+(this._fontSizeMult-1+c[h])*this.fontSize-b,m,this.fontSize/15);f+=p}}}},_getFontDeclaration:function(){return[e.isLikelyNode?this.fontWeight:this.fontStyle,e.isLikelyNode?this.fontStyle:this.fontWeight,this.fontSize+"px",e.isLikelyNode?'"'+this.fontFamily+'"':this.fontFamily].join(" ")},render:function(a,b){this.visible&&(a.save(),this._setTextStyles(a),this._shouldClearCache()&&this._initDimensions(a),b||this.transform(a),this._setStrokeStyles(a),this._setFillStyles(a),this.transformMatrix&&
a.transform.apply(a,this.transformMatrix),this.group&&"path-group"===this.group.type&&a.translate(this.left,this.top),this._render(a),a.restore())},toObject:function(a){a=g(this.callSuper("toObject",a),{text:this.text,fontSize:this.fontSize,fontWeight:this.fontWeight,fontFamily:this.fontFamily,fontStyle:this.fontStyle,lineHeight:this.lineHeight,textDecoration:this.textDecoration,textAlign:this.textAlign,textBackgroundColor:this.textBackgroundColor});this.includeDefaultValues||this._removeDefaultValues(a);
return a},toSVG:function(a){var b=this._createBaseSVGMarkup(),c=this._getSVGLeftTopOffsets(this.ctx),c=this._getSVGTextAndBg(c.textTop,c.textLeft);this._wrapSVGTextAndBg(b,c);return a?a(b.join("")):b.join("")},_getSVGLeftTopOffsets:function(a){a=this._getHeightOfLine(a,0);return{textLeft:-this.width/2+(this.group&&"path-group"===this.group.type?this.left:0),textTop:0+(this.group&&"path-group"===this.group.type?-this.top:0),lineTop:a}},_wrapSVGTextAndBg:function(a,b){a.push('\t<g transform="',this.getSvgTransform(),
this.getSvgTransformMatrix(),'">\n',b.textBgRects.join(""),"\t\t<text ",this.fontFamily?'font-family="'+this.fontFamily.replace(/"/g,"'")+'" ':"",this.fontSize?'font-size="'+this.fontSize+'" ':"",this.fontStyle?'font-style="'+this.fontStyle+'" ':"",this.fontWeight?'font-weight="'+this.fontWeight+'" ':"",this.textDecoration?'text-decoration="'+this.textDecoration+'" ':"",'style="',this.getSvgStyles(),'" >',b.textSpans.join(""),"</text>\n","\t</g>\n")},_getSVGTextAndBg:function(a,b){var c=[],e=[],f=
0;this._setSVGBg(e);for(var g=0,h=this._textLines.length;g<h;g++)this.textBackgroundColor&&this._setSVGTextLineBg(e,g,b,a,f),this._setSVGTextLineText(g,c,f,b,a,e),f+=this._getHeightOfLine(this.ctx,g);return{textSpans:c,textBgRects:e}},_setSVGTextLineText:function(b,c,f,g,h){f=this.fontSize*(this._fontSizeMult-this._fontSizeFraction)-h+f-this.height/2;c.push('<tspan x="',a(g+this._getLineLeftOffset(this.__lineWidths[b]),4),'" ','y="',a(f,4),'" ',this._getFillAttributes(this.fill),">",e.util.string.escapeXml(this._textLines[b]),
"</tspan>")},_setSVGTextLineBg:function(b,c,e,f,g){b.push("\t\t<rect ",this._getFillAttributes(this.textBackgroundColor),' x="',a(e+this._getLineLeftOffset(this.__lineWidths[c]),4),'" y="',a(g-this.height/2,4),'" width="',a(this.__lineWidths[c],4),'" height="',a(this._getHeightOfLine(this.ctx,c)/this.lineHeight,4),'"></rect>\n')},_setSVGBg:function(b){this.backgroundColor&&b.push("\t\t<rect ",this._getFillAttributes(this.backgroundColor),' x="',a(-this.width/2,4),'" y="',a(-this.height/2,4),'" width="',
a(this.width,4),'" height="',a(this.height,4),'"></rect>\n')},_getFillAttributes:function(a){var b=a&&"string"===typeof a?new e.Color(a):"";return b&&b.getSource()&&1!==b.getAlpha()?'opacity="'+b.getAlpha()+'" fill="'+b.setAlpha(1).toRgb()+'"':'fill="'+a+'"'},_set:function(a,b){this.callSuper("_set",a,b);a in this._dimensionAffectingProps&&(this._initDimensions(),this.setCoords())},complexity:function(){return 1}}),e.Text.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat("x y dx dy font-family font-style font-weight font-size text-decoration text-anchor".split(" ")),
e.Text.DEFAULT_SVG_FONT_SIZE=16,e.Text.fromElement=function(a,b){if(!a)return null;var c=e.parseAttributes(a,e.Text.ATTRIBUTE_NAMES);b=e.util.object.extend(b?e.util.object.clone(b):{},c);b.top=b.top||0;b.left=b.left||0;"dx"in c&&(b.left+=c.dx);"dy"in c&&(b.top+=c.dy);"fontSize"in b||(b.fontSize=e.Text.DEFAULT_SVG_FONT_SIZE);b.originX||(b.originX="left");var c=a.textContent.replace(/^\s+|\s+$|\n+/g,"").replace(/\s+/g," "),c=new e.Text(c,b),f=0;"left"===c.originX&&(f=c.getWidth()/2);"right"===c.originX&&
(f=-c.getWidth()/2);c.set({left:c.getLeft()+f,top:c.getTop()-c.getHeight()/2+c.fontSize*(.18+c._fontSizeFraction)});return c},e.Text.fromObject=function(a){return new e.Text(a.text,c(a))},e.util.createAccessors(e.Text))})("undefined"!==typeof h?h:this);console.dir(f);delete window.fabric;return h}().fabric;h.fabric=m}}});(function(){var h=L(n.org.transcrypt.fabric).fabric,m=new h.Canvas("canvas"),p=new h.Rect({left:100,top:100,fill:"red",width:20,height:20});m.add(p);var f=E("Attribute",[I],{get __init__(){return r(this,
function(a,b){a.game=b;a.game.attributes.append(a);a.install();a.reset()})},get reset(){return r(this,function(a){a.commit()})},get predict(){return r(this,function(a){})},get interact(){return r(this,function(a){})},get commit(){return r(this,function(a){})}}),l=E("Sprite",[f],{get __init__(){return r(this,function(a,b,c,e){a.width=c;a.height=e;f.__init__(a,b)})},get install(){return r(this,function(a){a.image=new h.Rect({width:a.width,height:a.height,originX:"center",originY:"center",fill:"white"})})},
get reset(){return r(this,function(a,b,c,e,g){if("undefined"==typeof a||a.__class__==t)a=0;if("undefined"==typeof b||b.__class__==t)b=0;if("undefined"==typeof c||c.__class__==t)c=0;if("undefined"==typeof e||e.__class__==t)e=0;a.vX=b;a.vY=c;a.x=e;a.y=g;f.reset(a)})},get predict(){return r(this,function(a){a.x=0;a.y=0})},get commit(){return r(this,function(a){var b=a.game.ortho(a.x,a.y);a.image.left=b[0];a.image.top=b[1]})},get draw(){return r(this,function(a){a.game.canvas.add(a.image)})}}),e=E("Paddle",
[l],{get __init__(){return r(this,function(a,b,c){a.index=c;l.__init__(a,b,a.width,a.height)})},get reset(){return r(this,function(a){l.reset(a,t({x:a.index?-1E3+a.margin:Math.floor(1E3)/Math.floor(2)+a.margin,y:0}))})},get predict(){return r(this,function(a){a.vY=0;l.predict(a)})},get interact(){return r(this,function(a){a.y=Math.max(a.height/2,Math.min(a.y,650-a.height/2));if(a.y-Math.floor(a.height)/Math.floor(2)<a.game.ball.y&&a.game.ball.y<a.y+Math.floor(a.height)/Math.floor(2)&&(0==a.index&&
a.game.ball.x<a.x||1==a.index&&a.game.ball.x>a.x)){a.game.ball.x=a.x;a.game.ball.vX=-a.game.ball.vX;var b=1+.5*Math.pow(1-abs(a.game.ball.y-a.y)/Math.floor(a.height)/Math.floor(2),2);a.game.ball.vX*=b;a.game.ball.vY*=b}})}});e.margin=30;e.width=10;e.height=100;e.speed=400;var g=E("Ball",[l],{get __init__(){return r(this,function(a,b){l.__init__(a,b,a.side,a.side)})},get reset(){return r(this,function(a){var b=a.game.serviceIndex*Math.PI+(.5<Math.random()?1:-1)*Math.random()*Math.atan(.65);l.reset(a,
t({vX:a.speed*Math.cos(b),vY:a.speed*Math.sin(b)}))})},get predict(){return r(this,function(a){l.predict(a);0>a.x?a.game.scored(1):1E3<a.x&&a.game.scored(0);650<a.y?(a.y=650,a.vY=-a.vY):0>a.y&&(a.y=0,a.vY=-a.vY)})}});g.side=8;g.speed=300;var c=E("Scoreboard",[f],{get install(){return r(this,function(a){a.image=new h.Line({x1:0,y1:650,x2:1E3,y2:650,fill:"white",stroke:"white",strokeWidth:"5"});a.image.left=Math.floor(a.width)/Math.floor(2);a.image.top=Math.floor(a.height)/Math.floor(2)})},get increment(){return r(this,
function(a,b){a.scores[b]++})},get reset(){return r(this,function(a){a.scores=x([0,0]);f.reset(a)})},get commit(){return r(this,function(a){})},get draw(){return r(this,function(a){a.game.canvas.add(a.image)})}});c.nameShift=75;c.scoreShift=25;var a=E("Game",[I],{get __init__(){return r(this,function(a){a.deltaT=0;a.serviceIndex=.5<Math.random()?1:0;a.pause=!0;a.canvas=new h.Canvas("canvas",{backgroundColor:"black",originX:"center",originY:"center"});a.canvas.onWindowResise=a.resize;a.canvas.onWindowDraw=
a.draw;a.canvas.lineWidth=2;a.canvas.clear();a.attributes=x([]);a.ball=g(a);a.scoreboard=c(a);a.deltaT=1/60;window.setInterval(a.update,a.deltaT);window.setInterval(a.draw,.05)})},get update(){return r(this,function(a){for(var b=a.attributes,c=0;c<b.length;c++){var e=b[c];e.predict()}b=a.attributes;for(c=0;c<b.length;c++)e=b[c],e.interact();b=a.attributes;for(c=0;c<b.length;c++)e=b[c],e.commit()})},get scored(){return r(this,function(a,b){a.scoreboard.increment(b);a.serviceIndex=1-b;for(var c=a.paddles,
e=0;e<c.length;e++)c[e].reset();a.ball.reset();a.pause=!0})},get draw(){return r(this,function(a){a.canvas.clear();a=a.attributes;for(var b=0;b<a.length;b++)a[b].draw()})},get resize(){return r(this,function(a,b,c){a.canvas.scale(b/1E3,c/750)})},get ortho(){return r(this,function(a,b,c){return C(x([(b+Math.floor(1E3)/Math.floor(2))*a.canvas.width/1E3,(750-Math.floor(650)/Math.floor(2)- -325)*a.canvas.height/750]))})}}),b=a();n.Attribute=f;n.Ball=g;n.Game=a;n.Paddle=e;n.Scoreboard=c;n.Sprite=l;n.canvas=
m;n.fieldHeight=650;n.game=b;n.orthoHeight=750;n.orthoWidth=1E3;n.rect=p})();return n}window.pong=pong;
