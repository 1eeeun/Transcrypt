'use strict';function pong(){function P(k,l,p){"undefined"==typeof l&&(l=k,k=0);"undefined"==typeof p&&(p=1);if(0<p&&k>=l||0>p&&k<=l)return[];for(var g=[];0<p?k<l:k>l;k+=p)g.push(k);return g}function U(k){if(null==k||"object"==typeof k)return k;var l={},p;for(p in obj)k.hasOwnProperty(p)&&(l[p]=k[p]);return l}function V(k){if(null==k||"object"==typeof k)return k;var l={},p;for(p in obj)k.hasOwnProperty(p)&&(l[p]=V(k[p]));return l}function y(k){k=k?[].slice.apply(k):[];k.__class__=y;return k}function v(k){k=
k?[].slice.apply(k):[];k.__class__=v;return k}function I(k){var l=[];if(k)for(var p=0;p<k.length;p++)l.add(k[p]);l.__class__=I;return l}function W(){keys=[];for(attrib in this)__normalattrib__(attrib)&&keys.push(key);return keys}function Q(k){var l={};if(k)for(var p=0;p<k.length;p++)l[pair[0]]=pair[1];l.__class__=Q;l.keys=W;return l}function J(k){return new String(k)}var n={},H=function(k,l,p){if(""!=l){l=l.split(".");for(var g=l.length,m=0;m<l.length;m++){if(!k.hasOwnProperty(l[m])){g=m;break}k=
k[l[m]]}for(m=g;m<l.length;m++)k[l[m]]={},k=k[l[m]]}for(var c in p)k[c]=p[c]};n.__nest__=H;var N=function(k){k.__inited__||k.__all__.__init__(k.__all__);return k.__all__};n.__init__=N;var r=function(k,l){return k?k.hasOwnProperty("__class__")||"string"==typeof k||k instanceof String?function(p){p=[].slice.apply(arguments);return l.apply(null,[k].concat(p))}:l:l};n.__get__=r;var C=function(k,l,p){for(var g=function(){var a=[].slice.apply(arguments);return g.__new__(a)},m=l.length-1;0<=m;m--){var c=
l[m],h;for(h in c){var d=Object.getOwnPropertyDescriptor(c,h);Object.defineProperty(g,h,d)}}g.__name__=k;g.__bases__=l;for(h in p)d=Object.getOwnPropertyDescriptor(p,h),Object.defineProperty(g,h,d);return g};n.__class__=C;var K=n.__class__("object",[],{__init__:function(k){},__name__:"object",__bases__:[],__new__:function(k){var l=Object.create(this,{__class__:{value:this,enumerable:!0}});this.__init__.apply(null,[l].concat(k));return l}});n.object=K;n.__pragma__=function(){};H(n,"org.transcrypt.__base__",
{__all__:{__inited__:!1,__init__:function(k){var l=C("__Envir__",[K],{get __init__(){return r(this,function(g){g.transpilerName="transcrypt";g.transpilerVersion="3.5.67";g.targetSubDir="__javascript__"})}}),p=l();k.__Envir__=l;k.__envir__=p}}});H(n,"org.transcrypt.__standard__",{__all__:{__inited__:!1,__init__:function(k){var l=C("Exception",[K],{get __init__(){return r(this,function(g){var m=v([].slice.apply(arguments).slice(1));g.args=m})},get __repr__(){return r(this,function(g){return L(g.args)?
"{}{}".format(g.__class__.__name__,X(v(g.args))):"???"})},get __str__(){return r(this,function(g){return 1<L(g.args)?J(v(g.args)):L(g.args)?J(g.args[0]):"???"})}}),p=function(g,m,c){if("undefined"==typeof m||null!=m&&m.__class__==t)m=null;if("undefined"==typeof c||null!=c&&c.__class__==t)c=!1;if(arguments.length){var h=arguments.length-1;if(arguments[h]&&arguments[h].__class__==t){var h=arguments[h--],d;for(d in h)switch(d){case "iterable":g=h[d];break;case "key":m=h[d];break;case "reverse":c=h[d]}}}m?
g.sort(function(a,b){if(arguments.length){var f=arguments.length-1;if(arguments[f]&&arguments[f].__class__==t){var f=arguments[f--],e;for(e in f)switch(e){case "a":a=f[e];break;case "b":b=f[e]}}}return m(a)>m(b)}):g.sort();c&&g.reverse()};k.Exception=l;k.sort=p;k.sorted=function(g,m,c){if("undefined"==typeof m||null!=m&&m.__class__==t)m=null;if("undefined"==typeof c||null!=c&&c.__class__==t)c=!1;if(arguments.length){var h=arguments.length-1;if(arguments[h]&&arguments[h].__class__==t){var h=arguments[h--],
d;for(d in h)switch(d){case "iterable":g=h[d];break;case "key":m=h[d];break;case "reverse":c=h[d]}}}d=U(g);p(d,m,c);return d}}}});H(n,"",N(n.org.transcrypt.__base__));var Y=n.__envir__;H(n,"",N(n.org.transcrypt.__standard__));Y.executorName=Y.transpilerName;n.main={__file__:""};n.__except__=null;var t=function(k){k.__class__=t;k.constructor=Object;return k};n.___kwargdict__=t;n.property=function(k,l){return{get:function(){return k(this)},set:function(k){l(this,k)},enumerable:!0}};n.__merge__=function(k,
l){var p={},g;for(g in k)p[g]=k[g];for(g in l)p[g]=l[g];return p};var Z=function(){console.log([].slice.apply(arguments).join(" "))};n.print=Z;console.log.apply=function(){Z([].slice.apply(arguments).slice(1))};var F=function(k,l){return-1<l.indexOf(k)};n.__in__=F;var R=function(k){return k.startswith("__")&&k.endswith("__")||"constructor"==k};n.__specialattrib__=R;var L=function(k){try{return k.length}catch(l){result=0;for(attrib in k)R(attrib)||result++;return result}};n.len=L;var aa={__name__:"bool"};
n.bool=aa;var S=function(k){return k|0};S.__name__="int";n.int=S;var ba={__name__:"float"};n.float=ba;n.type=function(k){try{return k.__class__}catch(p){var l=typeof k;return"boolean"==l?aa:"number"==l?0==k%1?S:ba:l}};n.isinstance=function(k,l){function p(g){if(g==l)return!0;for(var m=0;m<g.__bases__.length;m++)if(p(g.__bases__[m],l))return!0;return!1}return p(k.__class__)};var X=function(k){try{return k.__repr__()}catch(c){try{return k.__str__()}catch(h){try{if(k.constructor==Object){var l="{",p=
!1,g;for(g in k)if(!R(g)){var m=g.isnumeric()?g:"'"+g+"'";p?l+=", ":p=!0;try{l+=m+": "+k[g].__repr__()}catch(d){l+=m+": "+k[g].toString()}}return l+"}"}return"boolean"==typeof k?k.toString().capitalize():k.toString()}catch(d){return console.log("ERROR: Could not evaluate repr (<object of type "+typeof k+">)"),"???"}}}};n.repr=X;n.chr=function(k){return String.fromCharCode(k)};var M=function(k){return k.charCodeAt(0)};n.org=M;var O=function(){var k=[].slice.call(arguments);return(0==k.length?[]:k.reduce(function(k,
p){return k.length<p.length?k:p})).map(function(l,p){return k.map(function(g){return g[p]})})};n.zip=O;n.range=P;n.enumerate=function(k){return O(P(L(k)),k)};n.copy=U;n.deepcopy=V;n.list=y;Array.prototype.__class__=y;y.__name__="list";Array.prototype.__getslice__=function(k,l,p){0>k&&(k=this.length+1-k);null==l?l=this.length:0>l&&(l=this.length+1-l);for(var g=[];k<l;k+=p)g.push(this[k]);return g};Array.prototype.__repr__=function(){if(this.__class__==I&&!this.length)return"set()";for(var k=this.__class__&&
this.__class__!=y?this.__class__==v?"(":"{":"[",l=0;l<this.length;l++){l&&(k+=", ");try{k+=this[l].__repr__()}catch(p){k+=this[l].toString()}}this.__class__==v&&1==this.length&&(k+=",");return k+=this.__class__&&this.__class__!=y?this.__class__==v?")":"}":"]"};Array.prototype.__setslice__=function(k,l,p,g){0>k&&(k=this.length+1-k);null==l?l=this.length:0>l&&(l=this.length+1-l);if(null==p)Array.prototype.splice.apply(this,[k,l-k].concat(g));else for(var m=0;k<l;k+=p)this[k]=g[m++]};Array.prototype.__str__=
Array.prototype.__repr__;Array.prototype.append=function(k){this.push(k)};Array.prototype.clear=function(k){k.splice(0,k.length)};Array.prototype.extend=function(k){this.push.apply(this,k)};n.tuple=v;v.__name__="tuple";n.set=I;I.__name__="set";Array.prototype.add=function(k){-1==this.indexOf(k)&&this.push(k)};Array.prototype.remove=function(k){k=this.indexOf(k);-1!=k&&this.splice(k,1)};n.__keys__=W;n.dict=Q;Q.__name__="dict";n.str=J;String.prototype.__class__=J;J.__name__="str";String.prototype.__repr__=
function(){return(-1==this.indexOf("'")?"'"+this+"'":'"'+this+'"').replace("\n","\\n")};String.prototype.__str__=function(){return this};String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.slice(1)};String.prototype.endswith=function(k){return""==k||this.slice(-k.length)==k};String.prototype.find=function(k,l){return this.indexOf(k,l)};Object.defineProperty(String.prototype,"format",{get:function(){return r(this,function(k){var l=v([].slice.apply(arguments).slice(1)),p=
0;return k.replace(/\{(\w*)\}/g,function(g,m){""==m&&(m=p++);if(m==+m)return"undefined"==l[m]?g:l[m];for(var c=0;c<l.length;c++)if("object"==typeof l[c]&&"undefined"!=typeof l[c][m])return l[c][m];return g})})},enumerable:!0});String.prototype.isnumeric=function(){return!isNaN(parseFloat(this))&&isFinite(this)};String.prototype.join=function(k){return k.join(this)};String.prototype.jsSplit=String.prototype.split;String.prototype.lower=function(){return this.toLowerCase()};String.prototype.lstrip=
function(){return this.replace(/^\s*/g,"")};String.prototype.rfind=function(k,l){return this.lastIndexOf(k,l)};String.prototype.rsplit=function(k,l){var p=this.split(k||/s+/);return l?[p.slice(0,-l).join(k)].concat(p.slice(-l)):p};String.prototype.rstrip=function(){return this.replace(/\s*$/g,"")};String.prototype.split=function(k,l){k||(k=" ");return this.jsSplit(k||/s+/,l)};String.prototype.startswith=function(k){return 0==this.indexOf(k)};String.prototype.strip=function(){return this.trim()};String.prototype.upper=
function(){return this.toUpperCase()};H(n,"com.fabricjs",{__all__:{__inited__:!1,__init__:function(k){var l=function(){var k={},g=g||{version:"1.5.0"};"undefined"!==typeof k&&(k.fabric=g);"undefined"!==typeof document&&"undefined"!==typeof window?(g.document=document,g.window=window,window.fabric=g):(g.document=require("jsdom").jsdom("<!DOCTYPE html><html><head></head><body></body></html>"),g.window=g.document.createWindow?g.document.createWindow():g.document.parentWindow);g.isTouchSupported="ontouchstart"in
g.document.documentElement;g.isLikelyNode="undefined"!==typeof Buffer&&"undefined"===typeof window;g.SHARED_ATTRIBUTES="display transform fill fill-opacity fill-rule opacity stroke stroke-dasharray stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width".split(" ");g.DPI=96;g.reNum="(?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:e[-+]?\\d+)?)";(function(){function m(a,b){this.__eventListeners[a]&&(b?g.util.removeFromArray(this.__eventListeners[a],b):this.__eventListeners[a].length=0)}function c(a,
b){this.__eventListeners||(this.__eventListeners={});if(1===arguments.length)for(var f in a)this.on(f,a[f]);else this.__eventListeners[a]||(this.__eventListeners[a]=[]),this.__eventListeners[a].push(b);return this}function h(a,b){if(this.__eventListeners){if(0===arguments.length)this.__eventListeners={};else if(1===arguments.length&&"object"===typeof arguments[0])for(var f in a)m.call(this,f,a[f]);else m.call(this,a,b);return this}}function d(a,b){if(this.__eventListeners){var f=this.__eventListeners[a];
if(f){for(var e=0,d=f.length;e<d;e++)f[e].call(this,b||{});return this}}}g.Observable={observe:c,stopObserving:h,fire:d,on:c,off:h,trigger:d}})();g.Collection={add:function(){this._objects.push.apply(this._objects,arguments);for(var g=0,c=arguments.length;g<c;g++)this._onObjectAdded(arguments[g]);this.renderOnAddRemove&&this.renderAll();return this},insertAt:function(g,c,h){var d=this.getObjects();h?d[c]=g:d.splice(c,0,g);this._onObjectAdded(g);this.renderOnAddRemove&&this.renderAll();return this},
remove:function(){for(var g=this.getObjects(),c,h=0,d=arguments.length;h<d;h++)c=g.indexOf(arguments[h]),-1!==c&&(g.splice(c,1),this._onObjectRemoved(arguments[h]));this.renderOnAddRemove&&this.renderAll();return this},forEachObject:function(g,c){for(var h=this.getObjects(),d=h.length;d--;)g.call(c,h[d],d,h);return this},getObjects:function(g){return"undefined"===typeof g?this._objects:this._objects.filter(function(c){return c.type===g})},item:function(g){return this.getObjects()[g]},isEmpty:function(){return 0===
this.getObjects().length},size:function(){return this.getObjects().length},contains:function(g){return-1<this.getObjects().indexOf(g)},complexity:function(){return this.getObjects().reduce(function(g,c){return g+=c.complexity?c.complexity():0},0)}};(function(m){var c=Math.sqrt,h=Math.atan2,d=Math.PI/180;g.util={removeFromArray:function(a,b){var f=a.indexOf(b);-1!==f&&a.splice(f,1);return a},getRandomInt:function(a,b){return Math.floor(Math.random()*(b-a+1))+a},degreesToRadians:function(a){return a*
d},radiansToDegrees:function(a){return a/d},rotatePoint:function(a,b,f){var e=Math.sin(f);f=Math.cos(f);a.subtractEquals(b);return(new g.Point(a.x*f-a.y*e,a.x*e+a.y*f)).addEquals(b)},transformPoint:function(a,b,f){return f?new g.Point(b[0]*a.x+b[2]*a.y,b[1]*a.x+b[3]*a.y):new g.Point(b[0]*a.x+b[2]*a.y+b[4],b[1]*a.x+b[3]*a.y+b[5])},invertTransform:function(a){var b=a.slice(),b=1/(a[0]*a[3]-a[1]*a[2]),b=[b*a[3],-b*a[1],-b*a[2],b*a[0],0,0];a=g.util.transformPoint({x:a[4],y:a[5]},b);b[4]=-a.x;b[5]=-a.y;
return b},toFixed:function(a,b){return parseFloat(Number(a).toFixed(b))},parseUnit:function(a,b){var f=/\D{0,2}$/.exec(a),e=parseFloat(a);b||(b=g.Text.DEFAULT_SVG_FONT_SIZE);switch(f[0]){case "mm":return e*g.DPI/25.4;case "cm":return e*g.DPI/2.54;case "in":return e*g.DPI;case "pt":return e*g.DPI/72;case "pc":return e*g.DPI/72*12;case "em":return e*b;default:return e}},falseFunction:function(){return!1},getKlass:function(a,b){a=g.util.string.camelize(a.charAt(0).toUpperCase()+a.slice(1));return g.util.resolveNamespace(b)[a]},
resolveNamespace:function(a){if(!a)return g;a=a.split(".");for(var b=a.length,f=m||g.window,e=0;e<b;++e)f=f[a[e]];return f},loadImage:function(a,b,f,e){if(a){var d=g.util.createImage();d.onload=function(){b&&b.call(f,d);d=d.onload=d.onerror=null};d.onerror=function(){g.log("Error loading "+d.src);b&&b.call(f,null,!0);d=d.onload=d.onerror=null};0!==a.indexOf("data")&&"undefined"!==typeof e&&(d.crossOrigin=e);d.src=a}else b&&b.call(f,a)},enlivenObjects:function(a,b,f,e){function d(){++h===m&&b&&b(c)}
a=a||[];var c=[],h=0,m=a.length;m?a.forEach(function(a,b){if(a&&a.type){var h=g.util.getKlass(a.type,f);h.async?h.fromObject(a,function(f,h){h||(c[b]=f,e&&e(a,c[b]));d()}):(c[b]=h.fromObject(a),e&&e(a,c[b]),d())}else d()}):b&&b(c)},groupSVGElements:function(a,b,f){a=new g.PathGroup(a,b);"undefined"!==typeof f&&a.setSourcePath(f);return a},populateWithProperties:function(a,b,f){if(f&&"[object Array]"===Object.prototype.toString.call(f))for(var e=0,d=f.length;e<d;e++)f[e]in a&&(b[f[e]]=a[f[e]])},drawDashedLine:function(a,
b,f,e,d,x){e-=b;var g=d-f;d=c(e*e+g*g);e=h(g,e);var g=x.length,m=0,k=!0;a.save();a.translate(b,f);a.moveTo(0,0);a.rotate(e);for(b=0;d>b;)b+=x[m++%g],b>d&&(b=d),a[k?"lineTo":"moveTo"](b,0),k=!k;a.restore()},createCanvasElement:function(a){a||(a=g.document.createElement("canvas"));a.getContext||"undefined"===typeof G_vmlCanvasManager||G_vmlCanvasManager.initElement(a);return a},createImage:function(){return g.isLikelyNode?new (require("canvas").Image):g.document.createElement("img")},createAccessors:function(a){a=
a.prototype;for(var b=a.stateProperties.length;b--;){var f=a.stateProperties[b],e=f.charAt(0).toUpperCase()+f.slice(1),d="set"+e,e="get"+e;a[e]||(a[e]=new Function('return this.get("'+f+'")'));a[d]||(a[d]=new Function("value",'return this.set("'+f+'", value)'))}},clipContext:function(a,b){b.save();b.beginPath();a.clipTo(b);b.clip()},multiplyTransformMatrices:function(a,b){return[a[0]*b[0]+a[2]*b[1],a[1]*b[0]+a[3]*b[1],a[0]*b[2]+a[2]*b[3],a[1]*b[2]+a[3]*b[3],a[0]*b[4]+a[2]*b[5]+a[4],a[1]*b[4]+a[3]*
b[5]+a[5]]},getFunctionBody:function(a){return(String(a).match(/function[^{]*\{([\s\S]*)\}/)||{})[1]},isTransparent:function(a,b,f,e){0<e&&(b=b>e?b-e:0,f=f>e?f-e:0);var d=!0;a=a.getImageData(b,f,2*e||1,2*e||1);b=3;for(f=a.data.length;b<f&&(d=0>=a.data[b],!1!==d);b+=4);return d}}})("undefined"!==typeof k?k:this);(function(){function m(f,b,d,g,m,k,da){var T=e.call(arguments);if(a[T])return a[T];var B=Math.PI,l=da*B/180,G=Math.sin(l),l=Math.cos(l),p=0,D=0;d=Math.abs(d);g=Math.abs(g);var z=-l*f*.5-G*
b*.5,n=-l*b*.5+G*f*.5,r=d*d,w=g*g,E=n*n,u=z*z,t=r*w-r*E-w*u,v=0;0>t?(r=Math.sqrt(1-t/(r*w)),d*=r,g*=r):v=(m===k?-1:1)*Math.sqrt(t/(r*E+w*u));E=v*d*n/g;u=-v*g*z/d;v=l*E-G*u+.5*f;r=G*E+l*u+.5*b;w=h(1,0,(z-E)/d,(n-u)/g);n=h((z-E)/d,(n-u)/g,(-z-E)/d,(-n-u)/g);0===k&&0<n?n-=2*B:1===k&&0>n&&(n+=2*B);B=Math.ceil(Math.abs(n/B*2));z=[];n/=B;E=8/3*Math.sin(n/4)*Math.sin(n/4)/Math.sin(n/2);u=w+n;for(t=0;t<B;t++)z[t]=c(w,u,l,G,d,g,v,r,E,p,D),p=z[t][4],D=z[t][5],w=u,u+=n;return a[T]=z}function c(f,a,d,c,h,g,m,
k,B,l,G){var n=e.call(arguments);if(b[n])return b[n];var p=Math.cos(f),z=Math.sin(f),r=Math.cos(a),t=Math.sin(a),w=d*h*r-c*g*t+m,v=c*h*r+d*g*t+k;b[n]=[l+B*(-d*h*z-c*g*p),G+B*(-c*h*z+d*g*p),w+B*(d*h*t+c*g*r),v+B*(c*h*t-d*g*r),w,v];return b[n]}function h(f,e,a,b){f=Math.atan2(e,f);a=Math.atan2(b,a);return a>=f?a-f:2*Math.PI-(f-a)}function d(a,b,d,c,h,g,m,k){var B=e.call(arguments);if(f[B])return f[B];var l=Math.sqrt,n=Math.min,p=Math.max,D=Math.abs,z=[],r=[[],[]],t,w,v,u,y;w=6*a-12*d+6*h;t=-3*a+9*d-
9*h+3*m;v=3*d-3*a;for(var C=0;2>C;++C)0<C&&(w=6*b-12*c+6*g,t=-3*b+9*c-9*g+3*k,v=3*c-3*b),1E-12>D(t)?1E-12>D(w)||(u=-v/w,0<u&&1>u&&z.push(u)):(u=w*w-4*v*t,0>u||(y=l(u),u=(-w+y)/(2*t),0<u&&1>u&&z.push(u),u=(-w-y)/(2*t),0<u&&1>u&&z.push(u)));for(D=l=z.length;l--;)u=z[l],w=1-u,t=w*w*w*a+3*w*w*u*d+3*w*u*u*h+u*u*u*m,r[0][l]=t,t=w*w*w*b+3*w*w*u*c+3*w*u*u*g+u*u*u*k,r[1][l]=t;r[0][D]=a;r[1][D]=b;r[0][D+1]=m;r[1][D+1]=k;n=[{x:n.apply(null,r[0]),y:n.apply(null,r[1])},{x:p.apply(null,r[0]),y:p.apply(null,r[1])}];
return f[B]=n}var a={},b={},f={},e=Array.prototype.join;g.util.drawArc=function(f,e,a,b){var d=[[],[],[],[]];b=m(b[5]-e,b[6]-a,b[0],b[1],b[3],b[4],b[2]);for(var c=0,h=b.length;c<h;c++)d[c][0]=b[c][0]+e,d[c][1]=b[c][1]+a,d[c][2]=b[c][2]+e,d[c][3]=b[c][3]+a,d[c][4]=b[c][4]+e,d[c][5]=b[c][5]+a,f.bezierCurveTo.apply(f,d[c])};g.util.getBoundsOfArc=function(f,e,a,b,c,h,g,k,B){var l=0,n=0,p=[],r=[];a=m(k-f,B-e,a,b,h,g,c);b=[[],[]];c=0;for(h=a.length;c<h;c++)p=d(l,n,a[c][0],a[c][1],a[c][2],a[c][3],a[c][4],
a[c][5]),b[0].x=p[0].x+f,b[0].y=p[0].y+e,b[1].x=p[1].x+f,b[1].y=p[1].y+e,r.push(b[0]),r.push(b[1]),l=a[c][4],n=a[c][5];return r};g.util.getBoundsOfCurve=d})();(function(){function m(c,d,a){if(c&&0!==c.length){var b=c.length-1,f=d?c[b][d]:c[b];if(d)for(;b--;)a(c[b][d],f)&&(f=c[b][d]);else for(;b--;)a(c[b],f)&&(f=c[b]);return f}}var c=Array.prototype.slice;Array.prototype.indexOf||(Array.prototype.indexOf=function(c){if(void 0===this||null===this)throw new TypeError;var d=Object(this),a=d.length>>>
0;if(0===a)return-1;var b=0;0<arguments.length&&(b=Number(arguments[1]),b!==b?b=0:0!==b&&b!==Number.POSITIVE_INFINITY&&b!==Number.NEGATIVE_INFINITY&&(b=(0<b||-1)*Math.floor(Math.abs(b))));if(b>=a)return-1;for(b=0<=b?b:Math.max(a-Math.abs(b),0);b<a;b++)if(b in d&&d[b]===c)return b;return-1});Array.prototype.forEach||(Array.prototype.forEach=function(c,d){for(var a=0,b=this.length>>>0;a<b;a++)a in this&&c.call(d,this[a],a,this)});Array.prototype.map||(Array.prototype.map=function(c,d){for(var a=[],
b=0,f=this.length>>>0;b<f;b++)b in this&&(a[b]=c.call(d,this[b],b,this));return a});Array.prototype.every||(Array.prototype.every=function(c,d){for(var a=0,b=this.length>>>0;a<b;a++)if(a in this&&!c.call(d,this[a],a,this))return!1;return!0});Array.prototype.some||(Array.prototype.some=function(c,d){for(var a=0,b=this.length>>>0;a<b;a++)if(a in this&&c.call(d,this[a],a,this))return!0;return!1});Array.prototype.filter||(Array.prototype.filter=function(c,d){for(var a=[],b,f=0,e=this.length>>>0;f<e;f++)f in
this&&(b=this[f],c.call(d,b,f,this)&&a.push(b));return a});Array.prototype.reduce||(Array.prototype.reduce=function(c){var d=this.length>>>0,a=0,b;if(1<arguments.length)b=arguments[1];else{do{if(a in this){b=this[a++];break}if(++a>=d)throw new TypeError;}while(1)}for(;a<d;a++)a in this&&(b=c.call(null,b,this[a],a,this));return b});g.util.array={invoke:function(h,d){for(var a=c.call(arguments,2),b=[],f=0,e=h.length;f<e;f++)b[f]=a.length?h[f][d].apply(h[f],a):h[f][d].call(h[f]);return b},min:function(c,
d){return m(c,d,function(a,b){return a<b})},max:function(c,d){return m(c,d,function(a,b){return a>=b})}}})();(function(){function m(c,h){for(var d in h)c[d]=h[d];return c}g.util.object={extend:m,clone:function(c){return m({},c)}}})();(function(){String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^[\s\xA0]+/,"").replace(/[\s\xA0]+$/,"")});g.util.string={camelize:function(g){return g.replace(/-+(.)?/g,function(c,h){return h?h.toUpperCase():""})},capitalize:function(g,c){return g.charAt(0).toUpperCase()+
(c?g.slice(1):g.slice(1).toLowerCase())},escapeXml:function(g){return g.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}}})();(function(){var g=Array.prototype.slice,c=Function.prototype.apply,h=function(){};Function.prototype.bind||(Function.prototype.bind=function(d){var a=this,b=g.call(arguments,1),f;f=b.length?function(){return c.call(a,this instanceof h?this:d,b.concat(g.call(arguments)))}:function(){return c.call(a,this instanceof
h?this:d,arguments)};h.prototype=this.prototype;f.prototype=new h;return f})})();(function(){function m(){}function c(f){var e=this.constructor.superclass.prototype[f];return 1<arguments.length?e.apply(this,h.call(arguments,1)):e.call(this)}var h=Array.prototype.slice,d=function(){},a=function(){for(var f in{toString:1})if("toString"===f)return!1;return!0}(),b=function(f,e,b){for(var d in e)d in f.prototype&&"function"===typeof f.prototype[d]&&-1<(e[d]+"").indexOf("callSuper")?f.prototype[d]=function(f){return function(){var a=
this.constructor.superclass;this.constructor.superclass=b;var d=e[f].apply(this,arguments);this.constructor.superclass=a;if("initialize"!==f)return d}}(d):f.prototype[d]=e[d],a&&(e.toString!==Object.prototype.toString&&(f.prototype.toString=e.toString),e.valueOf!==Object.prototype.valueOf&&(f.prototype.valueOf=e.valueOf))};g.util.createClass=function(){function f(){this.initialize.apply(this,arguments)}var e=null,a=h.call(arguments,0);"function"===typeof a[0]&&(e=a.shift());f.superclass=e;f.subclasses=
[];e&&(m.prototype=e.prototype,f.prototype=new m,e.subclasses.push(f));for(var g=0,A=a.length;g<A;g++)b(f,a[g],e);f.prototype.initialize||(f.prototype.initialize=d);f.prototype.constructor=f;f.prototype.callSuper=c;return f}})();(function(){function m(f){var e=Array.prototype.slice.call(arguments,1),a,b,d=e.length;for(b=0;b<d;b++)if(a=typeof f[e[b]],!/^(?:function|object|unknown)$/.test(a))return!1;return!0}function c(f,e){return function(b){e.call(a(f),b||g.window.event)}}function h(f,e){return function(a){if(A[f]&&
A[f][e])for(var b=A[f][e],d=0,c=b.length;d<c;d++)b[d].call(this,a||g.window.event)}}function d(f,e,a){var b="touchend"===f.type?"changedTouches":"touches";return f[b]&&f[b][0]?f[b][0][e]-(f[b][0][e]-f[b][0][a])||f[a]:f[a]}var a,b,f=function(){var f=0;return function(e){return e.__uniqueID||(e.__uniqueID="uniqueID__"+f++)}}();(function(){var f={};a=function(e){return f[e]};b=function(e,a){f[e]=a}})();var e=m(g.document.documentElement,"addEventListener","removeEventListener")&&m(g.window,"addEventListener",
"removeEventListener"),q=m(g.document.documentElement,"attachEvent","detachEvent")&&m(g.window,"attachEvent","detachEvent"),x={},A={};e?(e=function(f,e,a){f.addEventListener(e,a,!1)},q=function(f,e,a){f.removeEventListener(e,a,!1)}):q?(e=function(e,a,d){var h=f(e);b(h,e);x[h]||(x[h]={});x[h][a]||(x[h][a]=[]);d={handler:d,wrappedHandler:c(h,d)};x[h][a].push(d);e.attachEvent("on"+a,d.wrappedHandler)},q=function(e,a,b){var d=f(e),c;if(x[d]&&x[d][a])for(var h=0,q=x[d][a].length;h<q;h++)(c=x[d][a][h])&&
c.handler===b&&(e.detachEvent("on"+a,c.wrappedHandler),x[d][a][h]=null)}):(e=function(e,a,b){var d=f(e);A[d]||(A[d]={});if(!A[d][a]){A[d][a]=[];var c=e["on"+a];c&&A[d][a].push(c);e["on"+a]=h(d,a)}A[d][a].push(b)},q=function(e,a,b){e=f(e);if(A[e]&&A[e][a]){a=A[e][a];e=0;for(var d=a.length;e<d;e++)a[e]===b&&a.splice(e,1)}});g.util.addListener=e;g.util.removeListener=q;var k=function(f){return"unknown"!==typeof f.clientX?f.clientX:0},l=function(f){return"unknown"!==typeof f.clientY?f.clientY:0};g.isTouchSupported&&
(k=function(f){return d(f,"pageX","clientX")},l=function(f){return d(f,"pageY","clientY")});g.util.getPointer=function(f,e){f||(f=g.window.event);var a=g.util.getScrollLeftTop(f.target||("unknown"!==typeof f.srcElement?f.srcElement:null),e);return{x:k(f)+a.left,y:l(f)+a.top}};g.util.object.extend(g.util,g.Observable)})();(function(){var m=g.document.createElement("div"),c="string"===typeof m.style.filter,h=/alpha\s*\(\s*opacity\s*=\s*([^\)]+)\)/,d=function(a){return a};"string"===typeof m.style.opacity?
d=function(a,b){a.style.opacity=b;return a}:c&&(d=function(a,b){var f=a.style;a.currentStyle&&!a.currentStyle.hasLayout&&(f.zoom=1);h.test(f.filter)?f.filter=f.filter.replace(h,.9999<=b?"":"alpha(opacity="+100*b+")"):f.filter+=" alpha(opacity="+100*b+")";return a});g.util.setStyle=function(a,b){var f=a.style;if(!f)return a;if("string"===typeof b)return a.style.cssText+=";"+b,-1<b.indexOf("opacity")?d(a,b.match(/opacity:\s*(\d?\.?\d*)/)[1]):a;for(var e in b)"opacity"===e?d(a,b[e]):f["float"===e||"cssFloat"===
e?"undefined"===typeof f.styleFloat?"cssFloat":"styleFloat":e]=b[e];return a}})();(function(){function m(a,f){var e=g.document.createElement(a),d;for(d in f)"class"===d?e.className=f[d]:"for"===d?e.htmlFor=f[d]:e.setAttribute(d,f[d]);return e}var c=Array.prototype.slice,h,d=function(a){return c.call(a,0)};try{h=d(g.document.childNodes)instanceof Array}catch(b){}h||(d=function(a){for(var f=Array(a.length),e=a.length;e--;)f[e]=a[e];return f});var a;a=g.document.defaultView&&g.document.defaultView.getComputedStyle?
function(a,f){var e=g.document.defaultView.getComputedStyle(a,null);return e?e[f]:void 0}:function(a,f){var e=a.style[f];!e&&a.currentStyle&&(e=a.currentStyle[f]);return e};(function(){var a=g.document.documentElement.style,f="userSelect"in a?"userSelect":"MozUserSelect"in a?"MozUserSelect":"WebkitUserSelect"in a?"WebkitUserSelect":"KhtmlUserSelect"in a?"KhtmlUserSelect":"";g.util.makeElementUnselectable=function(e){"undefined"!==typeof e.onselectstart&&(e.onselectstart=g.util.falseFunction);f?e.style[f]=
"none":"string"===typeof e.unselectable&&(e.unselectable="on");return e};g.util.makeElementSelectable=function(e){"undefined"!==typeof e.onselectstart&&(e.onselectstart=null);f?e.style[f]="":"string"===typeof e.unselectable&&(e.unselectable="");return e}})();(function(){g.util.getScript=function(a,f){var e=g.document.getElementsByTagName("head")[0],d=g.document.createElement("script"),c=!0;d.onload=d.onreadystatechange=function(e){!c||"string"===typeof this.readyState&&"loaded"!==this.readyState&&
"complete"!==this.readyState||(c=!1,f(e||g.window.event),d=d.onload=d.onreadystatechange=null)};d.src=a;e.appendChild(d)}})();g.util.getById=function(a){return"string"===typeof a?g.document.getElementById(a):a};g.util.toArray=d;g.util.makeElement=m;g.util.addClass=function(a,f){a&&-1===(" "+a.className+" ").indexOf(" "+f+" ")&&(a.className+=(a.className?" ":"")+f)};g.util.wrapElement=function(a,f,e){"string"===typeof f&&(f=m(f,e));a.parentNode&&a.parentNode.replaceChild(f,a);f.appendChild(a);return f};
g.util.getScrollLeftTop=function(a,f){var e,d,c=0,h=0,m=g.document.documentElement,k=g.document.body||{scrollLeft:0,scrollTop:0};for(d=a;a&&a.parentNode&&!e;)a=a.parentNode,1===a.nodeType&&"fixed"===g.util.getElementStyle(a,"position")&&(e=a),1===a.nodeType&&d!==f&&"absolute"===g.util.getElementStyle(a,"position")?h=c=0:a===g.document?(c=k.scrollLeft||m.scrollLeft||0,h=k.scrollTop||m.scrollTop||0):(c+=a.scrollLeft||0,h+=a.scrollTop||0);return{left:c,top:h}};g.util.getElementOffset=function(b){var f;
f=b&&b.ownerDocument;var e={left:0,top:0},d={left:0,top:0},c={borderLeftWidth:"left",borderTopWidth:"top",paddingLeft:"left",paddingTop:"top"};if(!f)return{left:0,top:0};for(var h in c)d[c[h]]+=parseInt(a(b,h),10)||0;f=f.documentElement;"undefined"!==typeof b.getBoundingClientRect&&(e=b.getBoundingClientRect());b=g.util.getScrollLeftTop(b,null);return{left:e.left+b.left-(f.clientLeft||0)+d.left,top:e.top+b.top-(f.clientTop||0)+d.top}};g.util.getElementStyle=a})();(function(){function m(d,a){return d+
(/\?/.test(d)?"&":"?")+a}function c(){}var h=function(){for(var d=[function(){return new ActiveXObject("Microsoft.XMLHTTP")},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml2.XMLHTTP.3.0")},function(){return new XMLHttpRequest}],a=d.length;a--;)try{if(d[a]())return d[a]}catch(b){}}();g.util.request=function(d,a){a||(a={});var b=a.method?a.method.toUpperCase():"GET",f=a.onComplete||function(){},e=h(),q;e.onreadystatechange=function(){4===e.readyState&&
(f(e),e.onreadystatechange=c)};"GET"===b&&(q=null,"string"===typeof a.parameters&&(d=m(d,a.parameters)));e.open(b,d,!0);"POST"!==b&&"PUT"!==b||e.setRequestHeader("Content-Type","application/x-www-form-urlencoded");e.send(q);return e}})();g.log=function(){};g.warn=function(){};"undefined"!==typeof console&&["log","warn"].forEach(function(m){"undefined"!==typeof console[m]&&"function"===typeof console[m].apply&&(g[m]=function(){return console[m].apply(console,arguments)})});(function(g){function c(c,
d){this.x=c;this.y=d}g=g.fabric||(g.fabric={});g.Point?g.warn("fabric.Point is already defined"):(g.Point=c,c.prototype={constructor:c,add:function(h){return new c(this.x+h.x,this.y+h.y)},addEquals:function(c){this.x+=c.x;this.y+=c.y;return this},scalarAdd:function(h){return new c(this.x+h,this.y+h)},scalarAddEquals:function(c){this.x+=c;this.y+=c;return this},subtract:function(h){return new c(this.x-h.x,this.y-h.y)},subtractEquals:function(c){this.x-=c.x;this.y-=c.y;return this},scalarSubtract:function(h){return new c(this.x-
h,this.y-h)},scalarSubtractEquals:function(c){this.x-=c;this.y-=c;return this},multiply:function(h){return new c(this.x*h,this.y*h)},multiplyEquals:function(c){this.x*=c;this.y*=c;return this},divide:function(h){return new c(this.x/h,this.y/h)},divideEquals:function(c){this.x/=c;this.y/=c;return this},eq:function(c){return this.x===c.x&&this.y===c.y},lt:function(c){return this.x<c.x&&this.y<c.y},lte:function(c){return this.x<=c.x&&this.y<=c.y},gt:function(c){return this.x>c.x&&this.y>c.y},gte:function(c){return this.x>=
c.x&&this.y>=c.y},lerp:function(h,d){return new c(this.x+(h.x-this.x)*d,this.y+(h.y-this.y)*d)},distanceFrom:function(c){var d=this.x-c.x;c=this.y-c.y;return Math.sqrt(d*d+c*c)},midPointFrom:function(h){return new c(this.x+(h.x-this.x)/2,this.y+(h.y-this.y)/2)},min:function(h){return new c(Math.min(this.x,h.x),Math.min(this.y,h.y))},max:function(h){return new c(Math.max(this.x,h.x),Math.max(this.y,h.y))},toString:function(){return this.x+","+this.y},setXY:function(c,d){this.x=c;this.y=d},setFromPoint:function(c){this.x=
c.x;this.y=c.y},swap:function(c){var d=this.x,a=this.y;this.x=c.x;this.y=c.y;c.x=d;c.y=a}})})("undefined"!==typeof k?k:this);(function(g){function c(d){this.status=d;this.points=[]}var h=g.fabric||(g.fabric={});h.Intersection?h.warn("fabric.Intersection is already defined"):(h.Intersection=c,h.Intersection.prototype={appendPoint:function(d){this.points.push(d)},appendPoints:function(d){this.points=this.points.concat(d)}},h.Intersection.intersectLineLine=function(d,a,b,f){var e,q=(f.x-b.x)*(d.y-b.y)-
(f.y-b.y)*(d.x-b.x);e=(a.x-d.x)*(d.y-b.y)-(a.y-d.y)*(d.x-b.x);b=(f.y-b.y)*(a.x-d.x)-(f.x-b.x)*(a.y-d.y);0!==b?(q/=b,e/=b,0<=q&&1>=q&&0<=e&&1>=e?(e=new c("Intersection"),e.points.push(new h.Point(d.x+q*(a.x-d.x),d.y+q*(a.y-d.y)))):e=new c):e=0===q||0===e?new c("Coincident"):new c("Parallel");return e},h.Intersection.intersectLinePolygon=function(d,a,b){for(var f=new c,e=b.length,h=0;h<e;h++){var g=c.intersectLineLine(d,a,b[h],b[(h+1)%e]);f.appendPoints(g.points)}0<f.points.length&&(f.status="Intersection");
return f},h.Intersection.intersectPolygonPolygon=function(d,a){for(var b=new c,f=d.length,e=0;e<f;e++){var h=c.intersectLinePolygon(d[e],d[(e+1)%f],a);b.appendPoints(h.points)}0<b.points.length&&(b.status="Intersection");return b},h.Intersection.intersectPolygonRectangle=function(d,a,b){var f=a.min(b),e=a.max(b);b=new h.Point(e.x,f.y);var q=new h.Point(f.x,e.y);a=c.intersectLinePolygon(f,b,d);b=c.intersectLinePolygon(b,e,d);e=c.intersectLinePolygon(e,q,d);d=c.intersectLinePolygon(q,f,d);f=new c;f.appendPoints(a.points);
f.appendPoints(b.points);f.appendPoints(e.points);f.appendPoints(d.points);0<f.points.length&&(f.status="Intersection");return f})})("undefined"!==typeof k?k:this);(function(g){function c(a){a?this._tryParsingColor(a):this.setSource([0,0,0,1])}function h(a,b,f){0>f&&(f+=1);1<f&&--f;return f<1/6?a+6*(b-a)*f:.5>f?b:f<2/3?a+(b-a)*(2/3-f)*6:a}var d=g.fabric||(g.fabric={});d.Color?d.warn("fabric.Color is already defined."):(d.Color=c,d.Color.prototype={_tryParsingColor:function(a){var b;a in c.colorNameMap&&
(a=c.colorNameMap[a]);"transparent"===a?this.setSource([255,255,255,0]):((b=c.sourceFromHex(a))||(b=c.sourceFromRgb(a)),b||(b=c.sourceFromHsl(a)),b&&this.setSource(b))},_rgbToHsl:function(a,b,f){a/=255;b/=255;f/=255;var e,c,h,g=d.util.array.max([a,b,f]);c=d.util.array.min([a,b,f]);h=(g+c)/2;if(g===c)e=c=0;else{var k=g-c;c=.5<h?k/(2-g-c):k/(g+c);switch(g){case a:e=(b-f)/k+(b<f?6:0);break;case b:e=(f-a)/k+2;break;case f:e=(a-b)/k+4}e/=6}return[Math.round(360*e),Math.round(100*c),Math.round(100*h)]},
getSource:function(){return this._source},setSource:function(a){this._source=a},toRgb:function(){var a=this.getSource();return"rgb("+a[0]+","+a[1]+","+a[2]+")"},toRgba:function(){var a=this.getSource();return"rgba("+a[0]+","+a[1]+","+a[2]+","+a[3]+")"},toHsl:function(){var a=this.getSource(),a=this._rgbToHsl(a[0],a[1],a[2]);return"hsl("+a[0]+","+a[1]+"%,"+a[2]+"%)"},toHsla:function(){var a=this.getSource(),b=this._rgbToHsl(a[0],a[1],a[2]);return"hsla("+b[0]+","+b[1]+"%,"+b[2]+"%,"+a[3]+")"},toHex:function(){var a=
this.getSource(),b,f;b=a[0].toString(16);b=1===b.length?"0"+b:b;f=a[1].toString(16);f=1===f.length?"0"+f:f;a=a[2].toString(16);a=1===a.length?"0"+a:a;return b.toUpperCase()+f.toUpperCase()+a.toUpperCase()},getAlpha:function(){return this.getSource()[3]},setAlpha:function(a){var b=this.getSource();b[3]=a;this.setSource(b);return this},toGrayscale:function(){var a=this.getSource(),b=parseInt((.3*a[0]+.59*a[1]+.11*a[2]).toFixed(0),10);this.setSource([b,b,b,a[3]]);return this},toBlackWhite:function(a){var b=
this.getSource(),f=(.3*b[0]+.59*b[1]+.11*b[2]).toFixed(0),b=b[3],f=Number(f)<Number(a||127)?0:255;this.setSource([f,f,f,b]);return this},overlayWith:function(a){a instanceof c||(a=new c(a));var b=[],f=this.getAlpha(),e=this.getSource();a=a.getSource();for(var d=0;3>d;d++)b.push(Math.round(.5*e[d]+.5*a[d]));b[3]=f;this.setSource(b);return this}},d.Color.reRGBa=/^rgba?\(\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/,d.Color.reHSLa=
/^hsla?\(\s*(\d{1,3})\s*,\s*(\d{1,3}\%)\s*,\s*(\d{1,3}\%)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/,d.Color.reHex=/^#?([0-9a-f]{6}|[0-9a-f]{3})$/i,d.Color.colorNameMap={aqua:"#00FFFF",black:"#000000",blue:"#0000FF",fuchsia:"#FF00FF",gray:"#808080",green:"#008000",lime:"#00FF00",maroon:"#800000",navy:"#000080",olive:"#808000",orange:"#FFA500",purple:"#800080",red:"#FF0000",silver:"#C0C0C0",teal:"#008080",white:"#FFFFFF",yellow:"#FFFF00"},d.Color.fromRgb=function(a){return c.fromSource(c.sourceFromRgb(a))},
d.Color.sourceFromRgb=function(a){if(a=a.match(c.reRGBa)){var b=parseInt(a[1],10)/(/%$/.test(a[1])?100:1)*(/%$/.test(a[1])?255:1),f=parseInt(a[2],10)/(/%$/.test(a[2])?100:1)*(/%$/.test(a[2])?255:1),e=parseInt(a[3],10)/(/%$/.test(a[3])?100:1)*(/%$/.test(a[3])?255:1);return[parseInt(b,10),parseInt(f,10),parseInt(e,10),a[4]?parseFloat(a[4]):1]}},d.Color.fromRgba=c.fromRgb,d.Color.fromHsl=function(a){return c.fromSource(c.sourceFromHsl(a))},d.Color.sourceFromHsl=function(a){if(a=a.match(c.reHSLa)){var b=
(parseFloat(a[1])%360+360)%360/360,f=parseFloat(a[2])/(/%$/.test(a[2])?100:1),e=parseFloat(a[3])/(/%$/.test(a[3])?100:1);if(0===f)e=f=b=e;else var d=.5>=e?e*(f+1):e+f-e*f,g=2*e-d,e=h(g,d,b+1/3),f=h(g,d,b),b=h(g,d,b-1/3);return[Math.round(255*e),Math.round(255*f),Math.round(255*b),a[4]?parseFloat(a[4]):1]}},d.Color.fromHsla=c.fromHsl,d.Color.fromHex=function(a){return c.fromSource(c.sourceFromHex(a))},d.Color.sourceFromHex=function(a){if(a.match(c.reHex)){var b=a.slice(a.indexOf("#")+1),f=3===b.length;
a=f?b.charAt(0)+b.charAt(0):b.substring(0,2);var e=f?b.charAt(1)+b.charAt(1):b.substring(2,4),b=f?b.charAt(2)+b.charAt(2):b.substring(4,6);return[parseInt(a,16),parseInt(e,16),parseInt(b,16),1]}},d.Color.fromSource=function(a){var b=new c;b.setSource(a);return b})})("undefined"!==typeof k?k:this);(function(){if(g.StaticCanvas)g.warn("fabric.StaticCanvas is already defined.");else{var k=g.util.object.extend,c=g.util.getElementOffset,h=g.util.removeFromArray,d=Error("Could not initialize `canvas` element");
g.StaticCanvas=g.util.createClass({initialize:function(a,b){b||(b={});this._initStatic(a,b);g.StaticCanvas.activeInstance=this},backgroundColor:"",backgroundImage:null,overlayColor:"",overlayImage:null,includeDefaultValues:!0,stateful:!0,renderOnAddRemove:!0,clipTo:null,controlsAboveOverlay:!1,allowTouchScrolling:!1,imageSmoothingEnabled:!0,preserveObjectStacking:!1,viewportTransform:[1,0,0,1,0,0],onBeforeScaleRotate:function(){},_initStatic:function(a,b){this._objects=[];this._createLowerCanvas(a);
this._initOptions(b);this._setImageSmoothing();b.overlayImage&&this.setOverlayImage(b.overlayImage,this.renderAll.bind(this));b.backgroundImage&&this.setBackgroundImage(b.backgroundImage,this.renderAll.bind(this));b.backgroundColor&&this.setBackgroundColor(b.backgroundColor,this.renderAll.bind(this));b.overlayColor&&this.setOverlayColor(b.overlayColor,this.renderAll.bind(this));this.calcOffset()},calcOffset:function(){this._offset=c(this.lowerCanvasEl);return this},setOverlayImage:function(a,b,f){return this.__setBgOverlayImage("overlayImage",
a,b,f)},setBackgroundImage:function(a,b,f){return this.__setBgOverlayImage("backgroundImage",a,b,f)},setOverlayColor:function(a,b){return this.__setBgOverlayColor("overlayColor",a,b)},setBackgroundColor:function(a,b){return this.__setBgOverlayColor("backgroundColor",a,b)},_setImageSmoothing:function(){var a=this.getContext();a.imageSmoothingEnabled=this.imageSmoothingEnabled;a.webkitImageSmoothingEnabled=this.imageSmoothingEnabled;a.mozImageSmoothingEnabled=this.imageSmoothingEnabled;a.msImageSmoothingEnabled=
this.imageSmoothingEnabled;a.oImageSmoothingEnabled=this.imageSmoothingEnabled},__setBgOverlayImage:function(a,b,f,e){"string"===typeof b?g.util.loadImage(b,function(b){this[a]=new g.Image(b,e);f&&f()},this,e&&e.crossOrigin):(e&&b.setOptions(e),this[a]=b,f&&f());return this},__setBgOverlayColor:function(a,b,f){if(b&&b.source){var e=this;g.util.loadImage(b.source,function(d){e[a]=new g.Pattern({source:d,repeat:b.repeat,offsetX:b.offsetX,offsetY:b.offsetY});f&&f()})}else this[a]=b,f&&f();return this},
_createCanvasElement:function(){var a=g.document.createElement("canvas");a.style||(a.style={});if(!a)throw d;this._initCanvasElement(a);return a},_initCanvasElement:function(a){g.util.createCanvasElement(a);if("undefined"===typeof a.getContext)throw d;},_initOptions:function(a){for(var b in a)this[b]=a[b];this.width=this.width||parseInt(this.lowerCanvasEl.width,10)||0;this.height=this.height||parseInt(this.lowerCanvasEl.height,10)||0;this.lowerCanvasEl.style&&(this.lowerCanvasEl.width=this.width,
this.lowerCanvasEl.height=this.height,this.lowerCanvasEl.style.width=this.width+"px",this.lowerCanvasEl.style.height=this.height+"px",this.viewportTransform=this.viewportTransform.slice())},_createLowerCanvas:function(a){this.lowerCanvasEl=g.util.getById(a)||this._createCanvasElement();this._initCanvasElement(this.lowerCanvasEl);g.util.addClass(this.lowerCanvasEl,"lower-canvas");this.interactive&&this._applyCanvasStyle(this.lowerCanvasEl);this.contextContainer=this.lowerCanvasEl.getContext("2d")},
getWidth:function(){return this.width},getHeight:function(){return this.height},setWidth:function(a,b){return this.setDimensions({width:a},b)},setHeight:function(a,b){return this.setDimensions({height:a},b)},setDimensions:function(a,b){var f;b=b||{};for(var e in a)f=a[e],b.cssOnly||(this._setBackstoreDimension(e,a[e]),f+="px"),b.backstoreOnly||this._setCssDimension(e,f);b.cssOnly||this.renderAll();this.calcOffset();return this},_setBackstoreDimension:function(a,b){this.lowerCanvasEl[a]=b;this.upperCanvasEl&&
(this.upperCanvasEl[a]=b);this.cacheCanvasEl&&(this.cacheCanvasEl[a]=b);this[a]=b;return this},_setCssDimension:function(a,b){this.lowerCanvasEl.style[a]=b;this.upperCanvasEl&&(this.upperCanvasEl.style[a]=b);this.wrapperEl&&(this.wrapperEl.style[a]=b);return this},getZoom:function(){return Math.sqrt(this.viewportTransform[0]*this.viewportTransform[3])},setViewportTransform:function(a){var b=this.getActiveGroup();this.viewportTransform=a;this.renderAll();a=0;for(var f=this._objects.length;a<f;a++)this._objects[a].setCoords();
b&&b.setCoords();return this},zoomToPoint:function(a,b){var f=a;a=g.util.transformPoint(a,g.util.invertTransform(this.viewportTransform));this.viewportTransform[0]=b;this.viewportTransform[3]=b;var e=g.util.transformPoint(a,this.viewportTransform);this.viewportTransform[4]+=f.x-e.x;this.viewportTransform[5]+=f.y-e.y;this.renderAll();f=0;for(e=this._objects.length;f<e;f++)this._objects[f].setCoords();return this},setZoom:function(a){this.zoomToPoint(new g.Point(0,0),a);return this},absolutePan:function(a){this.viewportTransform[4]=
-a.x;this.viewportTransform[5]=-a.y;this.renderAll();a=0;for(var b=this._objects.length;a<b;a++)this._objects[a].setCoords();return this},relativePan:function(a){return this.absolutePan(new g.Point(-a.x-this.viewportTransform[4],-a.y-this.viewportTransform[5]))},getElement:function(){return this.lowerCanvasEl},getActiveObject:function(){return null},getActiveGroup:function(){return null},_draw:function(a,b){if(b){a.save();var f=this.viewportTransform;a.transform(f[0],f[1],f[2],f[3],f[4],f[5]);this._shouldRenderObject(b)&&
b.render(a);a.restore();this.controlsAboveOverlay||b._renderControls(a)}},_shouldRenderObject:function(a){return a?a!==this.getActiveGroup()||!this.preserveObjectStacking:!1},_onObjectAdded:function(a){this.stateful&&a.setupState();a.canvas=this;a.setCoords();this.fire("object:added",{target:a});a.fire("added")},_onObjectRemoved:function(a){this.getActiveObject()===a&&(this.fire("before:selection:cleared",{target:a}),this._discardActiveObject(),this.fire("selection:cleared"));this.fire("object:removed",
{target:a});a.fire("removed")},clearContext:function(a){a.clearRect(0,0,this.width,this.height);return this},getContext:function(){return this.contextContainer},clear:function(){this._objects.length=0;this.discardActiveGroup&&this.discardActiveGroup();this.discardActiveObject&&this.discardActiveObject();this.clearContext(this.contextContainer);this.contextTop&&this.clearContext(this.contextTop);this.fire("canvas:cleared");this.renderAll();return this},renderAll:function(a){var b=this[!0===a&&this.interactive?
"contextTop":"contextContainer"],f=this.getActiveGroup();this.contextTop&&this.selection&&!this._groupSelector&&this.clearContext(this.contextTop);a||this.clearContext(b);this.fire("before:render");this.clipTo&&g.util.clipContext(this,b);this._renderBackground(b);this._renderObjects(b,f);this._renderActiveGroup(b,f);this.clipTo&&b.restore();this._renderOverlay(b);this.controlsAboveOverlay&&this.interactive&&this.drawControls(b);this.fire("after:render");return this},_renderObjects:function(a,b){var f,
e;if(!b||this.preserveObjectStacking)for(f=0,e=this._objects.length;f<e;++f)this._draw(a,this._objects[f]);else for(f=0,e=this._objects.length;f<e;++f)this._objects[f]&&!b.contains(this._objects[f])&&this._draw(a,this._objects[f])},_renderActiveGroup:function(a,b){if(b){var f=[];this.forEachObject(function(e){b.contains(e)&&f.push(e)});b._set("objects",f);this._draw(a,b)}},_renderBackground:function(a){this.backgroundColor&&(a.fillStyle=this.backgroundColor.toLive?this.backgroundColor.toLive(a):this.backgroundColor,
a.fillRect(this.backgroundColor.offsetX||0,this.backgroundColor.offsetY||0,this.width,this.height));this.backgroundImage&&this._draw(a,this.backgroundImage)},_renderOverlay:function(a){this.overlayColor&&(a.fillStyle=this.overlayColor.toLive?this.overlayColor.toLive(a):this.overlayColor,a.fillRect(this.overlayColor.offsetX||0,this.overlayColor.offsetY||0,this.width,this.height));this.overlayImage&&this._draw(a,this.overlayImage)},renderTop:function(){var a=this.contextTop||this.contextContainer;this.clearContext(a);
this.selection&&this._groupSelector&&this._drawSelection();var b=this.getActiveGroup();b&&b.render(a);this._renderOverlay(a);this.fire("after:render");return this},getCenter:function(){return{top:this.getHeight()/2,left:this.getWidth()/2}},centerObjectH:function(a){this._centerObject(a,new g.Point(this.getCenter().left,a.getCenterPoint().y));this.renderAll();return this},centerObjectV:function(a){this._centerObject(a,new g.Point(a.getCenterPoint().x,this.getCenter().top));this.renderAll();return this},
centerObject:function(a){var b=this.getCenter();this._centerObject(a,new g.Point(b.left,b.top));this.renderAll();return this},_centerObject:function(a,b){a.setPositionByOrigin(b,"center","center");return this},toDatalessJSON:function(a){return this.toDatalessObject(a)},toObject:function(a){return this._toObjectMethod("toObject",a)},toDatalessObject:function(a){return this._toObjectMethod("toDatalessObject",a)},_toObjectMethod:function(a,b){var f={objects:this._toObjects(a,b)};k(f,this.__serializeBgOverlay());
g.util.populateWithProperties(this,f,b);return f},_toObjects:function(a,b){return this.getObjects().map(function(f){return this._toObject(f,a,b)},this)},_toObject:function(a,b,f){var e;this.includeDefaultValues||(e=a.includeDefaultValues,a.includeDefaultValues=!1);var d=this._realizeGroupTransformOnObject(a);b=a[b](f);this.includeDefaultValues||(a.includeDefaultValues=e);this._unwindGroupTransformOnObject(a,d);return b},_realizeGroupTransformOnObject:function(a){var b="angle flipX flipY height left scaleX scaleY top width".split(" ");
if(a.group&&a.group===this.getActiveGroup()){var f={};b.forEach(function(e){f[e]=a[e]});this.getActiveGroup().realizeTransform(a);return f}return null},_unwindGroupTransformOnObject:function(a,b){b&&a.set(b)},__serializeBgOverlay:function(){var a={background:this.backgroundColor&&this.backgroundColor.toObject?this.backgroundColor.toObject():this.backgroundColor};this.overlayColor&&(a.overlay=this.overlayColor.toObject?this.overlayColor.toObject():this.overlayColor);this.backgroundImage&&(a.backgroundImage=
this.backgroundImage.toObject());this.overlayImage&&(a.overlayImage=this.overlayImage.toObject());return a},svgViewportTransformation:!0,toSVG:function(a,b){a||(a={});var f=[];this._setSVGPreamble(f,a);this._setSVGHeader(f,a);this._setSVGBgOverlayColor(f,"backgroundColor");this._setSVGBgOverlayImage(f,"backgroundImage");this._setSVGObjects(f,b);this._setSVGBgOverlayColor(f,"overlayColor");this._setSVGBgOverlayImage(f,"overlayImage");f.push("</svg>");return f.join("")},_setSVGPreamble:function(a,b){b.suppressPreamble||
a.push('<?xml version="1.0" encoding="',b.encoding||"UTF-8",'" standalone="no" ?>','<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ','"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\n')},_setSVGHeader:function(a,b){var f,e,d;b.viewBox?(f=b.viewBox.width,e=b.viewBox.height):(f=this.width,e=this.height,this.svgViewportTransformation||(d=this.viewportTransform,f/=d[0],e/=d[3]));a.push("<svg ",'xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',
f,'" ','height="',e,'" ',this.backgroundColor&&!this.backgroundColor.toLive?'style="background-color: '+this.backgroundColor+'" ':null,b.viewBox?'viewBox="'+b.viewBox.x+" "+b.viewBox.y+" "+b.viewBox.width+" "+b.viewBox.height+'" ':null,'xml:space="preserve">',"<desc>Created with Fabric.js ",g.version,"</desc>","<defs>",g.createSVGFontFacesMarkup(this.getObjects()),g.createSVGRefElementsMarkup(this),"</defs>")},_setSVGObjects:function(a,b){for(var f=0,e=this.getObjects(),d=e.length;f<d;f++){var c=
e[f],h=this._realizeGroupTransformOnObject(c);a.push(c.toSVG(b));this._unwindGroupTransformOnObject(c,h)}},_setSVGBgOverlayImage:function(a,b){this[b]&&this[b].toSVG&&a.push(this[b].toSVG())},_setSVGBgOverlayColor:function(a,b){this[b]&&this[b].source?a.push('<rect x="',this[b].offsetX,'" y="',this[b].offsetY,'" ','width="',"repeat-y"===this[b].repeat||"no-repeat"===this[b].repeat?this[b].source.width:this.width,'" height="',"repeat-x"===this[b].repeat||"no-repeat"===this[b].repeat?this[b].source.height:
this.height,'" fill="url(#'+b+'Pattern)"',"></rect>"):this[b]&&"overlayColor"===b&&a.push('<rect x="0" y="0" ','width="',this.width,'" height="',this.height,'" fill="',this[b],'"',"></rect>")},sendToBack:function(a){h(this._objects,a);this._objects.unshift(a);return this.renderAll&&this.renderAll()},bringToFront:function(a){h(this._objects,a);this._objects.push(a);return this.renderAll&&this.renderAll()},sendBackwards:function(a,b){var f=this._objects.indexOf(a);0!==f&&(f=this._findNewLowerIndex(a,
f,b),h(this._objects,a),this._objects.splice(f,0,a),this.renderAll&&this.renderAll());return this},_findNewLowerIndex:function(a,b,f){if(f)for(f=b,--b;0<=b;--b){if(a.intersectsWithObject(this._objects[b])||a.isContainedWithinObject(this._objects[b])||this._objects[b].isContainedWithinObject(a)){f=b;break}}else f=b-1;return f},bringForward:function(a,b){var f=this._objects.indexOf(a);f!==this._objects.length-1&&(f=this._findNewUpperIndex(a,f,b),h(this._objects,a),this._objects.splice(f,0,a),this.renderAll&&
this.renderAll());return this},_findNewUpperIndex:function(a,b,f){if(f)for(f=b,b+=1;b<this._objects.length;++b){if(a.intersectsWithObject(this._objects[b])||a.isContainedWithinObject(this._objects[b])||this._objects[b].isContainedWithinObject(a)){f=b;break}}else f=b+1;return f},moveTo:function(a,b){h(this._objects,a);this._objects.splice(b,0,a);return this.renderAll&&this.renderAll()},dispose:function(){this.clear();this.interactive&&this.removeListeners();return this},toString:function(){return"#<fabric.Canvas ("+
this.complexity()+"): { objects: "+this.getObjects().length+" }>"}});k(g.StaticCanvas.prototype,g.Observable);k(g.StaticCanvas.prototype,g.Collection);k(g.StaticCanvas.prototype,g.DataURLExporter);k(g.StaticCanvas,{EMPTY_JSON:'{"objects": [], "background": "white"}',supports:function(a){var b=g.util.createCanvasElement();if(!b||!b.getContext)return null;var f=b.getContext("2d");if(!f)return null;switch(a){case "getImageData":return"undefined"!==typeof f.getImageData;case "setLineDash":return"undefined"!==
typeof f.setLineDash;case "toDataURL":return"undefined"!==typeof b.toDataURL;case "toDataURLWithQuality":try{return b.toDataURL("image/jpeg",0),!0}catch(e){}return!1;default:return null}}});g.StaticCanvas.prototype.toJSON=g.StaticCanvas.prototype.toObject}})();(function(){var k=g.util.getPointer,c=g.util.degreesToRadians,h=g.util.radiansToDegrees,d=Math.atan2,a=Math.abs;g.Canvas=g.util.createClass(g.StaticCanvas,{initialize:function(f,e){e||(e={});this._initStatic(f,e);this._initInteractive();this._createCacheCanvas();
g.Canvas.activeInstance=this},uniScaleTransform:!1,centeredScaling:!1,centeredRotation:!1,interactive:!0,selection:!0,selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",rotationCursor:"crosshair",containerClass:"canvas-container",perPixelTargetFind:!1,targetFindTolerance:0,skipTargetFind:!1,_initInteractive:function(){this._groupSelector=
this._currentTransform=null;this._initWrapperElement();this._createUpperCanvas();this._initEventListeners();this.freeDrawingBrush=g.PencilBrush&&new g.PencilBrush(this);this.calcOffset()},_resetCurrentTransform:function(f){var e=this._currentTransform;e.target.set({scaleX:e.original.scaleX,scaleY:e.original.scaleY,left:e.original.left,top:e.original.top});this._shouldCenterTransform(f,e.target)?"rotate"===e.action?this._setOriginToCenter(e.target):("center"!==e.originX&&(e.mouseXSign="right"===e.originX?
-1:1),"center"!==e.originY&&(e.mouseYSign="bottom"===e.originY?-1:1),e.originX="center",e.originY="center"):(e.originX=e.original.originX,e.originY=e.original.originY)},containsPoint:function(f,e){var a=this.getPointer(f,!0),b=this._normalizePointer(e,a);return e.containsPoint(b)||e._findTargetCorner(a)},_normalizePointer:function(f,e){var a=this.getActiveGroup(),b=e.x,d=e.y;a&&"group"!==f.type&&a.contains(f)&&(a=new g.Point(a.left,a.top),a=g.util.transformPoint(a,this.viewportTransform,!0),b-=a.x,
d-=a.y);return{x:b,y:d}},isTargetTransparent:function(f,e,a){var b=f.hasBorders,d=f.transparentCorners;f.hasBorders=f.transparentCorners=!1;this._draw(this.contextCache,f);f.hasBorders=b;f.transparentCorners=d;f=g.util.isTransparent(this.contextCache,e,a,this.targetFindTolerance);this.clearContext(this.contextCache);return f},_shouldClearSelection:function(f,e){var a=this.getActiveGroup(),b=this.getActiveObject();return!e||e&&a&&!a.contains(e)&&a!==e&&!f.shiftKey||e&&!e.evented||e&&!e.selectable&&
b&&b!==e},_shouldCenterTransform:function(f,e){if(e){var a=this._currentTransform,b;"scale"===a.action||"scaleX"===a.action||"scaleY"===a.action?b=this.centeredScaling||e.centeredScaling:"rotate"===a.action&&(b=this.centeredRotation||e.centeredRotation);return b?!f.altKey:f.altKey}},_getOriginFromCorner:function(f,e){var a={x:f.originX,y:f.originY};if("ml"===e||"tl"===e||"bl"===e)a.x="right";else if("mr"===e||"tr"===e||"br"===e)a.x="left";if("tl"===e||"mt"===e||"tr"===e)a.y="bottom";else if("bl"===
e||"mb"===e||"br"===e)a.y="top";return a},_getActionFromCorner:function(f,e){var a="drag";e&&(a="ml"===e||"mr"===e?"scaleX":"mt"===e||"mb"===e?"scaleY":"mtr"===e?"rotate":"scale");return a},_setupCurrentTransform:function(f,e){if(e){var a=this.getPointer(f),b=e._findTargetCorner(this.getPointer(f,!0)),d=this._getActionFromCorner(e,b),b=this._getOriginFromCorner(e,b);this._currentTransform={target:e,action:d,scaleX:e.scaleX,scaleY:e.scaleY,offsetX:a.x-e.left,offsetY:a.y-e.top,originX:b.x,originY:b.y,
ex:a.x,ey:a.y,left:e.left,top:e.top,theta:c(e.angle),width:e.width*e.scaleX,mouseXSign:1,mouseYSign:1};this._currentTransform.original={left:e.left,top:e.top,scaleX:e.scaleX,scaleY:e.scaleY,originX:b.x,originY:b.y};this._resetCurrentTransform(f)}},_translateObject:function(f,e){var a=this._currentTransform.target;a.get("lockMovementX")||a.set("left",f-this._currentTransform.offsetX);a.get("lockMovementY")||a.set("top",e-this._currentTransform.offsetY)},_scaleObject:function(f,e,a){var b=this._currentTransform,
d=b.target,c=d.get("lockScalingX"),h=d.get("lockScalingY"),k=d.get("lockScalingFlip");if(!c||!h){var m=d.translateToOriginPoint(d.getCenterPoint(),b.originX,b.originY);f=d.toLocalPoint(new g.Point(f,e),b.originX,b.originY);this._setLocalMouse(f,b);this._setObjectScale(f,b,c,h,a,k);d.setPositionByOrigin(m,b.originX,b.originY)}},_setObjectScale:function(f,e,a,b,d,c){var h=e.target,g=!1,k=!1,m=h.stroke?h.strokeWidth:0;e.newScaleX=f.x/(h.width+m/2);e.newScaleY=f.y/(h.height+m/2);c&&0>=e.newScaleX&&e.newScaleX<
h.scaleX&&(g=!0);c&&0>=e.newScaleY&&e.newScaleY<h.scaleY&&(k=!0);"equally"!==d||a||b?d?"x"!==d||h.get("lockUniScaling")?"y"!==d||h.get("lockUniScaling")||k||b||h.set("scaleY",e.newScaleY):g||a||h.set("scaleX",e.newScaleX):(g||a||h.set("scaleX",e.newScaleX),k||b||h.set("scaleY",e.newScaleY)):g||k||this._scaleObjectEqually(f,h,e);g||k||this._flipObject(e,d)},_scaleObjectEqually:function(f,e,a){f=f.y+f.x;var b=e.stroke?e.strokeWidth:0,b=(e.height+b/2)*a.original.scaleY+(e.width+b/2)*a.original.scaleX;
a.newScaleX=a.original.scaleX*f/b;a.newScaleY=a.original.scaleY*f/b;e.set("scaleX",a.newScaleX);e.set("scaleY",a.newScaleY)},_flipObject:function(f,a){0>f.newScaleX&&"y"!==a&&("left"===f.originX?f.originX="right":"right"===f.originX&&(f.originX="left"));0>f.newScaleY&&"x"!==a&&("top"===f.originY?f.originY="bottom":"bottom"===f.originY&&(f.originY="top"))},_setLocalMouse:function(f,e){var b=e.target;"right"===e.originX?f.x*=-1:"center"===e.originX&&(f.x=2*f.x*e.mouseXSign,0>f.x&&(e.mouseXSign=-e.mouseXSign));
"bottom"===e.originY?f.y*=-1:"center"===e.originY&&(f.y=2*f.y*e.mouseYSign,0>f.y&&(e.mouseYSign=-e.mouseYSign));a(f.x)>b.padding?f.x=0>f.x?f.x+b.padding:f.x-b.padding:f.x=0;a(f.y)>b.padding?f.y=0>f.y?f.y+b.padding:f.y-b.padding:f.y=0},_rotateObject:function(f,a){var b=this._currentTransform;if(!b.target.get("lockRotation")){var c=d(b.ey-b.top,b.ex-b.left),g=d(a-b.top,f-b.left),c=h(g-c+b.theta);0>c&&(c=360+c);b.target.angle=c%360}},setCursor:function(f){this.upperCanvasEl.style.cursor=f},_resetObjectTransform:function(f){f.scaleX=
1;f.scaleY=1;f.setAngle(0)},_drawSelection:function(){var f=this.contextTop,e=this._groupSelector,b=e.left,d=e.top,c=a(b),h=a(d);f.fillStyle=this.selectionColor;f.fillRect(e.ex-(0<b?0:-b),e.ey-(0<d?0:-d),c,h);f.lineWidth=this.selectionLineWidth;f.strokeStyle=this.selectionBorderColor;1<this.selectionDashArray.length?(b=e.ex+.5-(0<b?0:c),e=e.ey+.5-(0<d?0:h),f.beginPath(),g.util.drawDashedLine(f,b,e,b+c,e,this.selectionDashArray),g.util.drawDashedLine(f,b,e+h-1,b+c,e+h-1,this.selectionDashArray),g.util.drawDashedLine(f,
b,e,b,e+h,this.selectionDashArray),g.util.drawDashedLine(f,b+c-1,e,b+c-1,e+h,this.selectionDashArray),f.closePath(),f.stroke()):f.strokeRect(e.ex+.5-(0<b?0:c),e.ey+.5-(0<d?0:h),c,h)},_isLastRenderedObject:function(f){return this.controlsAboveOverlay&&this.lastRenderedObjectWithControlsAboveOverlay&&this.lastRenderedObjectWithControlsAboveOverlay.visible&&this.containsPoint(f,this.lastRenderedObjectWithControlsAboveOverlay)&&this.lastRenderedObjectWithControlsAboveOverlay._findTargetCorner(this.getPointer(f,
!0))},findTarget:function(f,a){if(!this.skipTargetFind){if(this._isLastRenderedObject(f))return this.lastRenderedObjectWithControlsAboveOverlay;var b=this.getActiveGroup();if(b&&!a&&this.containsPoint(f,b))return b;b=this._searchPossibleTargets(f);this._fireOverOutEvents(b);return b}},_fireOverOutEvents:function(f){f?this._hoveredTarget!==f&&(this.fire("mouse:over",{target:f}),f.fire("mouseover"),this._hoveredTarget&&(this.fire("mouse:out",{target:this._hoveredTarget}),this._hoveredTarget.fire("mouseout")),
this._hoveredTarget=f):this._hoveredTarget&&(this.fire("mouse:out",{target:this._hoveredTarget}),this._hoveredTarget.fire("mouseout"),this._hoveredTarget=null)},_checkTarget:function(f,a,b){if(a&&a.visible&&a.evented&&this.containsPoint(f,a)&&(!this.perPixelTargetFind&&!a.perPixelTargetFind||a.isEditing||!this.isTargetTransparent(a,b.x,b.y)))return!0},_searchPossibleTargets:function(f){for(var a,b=this.getPointer(f,!0),d=this._objects.length;d--;)if(!this._objects[d].group&&this._checkTarget(f,this._objects[d],
b)){this.relatedTarget=this._objects[d];a=this._objects[d];break}return a},getPointer:function(f,a,b){b||(b=this.upperCanvasEl);f=k(f,b);var d=b.getBoundingClientRect(),c=d.width||0,h=d.height||0;c&&h||("top"in d&&"bottom"in d&&(h=Math.abs(d.top-d.bottom)),"right"in d&&"left"in d&&(c=Math.abs(d.right-d.left)));this.calcOffset();f.x-=this._offset.left;f.y-=this._offset.top;a||(f=g.util.transformPoint(f,g.util.invertTransform(this.viewportTransform)));0===c||0===h?b=a=1:(a=b.width/c,b=b.height/h);return{x:f.x*
a,y:f.y*b}},_createUpperCanvas:function(){var a=this.lowerCanvasEl.className.replace(/\s*lower-canvas\s*/,"");this.upperCanvasEl=this._createCanvasElement();g.util.addClass(this.upperCanvasEl,"upper-canvas "+a);this.wrapperEl.appendChild(this.upperCanvasEl);this._copyCanvasStyle(this.lowerCanvasEl,this.upperCanvasEl);this._applyCanvasStyle(this.upperCanvasEl);this.contextTop=this.upperCanvasEl.getContext("2d")},_createCacheCanvas:function(){this.cacheCanvasEl=this._createCanvasElement();this.cacheCanvasEl.setAttribute("width",
this.width);this.cacheCanvasEl.setAttribute("height",this.height);this.contextCache=this.cacheCanvasEl.getContext("2d")},_initWrapperElement:function(){this.wrapperEl=g.util.wrapElement(this.lowerCanvasEl,"div",{"class":this.containerClass});g.util.setStyle(this.wrapperEl,{width:this.getWidth()+"px",height:this.getHeight()+"px",position:"relative"});g.util.makeElementUnselectable(this.wrapperEl)},_applyCanvasStyle:function(a){var e=this.getWidth()||a.width,b=this.getHeight()||a.height;g.util.setStyle(a,
{position:"absolute",width:e+"px",height:b+"px",left:0,top:0});a.width=e;a.height=b;g.util.makeElementUnselectable(a)},_copyCanvasStyle:function(a,e){e.style.cssText=a.style.cssText},getSelectionContext:function(){return this.contextTop},getSelectionElement:function(){return this.upperCanvasEl},_setActiveObject:function(a){this._activeObject&&this._activeObject.set("active",!1);this._activeObject=a;a.set("active",!0)},setActiveObject:function(a,e){this._setActiveObject(a);this.renderAll();this.fire("object:selected",
{target:a,e:e});a.fire("selected",{e:e});return this},getActiveObject:function(){return this._activeObject},_discardActiveObject:function(){this._activeObject&&this._activeObject.set("active",!1);this._activeObject=null},discardActiveObject:function(a){this._discardActiveObject();this.renderAll();this.fire("selection:cleared",{e:a});return this},_setActiveGroup:function(a){(this._activeGroup=a)&&a.set("active",!0)},setActiveGroup:function(a,e){this._setActiveGroup(a);a&&(this.fire("object:selected",
{target:a,e:e}),a.fire("selected",{e:e}));return this},getActiveGroup:function(){return this._activeGroup},_discardActiveGroup:function(){var a=this.getActiveGroup();a&&a.destroy();this.setActiveGroup(null)},discardActiveGroup:function(a){this._discardActiveGroup();this.fire("selection:cleared",{e:a});return this},deactivateAll:function(){for(var a=this.getObjects(),e=0,b=a.length;e<b;e++)a[e].set("active",!1);this._discardActiveGroup();this._discardActiveObject();return this},deactivateAllWithDispatch:function(a){var e=
this.getActiveGroup()||this.getActiveObject();e&&this.fire("before:selection:cleared",{target:e,e:a});this.deactivateAll();e&&this.fire("selection:cleared",{e:a});return this},drawControls:function(a){var e=this.getActiveGroup();e?this._drawGroupControls(a,e):this._drawObjectsControls(a)},_drawGroupControls:function(a,e){e._renderControls(a)},_drawObjectsControls:function(a){for(var e=0,b=this._objects.length;e<b;++e)this._objects[e]&&this._objects[e].active&&(this._objects[e]._renderControls(a),
this.lastRenderedObjectWithControlsAboveOverlay=this._objects[e])}});for(var b in g.StaticCanvas)"prototype"!==b&&(g.Canvas[b]=g.StaticCanvas[b]);g.isTouchSupported&&(g.Canvas.prototype._setCursorFromEvent=function(){});g.Element=g.Canvas})();(function(){var k={mt:0,tr:1,mr:2,br:3,mb:4,bl:5,ml:6,tl:7},c=g.util.addListener,h=g.util.removeListener;g.util.object.extend(g.Canvas.prototype,{cursorMap:"n-resize ne-resize e-resize se-resize s-resize sw-resize w-resize nw-resize".split(" "),_initEventListeners:function(){this._bindEvents();
c(g.window,"resize",this._onResize);c(this.upperCanvasEl,"mousedown",this._onMouseDown);c(this.upperCanvasEl,"mousemove",this._onMouseMove);c(this.upperCanvasEl,"mousewheel",this._onMouseWheel);c(this.upperCanvasEl,"touchstart",this._onMouseDown);c(this.upperCanvasEl,"touchmove",this._onMouseMove);"undefined"!==typeof eventjs&&"add"in eventjs&&(eventjs.add(this.upperCanvasEl,"gesture",this._onGesture),eventjs.add(this.upperCanvasEl,"drag",this._onDrag),eventjs.add(this.upperCanvasEl,"orientation",
this._onOrientationChange),eventjs.add(this.upperCanvasEl,"shake",this._onShake),eventjs.add(this.upperCanvasEl,"longpress",this._onLongPress))},_bindEvents:function(){this._onMouseDown=this._onMouseDown.bind(this);this._onMouseMove=this._onMouseMove.bind(this);this._onMouseUp=this._onMouseUp.bind(this);this._onResize=this._onResize.bind(this);this._onGesture=this._onGesture.bind(this);this._onDrag=this._onDrag.bind(this);this._onShake=this._onShake.bind(this);this._onLongPress=this._onLongPress.bind(this);
this._onOrientationChange=this._onOrientationChange.bind(this);this._onMouseWheel=this._onMouseWheel.bind(this)},removeListeners:function(){h(g.window,"resize",this._onResize);h(this.upperCanvasEl,"mousedown",this._onMouseDown);h(this.upperCanvasEl,"mousemove",this._onMouseMove);h(this.upperCanvasEl,"mousewheel",this._onMouseWheel);h(this.upperCanvasEl,"touchstart",this._onMouseDown);h(this.upperCanvasEl,"touchmove",this._onMouseMove);"undefined"!==typeof eventjs&&"remove"in eventjs&&(eventjs.remove(this.upperCanvasEl,
"gesture",this._onGesture),eventjs.remove(this.upperCanvasEl,"drag",this._onDrag),eventjs.remove(this.upperCanvasEl,"orientation",this._onOrientationChange),eventjs.remove(this.upperCanvasEl,"shake",this._onShake),eventjs.remove(this.upperCanvasEl,"longpress",this._onLongPress))},_onGesture:function(d,a){this.__onTransformGesture&&this.__onTransformGesture(d,a)},_onDrag:function(d,a){this.__onDrag&&this.__onDrag(d,a)},_onMouseWheel:function(d,a){this.__onMouseWheel&&this.__onMouseWheel(d,a)},_onOrientationChange:function(d,
a){this.__onOrientationChange&&this.__onOrientationChange(d,a)},_onShake:function(d,a){this.__onShake&&this.__onShake(d,a)},_onLongPress:function(d,a){this.__onLongPress&&this.__onLongPress(d,a)},_onMouseDown:function(d){this.__onMouseDown(d);c(g.document,"touchend",this._onMouseUp);c(g.document,"touchmove",this._onMouseMove);h(this.upperCanvasEl,"mousemove",this._onMouseMove);h(this.upperCanvasEl,"touchmove",this._onMouseMove);"touchstart"===d.type?h(this.upperCanvasEl,"mousedown",this._onMouseDown):
(c(g.document,"mouseup",this._onMouseUp),c(g.document,"mousemove",this._onMouseMove))},_onMouseUp:function(d){this.__onMouseUp(d);h(g.document,"mouseup",this._onMouseUp);h(g.document,"touchend",this._onMouseUp);h(g.document,"mousemove",this._onMouseMove);h(g.document,"touchmove",this._onMouseMove);c(this.upperCanvasEl,"mousemove",this._onMouseMove);c(this.upperCanvasEl,"touchmove",this._onMouseMove);if("touchend"===d.type){var a=this;setTimeout(function(){c(a.upperCanvasEl,"mousedown",a._onMouseDown)},
400)}},_onMouseMove:function(d){!this.allowTouchScrolling&&d.preventDefault&&d.preventDefault();this.__onMouseMove(d)},_onResize:function(){this.calcOffset()},_shouldRender:function(d,a){var b=this.getActiveGroup()||this.getActiveObject();return!!(d&&(d.isMoving||d!==b)||!d&&b||!d&&!b&&!this._groupSelector||a&&this._previousPointer&&this.selection&&(a.x!==this._previousPointer.x||a.y!==this._previousPointer.y))},__onMouseUp:function(d){var a;if(this.isDrawingMode&&this._isCurrentlyDrawing)this._onMouseUpInDrawingMode(d);
else{this._currentTransform?(this._finalizeCurrentTransform(),a=this._currentTransform.target):a=this.findTarget(d,!0);var b=this._shouldRender(a,this.getPointer(d));this._maybeGroupObjects(d);a&&(a.isMoving=!1);b&&this.renderAll();this._handleCursorAndEvent(d,a)}},_handleCursorAndEvent:function(d,a){this._setCursorFromEvent(d,a);var b=this;setTimeout(function(){b._setCursorFromEvent(d,a)},50);this.fire("mouse:up",{target:a,e:d});a&&a.fire("mouseup",{e:d})},_finalizeCurrentTransform:function(){var d=
this._currentTransform.target;d._scaling&&(d._scaling=!1);d.setCoords();this.stateful&&d.hasStateChanged()&&(this.fire("object:modified",{target:d}),d.fire("modified"));this._restoreOriginXY(d)},_restoreOriginXY:function(d){if(this._previousOriginX&&this._previousOriginY){var a=d.translateToOriginPoint(d.getCenterPoint(),this._previousOriginX,this._previousOriginY);d.originX=this._previousOriginX;d.originY=this._previousOriginY;d.left=a.x;d.top=a.y;this._previousOriginY=this._previousOriginX=null}},
_onMouseDownInDrawingMode:function(d){this._isCurrentlyDrawing=!0;this.discardActiveObject(d).renderAll();this.clipTo&&g.util.clipContext(this,this.contextTop);var a=g.util.invertTransform(this.viewportTransform),a=g.util.transformPoint(this.getPointer(d,!0),a);this.freeDrawingBrush.onMouseDown(a);this.fire("mouse:down",{e:d});a=this.findTarget(d);"undefined"!==typeof a&&a.fire("mousedown",{e:d,target:a})},_onMouseMoveInDrawingMode:function(d){if(this._isCurrentlyDrawing){var a=g.util.invertTransform(this.viewportTransform),
a=g.util.transformPoint(this.getPointer(d,!0),a);this.freeDrawingBrush.onMouseMove(a)}this.setCursor(this.freeDrawingCursor);this.fire("mouse:move",{e:d});a=this.findTarget(d);"undefined"!==typeof a&&a.fire("mousemove",{e:d,target:a})},_onMouseUpInDrawingMode:function(d){this._isCurrentlyDrawing=!1;this.clipTo&&this.contextTop.restore();this.freeDrawingBrush.onMouseUp();this.fire("mouse:up",{e:d});var a=this.findTarget(d);"undefined"!==typeof a&&a.fire("mouseup",{e:d,target:a})},__onMouseDown:function(d){if(("which"in
d?1===d.which:1===d.button)||g.isTouchSupported)if(this.isDrawingMode)this._onMouseDownInDrawingMode(d);else if(!this._currentTransform){var a=this.findTarget(d),b=this.getPointer(d,!0);this._previousPointer=b;var f=this._shouldRender(a,b),e=this._shouldGroup(d,a);this._shouldClearSelection(d,a)?this._clearSelection(d,a,b):e&&(this._handleGrouping(d,a),a=this.getActiveGroup());a&&a.selectable&&!e&&(this._beforeTransform(d,a),this._setupCurrentTransform(d,a));f&&this.renderAll();this.fire("mouse:down",
{target:a,e:d});a&&a.fire("mousedown",{e:d})}},_beforeTransform:function(d,a){this.stateful&&a.saveState();if(a._findTargetCorner(this.getPointer(d)))this.onBeforeScaleRotate(a);a!==this.getActiveGroup()&&a!==this.getActiveObject()&&(this.deactivateAll(),this.setActiveObject(a,d))},_clearSelection:function(d,a,b){this.deactivateAllWithDispatch(d);a&&a.selectable?this.setActiveObject(a,d):this.selection&&(this._groupSelector={ex:b.x,ey:b.y,top:0,left:0})},_setOriginToCenter:function(d){this._previousOriginX=
this._currentTransform.target.originX;this._previousOriginY=this._currentTransform.target.originY;var a=d.getCenterPoint();d.originX="center";d.originY="center";d.left=a.x;d.top=a.y;this._currentTransform.left=d.left;this._currentTransform.top=d.top},_setCenterToOrigin:function(d){var a=d.translateToOriginPoint(d.getCenterPoint(),this._previousOriginX,this._previousOriginY);d.originX=this._previousOriginX;d.originY=this._previousOriginY;d.left=a.x;d.top=a.y;this._previousOriginY=this._previousOriginX=
null},__onMouseMove:function(d){var a,b;if(this.isDrawingMode)this._onMouseMoveInDrawingMode(d);else if(!("undefined"!==typeof d.touches&&1<d.touches.length)){var f=this._groupSelector;f?(b=this.getPointer(d,!0),f.left=b.x-f.ex,f.top=b.y-f.ey,this.renderTop()):this._currentTransform?this._transformObject(d):(a=this.findTarget(d),!a||a&&!a.selectable?this.setCursor(this.defaultCursor):this._setCursorFromEvent(d,a));this.fire("mouse:move",{target:a,e:d});a&&a.fire("mousemove",{e:d})}},_transformObject:function(d){var a=
this.getPointer(d),b=this._currentTransform;b.reset=!1;b.target.isMoving=!0;this._beforeScaleTransform(d,b);this._performTransformAction(d,b,a);this.renderAll()},_performTransformAction:function(d,a,b){var f=b.x;b=b.y;var e=a.target,c=a.action;"rotate"===c?(this._rotateObject(f,b),this._fire("rotating",e,d)):"scale"===c?(this._onScale(d,a,f,b),this._fire("scaling",e,d)):"scaleX"===c?(this._scaleObject(f,b,"x"),this._fire("scaling",e,d)):"scaleY"===c?(this._scaleObject(f,b,"y"),this._fire("scaling",
e,d)):(this._translateObject(f,b),this._fire("moving",e,d),this.setCursor(this.moveCursor))},_fire:function(d,a,b){this.fire("object:"+d,{target:a,e:b});a.fire(d,{e:b})},_beforeScaleTransform:function(d,a){if("scale"===a.action||"scaleX"===a.action||"scaleY"===a.action){var b=this._shouldCenterTransform(d,a.target);if(b&&("center"!==a.originX||"center"!==a.originY)||!b&&"center"===a.originX&&"center"===a.originY)this._resetCurrentTransform(d),a.reset=!0}},_onScale:function(d,a,b,f){!d.shiftKey&&!this.uniScaleTransform||
a.target.get("lockUniScaling")?(a.reset||"scale"!==a.currentAction||this._resetCurrentTransform(d,a.target),a.currentAction="scaleEqually",this._scaleObject(b,f,"equally")):(a.currentAction="scale",this._scaleObject(b,f))},_setCursorFromEvent:function(d,a){if(a&&a.selectable){var b=this.getActiveGroup();(b=a._findTargetCorner&&(!b||!b.contains(a))&&a._findTargetCorner(this.getPointer(d,!0)))?this._setCornerCursor(b,a):this.setCursor(a.hoverCursor||this.hoverCursor)}else return this.setCursor(this.defaultCursor),
!1;return!0},_setCornerCursor:function(d,a){if(d in k)this.setCursor(this._getRotatedCornerCursor(d,a));else if("mtr"===d&&a.hasRotatingPoint)this.setCursor(this.rotationCursor);else return this.setCursor(this.defaultCursor),!1},_getRotatedCornerCursor:function(d,a){var b=Math.round(a.getAngle()%360/45);0>b&&(b+=8);b+=k[d];return this.cursorMap[b%8]}})})();(function(){var k=Math.min,c=Math.max;g.util.object.extend(g.Canvas.prototype,{_shouldGroup:function(c,d){var a=this.getActiveObject();return c.shiftKey&&
(this.getActiveGroup()||a&&a!==d)&&this.selection},_handleGrouping:function(c,d){if(d===this.getActiveGroup()&&(d=this.findTarget(c,!0),!d||d.isType("group")))return;this.getActiveGroup()?this._updateActiveGroup(d,c):this._createActiveGroup(d,c);this._activeGroup&&this._activeGroup.saveCoords()},_updateActiveGroup:function(c,d){var a=this.getActiveGroup();if(a.contains(c)){if(a.removeWithUpdate(c),this._resetObjectTransform(a),c.set("active",!1),1===a.size()){this.discardActiveGroup(d);this.setActiveObject(a.item(0));
return}}else a.addWithUpdate(c),this._resetObjectTransform(a);this.fire("selection:created",{target:a,e:d});a.set("active",!0)},_createActiveGroup:function(c,d){if(this._activeObject&&c!==this._activeObject){var a=this._createGroup(c);a.addWithUpdate();this.setActiveGroup(a);this._activeObject=null;this.fire("selection:created",{target:a,e:d})}c.set("active",!0)},_createGroup:function(c){var d=this.getObjects();c=d.indexOf(this._activeObject)<d.indexOf(c)?[this._activeObject,c]:[c,this._activeObject];
return new g.Group(c,{canvas:this})},_groupSelectedObjects:function(c){var d=this._collectObjects();1===d.length?this.setActiveObject(d[0],c):1<d.length&&(d=new g.Group(d.reverse(),{canvas:this}),d.addWithUpdate(),this.setActiveGroup(d,c),d.saveCoords(),this.fire("selection:created",{target:d}),this.renderAll())},_collectObjects:function(){var h=[],d;d=this._groupSelector.ex;for(var a=this._groupSelector.ey,b=d+this._groupSelector.left,f=a+this._groupSelector.top,e=new g.Point(k(d,b),k(a,f)),q=new g.Point(c(d,
b),c(a,f)),a=d===b&&a===f,b=this._objects.length;b--&&!((d=this._objects[b])&&d.selectable&&d.visible&&(d.intersectsWithRect(e,q)||d.isContainedWithinRect(e,q)||d.containsPoint(e)||d.containsPoint(q))&&(d.set("active",!0),h.push(d),a)););return h},_maybeGroupObjects:function(c){this.selection&&this._groupSelector&&this._groupSelectedObjects(c);if(c=this.getActiveGroup())c.setObjectsCoords().setCoords(),c.isMoving=!1,this.setCursor(this.defaultCursor);this._currentTransform=this._groupSelector=null}})})();
g.util.object.extend(g.StaticCanvas.prototype,{toDataURL:function(g){g||(g={});var c=g.format||"png",h=g.quality||1,d=g.multiplier||1;g={left:g.left,top:g.top,width:g.width,height:g.height};return 1!==d?this.__toDataURLWithMultiplier(c,h,g,d):this.__toDataURL(c,h,g)},__toDataURL:function(k,c,h){this.renderAll(!0);var d=this.upperCanvasEl||this.lowerCanvasEl;h=this.__getCroppedCanvas(d,h);"jpg"===k&&(k="jpeg");k=g.StaticCanvas.supports("toDataURLWithQuality")?(h||d).toDataURL("image/"+k,c):(h||d).toDataURL("image/"+
k);this.contextTop&&this.clearContext(this.contextTop);this.renderAll();return k},__getCroppedCanvas:function(k,c){var h,d;if("left"in c||"top"in c||"width"in c||"height"in c)h=g.util.createCanvasElement(),d=h.getContext("2d"),h.width=c.width||this.width,h.height=c.height||this.height,d.drawImage(k,-c.left||0,-c.top||0);return h},__toDataURLWithMultiplier:function(g,c,h,d){var a=this.getWidth(),b=this.getHeight(),f=a*d,e=b*d,q=this.getActiveObject(),k=this.getActiveGroup(),A=this.contextTop||this.contextContainer;
1<d&&this.setWidth(f).setHeight(e);A.scale(d,d);h.left&&(h.left*=d);h.top&&(h.top*=d);h.width?h.width*=d:1>d&&(h.width=f);h.height?h.height*=d:1>d&&(h.height=e);k?this._tempRemoveBordersControlsFromGroup(k):q&&this.deactivateAll&&this.deactivateAll();this.renderAll(!0);g=this.__toDataURL(g,c,h);this.width=a;this.height=b;A.scale(1/d,1/d);this.setWidth(a).setHeight(b);k?this._restoreBordersControlsOnGroup(k):q&&this.setActiveObject&&this.setActiveObject(q);this.contextTop&&this.clearContext(this.contextTop);
this.renderAll();return g},toDataURLWithMultiplier:function(g,c,h){return this.toDataURL({format:g,multiplier:c,quality:h})},_tempRemoveBordersControlsFromGroup:function(g){g.origHasControls=g.hasControls;g.origBorderColor=g.borderColor;g.hasControls=!0;g.borderColor="rgba(0,0,0,0)";g.forEachObject(function(c){c.origBorderColor=c.borderColor;c.borderColor="rgba(0,0,0,0)"})},_restoreBordersControlsOnGroup:function(g){g.hideControls=g.origHideControls;g.borderColor=g.origBorderColor;g.forEachObject(function(c){c.borderColor=
c.origBorderColor;delete c.origBorderColor})}});(function(g){var c=g.fabric||(g.fabric={});g=c.util.object.extend;var h=c.util.toFixed,d=c.util.string.capitalize,a=c.util.degreesToRadians,b=c.StaticCanvas.supports("setLineDash");c.Object||(c.Object=c.util.createClass({type:"object",originX:"left",originY:"top",top:0,left:0,width:0,height:0,scaleX:1,scaleY:1,flipX:!1,flipY:!1,opacity:1,angle:0,cornerSize:12,transparentCorners:!0,hoverCursor:null,padding:0,borderColor:"rgba(102,153,255,0.75)",cornerColor:"rgba(102,153,255,0.5)",
centeredScaling:!1,centeredRotation:!0,fill:"rgb(0,0,0)",fillRule:"nonzero",globalCompositeOperation:"source-over",backgroundColor:"",stroke:null,strokeWidth:1,strokeDashArray:null,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:10,shadow:null,borderOpacityWhenMoving:.4,borderScaleFactor:1,transformMatrix:null,minScaleLimit:.01,selectable:!0,evented:!0,visible:!0,hasControls:!0,hasBorders:!0,hasRotatingPoint:!0,rotatingPointOffset:40,perPixelTargetFind:!1,includeDefaultValues:!0,clipTo:null,
lockMovementX:!1,lockMovementY:!1,lockRotation:!1,lockScalingX:!1,lockScalingY:!1,lockUniScaling:!1,lockScalingFlip:!1,stateProperties:"top left width height scaleX scaleY flipX flipY originX originY transformMatrix stroke strokeWidth strokeDashArray strokeLineCap strokeLineJoin strokeMiterLimit angle opacity fill fillRule globalCompositeOperation shadow clipTo visible backgroundColor".split(" "),initialize:function(a){a&&this.setOptions(a)},_initGradient:function(a){!a.fill||!a.fill.colorStops||
a.fill instanceof c.Gradient||this.set("fill",new c.Gradient(a.fill))},_initPattern:function(a){!a.fill||!a.fill.source||a.fill instanceof c.Pattern||this.set("fill",new c.Pattern(a.fill));!a.stroke||!a.stroke.source||a.stroke instanceof c.Pattern||this.set("stroke",new c.Pattern(a.stroke))},_initClipping:function(a){a.clipTo&&"string"===typeof a.clipTo&&(a=c.util.getFunctionBody(a.clipTo),"undefined"!==typeof a&&(this.clipTo=new Function("ctx",a)))},setOptions:function(a){for(var e in a)this.set(e,
a[e]);this._initGradient(a);this._initPattern(a);this._initClipping(a)},transform:function(f,e){var b=e?this._getLeftTopCoords():this.getCenterPoint();f.translate(b.x,b.y);f.rotate(a(this.angle));f.scale(this.scaleX*(this.flipX?-1:1),this.scaleY*(this.flipY?-1:1))},toObject:function(a){var e=c.Object.NUM_FRACTION_DIGITS,e={type:this.type,originX:this.originX,originY:this.originY,left:h(this.left,e),top:h(this.top,e),width:h(this.width,e),height:h(this.height,e),fill:this.fill&&this.fill.toObject?
this.fill.toObject():this.fill,stroke:this.stroke&&this.stroke.toObject?this.stroke.toObject():this.stroke,strokeWidth:h(this.strokeWidth,e),strokeDashArray:this.strokeDashArray,strokeLineCap:this.strokeLineCap,strokeLineJoin:this.strokeLineJoin,strokeMiterLimit:h(this.strokeMiterLimit,e),scaleX:h(this.scaleX,e),scaleY:h(this.scaleY,e),angle:h(this.getAngle(),e),flipX:this.flipX,flipY:this.flipY,opacity:h(this.opacity,e),shadow:this.shadow&&this.shadow.toObject?this.shadow.toObject():this.shadow,
visible:this.visible,clipTo:this.clipTo&&String(this.clipTo),backgroundColor:this.backgroundColor,fillRule:this.fillRule,globalCompositeOperation:this.globalCompositeOperation};this.includeDefaultValues||(e=this._removeDefaultValues(e));c.util.populateWithProperties(this,e,a);return e},toDatalessObject:function(a){return this.toObject(a)},_removeDefaultValues:function(a){var e=c.util.getKlass(a.type).prototype;e.stateProperties.forEach(function(b){a[b]===e[b]&&delete a[b]});return a},toString:function(){return"#<fabric."+
d(this.type)+">"},get:function(a){return this[a]},_setObject:function(a){for(var e in a)this._set(e,a[e])},set:function(a,e){"object"===typeof a?this._setObject(a):"function"===typeof e&&"clipTo"!==a?this._set(a,e(this.get(a))):this._set(a,e);return this},_set:function(a,e){if("scaleX"===a||"scaleY"===a)e=this._constrainScale(e);"scaleX"===a&&0>e?(this.flipX=!this.flipX,e*=-1):"scaleY"===a&&0>e?(this.flipY=!this.flipY,e*=-1):"width"===a||"height"===a?this.minScaleLimit=h(Math.min(.1,1/Math.max(this.width,
this.height)),2):"shadow"!==a||!e||e instanceof c.Shadow||(e=new c.Shadow(e));this[a]=e;return this},toggle:function(a){var e=this.get(a);"boolean"===typeof e&&this.set(a,!e);return this},setSourcePath:function(a){this.sourcePath=a;return this},getViewportTransform:function(){return this.canvas&&this.canvas.viewportTransform?this.canvas.viewportTransform:[1,0,0,1,0,0]},render:function(a,e){0===this.width&&0===this.height||!this.visible||(a.save(),this._setupCompositeOperation(a),e||this.transform(a),
this._setStrokeStyles(a),this._setFillStyles(a),this.transformMatrix&&a.transform.apply(a,this.transformMatrix),this._setOpacity(a),this._setShadow(a),this.clipTo&&c.util.clipContext(this,a),this._render(a,e),this.clipTo&&a.restore(),this._removeShadow(a),this._restoreCompositeOperation(a),a.restore())},_setOpacity:function(a){this.group&&this.group._setOpacity(a);a.globalAlpha*=this.opacity},_setStrokeStyles:function(a){this.stroke&&(a.lineWidth=this.strokeWidth,a.lineCap=this.strokeLineCap,a.lineJoin=
this.strokeLineJoin,a.miterLimit=this.strokeMiterLimit,a.strokeStyle=this.stroke.toLive?this.stroke.toLive(a,this):this.stroke)},_setFillStyles:function(a){this.fill&&(a.fillStyle=this.fill.toLive?this.fill.toLive(a,this):this.fill)},_renderControls:function(f,e){if(this.active&&!e){var b=this.getViewportTransform();f.save();var d;this.group&&(d=c.util.transformPoint(this.group.getCenterPoint(),b),f.translate(d.x,d.y),f.rotate(a(this.group.angle)));d=c.util.transformPoint(this.getCenterPoint(),b,
null!=this.group);this.group&&(d.x*=this.group.scaleX,d.y*=this.group.scaleY);f.translate(d.x,d.y);f.rotate(a(this.angle));this.drawBorders(f);this.drawControls(f);f.restore()}},_setShadow:function(a){if(this.shadow){var e=this.canvas&&this.canvas.viewportTransform[0]||1,b=this.canvas&&this.canvas.viewportTransform[3]||1;a.shadowColor=this.shadow.color;a.shadowBlur=this.shadow.blur*(e+b)*(this.scaleX+this.scaleY)/4;a.shadowOffsetX=this.shadow.offsetX*e*this.scaleX;a.shadowOffsetY=this.shadow.offsetY*
b*this.scaleY}},_removeShadow:function(a){this.shadow&&(a.shadowColor="",a.shadowBlur=a.shadowOffsetX=a.shadowOffsetY=0)},_renderFill:function(a){this.fill&&(a.save(),this.fill.gradientTransform&&a.transform.apply(a,this.fill.gradientTransform),this.fill.toLive&&a.translate(-this.width/2+this.fill.offsetX||0,-this.height/2+this.fill.offsetY||0),"evenodd"===this.fillRule?a.fill("evenodd"):a.fill(),a.restore(),this.shadow&&!this.shadow.affectStroke&&this._removeShadow(a))},_renderStroke:function(a){this.stroke&&
0!==this.strokeWidth&&(a.save(),this.strokeDashArray?(1&this.strokeDashArray.length&&this.strokeDashArray.push.apply(this.strokeDashArray,this.strokeDashArray),b?(a.setLineDash(this.strokeDashArray),this._stroke&&this._stroke(a)):this._renderDashedStroke&&this._renderDashedStroke(a),a.stroke()):(this.stroke.gradientTransform&&a.transform.apply(a,this.stroke.gradientTransform),this._stroke?this._stroke(a):a.stroke()),this._removeShadow(a),a.restore())},clone:function(a,e){return this.constructor.fromObject?
this.constructor.fromObject(this.toObject(e),a):new c.Object(this.toObject(e))},cloneAsImage:function(a){var e=this.toDataURL();c.util.loadImage(e,function(e){a&&a(new c.Image(e))});return this},toDataURL:function(a){a||(a={});var e=c.util.createCanvasElement(),b=this.getBoundingRect();e.width=b.width;e.height=b.height;c.util.wrapElement(e,"div");b=new c.StaticCanvas(e);"jpg"===a.format&&(a.format="jpeg");"jpeg"===a.format&&(b.backgroundColor="#fff");var d={active:this.get("active"),left:this.getLeft(),
top:this.getTop()};this.set("active",!1);this.setPositionByOrigin(new c.Point(e.width/2,e.height/2),"center","center");e=this.canvas;b.add(this);a=b.toDataURL(a);this.set(d).setCoords();this.canvas=e;b.dispose();return a},isType:function(a){return this.type===a},complexity:function(){return 0},toJSON:function(a){return this.toObject(a)},setGradient:function(a,e){e||(e={});var b={colorStops:[]};b.type=e.type||(e.r1||e.r2?"radial":"linear");b.coords={x1:e.x1,y1:e.y1,x2:e.x2,y2:e.y2};if(e.r1||e.r2)b.coords.r1=
e.r1,b.coords.r2=e.r2;for(var d in e.colorStops){var h=new c.Color(e.colorStops[d]);b.colorStops.push({offset:d,color:h.toRgb(),opacity:h.getAlpha()})}return this.set(a,c.Gradient.forObject(this,b))},setPatternFill:function(a){return this.set("fill",new c.Pattern(a))},setShadow:function(a){return this.set("shadow",a?new c.Shadow(a):null)},setColor:function(a){this.set("fill",a);return this},setAngle:function(a){var e=("center"!==this.originX||"center"!==this.originY)&&this.centeredRotation;e&&this._setOriginToCenter();
this.set("angle",a);e&&this._resetOrigin();return this},centerH:function(){this.canvas.centerObjectH(this);return this},centerV:function(){this.canvas.centerObjectV(this);return this},center:function(){this.canvas.centerObject(this);return this},remove:function(){this.canvas.remove(this);return this},getLocalPointer:function(a,e){e=e||this.canvas.getPointer(a);var b=this.translateToOriginPoint(this.getCenterPoint(),"left","top");return{x:e.x-b.x,y:e.y-b.y}},_setupCompositeOperation:function(a){this.globalCompositeOperation&&
(this._prevGlobalCompositeOperation=a.globalCompositeOperation,a.globalCompositeOperation=this.globalCompositeOperation)},_restoreCompositeOperation:function(a){this.globalCompositeOperation&&this._prevGlobalCompositeOperation&&(a.globalCompositeOperation=this._prevGlobalCompositeOperation)}}),c.util.createAccessors(c.Object),c.Object.prototype.rotate=c.Object.prototype.setAngle,g(c.Object.prototype,c.Observable),c.Object.NUM_FRACTION_DIGITS=2,c.Object.__uid=0)})("undefined"!==typeof k?k:this);(function(){var k=
g.util.degreesToRadians;g.util.object.extend(g.Object.prototype,{translateToCenterPoint:function(c,h,d){var a=c.x,b=c.y,f=this.stroke?this.strokeWidth:0;"left"===h?a=c.x+(this.getWidth()+f*this.scaleX)/2:"right"===h&&(a=c.x-(this.getWidth()+f*this.scaleX)/2);"top"===d?b=c.y+(this.getHeight()+f*this.scaleY)/2:"bottom"===d&&(b=c.y-(this.getHeight()+f*this.scaleY)/2);return g.util.rotatePoint(new g.Point(a,b),c,k(this.angle))},translateToOriginPoint:function(c,h,d){var a=c.x,b=c.y,f=this.stroke?this.strokeWidth:
0;"left"===h?a=c.x-(this.getWidth()+f*this.scaleX)/2:"right"===h&&(a=c.x+(this.getWidth()+f*this.scaleX)/2);"top"===d?b=c.y-(this.getHeight()+f*this.scaleY)/2:"bottom"===d&&(b=c.y+(this.getHeight()+f*this.scaleY)/2);return g.util.rotatePoint(new g.Point(a,b),c,k(this.angle))},getCenterPoint:function(){var c=new g.Point(this.left,this.top);return this.translateToCenterPoint(c,this.originX,this.originY)},getPointByOrigin:function(c,h){var d=this.getCenterPoint();return this.translateToOriginPoint(d,
c,h)},toLocalPoint:function(c,h,d){var a=this.getCenterPoint(),b=this.stroke?this.strokeWidth:0;h&&d?(h="left"===h?a.x-(this.getWidth()+b*this.scaleX)/2:"right"===h?a.x+(this.getWidth()+b*this.scaleX)/2:a.x,d="top"===d?a.y-(this.getHeight()+b*this.scaleY)/2:"bottom"===d?a.y+(this.getHeight()+b*this.scaleY)/2:a.y):(h=this.left,d=this.top);return g.util.rotatePoint(new g.Point(c.x,c.y),a,-k(this.angle)).subtractEquals(new g.Point(h,d))},setPositionByOrigin:function(c,h,d){c=this.translateToCenterPoint(c,
h,d);c=this.translateToOriginPoint(c,this.originX,this.originY);this.set("left",c.x);this.set("top",c.y)},adjustPosition:function(c){var h=k(this.angle),d=this.getWidth()/2,a=Math.cos(h)*d,d=Math.sin(h)*d,b=this.getWidth(),f=Math.cos(h)*b,h=Math.sin(h)*b;"center"===this.originX&&"left"===c||"right"===this.originX&&"center"===c?(this.left-=a,this.top-=d):"left"===this.originX&&"center"===c||"center"===this.originX&&"right"===c?(this.left+=a,this.top+=d):"left"===this.originX&&"right"===c?(this.left+=
f,this.top+=h):"right"===this.originX&&"left"===c&&(this.left-=f,this.top-=h);this.setCoords();this.originX=c},_setOriginToCenter:function(){this._originalOriginX=this.originX;this._originalOriginY=this.originY;var c=this.getCenterPoint();this.originY=this.originX="center";this.left=c.x;this.top=c.y},_resetOrigin:function(){var c=this.translateToOriginPoint(this.getCenterPoint(),this._originalOriginX,this._originalOriginY);this.originX=this._originalOriginX;this.originY=this._originalOriginY;this.left=
c.x;this.top=c.y;this._originalOriginY=this._originalOriginX=null},_getLeftTopCoords:function(){return this.translateToOriginPoint(this.getCenterPoint(),"left","center")}})})();(function(){var k=g.util.degreesToRadians;g.util.object.extend(g.Object.prototype,{oCoords:null,intersectsWithRect:function(c,h){var d=this.oCoords,a=new g.Point(d.tl.x,d.tl.y),b=new g.Point(d.tr.x,d.tr.y),f=new g.Point(d.bl.x,d.bl.y),d=new g.Point(d.br.x,d.br.y);return"Intersection"===g.Intersection.intersectPolygonRectangle([a,
b,d,f],c,h).status},intersectsWithObject:function(c){function h(a){return{tl:new g.Point(a.tl.x,a.tl.y),tr:new g.Point(a.tr.x,a.tr.y),bl:new g.Point(a.bl.x,a.bl.y),br:new g.Point(a.br.x,a.br.y)}}var d=h(this.oCoords);c=h(c.oCoords);return"Intersection"===g.Intersection.intersectPolygonPolygon([d.tl,d.tr,d.br,d.bl],[c.tl,c.tr,c.br,c.bl]).status},isContainedWithinObject:function(c){var h=c.getBoundingRect();c=new g.Point(h.left,h.top);h=new g.Point(h.left+h.width,h.top+h.height);return this.isContainedWithinRect(c,
h)},isContainedWithinRect:function(c,h){var d=this.getBoundingRect();return d.left>=c.x&&d.left+d.width<=h.x&&d.top>=c.y&&d.top+d.height<=h.y},containsPoint:function(c){var h=this._getImageLines(this.oCoords);c=this._findCrossPoints(c,h);return 0!==c&&1===c%2},_getImageLines:function(c){return{topline:{o:c.tl,d:c.tr},rightline:{o:c.tr,d:c.br},bottomline:{o:c.br,d:c.bl},leftline:{o:c.bl,d:c.tl}}},_findCrossPoints:function(c,h){var d,a,b,f=0,e;for(e in h)if(b=h[e],!(b.o.y<c.y&&b.d.y<c.y||b.o.y>=c.y&&
b.d.y>=c.y)&&(b.o.x===b.d.x&&b.o.x>=c.x?d=b.o.x:(d=(b.d.y-b.o.y)/(b.d.x-b.o.x),a=c.y-0*c.x,b=b.o.y-d*b.o.x,d=-(a-b)/(0-d)),d>=c.x&&(f+=1),2===f))break;return f},getBoundingRectWidth:function(){return this.getBoundingRect().width},getBoundingRectHeight:function(){return this.getBoundingRect().height},getBoundingRect:function(){this.oCoords||this.setCoords();var c=[this.oCoords.tl.x,this.oCoords.tr.x,this.oCoords.br.x,this.oCoords.bl.x],h=g.util.array.min(c),c=g.util.array.max(c),c=Math.abs(h-c),d=
[this.oCoords.tl.y,this.oCoords.tr.y,this.oCoords.br.y,this.oCoords.bl.y],a=g.util.array.min(d),d=g.util.array.max(d);return{left:h,top:a,width:c,height:Math.abs(a-d)}},getWidth:function(){return this.width*this.scaleX},getHeight:function(){return this.height*this.scaleY},_constrainScale:function(c){return Math.abs(c)<this.minScaleLimit?0>c?-this.minScaleLimit:this.minScaleLimit:c},scale:function(c){c=this._constrainScale(c);0>c&&(this.flipX=!this.flipX,this.flipY=!this.flipY,c*=-1);this.scaleY=this.scaleX=
c;this.setCoords();return this},scaleToWidth:function(c){var h=this.getBoundingRectWidth()/this.getWidth();return this.scale(c/this.width/h)},scaleToHeight:function(c){var h=this.getBoundingRectHeight()/this.getHeight();return this.scale(c/this.height/h)},setCoords:function(){var c=k(this.angle),h=this.getViewportTransform(),d=function(a){return g.util.transformPoint(a,h)},a=this._calculateCurrentDimensions(!1),b=a.x,f=a.y;0>b&&(b=Math.abs(b));var a=Math.sqrt(Math.pow(b/2,2)+Math.pow(f/2,2)),e=Math.atan(isFinite(f/
b)?f/b:0),q=Math.cos(e+c)*a,e=Math.sin(e+c)*a,a=Math.sin(c),c=Math.cos(c),x=this.getCenterPoint(),f=new g.Point(b,f),x=new g.Point(x.x-q,x.y-e),e=new g.Point(x.x+f.x*c,x.y+f.x*a),b=d(new g.Point(x.x-f.y*a,x.y+f.y*c)),q=d(new g.Point(e.x-f.y*a,e.y+f.y*c)),f=d(x),d=d(e),e=new g.Point((f.x+b.x)/2,(f.y+b.y)/2),x=new g.Point((d.x+f.x)/2,(d.y+f.y)/2),A=new g.Point((q.x+d.x)/2,(q.y+d.y)/2),ca=new g.Point((q.x+b.x)/2,(q.y+b.y)/2),a=new g.Point(x.x+a*this.rotatingPointOffset,x.y-c*this.rotatingPointOffset);
this.oCoords={tl:f,tr:d,br:q,bl:b,ml:e,mt:x,mr:A,mb:ca,mtr:a};this._setCornerCoords&&this._setCornerCoords();return this}})})();g.util.object.extend(g.Object.prototype,{sendToBack:function(){this.group?g.StaticCanvas.prototype.sendToBack.call(this.group,this):this.canvas.sendToBack(this);return this},bringToFront:function(){this.group?g.StaticCanvas.prototype.bringToFront.call(this.group,this):this.canvas.bringToFront(this);return this},sendBackwards:function(k){this.group?g.StaticCanvas.prototype.sendBackwards.call(this.group,
this,k):this.canvas.sendBackwards(this,k);return this},bringForward:function(k){this.group?g.StaticCanvas.prototype.bringForward.call(this.group,this,k):this.canvas.bringForward(this,k);return this},moveTo:function(k){this.group?g.StaticCanvas.prototype.moveTo.call(this.group,this,k):this.canvas.moveTo(this,k);return this}});g.util.object.extend(g.Object.prototype,{getSvgStyles:function(){var g=this.fill?this.fill.toLive?"url(#SVGID_"+this.fill.id+")":this.fill:"none",c=this.fillRule,h=this.stroke?
this.stroke.toLive?"url(#SVGID_"+this.stroke.id+")":this.stroke:"none",d=this.strokeWidth?this.strokeWidth:"0",a=this.strokeDashArray?this.strokeDashArray.join(" "):"";return["stroke: ",h,"; stroke-width: ",d,"; stroke-dasharray: ",a,"; stroke-linecap: ",this.strokeLineCap?this.strokeLineCap:"butt","; stroke-linejoin: ",this.strokeLineJoin?this.strokeLineJoin:"miter","; stroke-miterlimit: ",this.strokeMiterLimit?this.strokeMiterLimit:"4","; fill: ",g,"; fill-rule: ",c,"; opacity: ","undefined"!==
typeof this.opacity?this.opacity:"1",";",this.shadow?"filter: url(#SVGID_"+this.shadow.id+");":"",this.visible?"":" visibility: hidden;"].join("")},getSvgTransform:function(){if(this.group&&"path-group"===this.group.type)return"";var k=g.util.toFixed,c=this.getAngle(),h=!this.canvas||this.canvas.svgViewportTransformation?this.getViewportTransform():[1,0,0,1,0,0],d=g.util.transformPoint(this.getCenterPoint(),h),a=g.Object.NUM_FRACTION_DIGITS,d="path-group"===this.type?"":"translate("+k(d.x,a)+" "+
k(d.y,a)+")",c=0!==c?" rotate("+k(c,a)+")":"",k=1===this.scaleX&&1===this.scaleY&&1===h[0]&&1===h[3]?"":" scale("+k(this.scaleX*h[0],a)+" "+k(this.scaleY*h[3],a)+")",a="path-group"===this.type?this.width*h[0]:0,h="path-group"===this.type?this.height*h[3]:0;return[d,c,k,this.flipX?" matrix(-1 0 0 1 "+a+" 0) ":"",this.flipY?" matrix(1 0 0 -1 0 "+h+")":""].join("")},getSvgTransformMatrix:function(){return this.transformMatrix?" matrix("+this.transformMatrix.join(" ")+") ":""},_createBaseSVGMarkup:function(){var g=
[];this.fill&&this.fill.toLive&&g.push(this.fill.toSVG(this,!1));this.stroke&&this.stroke.toLive&&g.push(this.stroke.toSVG(this,!1));this.shadow&&g.push(this.shadow.toSVG(this));return g}});g.util.object.extend(g.Object.prototype,{hasStateChanged:function(){return this.stateProperties.some(function(g){return this.get(g)!==this.originalState[g]},this)},saveState:function(g){this.stateProperties.forEach(function(c){this.originalState[c]=this.get(c)},this);g&&g.stateProperties&&g.stateProperties.forEach(function(c){this.originalState[c]=
this.get(c)},this);return this},setupState:function(){this.originalState={};this.saveState();return this}});(function(){var k=g.util.degreesToRadians;g.util.object.extend(g.Object.prototype,{_controlsVisibility:null,_findTargetCorner:function(c){if(!this.hasControls||!this.active)return!1;var h=c.x;c=c.y;var d,a;for(a in this.oCoords)if(this.isControlVisible(a)&&("mtr"!==a||this.hasRotatingPoint)&&(!this.get("lockUniScaling")||"mt"!==a&&"mr"!==a&&"mb"!==a&&"ml"!==a)&&(d=this._getImageLines(this.oCoords[a].corner),
d=this._findCrossPoints({x:h,y:c},d),0!==d&&1===d%2))return this.__corner=a;return!1},_setCornerCoords:function(){var c=this.oCoords,h=k(45-this.angle),d=Math.sqrt(2*Math.pow(this.cornerSize,2))/2,a=d*Math.cos(h),h=d*Math.sin(h),b,f;for(f in c)d=c[f].x,b=c[f].y,c[f].corner={tl:{x:d-h,y:b-a},tr:{x:d+a,y:b-h},bl:{x:d-a,y:b+h},br:{x:d+h,y:b+a}}},_calculateCurrentDimensions:function(c){var h=this.getViewportTransform(),d=this.strokeWidth,a=this.width,b=this.height,f="round"===this.strokeLineCap||"square"===
this.strokeLineCap,e="line"===this.type&&0===this.width,k="line"===this.type&&0===this.height,x=e||k;e?a=d:k&&(b=d);(f&&k||!x)&&(a+=0>a?-d:d);(f&&e||!x)&&(b+=0>b?-d:d);a=a*this.scaleX+2*this.padding;b=b*this.scaleY+2*this.padding;return c?g.util.transformPoint(new g.Point(a,b),h,!0):{x:a,y:b}},drawBorders:function(c){if(!this.hasBorders)return this;c.save();c.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1;c.strokeStyle=this.borderColor;c.lineWidth=1/this.borderScaleFactor;var h=this._calculateCurrentDimensions(!0),
d=h.x,h=h.y;this.group&&(d*=this.group.scaleX,h*=this.group.scaleY);c.strokeRect(~~-(d/2)-.5,~~-(h/2)-.5,~~d+1,~~h+1);this.hasRotatingPoint&&this.isControlVisible("mtr")&&!this.get("lockRotation")&&this.hasControls&&(d=-h/2,c.beginPath(),c.moveTo(0,d),c.lineTo(0,d-this.rotatingPointOffset),c.closePath(),c.stroke());c.restore();return this},drawControls:function(c){if(!this.hasControls)return this;var h=this._calculateCurrentDimensions(!0),d=h.x,h=h.y,a=-(d/2),b=-(h/2),f=this.cornerSize/2,e=this.transparentCorners?
"strokeRect":"fillRect";c.save();c.lineWidth=1;c.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1;c.strokeStyle=c.fillStyle=this.cornerColor;this._drawControl("tl",c,e,a-f,b-f);this._drawControl("tr",c,e,a+d-f,b-f);this._drawControl("bl",c,e,a-f,b+h-f);this._drawControl("br",c,e,a+d-f,b+h-f);this.get("lockUniScaling")||(this._drawControl("mt",c,e,a+d/2-f,b-f),this._drawControl("mb",c,e,a+d/2-f,b+h-f),this._drawControl("mr",c,e,a+d-f,b+h/2-f),this._drawControl("ml",c,e,a-f,b+h/2-f));this.hasRotatingPoint&&
this._drawControl("mtr",c,e,a+d/2-f,b-this.rotatingPointOffset-f);c.restore();return this},_drawControl:function(c,h,d,a,b){this.isControlVisible(c)&&(c=this.cornerSize,"undefined"!==typeof G_vmlCanvasManager||this.transparentCorners||h.clearRect(a,b,c,c),h[d](a,b,c,c))},isControlVisible:function(c){return this._getControlsVisibility()[c]},setControlVisible:function(c,h){this._getControlsVisibility()[c]=h;return this},setControlsVisibility:function(c){c||(c={});for(var h in c)this.setControlVisible(h,
c[h]);return this},_getControlsVisibility:function(){this._controlsVisibility||(this._controlsVisibility={tl:!0,tr:!0,br:!0,bl:!0,ml:!0,mt:!0,mr:!0,mb:!0,mtr:!0});return this._controlsVisibility}})})();(function(g){function c(a,e){var b=a.origin,d=a.axis1,c=a.axis2,h=a.dimension,g=e.nearest,k=e.center,m=e.farthest;return function(){switch(this.get(b)){case g:return Math.min(this.get(d),this.get(c));case k:return Math.min(this.get(d),this.get(c))+.5*this.get(h);case m:return Math.max(this.get(d),this.get(c))}}}
var h=g.fabric||(g.fabric={}),d=h.util.object.extend,a={x1:1,x2:1,y1:1,y2:1},b=h.StaticCanvas.supports("setLineDash");h.Line?h.warn("fabric.Line is already defined"):(h.Line=h.util.createClass(h.Object,{type:"line",x1:0,y1:0,x2:0,y2:0,initialize:function(a,e){e=e||{};a||(a=[0,0,0,0]);this.callSuper("initialize",e);this.set("x1",a[0]);this.set("y1",a[1]);this.set("x2",a[2]);this.set("y2",a[3]);this._setWidthHeight(e)},_setWidthHeight:function(a){a||(a={});this.width=Math.abs(this.x2-this.x1);this.height=
Math.abs(this.y2-this.y1);this.left="left"in a?a.left:this._getLeftToOriginX();this.top="top"in a?a.top:this._getTopToOriginY()},_set:function(b,e){this.callSuper("_set",b,e);"undefined"!==typeof a[b]&&this._setWidthHeight();return this},_getLeftToOriginX:c({origin:"originX",axis1:"x1",axis2:"x2",dimension:"width"},{nearest:"left",center:"center",farthest:"right"}),_getTopToOriginY:c({origin:"originY",axis1:"y1",axis2:"y2",dimension:"height"},{nearest:"top",center:"center",farthest:"bottom"}),_render:function(a,
e){a.beginPath();if(e){var d=this.getCenterPoint();a.translate(d.x-this.strokeWidth/2,d.y-this.strokeWidth/2)}if(!this.strokeDashArray||this.strokeDashArray&&b)d=this.calcLinePoints(),a.moveTo(d.x1,d.y1),a.lineTo(d.x2,d.y2);a.lineWidth=this.strokeWidth;d=a.strokeStyle;a.strokeStyle=this.stroke||a.fillStyle;this.stroke&&this._renderStroke(a);a.strokeStyle=d},_renderDashedStroke:function(a){var e=this.calcLinePoints();a.beginPath();h.util.drawDashedLine(a,e.x1,e.y1,e.x2,e.y2,this.strokeDashArray);a.closePath()},
toObject:function(a){return d(this.callSuper("toObject",a),this.calcLinePoints())},calcLinePoints:function(){var a=this.x1<=this.x2?-1:1,e=this.y1<=this.y2?-1:1;return{x1:a*this.width*.5,x2:a*this.width*-.5,y1:e*this.height*.5,y2:e*this.height*-.5}},toSVG:function(a){var e=this._createBaseSVGMarkup(),b={x1:this.x1,x2:this.x2,y1:this.y1,y2:this.y2};this.group&&"path-group"===this.group.type||(b=this.calcLinePoints());e.push("<line ",'x1="',b.x1,'" y1="',b.y1,'" x2="',b.x2,'" y2="',b.y2,'" style="',
this.getSvgStyles(),'" transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'"/>\n');return a?a(e.join("")):e.join("")},complexity:function(){return 1}}),h.Line.ATTRIBUTE_NAMES=h.SHARED_ATTRIBUTES.concat(["x1","y1","x2","y2"]),h.Line.fromElement=function(a,e){var b=h.parseAttributes(a,h.Line.ATTRIBUTE_NAMES);return new h.Line([b.x1||0,b.y1||0,b.x2||0,b.y2||0],d(b,e))},h.Line.fromObject=function(a){return new h.Line([a.x1,a.y1,a.x2,a.y2],a)})})("undefined"!==typeof k?k:this);(function(g){var c=
g.fabric||(g.fabric={}),h=Math.PI,d=c.util.object.extend;c.Circle?c.warn("fabric.Circle is already defined."):(c.Circle=c.util.createClass(c.Object,{type:"circle",radius:0,startAngle:0,endAngle:2*h,initialize:function(a){a=a||{};this.callSuper("initialize",a);this.set("radius",a.radius||0);this.startAngle=a.startAngle||this.startAngle;this.endAngle=a.endAngle||this.endAngle},_set:function(a,b){this.callSuper("_set",a,b);"radius"===a&&this.setRadius(b);return this},toObject:function(a){return d(this.callSuper("toObject",
a),{radius:this.get("radius"),startAngle:this.startAngle,endAngle:this.endAngle})},toSVG:function(a){var b=this._createBaseSVGMarkup(),f=0,e=0,d=(this.endAngle-this.startAngle)%(2*h);0===d?(this.group&&"path-group"===this.group.type&&(f=this.left+this.radius,e=this.top+this.radius),b.push("<circle ",'cx="'+f+'" cy="'+e+'" ','r="',this.radius,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform()," ",this.getSvgTransformMatrix(),'"/>\n')):b.push('<path d="M '+Math.cos(this.startAngle)*
this.radius+" "+Math.sin(this.startAngle)*this.radius," A "+this.radius+" "+this.radius," 0 ",+(d>h?1:0)+" 1"," "+Math.cos(this.endAngle)*this.radius+" "+Math.sin(this.endAngle)*this.radius,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform()," ",this.getSvgTransformMatrix(),'"/>\n');return a?a(b.join("")):b.join("")},_render:function(a,b){a.beginPath();a.arc(b?this.left+this.radius:0,b?this.top+this.radius:0,this.radius,this.startAngle,this.endAngle,!1);this._renderFill(a);this._renderStroke(a)},
getRadiusX:function(){return this.get("radius")*this.get("scaleX")},getRadiusY:function(){return this.get("radius")*this.get("scaleY")},setRadius:function(a){this.radius=a;this.set("width",2*a).set("height",2*a)},complexity:function(){return 1}}),c.Circle.ATTRIBUTE_NAMES=c.SHARED_ATTRIBUTES.concat(["cx","cy","r"]),c.Circle.fromElement=function(a,b){b||(b={});var f=c.parseAttributes(a,c.Circle.ATTRIBUTE_NAMES);if(!("radius"in f&&0<=f.radius))throw Error("value of `r` attribute is required and can not be negative");
f.left=f.left||0;f.top=f.top||0;f=new c.Circle(d(f,b));f.left-=f.radius;f.top-=f.radius;return f},c.Circle.fromObject=function(a){return new c.Circle(a)})})("undefined"!==typeof k?k:this);(function(g){var c=g.fabric||(g.fabric={});c.Triangle?c.warn("fabric.Triangle is already defined"):(c.Triangle=c.util.createClass(c.Object,{type:"triangle",initialize:function(c){c=c||{};this.callSuper("initialize",c);this.set("width",c.width||100).set("height",c.height||100)},_render:function(c){var d=this.width/
2,a=this.height/2;c.beginPath();c.moveTo(-d,a);c.lineTo(0,-a);c.lineTo(d,a);c.closePath();this._renderFill(c);this._renderStroke(c)},_renderDashedStroke:function(h){var d=this.width/2,a=this.height/2;h.beginPath();c.util.drawDashedLine(h,-d,a,0,-a,this.strokeDashArray);c.util.drawDashedLine(h,0,-a,d,a,this.strokeDashArray);c.util.drawDashedLine(h,d,a,-d,a,this.strokeDashArray);h.closePath()},toSVG:function(c){var d=this._createBaseSVGMarkup(),a=this.width/2,b=this.height/2,a=[-a+" "+b,"0 "+-b,a+" "+
b].join();d.push("<polygon ",'points="',a,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),'"/>');return c?c(d.join("")):d.join("")},complexity:function(){return 1}}),c.Triangle.fromObject=function(h){return new c.Triangle(h)})})("undefined"!==typeof k?k:this);(function(g){var c=g.fabric||(g.fabric={}),h=2*Math.PI,d=c.util.object.extend;c.Ellipse?c.warn("fabric.Ellipse is already defined."):(c.Ellipse=c.util.createClass(c.Object,{type:"ellipse",rx:0,ry:0,initialize:function(a){a=
a||{};this.callSuper("initialize",a);this.set("rx",a.rx||0);this.set("ry",a.ry||0)},_set:function(a,b){this.callSuper("_set",a,b);switch(a){case "rx":this.rx=b;this.set("width",2*b);break;case "ry":this.ry=b,this.set("height",2*b)}return this},getRx:function(){return this.get("rx")*this.get("scaleX")},getRy:function(){return this.get("ry")*this.get("scaleY")},toObject:function(a){return d(this.callSuper("toObject",a),{rx:this.get("rx"),ry:this.get("ry")})},toSVG:function(a){var b=this._createBaseSVGMarkup(),
f=0,e=0;this.group&&"path-group"===this.group.type&&(f=this.left+this.rx,e=this.top+this.ry);b.push("<ellipse ",'cx="',f,'" cy="',e,'" ','rx="',this.rx,'" ry="',this.ry,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'"/>\n');return a?a(b.join("")):b.join("")},_render:function(a,b){a.beginPath();a.save();a.transform(1,0,0,this.ry/this.rx,0,0);a.arc(b?this.left+this.rx:0,b?(this.top+this.ry)*this.rx/this.ry:0,this.rx,0,h,!1);a.restore();this._renderFill(a);
this._renderStroke(a)},complexity:function(){return 1}}),c.Ellipse.ATTRIBUTE_NAMES=c.SHARED_ATTRIBUTES.concat(["cx","cy","rx","ry"]),c.Ellipse.fromElement=function(a,b){b||(b={});var f=c.parseAttributes(a,c.Ellipse.ATTRIBUTE_NAMES);f.left=f.left||0;f.top=f.top||0;f=new c.Ellipse(d(f,b));f.top-=f.ry;f.left-=f.rx;return f},c.Ellipse.fromObject=function(a){return new c.Ellipse(a)})})("undefined"!==typeof k?k:this);(function(g){var c=g.fabric||(g.fabric={}),h=c.util.object.extend;c.Rect?console.warn("fabric.Rect is already defined"):
(g=c.Object.prototype.stateProperties.concat(),g.push("rx","ry","x","y"),c.Rect=c.util.createClass(c.Object,{stateProperties:g,type:"rect",rx:0,ry:0,strokeDashArray:null,initialize:function(d){d=d||{};this.callSuper("initialize",d);this._initRxRy()},_initRxRy:function(){this.rx&&!this.ry?this.ry=this.rx:this.ry&&!this.rx&&(this.rx=this.ry)},_render:function(d,a){if(1===this.width&&1===this.height)d.fillRect(0,0,1,1);else{var b=this.rx?Math.min(this.rx,this.width/2):0,f=this.ry?Math.min(this.ry,this.height/
2):0,e=this.width,c=this.height,h=a?this.left:-this.width/2,g=a?this.top:-this.height/2,k=0!==b||0!==f;d.beginPath();d.moveTo(h+b,g);d.lineTo(h+e-b,g);k&&d.bezierCurveTo(h+e-.4477152502*b,g,h+e,g+.4477152502*f,h+e,g+f);d.lineTo(h+e,g+c-f);k&&d.bezierCurveTo(h+e,g+c-.4477152502*f,h+e-.4477152502*b,g+c,h+e-b,g+c);d.lineTo(h+b,g+c);k&&d.bezierCurveTo(h+.4477152502*b,g+c,h,g+c-.4477152502*f,h,g+c-f);d.lineTo(h,g+f);k&&d.bezierCurveTo(h,g+.4477152502*f,h+.4477152502*b,g,h+b,g);d.closePath();this._renderFill(d);
this._renderStroke(d)}},_renderDashedStroke:function(d){var a=-this.width/2,b=-this.height/2,f=this.width,e=this.height;d.beginPath();c.util.drawDashedLine(d,a,b,a+f,b,this.strokeDashArray);c.util.drawDashedLine(d,a+f,b,a+f,b+e,this.strokeDashArray);c.util.drawDashedLine(d,a+f,b+e,a,b+e,this.strokeDashArray);c.util.drawDashedLine(d,a,b+e,a,b,this.strokeDashArray);d.closePath()},toObject:function(d){d=h(this.callSuper("toObject",d),{rx:this.get("rx")||0,ry:this.get("ry")||0});this.includeDefaultValues||
this._removeDefaultValues(d);return d},toSVG:function(d){var a=this._createBaseSVGMarkup(),b=this.left,f=this.top;this.group&&"path-group"===this.group.type||(b=-this.width/2,f=-this.height/2);a.push("<rect ",'x="',b,'" y="',f,'" rx="',this.get("rx"),'" ry="',this.get("ry"),'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'"/>\n');return d?d(a.join("")):a.join("")},complexity:function(){return 1}}),
c.Rect.ATTRIBUTE_NAMES=c.SHARED_ATTRIBUTES.concat("x y rx ry width height".split(" ")),c.Rect.fromElement=function(d,a){if(!d)return null;a=a||{};var b=c.parseAttributes(d,c.Rect.ATTRIBUTE_NAMES);b.left=b.left||0;b.top=b.top||0;b=new c.Rect(h(a?c.util.object.clone(a):{},b));b.visible=0<b.width&&0<b.height;return b},c.Rect.fromObject=function(d){return new c.Rect(d)})})("undefined"!==typeof k?k:this);(function(g){var c=g.fabric||(g.fabric={});c.Polyline?c.warn("fabric.Polyline is already defined"):
(c.Polyline=c.util.createClass(c.Object,{type:"polyline",points:null,minX:0,minY:0,initialize:function(h,d){return c.Polygon.prototype.initialize.call(this,h,d)},_calcDimensions:function(){return c.Polygon.prototype._calcDimensions.call(this)},_applyPointOffset:function(){return c.Polygon.prototype._applyPointOffset.call(this)},toObject:function(h){return c.Polygon.prototype.toObject.call(this,h)},toSVG:function(h){return c.Polygon.prototype.toSVG.call(this,h)},_render:function(h){c.Polygon.prototype.commonRender.call(this,
h)&&(this._renderFill(h),this._renderStroke(h))},_renderDashedStroke:function(h){var d,a;h.beginPath();for(var b=0,f=this.points.length;b<f;b++)d=this.points[b],a=this.points[b+1]||d,c.util.drawDashedLine(h,d.x,d.y,a.x,a.y,this.strokeDashArray)},complexity:function(){return this.get("points").length}}),c.Polyline.ATTRIBUTE_NAMES=c.SHARED_ATTRIBUTES.concat(),c.Polyline.fromElement=function(h,d){if(!h)return null;d||(d={});var a=c.parsePointsAttribute(h.getAttribute("points")),b=c.parseAttributes(h,
c.Polyline.ATTRIBUTE_NAMES);return new c.Polyline(a,c.util.object.extend(b,d))},c.Polyline.fromObject=function(h){return new c.Polyline(h.points,h,!0)})})("undefined"!==typeof k?k:this);(function(g){var c=g.fabric||(g.fabric={}),h=c.util.object.extend,d=c.util.array.min,a=c.util.array.max,b=c.util.toFixed;c.Polygon?c.warn("fabric.Polygon is already defined"):(c.Polygon=c.util.createClass(c.Object,{type:"polygon",points:null,minX:0,minY:0,initialize:function(a,e){e=e||{};this.points=a||[];this.callSuper("initialize",
e);this._calcDimensions();"top"in e||(this.top=this.minY);"left"in e||(this.left=this.minX)},_calcDimensions:function(){var b=this.points,e=d(b,"x"),c=d(b,"y"),h=a(b,"x"),b=a(b,"y");this.width=h-e||0;this.height=b-c||0;this.minX=e||0;this.minY=c||0},_applyPointOffset:function(){this.points.forEach(function(a){a.x-=this.minX+this.width/2;a.y-=this.minY+this.height/2},this)},toObject:function(a){return h(this.callSuper("toObject",a),{points:this.points.concat()})},toSVG:function(a){for(var e=[],d=this._createBaseSVGMarkup(),
c=0,h=this.points.length;c<h;c++)e.push(b(this.points[c].x,2),",",b(this.points[c].y,2)," ");d.push("<",this.type," ",'points="',e.join(""),'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform()," ",this.getSvgTransformMatrix(),'"/>\n');return a?a(d.join("")):d.join("")},_render:function(a){this.commonRender(a)&&(this._renderFill(a),this.stroke||this.strokeDashArray)&&(a.closePath(),this._renderStroke(a))},commonRender:function(a){var e,b=this.points.length;if(!b||isNaN(this.points[b-
1].y))return!1;a.beginPath();this._applyPointOffset&&(this.group&&"path-group"===this.group.type||this._applyPointOffset(),this._applyPointOffset=null);a.moveTo(this.points[0].x,this.points[0].y);for(var d=0;d<b;d++)e=this.points[d],a.lineTo(e.x,e.y);return!0},_renderDashedStroke:function(a){c.Polyline.prototype._renderDashedStroke.call(this,a);a.closePath()},complexity:function(){return this.points.length}}),c.Polygon.ATTRIBUTE_NAMES=c.SHARED_ATTRIBUTES.concat(),c.Polygon.fromElement=function(a,
e){if(!a)return null;e||(e={});var b=c.parsePointsAttribute(a.getAttribute("points")),d=c.parseAttributes(a,c.Polygon.ATTRIBUTE_NAMES);return new c.Polygon(b,h(d,e))},c.Polygon.fromObject=function(a){return new c.Polygon(a.points,a,!0)})})("undefined"!==typeof k?k:this);(function(g){var c=g.fabric||(g.fabric={}),h=c.util.array.min,d=c.util.array.max,a=c.util.object.extend,b=Object.prototype.toString,f=c.util.drawArc,e={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},k={m:"l",M:"L"};c.Path?c.warn("fabric.Path is already defined"):
(c.Path=c.util.createClass(c.Object,{type:"path",path:null,minX:0,minY:0,initialize:function(a,e){e=e||{};this.setOptions(e);if(!a)throw Error("`path` argument is required");var f="[object Array]"===b.call(a);if(this.path=f?a:a.match&&a.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi))f||(this.path=this._parsePath()),this._setPositionDimensions(),e.sourcePath&&this.setSourcePath(e.sourcePath)},_setPositionDimensions:function(){var a=this._parseDimensions();this.minX=a.left;this.minY=a.top;this.width=a.width;
this.height=a.height;a.left+="center"===this.originX?this.width/2:"right"===this.originX?this.width:0;a.top+="center"===this.originY?this.height/2:"bottom"===this.originY?this.height:0;this.top=this.top||a.top;this.left=this.left||a.left;this.pathOffset=this.pathOffset||{x:this.minX+this.width/2,y:this.minY+this.height/2}},_render:function(a){var e,b=null,d=0,c=0,h=0,g=0,k=0,q=0,l,m,n=-this.pathOffset.x,p=-this.pathOffset.y;this.group&&"path-group"===this.group.type&&(p=n=0);a.beginPath();for(var r=
0,t=this.path.length;r<t;++r){e=this.path[r];switch(e[0]){case "l":h+=e[1];g+=e[2];a.lineTo(h+n,g+p);break;case "L":h=e[1];g=e[2];a.lineTo(h+n,g+p);break;case "h":h+=e[1];a.lineTo(h+n,g+p);break;case "H":h=e[1];a.lineTo(h+n,g+p);break;case "v":g+=e[1];a.lineTo(h+n,g+p);break;case "V":g=e[1];a.lineTo(h+n,g+p);break;case "m":h+=e[1];g+=e[2];d=h;c=g;a.moveTo(h+n,g+p);break;case "M":h=e[1];g=e[2];d=h;c=g;a.moveTo(h+n,g+p);break;case "c":l=h+e[5];m=g+e[6];k=h+e[3];q=g+e[4];a.bezierCurveTo(h+e[1]+n,g+e[2]+
p,k+n,q+p,l+n,m+p);h=l;g=m;break;case "C":h=e[5];g=e[6];k=e[3];q=e[4];a.bezierCurveTo(e[1]+n,e[2]+p,k+n,q+p,h+n,g+p);break;case "s":l=h+e[3];m=g+e[4];null===b[0].match(/[CcSs]/)?(k=h,q=g):(k=2*h-k,q=2*g-q);a.bezierCurveTo(k+n,q+p,h+e[1]+n,g+e[2]+p,l+n,m+p);k=h+e[1];q=g+e[2];h=l;g=m;break;case "S":l=e[3];m=e[4];null===b[0].match(/[CcSs]/)?(k=h,q=g):(k=2*h-k,q=2*g-q);a.bezierCurveTo(k+n,q+p,e[1]+n,e[2]+p,l+n,m+p);h=l;g=m;k=e[1];q=e[2];break;case "q":l=h+e[3];m=g+e[4];k=h+e[1];q=g+e[2];a.quadraticCurveTo(k+
n,q+p,l+n,m+p);h=l;g=m;break;case "Q":l=e[3];m=e[4];a.quadraticCurveTo(e[1]+n,e[2]+p,l+n,m+p);h=l;g=m;k=e[1];q=e[2];break;case "t":l=h+e[1];m=g+e[2];null===b[0].match(/[QqTt]/)?(k=h,q=g):(k=2*h-k,q=2*g-q);a.quadraticCurveTo(k+n,q+p,l+n,m+p);h=l;g=m;break;case "T":l=e[1];m=e[2];null===b[0].match(/[QqTt]/)?(k=h,q=g):(k=2*h-k,q=2*g-q);a.quadraticCurveTo(k+n,q+p,l+n,m+p);h=l;g=m;break;case "a":f(a,h+n,g+p,[e[1],e[2],e[3],e[4],e[5],e[6]+h+n,e[7]+g+p]);h+=e[6];g+=e[7];break;case "A":f(a,h+n,g+p,[e[1],e[2],
e[3],e[4],e[5],e[6]+n,e[7]+p]);h=e[6];g=e[7];break;case "z":case "Z":h=d,g=c,a.closePath()}b=e}this._renderFill(a);this._renderStroke(a)},toString:function(){return"#<fabric.Path ("+this.complexity()+'): { "top": '+this.top+', "left": '+this.left+" }>"},toObject:function(e){e=a(this.callSuper("toObject",e),{path:this.path.map(function(a){return a.slice()}),pathOffset:this.pathOffset});this.sourcePath&&(e.sourcePath=this.sourcePath);this.transformMatrix&&(e.transformMatrix=this.transformMatrix);return e},
toDatalessObject:function(a){a=this.toObject(a);this.sourcePath&&(a.path=this.sourcePath);delete a.sourcePath;return a},toSVG:function(a){for(var e=[],b=this._createBaseSVGMarkup(),f="",d=0,c=this.path.length;d<c;d++)e.push(this.path[d].join(" "));e=e.join(" ");this.group&&"path-group"===this.group.type||(f=" translate("+-this.pathOffset.x+", "+-this.pathOffset.y+") ");b.push("<path ",'d="',e,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),f,this.getSvgTransformMatrix(),'" stroke-linecap="round" ',
"/>\n");return a?a(b.join("")):b.join("")},complexity:function(){return this.path.length},_parsePath:function(){for(var a=[],b=[],f,d,c=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:e[-+]?\d+)?)/ig,h,g=0,l=this.path.length;g<l;g++){f=this.path[g];h=f.slice(1).trim();for(b.length=0;d=c.exec(h);)b.push(d[0]);f=[f.charAt(0)];h=0;for(var m=b.length;h<m;h++)d=parseFloat(b[h]),isNaN(d)||f.push(d);d=f[0];h=e[d.toLowerCase()];m=k[d]||d;if(f.length-1>h)for(var n=1,p=f.length;n<p;n+=h)a.push([d].concat(f.slice(n,n+
h))),d=m;else a.push(f)}return a},_parseDimensions:function(){for(var a=[],e=[],b,f=null,g=0,k=0,q=0,l=0,m=0,n=0,p,r,t,v=0,y=this.path.length;v<y;++v){b=this.path[v];switch(b[0]){case "l":q+=b[1];l+=b[2];t=[];break;case "L":q=b[1];l=b[2];t=[];break;case "h":q+=b[1];t=[];break;case "H":q=b[1];t=[];break;case "v":l+=b[1];t=[];break;case "V":l=b[1];t=[];break;case "m":q+=b[1];l+=b[2];g=q;k=l;t=[];break;case "M":q=b[1];l=b[2];g=q;k=l;t=[];break;case "c":p=q+b[5];r=l+b[6];m=q+b[3];n=l+b[4];t=c.util.getBoundsOfCurve(q,
l,q+b[1],l+b[2],m,n,p,r);q=p;l=r;break;case "C":q=b[5];l=b[6];m=b[3];n=b[4];t=c.util.getBoundsOfCurve(q,l,b[1],b[2],m,n,q,l);break;case "s":p=q+b[3];r=l+b[4];null===f[0].match(/[CcSs]/)?(m=q,n=l):(m=2*q-m,n=2*l-n);t=c.util.getBoundsOfCurve(q,l,m,n,q+b[1],l+b[2],p,r);m=q+b[1];n=l+b[2];q=p;l=r;break;case "S":p=b[3];r=b[4];null===f[0].match(/[CcSs]/)?(m=q,n=l):(m=2*q-m,n=2*l-n);t=c.util.getBoundsOfCurve(q,l,m,n,b[1],b[2],p,r);q=p;l=r;m=b[1];n=b[2];break;case "q":p=q+b[3];r=l+b[4];m=q+b[1];n=l+b[2];t=
c.util.getBoundsOfCurve(q,l,m,n,m,n,p,r);q=p;l=r;break;case "Q":m=b[1];n=b[2];t=c.util.getBoundsOfCurve(q,l,m,n,m,n,b[3],b[4]);q=b[3];l=b[4];break;case "t":p=q+b[1];r=l+b[2];null===f[0].match(/[QqTt]/)?(m=q,n=l):(m=2*q-m,n=2*l-n);t=c.util.getBoundsOfCurve(q,l,m,n,m,n,p,r);q=p;l=r;break;case "T":p=b[1];r=b[2];null===f[0].match(/[QqTt]/)?(m=q,n=l):(m=2*q-m,n=2*l-n);t=c.util.getBoundsOfCurve(q,l,m,n,m,n,p,r);q=p;l=r;break;case "a":t=c.util.getBoundsOfArc(q,l,b[1],b[2],b[3],b[4],b[5],b[6]+q,b[7]+l);q+=
b[6];l+=b[7];break;case "A":t=c.util.getBoundsOfArc(q,l,b[1],b[2],b[3],b[4],b[5],b[6],b[7]);q=b[6];l=b[7];break;case "z":case "Z":q=g,l=k}f=b;t.forEach(function(b){a.push(b.x);e.push(b.y)});a.push(q);e.push(l)}b=h(a);f=h(e);g=d(a);k=d(e);return{left:b,top:f,width:g-b,height:k-f}}}),c.Path.fromObject=function(a,e){"string"===typeof a.path?c.loadSVGFromURL(a.path,function(b){b=b[0];var f=a.path;delete a.path;c.util.object.extend(b,a);b.setSourcePath(f);e(b)}):e(new c.Path(a.path,a))},c.Path.ATTRIBUTE_NAMES=
c.SHARED_ATTRIBUTES.concat(["d"]),c.Path.fromElement=function(e,b,f){e=c.parseAttributes(e,c.Path.ATTRIBUTE_NAMES);b&&b(new c.Path(e.d,a(e,f)))},c.Path.async=!0)})("undefined"!==typeof k?k:this);(function(g){var c=g.fabric||(g.fabric={}),h=c.util.object.extend,d=c.util.array.invoke,a=c.Object.prototype.toObject;c.PathGroup?c.warn("fabric.PathGroup is already defined"):(c.PathGroup=c.util.createClass(c.Path,{type:"path-group",fill:"",initialize:function(a,f){f=f||{};this.paths=a||[];for(var e=this.paths.length;e--;)this.paths[e].group=
this;f.toBeParsed&&(this.parseDimensionsFromPaths(f),delete f.toBeParsed);this.setOptions(f);this.setCoords();f.sourcePath&&this.setSourcePath(f.sourcePath)},parseDimensionsFromPaths:function(a){for(var f,e,d=[],h=[],g,k=this.transformMatrix,l=this.paths.length;l--;)for(f=this.paths[l],e=f.height+f.strokeWidth,g=f.width+f.strokeWidth,f=[{x:f.left,y:f.top},{x:f.left+g,y:f.top},{x:f.left,y:f.top+e},{x:f.left+g,y:f.top+e}],g=0;g<f.length;g++)e=f[g],k&&(e=c.util.transformPoint(e,k,!1)),d.push(e.x),h.push(e.y);
a.width=Math.max.apply(null,d);a.height=Math.max.apply(null,h)},render:function(a){if(this.visible){a.save();this.transformMatrix&&a.transform.apply(a,this.transformMatrix);this.transform(a);this._setShadow(a);this.clipTo&&c.util.clipContext(this,a);a.translate(-this.width/2,-this.height/2);for(var f=0,e=this.paths.length;f<e;++f)this.paths[f].render(a,!0);this.clipTo&&a.restore();this._removeShadow(a);a.restore()}},_set:function(a,f){if("fill"===a&&f&&this.isSameColor())for(var e=this.paths.length;e--;)this.paths[e]._set(a,
f);return this.callSuper("_set",a,f)},toObject:function(b){b=h(a.call(this,b),{paths:d(this.getObjects(),"toObject",b)});this.sourcePath&&(b.sourcePath=this.sourcePath);return b},toDatalessObject:function(a){a=this.toObject(a);this.sourcePath&&(a.paths=this.sourcePath);return a},toSVG:function(a){for(var f=this.getObjects(),e=this.getPointByOrigin("left","top"),e="translate("+e.x+" "+e.y+")",e=["<g ",'style="',this.getSvgStyles(),'" ','transform="',this.getSvgTransformMatrix(),e,this.getSvgTransform(),
'" ',">\n"],d=0,c=f.length;d<c;d++)e.push(f[d].toSVG(a));e.push("</g>\n");return a?a(e.join("")):e.join("")},toString:function(){return"#<fabric.PathGroup ("+this.complexity()+"): { top: "+this.top+", left: "+this.left+" }>"},isSameColor:function(){var a=(this.getObjects()[0].get("fill")||"").toLowerCase();return this.getObjects().every(function(f){return(f.get("fill")||"").toLowerCase()===a})},complexity:function(){return this.paths.reduce(function(a,f){return a+(f&&f.complexity?f.complexity():0)},
0)},getObjects:function(){return this.paths}}),c.PathGroup.fromObject=function(a,f){"string"===typeof a.paths?c.loadSVGFromURL(a.paths,function(e){var d=a.paths;delete a.paths;e=c.util.groupSVGElements(e,a,d);f(e)}):c.util.enlivenObjects(a.paths,function(e){delete a.paths;f(new c.PathGroup(e,a))})},c.PathGroup.async=!0)})("undefined"!==typeof k?k:this);(function(g){var c=g.fabric||(g.fabric={}),h=c.util.object.extend,d=c.util.array.min,a=c.util.array.max,b=c.util.array.invoke;if(!c.Group){var f={lockMovementX:!0,
lockMovementY:!0,lockRotation:!0,lockScalingX:!0,lockScalingY:!0,lockUniScaling:!0};c.Group=c.util.createClass(c.Object,c.Collection,{type:"group",initialize:function(a,b){b=b||{};this._objects=a||[];for(var f=this._objects.length;f--;)this._objects[f].group=this;this.originalState={};this.callSuper("initialize");b.originX&&(this.originX=b.originX);b.originY&&(this.originY=b.originY);this._calcBounds();this._updateObjectsCoords();this.callSuper("initialize",b);this.setCoords();this.saveCoords()},
_updateObjectsCoords:function(){this.forEachObject(this._updateObjectCoords,this)},_updateObjectCoords:function(a){var b=a.getLeft(),f=a.getTop(),d=this.getCenterPoint();a.set({originalLeft:b,originalTop:f,left:b-d.x,top:f-d.y});a.setCoords();a.__origHasControls=a.hasControls;a.hasControls=!1},toString:function(){return"#<fabric.Group: ("+this.complexity()+")>"},addWithUpdate:function(a){this._restoreObjectsState();a&&(this._objects.push(a),a.group=this);this.forEachObject(this._setObjectActive,this);
this._calcBounds();this._updateObjectsCoords();return this},_setObjectActive:function(a){a.set("active",!0);a.group=this},removeWithUpdate:function(a){this._moveFlippedObject(a);this._restoreObjectsState();this.forEachObject(this._setObjectActive,this);this.remove(a);this._calcBounds();this._updateObjectsCoords();return this},_onObjectAdded:function(a){a.group=this},_onObjectRemoved:function(a){delete a.group;a.set("active",!1)},delegatedProperties:{fill:!0,opacity:!0,fontFamily:!0,fontWeight:!0,
fontSize:!0,fontStyle:!0,lineHeight:!0,textDecoration:!0,textAlign:!0,backgroundColor:!0},_set:function(a,b){if(a in this.delegatedProperties)for(var f=this._objects.length;f--;)this._objects[f].set(a,b);this.callSuper("_set",a,b)},toObject:function(a){return h(this.callSuper("toObject",a),{objects:b(this._objects,"toObject",a)})},render:function(a){if(this.visible){a.save();this.clipTo&&c.util.clipContext(this,a);this.transform(a);for(var b=0,f=this._objects.length;b<f;b++)this._renderObject(this._objects[b],
a);this.clipTo&&a.restore();a.restore()}},_renderControls:function(a,b){this.callSuper("_renderControls",a,b);for(var f=0,d=this._objects.length;f<d;f++)this._objects[f]._renderControls(a)},_renderObject:function(a,b){var f=a.hasRotatingPoint;a.visible&&(a.hasRotatingPoint=!1,a.render(b),a.hasRotatingPoint=f)},_restoreObjectsState:function(){this._objects.forEach(this._restoreObjectState,this);return this},realizeTransform:function(a){this._moveFlippedObject(a);this._setObjectPosition(a);return a},
_moveFlippedObject:function(a){var b=a.get("originX"),f=a.get("originY"),d=a.getCenterPoint();a.set({originX:"center",originY:"center",left:d.x,top:d.y});this._toggleFlipping(a);d=a.getPointByOrigin(b,f);a.set({originX:b,originY:f,left:d.x,top:d.y});return this},_toggleFlipping:function(a){this.flipX&&(a.toggle("flipX"),a.set("left",-a.get("left")),a.setAngle(-a.getAngle()));this.flipY&&(a.toggle("flipY"),a.set("top",-a.get("top")),a.setAngle(-a.getAngle()))},_restoreObjectState:function(a){this._setObjectPosition(a);
a.setCoords();a.hasControls=a.__origHasControls;delete a.__origHasControls;a.set("active",!1);a.setCoords();delete a.group;return this},_setObjectPosition:function(a){var b=this.getCenterPoint(),f=this._getRotatedLeftTop(a);a.set({angle:a.getAngle()+this.getAngle(),left:b.x+f.left,top:b.y+f.top,scaleX:a.get("scaleX")*this.get("scaleX"),scaleY:a.get("scaleY")*this.get("scaleY")})},_getRotatedLeftTop:function(a){var b=this.getAngle()*(Math.PI/180);return{left:-Math.sin(b)*a.getTop()*this.get("scaleY")+
Math.cos(b)*a.getLeft()*this.get("scaleX"),top:Math.cos(b)*a.getTop()*this.get("scaleY")+Math.sin(b)*a.getLeft()*this.get("scaleX")}},destroy:function(){this._objects.forEach(this._moveFlippedObject,this);return this._restoreObjectsState()},saveCoords:function(){this._originalLeft=this.get("left");this._originalTop=this.get("top");return this},hasMoved:function(){return this._originalLeft!==this.get("left")||this._originalTop!==this.get("top")},setObjectsCoords:function(){this.forEachObject(function(a){a.setCoords()});
return this},_calcBounds:function(a){for(var b=[],f=[],d,c,h=["tr","br","bl","tl"],g=0,k=this._objects.length;g<k;++g){d=this._objects[g];d.setCoords();for(var l=0;l<h.length;l++)c=h[l],b.push(d.oCoords[c].x),f.push(d.oCoords[c].y)}this.set(this._getBounds(b,f,a))},_getBounds:function(e,b,f){var h=c.util.invertTransform(this.getViewportTransform()),g=c.util.transformPoint(new c.Point(d(e),d(b)),h);e=c.util.transformPoint(new c.Point(a(e),a(b)),h);e={width:e.x-g.x||0,height:e.y-g.y||0};f||(e.left=
g.x||0,e.top=g.y||0,"center"===this.originX&&(e.left+=e.width/2),"right"===this.originX&&(e.left+=e.width),"center"===this.originY&&(e.top+=e.height/2),"bottom"===this.originY&&(e.top+=e.height));return e},toSVG:function(a){for(var b=["<g ",'transform="',this.getSvgTransform(),'">\n'],f=0,d=this._objects.length;f<d;f++)b.push(this._objects[f].toSVG(a));b.push("</g>\n");return a?a(b.join("")):b.join("")},get:function(a){if(a in f){if(this[a])return this[a];for(var b=0,d=this._objects.length;b<d;b++)if(this._objects[b][a])return!0;
return!1}return a in this.delegatedProperties?this._objects[0]&&this._objects[0].get(a):this[a]}});c.Group.fromObject=function(a,b){c.util.enlivenObjects(a.objects,function(f){delete a.objects;b&&b(new c.Group(f,a))})};c.Group.async=!0}})("undefined"!==typeof k?k:this);(function(k){var c=g.util.object.extend;k.fabric||(k.fabric={});k.fabric.Image?g.warn("fabric.Image is already defined."):(g.Image=g.util.createClass(g.Object,{type:"image",crossOrigin:"",alignX:"none",alignY:"none",meetOrSlice:"meet",
_lastScaleX:1,_lastScaleY:1,initialize:function(c,d){d||(d={});this.filters=[];this.resizeFilters=[];this.callSuper("initialize",d);this._initElement(c,d);this._initConfig(d);d.filters&&(this.filters=d.filters,this.applyFilters())},getElement:function(){return this._element},setElement:function(c,d,a){this._originalElement=this._element=c;this._initConfig(a);0!==this.filters.length?this.applyFilters(d):d&&d();return this},setCrossOrigin:function(c){this.crossOrigin=c;this._element.crossOrigin=c;return this},
getOriginalSize:function(){var c=this.getElement();return{width:c.width,height:c.height}},_stroke:function(c){c.save();this._setStrokeStyles(c);c.beginPath();c.strokeRect(-this.width/2,-this.height/2,this.width,this.height);c.closePath();c.restore()},_renderDashedStroke:function(c){var d=-this.width/2,a=-this.height/2,b=this.width,f=this.height;c.save();this._setStrokeStyles(c);c.beginPath();g.util.drawDashedLine(c,d,a,d+b,a,this.strokeDashArray);g.util.drawDashedLine(c,d+b,a,d+b,a+f,this.strokeDashArray);
g.util.drawDashedLine(c,d+b,a+f,d,a+f,this.strokeDashArray);g.util.drawDashedLine(c,d,a+f,d,a,this.strokeDashArray);c.closePath();c.restore()},toObject:function(g){return c(this.callSuper("toObject",g),{src:this._originalElement.src||this._originalElement._src,filters:this.filters.map(function(d){return d&&d.toObject()}),crossOrigin:this.crossOrigin,alignX:this.alignX,alignY:this.alignY,meetOrSlice:this.meetOrSlice})},toSVG:function(c){var d=[],a=-this.width/2,b=-this.height/2,f="none";this.group&&
"path-group"===this.group.type&&(a=this.left,b=this.top);"none"!==this.alignX&&"none"!==this.alignY&&(f="x"+this.alignX+"Y"+this.alignY+" "+this.meetOrSlice);d.push('<g transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'">\n','<image xlink:href="',this.getSvgSrc(),'" x="',a,'" y="',b,'" style="',this.getSvgStyles(),'" width="',this.width,'" height="',this.height,'" preserveAspectRatio="',f,'"',"></image>\n");if(this.stroke||this.strokeDashArray)f=this.fill,this.fill=null,d.push("<rect ",
'x="',a,'" y="',b,'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),'"/>\n'),this.fill=f;d.push("</g>\n");return c?c(d.join("")):d.join("")},getSrc:function(){if(this.getElement())return this.getElement().src||this.getElement()._src},setSrc:function(c,d,a){g.util.loadImage(c,function(b){return this.setElement(b,d,a)},this,a&&a.crossOrigin)},toString:function(){return'#<fabric.Image: { src: "'+this.getSrc()+'" }>'},clone:function(c,d){this.constructor.fromObject(this.toObject(d),
c)},applyFilters:function(c,d,a,b){d=d||this.filters;if(a=a||this._originalElement){var f=a,e=g.util.createCanvasElement(),k=g.util.createImage(),l=this;e.width=f.width;e.height=f.height;e.getContext("2d").drawImage(f,0,0,f.width,f.height);if(0===d.length)return this._element=a,c&&c(),e;d.forEach(function(a){a&&a.applyTo(e,a.scaleX||l.scaleX,a.scaleY||l.scaleY);!b&&a&&"Resize"===a.type&&(l.width*=a.scaleX,l.height*=a.scaleY)});k.width=e.width;k.height=e.height;g.isLikelyNode?(k.src=e.toBuffer(void 0,
g.Image.pngCompression),l._element=k,!b&&(l._filteredEl=k),c&&c()):(k.onload=function(){l._element=k;!b&&(l._filteredEl=k);c&&c();k.onload=e=f=null},k.src=e.toDataURL("image/png"));return e}},_render:function(c,d){var a,b,f=this._findMargins(),e;a=d?this.left:-this.width/2;b=d?this.top:-this.height/2;"slice"===this.meetOrSlice&&(c.beginPath(),c.rect(a,b,this.width,this.height),c.clip());!1===this.isMoving&&this.resizeFilters.length&&this._needsResize()?(this._lastScaleX=this.scaleX,this._lastScaleY=
this.scaleY,e=this.applyFilters(null,this.resizeFilters,this._filteredEl||this._originalElement,!0)):e=this._element;e&&c.drawImage(e,a+f.marginX,b+f.marginY,f.width,f.height);this._renderStroke(c)},_needsResize:function(){return this.scaleX!==this._lastScaleX||this.scaleY!==this._lastScaleY},_findMargins:function(){var c=this.width,d=this.height,a=0,b=0;if("none"!==this.alignX||"none"!==this.alignY)c=[this.width/this._element.width,this.height/this._element.height],d="meet"===this.meetOrSlice?Math.min.apply(null,
c):Math.max.apply(null,c),c=this._element.width*d,d*=this._element.height,"Mid"===this.alignX&&(a=(this.width-c)/2),"Max"===this.alignX&&(a=this.width-c),"Mid"===this.alignY&&(b=(this.height-d)/2),"Max"===this.alignY&&(b=this.height-d);return{width:c,height:d,marginX:a,marginY:b}},_resetWidthHeight:function(){var c=this.getElement();this.set("width",c.width);this.set("height",c.height)},_initElement:function(c){this.setElement(g.util.getById(c));g.util.addClass(this.getElement(),g.Image.CSS_CANVAS)},
_initConfig:function(c){c||(c={});this.setOptions(c);this._setWidthHeight(c);this._element&&this.crossOrigin&&(this._element.crossOrigin=this.crossOrigin)},_initFilters:function(c,d){c.filters&&c.filters.length?g.util.enlivenObjects(c.filters,function(a){d&&d(a)},"fabric.Image.filters"):d&&d()},_setWidthHeight:function(c){this.width="width"in c?c.width:this.getElement()?this.getElement().width||0:0;this.height="height"in c?c.height:this.getElement()?this.getElement().height||0:0},complexity:function(){return 1}}),
g.Image.CSS_CANVAS="canvas-img",g.Image.prototype.getSvgSrc=g.Image.prototype.getSrc,g.Image.fromObject=function(c,d){g.util.loadImage(c.src,function(a){g.Image.prototype._initFilters.call(c,c,function(b){c.filters=b||[];b=new g.Image(a,c);d&&d(b)})},null,c.crossOrigin)},g.Image.fromURL=function(c,d,a){g.util.loadImage(c,function(b){d&&d(new g.Image(b,a))},null,a&&a.crossOrigin)},g.Image.ATTRIBUTE_NAMES=g.SHARED_ATTRIBUTES.concat("x y width height preserveAspectRatio xlink:href".split(" ")),g.Image.fromElement=
function(h,d,a){h=g.parseAttributes(h,g.Image.ATTRIBUTE_NAMES);var b="xMidYMid",f="meet",e;h.preserveAspectRatio&&(e=h.preserveAspectRatio.split(" "));e&&e.length&&(f=e.pop(),"meet"!==f&&"slice"!==f?(b=f,f="meet"):e.length&&(b=e.pop()));e="none"!==b?b.slice(1,4):"none";b="none"!==b?b.slice(5,8):"none";h.alignX=e;h.alignY=b;h.meetOrSlice=f;g.Image.fromURL(h["xlink:href"],d,c(a?g.util.object.clone(a):{},h))},g.Image.async=!0,g.Image.pngCompression=1)})("undefined"!==typeof k?k:this);(function(g){var c=
g.fabric||(g.fabric={}),h=c.util.object.extend,d=c.util.object.clone,a=c.util.toFixed,b=c.StaticCanvas.supports("setLineDash");c.Text?c.warn("fabric.Text is already defined"):(g=c.Object.prototype.stateProperties.concat(),g.push("fontFamily","fontWeight","fontSize","text","textDecoration","textAlign","fontStyle","lineHeight","textBackgroundColor"),c.Text=c.util.createClass(c.Object,{_dimensionAffectingProps:{fontSize:!0,fontWeight:!0,fontFamily:!0,fontStyle:!0,lineHeight:!0,stroke:!0,strokeWidth:!0,
text:!0,textAlign:!0},_reNewline:/\r?\n/,type:"text",fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",textDecoration:"",textAlign:"left",fontStyle:"",lineHeight:1.16,textBackgroundColor:"",stateProperties:g,stroke:null,shadow:null,_fontSizeFraction:.25,_fontSizeMult:1.13,initialize:function(a,e){e=e||{};this.text=a;this.__skipDimension=!0;this.setOptions(e);this.__skipDimension=!1;this._initDimensions()},_initDimensions:function(a){if(!this.__skipDimension){a||(a=c.util.createCanvasElement().getContext("2d"),
this._setTextStyles(a));this._textLines=this.text.split(this._reNewline);this._clearCache();var e=this.textAlign;this.textAlign="left";this.width=this._getTextWidth(a);this.textAlign=e;this.height=this._getTextHeight(a)}},toString:function(){return"#<fabric.Text ("+this.complexity()+'): { "text": "'+this.text+'", "fontFamily": "'+this.fontFamily+'" }>'},_render:function(a){this.clipTo&&c.util.clipContext(this,a);this._renderTextBackground(a);this._renderText(a);this._renderTextDecoration(a);this.clipTo&&
a.restore()},_renderText:function(a){a.save();this._translateForTextAlign(a);this._setOpacity(a);this._setShadow(a);this._setupCompositeOperation(a);this._renderTextFill(a);this._renderTextStroke(a);this._restoreCompositeOperation(a);this._removeShadow(a);a.restore()},_translateForTextAlign:function(a){"left"!==this.textAlign&&"justify"!==this.textAlign&&a.translate("center"===this.textAlign?this.width/2:this.width,0)},_setTextStyles:function(a){a.textBaseline="alphabetic";this.skipTextAlign||(a.textAlign=
this.textAlign);a.font=this._getFontDeclaration()},_getTextHeight:function(){return this._textLines.length*this._getHeightOfLine()},_getTextWidth:function(a){for(var e=this._getLineWidth(a,0),b=1,c=this._textLines.length;b<c;b++){var d=this._getLineWidth(a,b);d>e&&(e=d)}return e},_renderChars:function(a,e,b,c,d){e[a](b,c,d)},_renderTextLine:function(a,e,b,c,d,g){d-=this.fontSize*this._fontSizeFraction;if("justify"!==this.textAlign)this._renderChars(a,e,b,c,d,g);else{var h=this._getLineWidth(e,g),
k=this.width;if(k>=h){h=b.split(/\s+/);b=this._getWidthOfWords(e,b,g);for(var k=(k-b)/(h.length-1),l=b=0,m=h.length;l<m;l++)this._renderChars(a,e,h[l],c+b,d,g),b+=e.measureText(h[l]).width+k}else this._renderChars(a,e,b,c,d,g)}},_getWidthOfWords:function(a,b){return a.measureText(b.replace(/\s+/g,"")).width},_getLeftOffset:function(){return-this.width/2},_getTopOffset:function(){return-this.height/2},_renderTextFill:function(a){if(this.fill||this._skipFillStrokeCheck){for(var b=0,c=0,d=this._textLines.length;c<
d;c++){var g=this._getHeightOfLine(a,c),h=g/this.lineHeight;this._renderTextLine("fillText",a,this._textLines[c],this._getLeftOffset(),this._getTopOffset()+b+h,c);b+=g}this.shadow&&!this.shadow.affectStroke&&this._removeShadow(a)}},_renderTextStroke:function(a){if(this.stroke&&0!==this.strokeWidth||this._skipFillStrokeCheck){var e=0;a.save();this.strokeDashArray&&(1&this.strokeDashArray.length&&this.strokeDashArray.push.apply(this.strokeDashArray,this.strokeDashArray),b&&a.setLineDash(this.strokeDashArray));
a.beginPath();for(var c=0,d=this._textLines.length;c<d;c++){var g=this._getHeightOfLine(a,c),h=g/this.lineHeight;this._renderTextLine("strokeText",a,this._textLines[c],this._getLeftOffset(),this._getTopOffset()+e+h,c);e+=g}a.closePath();a.restore()}},_getHeightOfLine:function(){return this.fontSize*this._fontSizeMult*this.lineHeight},_renderTextBackground:function(a){this._renderTextBoxBackground(a);this._renderTextLinesBackground(a)},_renderTextBoxBackground:function(a){this.backgroundColor&&(a.save(),
a.fillStyle=this.backgroundColor,a.fillRect(this._getLeftOffset(),this._getTopOffset(),this.width,this.height),a.restore())},_renderTextLinesBackground:function(a){var b=0,c=this._getHeightOfLine();if(this.textBackgroundColor){a.save();a.fillStyle=this.textBackgroundColor;for(var d=0,g=this._textLines.length;d<g;d++){if(""!==this._textLines[d]){var h=this._getLineWidth(a,d),k=this._getLineLeftOffset(h);a.fillRect(this._getLeftOffset()+k,this._getTopOffset()+b,h,this.fontSize*this._fontSizeMult)}b+=
c}a.restore()}},_getLineLeftOffset:function(a){return"center"===this.textAlign?(this.width-a)/2:"right"===this.textAlign?this.width-a:0},_clearCache:function(){this.__lineWidths=[];this.__lineHeights=[];this.__lineOffsets=[]},_shouldClearCache:function(){var a=!1,b;for(b in this._dimensionAffectingProps)this["__"+b]!==this[b]&&(this["__"+b]=this[b],a=!0);return a},_getLineWidth:function(a,b){if(this.__lineWidths[b])return this.__lineWidths[b];this.__lineWidths[b]=a.measureText(this._textLines[b]).width;
return this.__lineWidths[b]},_renderTextDecoration:function(a){if(this.textDecoration){var b=this.height/2,c=[];-1<this.textDecoration.indexOf("underline")&&c.push(.85);-1<this.textDecoration.indexOf("line-through")&&c.push(.43);-1<this.textDecoration.indexOf("overline")&&c.push(-.12);if(0<c.length){var d,g=0,h,k,l;d=0;for(h=this._textLines.length;d<h;d++){var m=this._getLineWidth(a,d),n=this._getLineLeftOffset(m),p=this._getHeightOfLine(a,d);k=0;for(l=c.length;k<l;k++)a.fillRect(this._getLeftOffset()+
n,g+(this._fontSizeMult-1+c[k])*this.fontSize-b,m,this.fontSize/15);g+=p}}}},_getFontDeclaration:function(){return[c.isLikelyNode?this.fontWeight:this.fontStyle,c.isLikelyNode?this.fontStyle:this.fontWeight,this.fontSize+"px",c.isLikelyNode?'"'+this.fontFamily+'"':this.fontFamily].join(" ")},render:function(a,b){this.visible&&(a.save(),this._setTextStyles(a),this._shouldClearCache()&&this._initDimensions(a),b||this.transform(a),this._setStrokeStyles(a),this._setFillStyles(a),this.transformMatrix&&
a.transform.apply(a,this.transformMatrix),this.group&&"path-group"===this.group.type&&a.translate(this.left,this.top),this._render(a),a.restore())},toObject:function(a){a=h(this.callSuper("toObject",a),{text:this.text,fontSize:this.fontSize,fontWeight:this.fontWeight,fontFamily:this.fontFamily,fontStyle:this.fontStyle,lineHeight:this.lineHeight,textDecoration:this.textDecoration,textAlign:this.textAlign,textBackgroundColor:this.textBackgroundColor});this.includeDefaultValues||this._removeDefaultValues(a);
return a},toSVG:function(a){var b=this._createBaseSVGMarkup(),c=this._getSVGLeftTopOffsets(this.ctx),c=this._getSVGTextAndBg(c.textTop,c.textLeft);this._wrapSVGTextAndBg(b,c);return a?a(b.join("")):b.join("")},_getSVGLeftTopOffsets:function(a){a=this._getHeightOfLine(a,0);return{textLeft:-this.width/2+(this.group&&"path-group"===this.group.type?this.left:0),textTop:0+(this.group&&"path-group"===this.group.type?-this.top:0),lineTop:a}},_wrapSVGTextAndBg:function(a,b){a.push('\t<g transform="',this.getSvgTransform(),
this.getSvgTransformMatrix(),'">\n',b.textBgRects.join(""),"\t\t<text ",this.fontFamily?'font-family="'+this.fontFamily.replace(/"/g,"'")+'" ':"",this.fontSize?'font-size="'+this.fontSize+'" ':"",this.fontStyle?'font-style="'+this.fontStyle+'" ':"",this.fontWeight?'font-weight="'+this.fontWeight+'" ':"",this.textDecoration?'text-decoration="'+this.textDecoration+'" ':"",'style="',this.getSvgStyles(),'" >',b.textSpans.join(""),"</text>\n","\t</g>\n")},_getSVGTextAndBg:function(a,b){var c=[],d=[],g=
0;this._setSVGBg(d);for(var h=0,k=this._textLines.length;h<k;h++)this.textBackgroundColor&&this._setSVGTextLineBg(d,h,b,a,g),this._setSVGTextLineText(h,c,g,b,a,d),g+=this._getHeightOfLine(this.ctx,h);return{textSpans:c,textBgRects:d}},_setSVGTextLineText:function(b,e,d,g,h){d=this.fontSize*(this._fontSizeMult-this._fontSizeFraction)-h+d-this.height/2;e.push('<tspan x="',a(g+this._getLineLeftOffset(this.__lineWidths[b]),4),'" ','y="',a(d,4),'" ',this._getFillAttributes(this.fill),">",c.util.string.escapeXml(this._textLines[b]),
"</tspan>")},_setSVGTextLineBg:function(b,e,c,d,g){b.push("\t\t<rect ",this._getFillAttributes(this.textBackgroundColor),' x="',a(c+this._getLineLeftOffset(this.__lineWidths[e]),4),'" y="',a(g-this.height/2,4),'" width="',a(this.__lineWidths[e],4),'" height="',a(this._getHeightOfLine(this.ctx,e)/this.lineHeight,4),'"></rect>\n')},_setSVGBg:function(b){this.backgroundColor&&b.push("\t\t<rect ",this._getFillAttributes(this.backgroundColor),' x="',a(-this.width/2,4),'" y="',a(-this.height/2,4),'" width="',
a(this.width,4),'" height="',a(this.height,4),'"></rect>\n')},_getFillAttributes:function(a){var b=a&&"string"===typeof a?new c.Color(a):"";return b&&b.getSource()&&1!==b.getAlpha()?'opacity="'+b.getAlpha()+'" fill="'+b.setAlpha(1).toRgb()+'"':'fill="'+a+'"'},_set:function(a,b){this.callSuper("_set",a,b);a in this._dimensionAffectingProps&&(this._initDimensions(),this.setCoords())},complexity:function(){return 1}}),c.Text.ATTRIBUTE_NAMES=c.SHARED_ATTRIBUTES.concat("x y dx dy font-family font-style font-weight font-size text-decoration text-anchor".split(" ")),
c.Text.DEFAULT_SVG_FONT_SIZE=16,c.Text.fromElement=function(a,b){if(!a)return null;var d=c.parseAttributes(a,c.Text.ATTRIBUTE_NAMES);b=c.util.object.extend(b?c.util.object.clone(b):{},d);b.top=b.top||0;b.left=b.left||0;"dx"in d&&(b.left+=d.dx);"dy"in d&&(b.top+=d.dy);"fontSize"in b||(b.fontSize=c.Text.DEFAULT_SVG_FONT_SIZE);b.originX||(b.originX="left");var d=a.textContent.replace(/^\s+|\s+$|\n+/g,"").replace(/\s+/g," "),d=new c.Text(d,b),g=0;"left"===d.originX&&(g=d.getWidth()/2);"right"===d.originX&&
(g=-d.getWidth()/2);d.set({left:d.getLeft()+g,top:d.getTop()-d.getHeight()/2+d.fontSize*(.18+d._fontSizeFraction)});return d},c.Text.fromObject=function(a){return new c.Text(a.text,d(a))},c.util.createAccessors(c.Text))})("undefined"!==typeof k?k:this);delete window.fabric;return k}().fabric;k.fabric=l}}});(function(){var k=N(n.com.fabricjs).fabric,l=v(y([13,27,32])),p=l[0],g=l[1],m=l[2],c=C("Attribute",[K],{get __init__(){return r(this,function(a,b){a.game=b;a.game.attributes.append(a);a.install();
a.reset()})},get reset(){return r(this,function(a){a.commit()})},get predict(){return r(this,function(a){})},get interact(){return r(this,function(a){})},get commit(){return r(this,function(a){})}}),h=C("Sprite",[c],{get __init__(){return r(this,function(a,b,d,f){a.width=d;a.height=f;c.__init__(a,b)})},get install(){return r(this,function(a){a.image=new k.Rect({width:a.game.scaleX(a.width),height:a.game.scaleY(a.height),originX:"center",originY:"center",fill:"white"})})},get reset(){return r(this,
function(a,b,d,f,g){if("undefined"==typeof b||null!=b&&b.__class__==t)b=0;if("undefined"==typeof d||null!=d&&d.__class__==t)d=0;if("undefined"==typeof f||null!=f&&f.__class__==t)f=0;if("undefined"==typeof g||null!=g&&g.__class__==t)g=0;if(arguments.length){var h=arguments.length-1;if(arguments[h]&&arguments[h].__class__==t){var h=arguments[h--],k;for(k in h)switch(k){case "self":a=h[k];break;case "vX":b=h[k];break;case "vY":d=h[k];break;case "x":f=h[k];break;case "y":g=h[k]}}}a.vX=b;a.vY=d;a.x=f;
a.y=g;c.reset(a)})},get predict(){return r(this,function(a){a.x+=a.vX*a.game.deltaT;a.y+=a.vY*a.game.deltaT})},get commit(){return r(this,function(a){a.image.left=a.game.orthoX(a.x);a.image.top=a.game.orthoY(a.y)})},get draw(){return r(this,function(a){a.game.canvas.add(a.image)})}}),d=C("Paddle",[h],{get __init__(){return r(this,function(a,b,c){a.index=c;h.__init__(a,b,a.width,a.height)})},get reset(){return r(this,function(a){h.reset(a,t({x:a.index?Math.floor(1E3)/Math.floor(2)-a.margin:Math.floor(-1E3)/
Math.floor(2)+a.margin,y:0}))})},get predict(){return r(this,function(a){a.vY=0;a.index?F(M("K"),a.game.keySet)?a.vY=a.speed:F(M("M"),a.game.keySet)&&(a.vY=-a.speed):F(M("A"),a.game.keySet)?a.vY=a.speed:F(M("Z"),a.game.keySet)&&(a.vY=-a.speed);h.predict(a)})},get interact(){return r(this,function(a){a.y=Math.max(Math.floor(a.height)/Math.floor(2)-Math.floor(650)/Math.floor(2),Math.min(a.y,Math.floor(650)/Math.floor(2)-Math.floor(a.height)/Math.floor(2)));a.y-Math.floor(a.height)/Math.floor(2)<a.game.ball.y&&
a.game.ball.y<a.y+Math.floor(a.height)/Math.floor(2)&&(0==a.index&&a.game.ball.x<a.x||1==a.index&&a.game.ball.x>a.x)&&(a.game.ball.x=a.x,a.game.ball.vX=-a.game.ball.vX,a.game.ball.speedUp(a))})}});d.margin=30;d.width=10;d.height=100;d.speed=400;var a=C("Ball",[h],{get __init__(){return r(this,function(a,b){h.__init__(a,b,a.side,a.side)})},get reset(){return r(this,function(a){var b=a.game.serviceIndex*Math.PI+(.5<Math.random()?1:-1)*Math.random()*Math.atan(.65);h.reset(a,t({vX:a.speed*Math.cos(b),
vY:a.speed*Math.sin(b)}))})},get predict(){return r(this,function(a){h.predict(a);a.x<Math.floor(-1E3)/Math.floor(2)?a.game.scored(1):a.x>Math.floor(1E3)/Math.floor(2)&&a.game.scored(0);a.y>Math.floor(650)/Math.floor(2)?(a.y=Math.floor(650)/Math.floor(2),a.vY=-a.vY):a.y<Math.floor(-650)/Math.floor(2)&&(a.y=Math.floor(-650)/Math.floor(2),a.vY=-a.vY)})},get speedUp(){return r(this,function(a,b){var c=1+.15*Math.pow(1-Math.abs(a.y-b.y)/Math.floor(b.height)/Math.floor(2),2);Math.abs(a.vX)<3*a.speed&&
(a.vX*=c,a.vY*=c)})}});a.side=8;a.speed=300;var b=C("Scoreboard",[c],{get install(){return r(this,function(a){for(var b=[],c=v(y([v(y(["AZ keys:",-.4375])),v(y(["KM keys:",.0625]))])),d=0;d<c.length;d++){var f=c[d],g=f[1];b.append(new k.Text("Player {}".format(f[0]),{fill:"white",fontFamily:"arial",fontSize:"30",left:a.game.orthoX(1E3*g),top:a.game.orthoY(Math.floor(650)/Math.floor(2)+a.nameShift)}))}a.playerLabels=b;a.hintLabel=new k.Text("[spacebar] starts game, [enter] resets score",{fill:"white",
fontFamily:"arial",fontSize:"12",left:a.game.orthoX(-437.5),top:a.game.orthoY(Math.floor(650)/Math.floor(2)+a.hintShift)});a.image=new k.Line(y([a.game.orthoX(Math.floor(-1E3)/Math.floor(2)),a.game.orthoY(Math.floor(650)/Math.floor(2)),a.game.orthoX(Math.floor(1E3)/Math.floor(2)),a.game.orthoY(Math.floor(650)/Math.floor(2))]),{stroke:"white"})})},get increment(){return r(this,function(a,b){a.scores[b]++})},get reset(){return r(this,function(a){a.scores=y([0,0]);c.reset(a)})},get commit(){return r(this,
function(a){for(var b=[],c=O(a.scores,v(y([-.125,.375]))),d=0;d<c.length;d++){var f=c[d],g=f[1];b.append(new k.Text("{}".format(f[0]),{fill:"white",fontFamily:"arial",fontSize:"30",left:a.game.orthoX(1E3*g),top:a.game.orthoY(Math.floor(650)/Math.floor(2)+a.nameShift)}))}a.scoreLabels=b})},get draw(){return r(this,function(a){for(var b=O(a.playerLabels,a.scoreLabels),c=0;c<b.length;c++){var d=b[c],f=d[1];a.game.canvas.add(d[0]);a.game.canvas.add(f);a.game.canvas.add(a.hintLabel)}a.game.canvas.add(a.image)})}});
b.nameShift=75;b.hintShift=25;var l=C("Game",[K],{get __init__(){return r(this,function(c){c.serviceIndex=.5<Math.random()?1:0;c.pause=!0;c.keySet=I();c.canvas=new k.Canvas("canvas",{backgroundColor:"black",originX:"center",originY:"center"});c.canvas.onWindowResise=c.resize;c.canvas.onWindowDraw=c.draw;c.canvas.lineWidth=2;c.canvas.clear();c.attributes=y([]);for(var f=[],g=P(2),h=0;h<g.length;h++)f.append(d(c,g[h]));c.paddles=f;c.ball=a(c);c.scoreboard=b(c);window.setInterval(c.update,10);window.setInterval(c.draw,
20);window.addEventListener("keydown",c.keydown);window.addEventListener("keyup",c.keyup);c.time=+new Date})},get update(){return r(this,function(a){var b=a.time;a.time=+new Date;a.deltaT=(a.time-b)/1E3;if(a.pause)F(m,a.keySet)?a.pause=!1:F(p,a.keySet)&&a.scoreboard.reset();else{for(var b=a.attributes,c=0;c<b.length;c++){var d=b[c];d.predict()}b=a.attributes;for(c=0;c<b.length;c++)d=b[c],d.interact();b=a.attributes;for(c=0;c<b.length;c++)d=b[c],d.commit()}})},get scored(){return r(this,function(a,
b){a.scoreboard.increment(b);a.serviceIndex=1-b;for(var c=a.paddles,d=0;d<c.length;d++)c[d].reset();a.ball.reset();a.pause=!0})},get draw(){return r(this,function(a){a.canvas.clear();a=a.attributes;for(var b=0;b<a.length;b++)a[b].draw()})},get resize(){return r(this,function(a,b,c){})},get scaleX(){return r(this,function(a,b){return b*a.canvas.width/1E3})},get scaleY(){return r(this,function(a,b){return b*a.canvas.height/750})},get orthoX(){return r(this,function(a,b){return a.scaleX(b+Math.floor(1E3)/
Math.floor(2))})},get orthoY(){return r(this,function(a,b){return a.scaleY(750-Math.floor(650)/Math.floor(2)-b)})},get keydown(){return r(this,function(a,b){a.keySet.add(b.keyCode)})},get keyup(){return r(this,function(a,b){a.keySet.remove(b.keyCode)})}}),f=l();n.Attribute=c;n.Ball=a;n.Game=l;n.Paddle=d;n.Scoreboard=b;n.Sprite=h;n.enter=p;n.esc=g;n.fieldHeight=650;n.game=f;n.orthoHeight=750;n.orthoWidth=1E3;n.space=m})();return n}window.pong=pong();
